(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{112:function(e,t,a){e.exports=a(204)},117:function(e,t,a){},204:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(17),o=a.n(r),l=a(3),i=a(4),c=a(8),u=a(6),p=a(7),h=(a(117),a(213)),m=a(214),f=a(219),d=a(215),v=a(218),g=a(206),b=a(207),k=a(216),y=a(208),E=a(209),O=a(210),x=a(220),j=a(211),w=a(59),q=a(212),S=a(217),C=a(16),N=a(221),_=a(205),A=a(77),M=a.n(A),T=a(63),P=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function W(e){if(F.swState("register"),"serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return void F.swState("unregistered");window.addEventListener("load",function(){F.swState("load");var t="".concat("","/service-worker.js");P?(F.swState("load_localhost"),function(e,t){fetch(e).then(function(a){404===a.status||-1===a.headers.get("content-type").indexOf("javascript")?(F.swState("noserviceworker"),navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})})):z(e,t)}).catch(function(){F.swState("error_local"),console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){F.swState("loaded_local"),console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):(F.swState("load_production"),z(t,e))})}}function z(e,t){F.swState("registering"),navigator.serviceWorker.register(e).then(function(e){F.swState("registered"),e.onupdatefound=function(){F.swState("updatefound");var a=e.installing;a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available; please refresh."),F.swState("newcontent"),t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),F.swState("cached"),t.onSuccess&&t.onSuccess(e)))}}}).catch(function(e){F.swState("error"),console.error("Error during service worker registration:",e)})}function Q(e){var t,a=F.data.tests.questions;if(e&&!a[e])console.error("questionTopics",e),t=[];else if(e&&a[e].topics){var n=a[e].topics.split(",")[0];t=[{topic:n.substr(0,n.length-1),level:1*n.substr(n.length-1,1)}]}else t=[];return t}function D(){var e={topics:{},levels:{}};return Object.keys(F.data.tests.questions).forEach(function(t){Q(t).forEach(function(a){var n=a.topic,s=a.level;e.topics[n]||(e.topics[n]={}),e.levels[s]||(e.levels[s]={}),e.topics[n][s]?e.topics[n][s].push(t):e.topics[n][s]=[t],e.levels[s][n]?e.levels[s][n].push(t):e.levels[s][n]=[t]})}),e}var F=new(function(){function e(){var t=this;Object(l.a)(this,e),this.vers=function(){var e="";return t.versions&&!t.versions.test?(e="freemaths:"+t.version,["help","tests","books","past"].forEach(function(a){e+=" "+a+(":"+re(1e3*t.versions[a].ts)+" "+t.versions[a].size).replace(/ /g,"_")})):e=t.versions.test?"tesining":"not set",e},this.setUser=function(e){var a=t.user;a.logout||(a.logout={name:a.name,id:a.id,log:a.log,token:a.token});var n=t.log.filter(function(t){return t.user_id===1*e});a.name=t.students[e].name,a.id=1*e,a.log=n,a.token=null,a.isAdmin=a.isTutor=!1,t.parent.setState({page:null,message:{type:"success",text:"Switched user to: "+a.name,close:t.logout}})},this.login=function(e,a){ce("/react_ajax/login",function(e){e.error?a(e.data):(t.versions=e.data.versions,t.user=t.store_user(e.data.user),t.ready())},e)},this.lastLogId=function(){return t.user&&t.user.log.length?t.user.log[t.user.log.length-1].id:0},this.password=function(e,a,n){ce("/react_ajax/password",function(e){e.error?n(e.data):(t.versions=e.data.versions,t.user=t.store_user(e.data.user,t.user),t.ready(),a())},{password:e,lastLogId:t.lastLogId()})},this.register=function(e,a,n){ce("/react_ajax/"+(t.user?"update":"register"),function(e){e.error?n(e.data):t.user?(t.user.email=e.data.email,t.user.name=e.data.name,a({type:"success",text:"Details updated"})):a({type:"success",text:"Account registered. Use Test to check you knowledge."})},e)},this.mail=function(e,a,n){ce("/react_ajax/mail",function(e){e.error?n({type:"danger",text:e.data.error}):(t.user&&t.user.log.push(e.data.log),a(JSON.parse(e.data.message)))},{token:e})},this.contact=function(e,a,n,s){ce("/react_ajax/contact",function(e){e.error?s(e.data):(t.user&&t.user.log.push(e.data.log),n({type:"success",text:a?"Reply sent.":"Message sent. We aim to respond within 24 hours."}))},e)},this.logout=function(){t.user.logout?(t.user.id=t.user.logout.id,t.user.name=t.user.logout.name,t.user.log=t.user.logout.log,t.user.token=t.user.logout.token,t.user.isAdmin=t.user.isTutor=!0,t.user.logout=null,t.parent.setState({page:"Students",message:{type:"success",text:"Switched user to:"+t.user.name}})):(ce("/react_ajax/logout"),t.clear_user(),t.user=null,t.parent.setState({ready:!1,page:null,message:null,password:!1}))},this.reset=function(e,t,a){ce("/react_ajax/reset",function(e){e.error?a(e.data):t({type:"success",text:"Your password has been reset."})},e)},this.updateLog=function(e){L("updateLog")&&console.log("updateLog(l)",e),t.user&&ce("/react_ajax/log_event",function(a){var n=null;a.error&&(n={type:"danger",text:"Working offline - work will not be logged"}),a.data.log||(a.data.log={id:t.lastLogId()+1,event:e.event,paper:e.paper,question:e.question,created_at:(new Date).toISOString(),variables:JSON.stringify(e.vars),answer:e.answer?e.answer:"",comment:e.comment?e.comment:"",user_id:t.user.id}),t.user.log.push(a.data.log),n?t.parent.setState({message:n}):t.parent.setState({message:null})},{log:e})},this.saveQ=function(e){0===e.id&&(e.id=Math.max.apply(Math,Object(T.a)(Object.keys(t.data.tests.questions)))+1),t.data.tests.questions[e.id]=e;var a=le(t.data.tests);ce("/react_ajax/save",function(e){t.data.tests.ts=e.data.versions.tests.ts,window.localStorage.setItem("FMtests",a)},{data:{tests:a}})},this.qNew=function(){var e=Math.max.apply(Math,Object(T.a)(Object.keys(t.data.tests.questions)))+1;return t.data.tests.questions[e]={id:e,topic:"",question:"",working:"",answer:"",help:"",variables:"",topics:""},e},this.saveBook=function(e){e.id||(e.id=Math.max.apply(Math,Object(T.a)(Object.keys(t.data.books).filter(function(e){return!isNaN(e)})))+1);var a={},n={};e.chapters.forEach(function(e){return e.exercises.forEach(function(t){a[e.chapter]||(a[e.chapter]={},n[e.chapter]={}),a[e.chapter][t.exercise]=t.qs,n[e.chapter][t.exercise]={};for(var s=0;s<t.qs.length;s++)n[e.chapter][t.exercise][t.qs[s].q]=s})}),t.data.books[e.id]={id:e.id,type:"book",title:e.name+"_"+e.board,book:e,qmap:{qs:a,q:n}};var s=le(t.data.books);return window.localStorage.setItem("FMbooks",s),ce("/react_ajax/save",null,{data:{books:s}}),e},this.getUsers=function(e,a){ce("react_ajax/users",function(n){if(n.error)a(n.data.error);else{var s={};ie(n.data.users).forEach(function(e){s[e.id]=e}),ie(n.data.log).forEach(function(e){e.user_id&&(s[e.user_id].visited_at=e.ts)}),t.users=s,e(s)}})},this.send=function(e,a,n){var s={freemaths:{version:t.version}};["help","tests","books","past"].forEach(function(e){var a=le(t.data[e]);a===t.zips[e]?s[e]={version:t.data[e].version,size:t.zips[e].length}:(t.data[e].version===t.versions[e].version&&(t.data[e].version++,a=le(t.data[e])),s[e]={version:t.data[e].version,size:a.length,change:a.length-t.zips[e].length,zip:a})}),n?n(s):ce("/react_ajax/update_data",function(t){t.error?a({type:"danger",text:"Server Error: "+t.data.error}):e({type:"success",text:"Data updated"})},{updates:s})},this.marking=function(e,a,n,s){ce("/react_ajax/marking",function(e){e.error?s(e.data.error):(t.user.log.push(e.data.log),n())},{test_id:e,info:a})},this.version=7,this.versions=null,this.state=null,this.user=null,this.data={},this.cache={},this.parent=null,this.students=null,this.log=null,this.got=!1}return Object(i.a)(e,[{key:"serviceWorker",value:function(e,t){var a=this;this.parent=e,["help","tests","books","past"].forEach(function(e){return a.loadFile(e)}),this.loadUser(),t?W({onUpdate:this.onUpdate,onSuccess:this.onSuccess}):(F.swState("unregister"),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()}))}},{key:"onUpdate",value:function(e){this.parent.setState({ready:!1,message:{type:"danger",text:"Software Updating - page will reload"}}),setTimeout(function(){window.location.reload()},2e3)}},{key:"onSuccess",value:function(e){this.parent.setState({type:"success",text:"Content is cached for offline use."}),this.ready()}},{key:"ready",value:function(e){var t=this,a=!0;if(this.versions&&!this.versions.test&&this.version!==this.versions.freemaths.version)console.log("freemaths",this.version,this.versions),this.parent.setState({message:{type:"danger",text:"FreeMaths requires updating - please reload - version:"+this.version+" latest:"+this.versions.freemaths.version}});else{if(e)return this.data&&this.data.help&&this.data.tests&&this.data.books&&this.data.past;this.data&&this.data.help&&this.data.tests&&this.data.books&&this.data.past&&this.versions?(this.versions.test||["tests","help","past","books"].forEach(function(e){t.data[e].ts!==t.versions[e].ts&&(t.data[e].ts<t.versions[e].ts?(a!==t.parent.state.ready&&t.parent.setState({message:{type:"danger",text:e+" requires updating - reloading. Current:"+re(1e3*t.data[e].ts)+" latest:"+re(1e3*t.versions[e].ts)}}),a=!1):console.log("version (local newer)",e,re(1e3*t.data[e].ts),re(1e3*t.versions[e].ts),t.data[e].ts,t.versions[e].ts))}),a?(this.parent.state.message&&this.parent.setState({message:null}),console.log("versions",this.vers())):this.got||this.getFiles(),a!==this.parent.state.ready&&this.parent.setState({ready:a&&null!==this.user})):((a=!1)!==this.parent.state.ready&&this.parent.setState({ready:a}),this.got||this.getFiles())}}},{key:"swState",value:function(e){this.state=e,console.log("FM Service Worker: ",e)}},{key:"loadFile",value:function(e){window.localStorage.getItem("FM"+e)&&(this.data[e]=ie(window.localStorage.getItem("FM"+e)),"tests"===e&&(this.cache.qTree=D()))}},{key:"getFiles",value:function(){var e=this;this.got=!0,["tests","help","past","books"].forEach(function(t){var a=e.versions.test?t+".gz":"";(!e.data[t]||!e.data[t].ts||e.versions[t].ts>e.data[t].ts)&&ce("react_ajax/get_file/"+a,function(a){a.error?e.parent.setState({message:{type:"danger",text:t+" Error: "+a.data.error}}):(e.versions.test||a.data.file)&&(console.log("getFiles",t,a.data.ts),e.data[t]=ie(a.data.file?a.data.file:a.data),a.data.ts&&e.data[t]&&a.data.ts!==e.data[t].ts?(e.data[t].ts=a.data.ts,window.localStorage.setItem("FM"+t,le(e.data[t]))):e.versions.test||window.localStorage.setItem("FM"+t,a.data.file),"tests"===t&&(e.cache.qTree=D()),e.versions.test||e.versions[t].ts===e.data[t].ts?(e.ready(!1),e.parent&&e.parent.message&&e.parent.setState({message:null})):e.parent.setState({message:{type:"danger",text:t+" version Error"}}))},{name:t,ts:e.data[t]?e.data[t].ts:0})})}},{key:"loadUser",value:function(){var e=this;this.user=this.load_user(),this.user?ce("/react_ajax/user",function(t){t.error?e.parent.setState({message:{type:"danger",text:"user Error: "+t.data.error}}):(e.versions=t.data.versions,"password"===t.data.user?e.parent.setState({password:!0}):e.user=e.store_user(t.data.user,e.user)),e.data.help?e.ready():e.getFiles()},{id:this.user.id,token:this.user.token,lastLogId:this.lastLogId()},this.user.token):ce("/react_ajax/versions",function(t){t.error?e.parent.setState({message:{type:"danger",text:"versions Error: "+t.data.error}}):e.versions=t.data.versions,e.versions.debug&&(console.log("debug",e.versions.debug),H(e.versions.debug)),e.data.help?e.ready():e.getFiles()})}},{key:"store_user",value:function(e,t){var a;if(t&&t.id===e.id&&(e.log=t.log.concat(e.log)),window.localStorage)try{a=le(e),window.localStorage.setItem("FMuser",a)}catch(n){console.error("user not stored",n.name,a,e)}return e.debug&&(e.debug.split(" ").forEach(function(e){return H(e)}),console.log("set_debug",e.debug)),e}},{key:"clear_user",value:function(){window.localStorage&&window.localStorage.removeItem("FMuser")}},{key:"load_user",value:function(){var e=null;if(window.localStorage&&window.localStorage.FMuser)try{(e=ie(window.localStorage.getItem("FMuser"))).id||(e=null)}catch(t){console.error("failed to unzip user from localStorage",t),window.localStorage.removeItem("FMuser"),e=null}return e}},{key:"getPhoto",value:function(e,t){ce("react_ajax/photo",function(e){if(e.error)console.log("photo error:",e.error);else{var a=JSON.parse(e.data.photo.json);a.id=e.data.photo.id,t(a)}},{photoId:e})}},{key:"photo",value:function(e){var t=this;ce("react_ajax/photo",function(e){e.error?console.log("photo error:",e.error):(t.user.log.push(e.data.log),t.parent.update())},{photo:e})}},{key:"help",value:function(e){this.updateLog({event:"Help",paper:"",question:"",variables:"",answer:e,comment:""})}},{key:"getStudents",value:function(e,t){var a=this;console.log("getStudents",e),ce("/react_ajax/students",function(n){if(n.error)a.parent.setState({message:{type:"danger",text:"Server Error: "+n.data.error,page:"Home"}});else{var s={},r=ie(n.data.log);ie(n.data.users).forEach(function(e){s[e.id]=e}),r.length?(a.students=s,a.log=r,t?t(!0):a.parent.setState({students:!0})):(a.students=null,a.parent.setState({message:{type:"danger",text:"Data Error"}})),console.log("getStudents",e,Object.keys(s).length,s)}},{all:e})}},{key:"setChallenge",value:function(e,t){var a=this;ce("/react_ajax/challenge",function(e){e.error?a.parent.setState({message:{type:"danger",text:"Server Error: "+e.data.error}}):t(!0)},{challenges:e})}}]),e}()),I={};function L(e){if(I[e]?I[e].n++:(I[e]={n:1},Object.keys(I).forEach(function(t){t!==e&&e.startsWith(t)&&I[t].show&&(I[e].show=!0)})),I[e].show)return!0}function H(){for(var e=arguments,t=function(){var t=e[a];I[t]?I[t].show=!I[t].show:I[t]={n:0,show:!0},Object.keys(I).forEach(function(e){e!==t&&e.startsWith(t)&&(I[e].show=!0)})},a=0;a<arguments.length;a++)t()}function B(e){return 0!==e?F.data.tests.questions[e]:{id:0,topic:"",question:"",working:"",answer:"",help:"",variables:"",topics:""}}function U(e,t){var a=e;if(t){var n=R(t);n&&n.qs&&n.qs.length&&n.qs.forEach(function(t){t&&1*t.qid===1*e&&(a=t.qn)})}return a}function R(e,t){var a=F.data;"string"===typeof e&&e.indexOf(":")>0&&(e=e.split(":")[0]);var n=a.tests.tests[e]?a.tests.tests[e]:a.books[e]?a.books[e]:a.past[e]?a.past[e]:null;if(0===e||"0"===e||null===e&&t){var s=t?B(t):null;n=s&&s.topics?{id:0,type:"var",title:s.topics.split(",")[0]}:{id:0,type:"vars",title:"Adaptive"}}return L("test")&&console.log("test(p,qid)=",e,t,n,F.data),n}function J(e,t,a,n){if(!e)return null;if("string"===typeof e&&e.indexOf(":")>0){var r=e.split(":"),o=Object(C.a)(r,4),l=o[0],i=o[1],c=o[2],u=o[3];e=l}var p=R(e)?R(e).title.replace(/Edexcel_/,"").replace(/B(1|2)_/,"").replace(/_/g," "):e;return Y(c)&&""!==c?p+=" "+c:Y(i)&&""!==i&&(p+=" "+i),a&&(p=""),Y(u)&&t&&(p+=" Q"+u),F.user&&F.user.isAdmin&&n&&(p=s.a.createElement(K,{tooltip:e},p)),p}var $=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){if("undefined"!==typeof this.props.save)var e=s.a.createElement(S.a.Footer,null,s.a.createElement(w.a,{className:"btn btn-sm btn-primary",onClick:this.props.save.fn},this.props.save.text));else e=null;return s.a.createElement(S.a,{show:!0,name:this.props.name,bsSize:"large",onHide:this.props.close},s.a.createElement(S.a.Header,{closeButton:!0},s.a.createElement(S.a.Title,null,this.props.title)),s.a.createElement(S.a.Body,null,this.props.children),e)}}]),t}(n.Component);function V(){return F.user&&F.user.isMobile?"large":"medium"}var K=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return F.user&&F.user.isMobile?s.a.createElement("span",{className:this.props.className},this.props.children):s.a.createElement(N.a,{placement:this.props.placement?this.props.placement:"top",overlay:s.a.createElement(_.a,{id:"tooltip"},this.props.tooltip)},s.a.createElement("span",{className:this.props.className},this.props.children))}}]),t}(n.Component),G=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return F.user&&F.user.isMobile?s.a.createElement("span",{className:this.props.className?this.props.className:"btn-link",onClick:this.props.onClick},this.props.children):s.a.createElement(N.a,{placement:"top",overlay:s.a.createElement(_.a,{id:"tooltip"},this.props.tooltip)},s.a.createElement("span",{className:this.props.className?this.props.className:"btn-link",onClick:this.props.onClick},this.props.children))}}]),t}(n.Component);function X(e){return e===Object(e)?JSON.parse(JSON.stringify(e)):e}function Y(e){return"undefined"!==typeof e&&null!==e}function Z(e){return"undefined"===typeof e||null===e||0===e.length}function ee(e){return e[0].toUpperCase()+e.substr(1,e.length-1)}function te(e){var t=e.getDate();t<10&&(t="0"+t);var a=e.getMonth()+1;return a<10&&(a="0"+a),t+"/"+a}function ae(e){var t=e.getHours();t<10&&(t="0"+t);var a=e.getMinutes();return a<10&&(a="0"+a),t+":"+a}function ne(e,t){if(!Y(e)||0===e)return"";var a=new Date(1*e);return t?function(e){var t=e.getDate();t<10&&(t="0"+t);var a=e.getMonth()+1;a<10&&(a="0"+a);var n=e.getFullYear()%100;return n<10&&(n="0"+n),t+"/"+a+"/"+n}(a):te(a)}function se(e){return new Date(e.replace(" ","T")).getTime()}function re(e){var t=new Date(1*e);return te(t)+" "+ae(t)}function oe(e,t){if(!Y(e))return"";"undefined"===typeof t&&(t="");var a=Math.floor(e/1e3);if(0===a)return"";var n=Math.floor(a/60);a-=60*n;var s=Math.floor(n/60);if(n-=60*s,a<10&&(a="0"+a),s>0){n<10&&(n="0"+n);var r=s+":"+n+":"+a}else r=n+":"+a;return t+r}function le(e){var t=btoa(M.a.deflate(JSON.stringify(e),{to:"string"}));return L("zip")&&console.log("zip",e,JSON.stringify(e).length,t.length),t}function ie(e){var t=JSON.parse(M.a.inflate(atob(e),{to:"string"}));return L("unzip")&&console.log("unzip",t,JSON.stringify(t).length,e.length),t}a(181);function ce(e,t,a,n){L("ajax")&&console.log("ajax",e,X(a));var s=!1;fetch(e,function(e,t){var a;a=e?{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","Content-Type":"application/json","FM-Token":t||(F.user?F.user.token:null)},method:"post",cache:"no-cache",body:JSON.stringify(e)}:{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","FM-Token":F.user?F.user.token:null,"FM-Env":JSON.stringify(Object({NODE_ENV:"production",PUBLIC_URL:""}))},method:"get",cache:"no-cache"};return a}(a,n)).then(function(t){return t.ok||(s=t.statusText),e.endsWith(".gz")?t.text():t.json()}).then(function(e){t&&t({error:s,data:e})}).catch(function(a){console.error(e,s),t&&t({error:a,data:{error:s||a.message}})})}var ue=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={email:"",password:"",remember:!!a.props.app,error:{}},a.error=function(e){a.setState({error:e})},a.login=function(e){e.preventDefault(),F.login(a.state,a.error)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(g.a,null,s.a.createElement(b.a,{smOffset:2,sm:8},s.a.createElement(k.a,null,s.a.createElement(k.a.Heading,null,s.a.createElement(k.a.Title,{componentClass:"h3"},"Login")),s.a.createElement(k.a.Body,null,this.state.error.error?s.a.createElement("div",{className:"alert alert-danger"},s.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,s.a.createElement(y.a,{onSubmit:this.login,horizontal:!0},s.a.createElement(E.a,{controlId:"formEmail",validationState:this.state.error.email?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Email"),s.a.createElement(b.a,{sm:9},s.a.createElement(x.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.setState({email:t.target.value,error:""})}})),this.state.error.email?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.email)):null),s.a.createElement(E.a,{controlId:"formPassword",validationState:this.state.error.password?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Password"),s.a.createElement(b.a,{sm:9},s.a.createElement(x.a,{type:"password",name:"password",value:this.state.password,placeholder:"Password",onChange:function(t){return e.setState({password:t.target.value,error:""})}})),this.state.error.password?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.password)):null),s.a.createElement(E.a,null,s.a.createElement(b.a,{smOffset:2,sm:4},s.a.createElement(w.a,{name:"login",bsStyle:"primary",type:"submit"},s.a.createElement("i",{className:"fa fa-btn fa-sign-in"})," Login")),s.a.createElement(b.a,{sm:4},s.a.createElement(w.a,{name:"forgot",bsStyle:"link",onClick:function(t){t.currentTarget.blur(),e.props.modal("forgot",e.state.email)}},"Forgot your password?"))),s.a.createElement(E.a,null,s.a.createElement(b.a,{smOffset:2,sm:4},s.a.createElement(q.a,{checked:!!this.state.remember,onChange:function(){return e.setState({remember:!e.state.remember})}},"remember me")),s.a.createElement(b.a,{sm:4},s.a.createElement(w.a,{name:"register",bsStyle:"link",onClick:function(t){t.currentTarget.blur(),e.props.modal("register")}},s.a.createElement("i",{className:"fa fa-btn fa-user"}),"Register"))))))))}}]),t}(n.Component),pe=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={email:a.props.email?a.props.email:"",error:{},sending:!1},a.send=function(e){e.preventDefault(),a.setState({sending:!0}),ce("/react_ajax/forgot",function(e){e.error?a.setState({error:e.data,sending:!1}):a.props.close({type:"success",text:"We have e-mailed your password reset link!"})},{email:a.state.email})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(S.a,{name:"forgot",show:!0,onHide:function(){return e.props.close()}},s.a.createElement(S.a.Header,{closeButton:!0},s.a.createElement(S.a.Title,null,"Reset Password")),s.a.createElement(S.a.Body,null,this.state.sending?s.a.createElement("div",{className:"alert alert-success"},s.a.createElement("strong",null,"Sending...")):null,this.state.error.error?s.a.createElement("div",{className:"alert alert-danger"},s.a.createElement("strong",null,"Error: ",this.state.error.error)):null,s.a.createElement(y.a,{onSubmit:this.send,horizontal:!0},s.a.createElement(E.a,{controlId:"formHorizontalEmail",validationState:this.state.error.email?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Email"),s.a.createElement(b.a,{sm:9},s.a.createElement(x.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.setState({email:t.target.value,error:{}})}})),""===this.state.error.email?null:s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.email))),s.a.createElement(E.a,null,s.a.createElement(b.a,{smOffset:2,sm:6},s.a.createElement(w.a,{bsStyle:"primary",type:"submit"},s.a.createElement("i",{className:"fa fa-btn fa-envelope"})," Send Password Reset Link"))))))}}]),t}(n.Component),he=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={email:"",password:"",password_confirmation:"",error:{}},a.error=function(e){return a.setState({error:e})},a.reset=function(e){e.preventDefault();var t={email:a.state.email,password:a.state.password,password_confirmation:a.state.password_confirmation,token:a.props.token};F.reset(t,a.props.close,a.error)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(S.a,{name:"reset",show:!0,onHide:function(){return e.props.close()}},s.a.createElement(S.a.Header,{closeButton:!0},s.a.createElement(S.a.Title,null,"Reset Password")),s.a.createElement(S.a.Body,null,this.state.error.error?s.a.createElement("div",{className:"alert alert-danger"},s.a.createElement("strong",null,"Error: ",this.state.error.error)):null,this.state.error.token?s.a.createElement("div",{className:"alert alert-danger"},s.a.createElement("strong",null,"Error: ",this.state.error.token)):null,s.a.createElement(y.a,{onSubmit:this.reset,horizontal:!0},s.a.createElement(E.a,{controlId:"email1",validationState:this.state.error.email?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Email"),s.a.createElement(b.a,{sm:9},s.a.createElement(x.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.setState({email:t.target.value,error:{}})}})),this.state.error.email?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.email)):null),s.a.createElement(E.a,{controlId:"password1",validationState:this.state.error.password?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Password"),s.a.createElement(b.a,{sm:9},s.a.createElement(x.a,{type:"password",name:"password",value:this.state.password,placeholder:"Password",onChange:function(t){return e.setState({password:t.target.value,error:{}})}})),Y(this.state.error.password)?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.password)):null),s.a.createElement(E.a,{controlId:"confirm1",validationState:this.state.error.password_confirmation?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Confirm"),s.a.createElement(b.a,{sm:9},s.a.createElement(x.a,{type:"password",name:"password_confirmation",value:this.state.password_confirmation,placeholder:"Password",onChange:function(t){return e.setState({password_confirmation:t.target.value,error:{}})}})),this.state.error.password_confirmation?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.password_confirmation)):null),s.a.createElement(E.a,null,s.a.createElement(b.a,{smOffset:2,sm:4},s.a.createElement(w.a,{bsStyle:"primary",type:"submit"},s.a.createElement("i",{className:"fa fa-btn fa-refresh"})," Reset Password"))))))}}]),t}(n.Component),me=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={password:"",error:{}},a.error=function(e){return a.setState({error:e})},a.password=function(e){e.preventDefault(),F.password(a.state.password,a.props.auth,a.error)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(S.a,{name:"password",show:!0,onHide:function(){return e.props.close()}},s.a.createElement(S.a.Header,{closeButton:!0},s.a.createElement(S.a.Title,null,"Enter Password")),s.a.createElement(S.a.Body,null,this.state.error.error?s.a.createElement("div",{className:"alert alert-danger"},s.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,s.a.createElement(y.a,{onSubmit:this.password,horizontal:!0},s.a.createElement(E.a,{controlId:"password",validationState:this.state.error.password?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Password"),s.a.createElement(b.a,{sm:9},s.a.createElement(x.a,{type:"password",name:"password",value:this.state.password,placeholder:"Password",onChange:function(t){return e.setState({password:t.target.value,error:""})}})),this.state.error.password?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.password)):null),s.a.createElement(E.a,null,s.a.createElement(b.a,{smOffset:2,sm:4},s.a.createElement(w.a,{bsStyle:"primary",type:"submit"},s.a.createElement("i",{className:"fa fa-btn fa-sign-in"})," Confirm")),F.user?null:s.a.createElement(b.a,{sm:4},s.a.createElement(w.a,{bsStyle:"link",onClick:function(){return e.props.close()}},"Switch user?"))))))}}]),t}(n.Component),fe=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={auth:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return this.state.auth?s.a.createElement(de,{close:this.props.close}):s.a.createElement(me,{close:this.props.close,auth:function(){return e.setState({auth:!0})}})}}]),t}(n.Component),de=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state=F.user?{name:F.user.name,email:F.user.email,password:"",password_confirmation:"",error:{},pw:!1}:{name:"",email:"",password:"",password_confirmation:"",error:{},pw:!0},a.error=function(e){return a.setState({error:e})},a.register=function(e){e.preventDefault(),F.register(a.state,a.props.close,a.error)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"update",value:function(e,t){var a=this.state;a[e]=t,Y(a.error[e])&&delete a.error[e],this.setState(a)}},{key:"render",value:function(){var e=this;return s.a.createElement(S.a,{name:"register",show:!0,onHide:function(){return e.props.close()}},s.a.createElement(S.a.Header,{closeButton:!0},s.a.createElement(S.a.Title,null,F.user?"Update Details":"Register")),s.a.createElement(S.a.Body,null,this.state.error.error?s.a.createElement("div",{className:"alert alert-danger"},s.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,s.a.createElement(y.a,{onSubmit:this.register,horizontal:!0},s.a.createElement(E.a,{controlId:"formName",validationState:Y(this.state.error.name)?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Name"),s.a.createElement(b.a,{sm:9},s.a.createElement(x.a,{type:"name",name:"name",value:this.state.name,placeholder:"First Last",onChange:function(t){return e.update("name",t.target.value)}})),Y(this.state.error.name)?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.name)):null),s.a.createElement(E.a,{controlId:"formEmail",validationState:Y(this.state.error.email)?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Email"),s.a.createElement(b.a,{sm:9},s.a.createElement(x.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.update("email",t.target.value)}})),Y(this.state.error.email)?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.email)):null),this.state.pw?s.a.createElement("div",null,s.a.createElement(E.a,{controlId:"formPassword",validationState:Y(this.state.error.password)?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Password"),s.a.createElement(b.a,{sm:9},s.a.createElement(x.a,{type:"password",name:"password",value:this.state.password,placeholder:F.user?"New Password":"Password",onChange:function(t){return e.update("password",t.target.value)}})),Y(this.state.error.password)?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.password)):null),s.a.createElement(E.a,{controlId:"formConfirm",validationState:Y(this.state.error.password_confirmation)?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Confirm"),s.a.createElement(b.a,{sm:9},s.a.createElement(x.a,{type:"password",name:"password_confirmation",value:this.state.password_confirmation,placeholder:F.user?"New Password":"Password",onChange:function(t){return e.update("password_confirmation",t.target.value)}})),Y(this.state.error.password_confirmation)?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.password_confirmation)):null)):s.a.createElement(E.a,null,s.a.createElement(b.a,{sm:4},s.a.createElement(w.a,{bsStyle:"link",onClick:function(t){e.setState({pw:!0})}},"Change password?"))),s.a.createElement(E.a,null,s.a.createElement(b.a,{smOffset:2,sm:4},s.a.createElement(w.a,{bsStyle:"primary",type:"submit"},s.a.createElement("i",{className:"fa fa-btn fa-user"})," ",F.user?"Update":"Register"))))))}}]),t}(n.Component),ve=a(28);function ge(e){return"string"===typeof e&&-1!==e.indexOf("?")}function be(e){var t=_e(e);return!(!t.d||0===t.d)}function ke(e,t){return!!(Ye(e)||be(e)||t&&""===e)}function ye(e,t,a){var n,s,r,o,l=null;if(L("evaluate")&&(s=X(t),n=X(a)),be(e)||qt(e)||ge(e))l=e;else if(Ye(e))l=1*e;else if(et(e))l=Te(e,t,a);else if(e){var i=ke(e.left,!0)?Ee(e.left):ye(e.left,t),c=ke(e.right)?Ee(e.right):ye(e.right,t);ge(c)?l=c:ge(i)?l=i:Ye(i)&&Ye(c)?l=je(i,c,e.op):Ze(i)&&","===e.op&&c.endsWith("bin")?l=function(e,t){var a=Number(e).toString(2),n=t.substr(0,t.length-3);n>a.length&&(a="0".repeat(n-a.length)+a);return a}(i,c):be(i)&&(r=c,o=e.op,be(r)||","===o&&"bin"!==r&&"dp"!==r&&"sf"!==r&&qt(r))?l=Me(ot(i,e.op,c)):""===i&&be(c)?l=Me(ot(0,e.op,c)):ke(i,!0)&&ke(c)?l=je(Oe(i),Oe(c),e.op):" "!==e.op||"bin"!==c&&"dp"!==c&&"sf"!==c||!Ze(i)?ke(i)&&","===e.op&&xe(c)?l=function(e,t){var a=e;if(Ye(e)&&xe(t)){var n=t.substr(0,t.length-2);a=t.endsWith("dp")?(1*e).toFixed(n):(1*e).toPrecision(1*n>0?n:1)}else a=""+e+t;return a}(Oe(i),c):(Array.isArray(i)||Array.isArray(c))&&(l=function(e,t,a){var n,s,r=[];L("eval_multi")&&(n=X(e),s=X(a));Array.isArray(e)?r=e.map(function(e){return ye({left:e,op:t,right:a})}):Array.isArray(a)&&(r=a.map(function(a){return ye({left:e,op:t,right:a})}));r.length&&(r=r.map(function(e){return st(e)?Ae(_e(e)):e}));L("eval_multi")&&console.log("eval_multi",X(r),n,t,s);return r}(i,e.op,c)):l=""+i+c}else console.error("evaluate",e,t,a,(new Error).stack);return L("evaluate")&&console.log("evaluate(t,vars)=",l,e,s,n,t,a),l}function Ee(e){var t,a=e;return(t=_e(e))?a=Ae(we(t)):Ye(e)&&(a=1*e),a}function Oe(e){var t,a=e;return(t=_e(e))&&(a=t.n/t.d),a}function xe(e){return"string"===typeof e&&(e.endsWith("dp")||e.endsWith("sf"))}function je(e,t,a){var n=0;switch(a){case"+":case"\u02fd":n=1*e+1*t;break;case"\xb1":n=[1*e+1*t,1*e-1*t];break;case"-":n=e-t;break;case"*":case" ":case"(":case"\xd7":n=e*t;break;case"\xf7":case"/":n=1*t!==0?Ze(e)&&Ze(t)?Ee(e+"/"+t):e/t:"?"+e+"/0";break;case"^":n=Math.pow(e,t);break;case"|":n=Math.abs(t);break;case"\u221a":n=t>=0?Math.pow(t,.5):"?\u221a"+t;break;case"~":n=Pe(1*e,1*t);break;case"=":n=pt?1*e===1*t?1:0:"@"+e+"="+t;break;case"\u2260":n=pt?1*e===1*t?0:1:"@"+e+"\u2260"+t;break;case">":n=pt?1*e>1*t?1:0:"@"+e+">"+t;break;case"<":n=pt?1*e<1*t?1:0:"@"+e+"<"+t;break;case"\u2265":n=pt?1*e>=1*t?1:0:"@"+e+"\u2265"+t;break;case"\u2264":n=pt?1*e<=1*t?1:0:"@"+e+"\u2264"+t;break;case",":n=[e,t];break;default:n=kt(a)?function(e,t){var a,n,s="",r=e.indexOf("^");r>0&&(s=e.substring(r+2,e.length-1),e=e.substring(0,r),1*s===-1&&(e="a"+e));if(Ye(t))if(n=Et(e))a=Math.log2(t)/Math.log2(n);else switch(e){case"sin":a=Math.sin(t);break;case"cos":a=Math.cos(t);break;case"tan":a=Math.tan(t);break;case"cosec":a=1/Math.sin(t);break;case"sec":a=1/Math.cos(t);break;case"cot":a=1/Math.tan(t);break;case"asin":a=Math.asin(t);break;case"acos":a=Math.acos(t);break;case"atan":a=Math.atan(t);break;case"acosec":a=Math.asin(1/t);break;case"asec":a=Math.acos(1/t);break;case"acot":a=Math.atan(1/t);break;case"ln":a=Math.log(t);break;default:console.error("evaluate not yet supported",e,t),a=[e,t]}else a=[e,t];s>0&&(a=Math.pow(a,s));return a.toString()}(a,t):"@@"+e+a+t}return n}function we(e){var t=Pe(e.n,e.d),a=e.d<0?-1:1;return{n:e.n*a/t,d:e.d*a/t}}function qe(e,t){return we({n:e.n*t.d+t.n*e.d,d:e.d*t.d})}function Se(e,t){return we({n:e.n*t.n,d:e.d*t.d})}function Ce(e,t){var a,n,s;if("numerator"===t)a=e.n;else if("denominator"===t)a=e.d;else if("whole"===t)a=Math.floor(e.n/e.d);else if("fractional"===t)a={n:e.n-Math.floor(e.n/e.d)*e.d,d:e.d};else if("improper"===t)a=e.n>e.d?1:0;else{var r=(n=e.d,s=t.d,n*s/Pe(n,s)/e.d);a={n:e.n*r,d:e.d*r}}return a}function Ne(e){var t=!1;if("string"===typeof e&&-1!==e.indexOf("/")){var a=e.split("/"),n=Object(C.a)(a,2),s=n[0],r=n[1],o=0,l=1;if(-1!==s.indexOf("\u02fd")){var i=s.split("\u02fd"),c=Object(C.a)(i,2);o=c[0],s=c[1],o*=l=o<0?-1:1}else s*=l=s<0?-1:1;Ze(o)&&Ze(s)&&Ze(r)&&(t=ot(1*s,"/",1*r),o&&(t=ot(o,"\u02fd",t)),l<0&&(t=ot("","-",t)))}return L("stof")&&console.log("stof(s)=",X(t),X(e)),t||e}function _e(e,t){var a=!1;if(t&&qt(e))a=e;else if(Ze(e))a={n:1*e,d:1};else if("string"===typeof e&&-1!==e.indexOf("/")){var n=e.split("/"),s=Object(C.a)(n,2),r=s[0],o=s[1],l=0;if(-1!==r.indexOf("\u02fd")){var i=r.split("\u02fd"),c=Object(C.a)(i,2);l=c[0],r=c[1]}var u=l<0?-1:1;Ze(l)&&Ze(r)&&Ze(o)&&(a={n:l*o+r*u,d:1*o})}return L("stof")&&console.log("stof(s)=",X(a),X(e)),a}function Ae(e,t){var a,n=X(e),s=n.n<0?-1:1,r=Math.floor(n.n*s/n.d);return a=1===n.d?n.n:t&&0!==r?(s>0?"":"-")+r+"\u02fd"+(n.n*s-r*n.d)+"/"+n.d:n.n+"/"+n.d,L("ftos")&&console.log("ftos(f,mixed)",a,e,t),a}function Me(e){var t=e,a=!1,n=_e(e.left),s=_e(e.right,","===e.op);if(!1!==n&&!1!==s)switch(e.op){case"\u02fd":a=!0,t=n.n<0?qe(n,{n:-s.n,d:s.d}):qe(n,s);break;case"+":t=qe(n,s);break;case"-":a=0===n.n&&"string"===typeof e.right&&-1!==e.right.indexOf("\u02fd"),t=qe(n,{n:-s.n,d:s.d});break;case"\xb1":t=[Ae(qe(n,s)),Ae(qe(n,{n:-s.n,d:s.d}))];break;case"*":case"(":case" ":case"\xd7":t=Se(n,s);break;case"\xf7":case"/":t=Se(n,{n:s.d,d:s.n});break;case"^":t=function(e,t){var a=we(e),n=we(t),s=!1;return n.n<0&&(n.n=-n.n,s=!0),n.d>1&&(a={n:Math.pow(a.n,1/n.d),d:Math.pow(a.d,1/n.d)}),a={n:Math.pow(a.n,n.n),d:Math.pow(a.d,n.n)},s&&(a={n:a.d,d:a.n}),Ze(a.n)&&Ze(a.d)||(a=Math.pow(e.n/e.d,t.n/t.d)),L("frac_pow")&&console.log("frac_pow(f1,f2)=",a,X(e),X(t)),a}(n,s);break;case",":"mixed"===s?(a=!0,t=n):qt(s)?t=Ce(n,s):(L("warn")&&console.log(", fractions",n,s),t=[Ae(n),Ae(s)]);break;case"//":t=Ce(n,s);break;case"~":t=1===n.d&&1===s.d?Pe(n.n,s.n):{n:n.n/Pe(n.n,s.d),d:n.d/Pe(n.d,s.n)};break;case"=":t=n.n===s.n&&n.d===s.d?1:0;break;case"\u2260":t=n.n===s.n&&n.d===s.d?0:1;break;case">":t=n.n*s.d>s.n*n.d?1:0;break;case"<":t=n.n*s.d<s.n*n.d?1:0;break;case"\u2265":t=n.n*s.d>=s.n*n.d?1:0;break;case"\u2264":t=n.n*s.d<=s.n*n.d?1:0;break;default:t=je(n.n/n.d,s.n/s.d,e.op)}return t&&t.d?t=Ae(t,a):0===t.d&&(t="?"+t.n+"/0"),L("fraction_op")&&console.log("fraction_op(t)=",t,X(e)),t}function Te(e,t,a){var n;L("substitute")&&(n=X(a));var s=e;return!function(e,t){return t&&wt(e,t)&&t.substitute&&void 0===t[e]&&(t[e]=.1234567+Object.keys(t).length),"string"===typeof e&&t&&void 0!==t[e]}(e,t)?s=jt(e,t)?"?"+e:function(e){var t=e;if("string"===typeof e&&-1!==t.indexOf("/")){var a=t.startsWith("-");a&&(t=t.substring(1));var n=t.split("/"),s=Object(C.a)(n,2),r=s[0],o=s[1];t=ot(r,"/",o),a&&(t=ot("","-",t))}L("checkFraction")&&console.log("checkFraction(f)=",e,t);return t}(e):(a||(a=[]),-1===a.indexOf(e)?(a.push(e),s=ye(function(e,t){return t&&void 0!==t[e]?t[e]:"?"+e}(e,t),t,a)):s="?"+e),"\u03c0"===s?s=Math.PI:"e"===s?s=Math.E:it(s)&&(s=function(e){var t=e;it(e)&&(t=e.replace(/([0-9]+)\xb0(?:([0-9]+)')?(?:([0-9]+)'')?$/,function(e,t,a,n,s,r){var o=(1*t+(a||0)/60+(n||0)/360)*Math.PI/180;return L("radians")&&console.log("radians",o,e,t,a,n,s,r),o}));return t}(s)),L("substitute")&&console.log("substitute(s,vars,done)=",s,e,t,n,X(a)),s}function Pe(e,t){var a=1;return Ye(e)&&Ye(t)&&(a=1*t===0?1*e:1*t===1?e%t:Pe(t,e%t)),a>0?a:0===a?1:-a}function We(e,t,a,n){var s,r,o;return e===t?s=!0:(r=ke(e)?e:ht(e,n),o=ke(t)?t:ht(t,n),null!==r&&null!==o||(s=!1),s=r===o||De(Ie(r),Ie(o),!0,a)),L("compare")&&console.log("compare(a,b,dpsf,vars)=",s,e,"=",r,t,"=",o,a,n),s}function ze(e,t,a){var n,s,r;return n=Oe(e),s=Oe(t),Ye(n)&&Ye(s)&&n!==s?!(r=n.toPrecision(10)===s.toPrecision(10))&&a&&""!==a&&(a.endsWith("sf")?r=n.toPrecision(a[0])===s.toPrecision(a[0]):a.endsWith("dp")&&(r=n.toFixed(a[0])===s.toFixed(a[0]))):r=n===s,L("compare_dpsf")&&console.log("compare_dpsf(a,b,dpsf)=",r,e,"=",n,t,"=",s,a),r}function Qe(e,t,a,n){var s,r,o,l,i;if(r=ht(e,n),o=(o=ht(t,n))||t,null===(r=r||e)||null===o||r===o)s=r===o;else{var c=X(n);c&&(c.substitute=!0),l=ye(r,c),i=(i=ye(o,c))||o,s=!ge(l=l||r)&&!ge(i)&&(Array.isArray(l)||Array.isArray(i)?function(e,t,a){if(!Array.isArray(e)||!Array.isArray(t)||0===e.length||e.length!==t.length)return!1;for(var n=!0,s=0,r=[];n&&s<e.length;){if(a&&","===a[0]){for(var o=!1,l=0;l<t.length&&!o;l++)r.includes(l)||(o=ze(e[s],t[l],a.substr(1)));o&&r.push(l-1),n=o}else n=ze(e[s],t[s],a);s++}return L("compare_multi")&&console.log("compare_multi(a,b,dpsf)=",n,X(e),X(t)),n}(l,i,a):ze(l,i,a))}return L("compare_eval")&&console.log("compare_eval(a,b,dpsf,vars)=",s,e,"=",r,"=",l,t,"=",o,"=",i,a,n),s}function De(e,t,a,n){"undefined"===typeof a&&(a=!0);var s,r,o=!1;if(L("compare_tree")&&(s=X(e),r=X(t)),Ye(e)&&Ye(t))o=ze(e,t,n);else if(null===e||null===t)o=e===t;else if(et(e)&&et(t))o=e===t;else if(et(e)||et(t))o=!1;else if(De(e.right,t.right,!0,n))" "!==e.op&&"("!==e.op&&"\xd7"!==e.op||(e.op="*")," "!==t.op&&"("!==t.op&&"\xd7"!==t.op||(t.op="*"),o=e.op===t.op&&De(e.left,t.left,!0,n);else if(rt(e)&&De(He(e),He(t),!1,n))o=!0;else if(a)for(var l,i=0;!1===o&&(l=Le(t,i++));)o=De(e,l,!1,n);else o=!1;return L("compare_tree")&&console.log("compare_tree(a,b,commut,dpsf)=",X(o),s,r,a,n),o}function Fe(e){return at(e)&&"/"===e.op}function Ie(e){"undefined"===typeof e&&console.error("normalise() called with null tree");var t,a=e;if(L("normalise")&&(t=X(e)),a&&!et(a)){var n=Ie(a.left),s=Ie(a.right);if("^"===(a=ot(n,a.op,s)).op&&rt(s)){var r=He(s);a=ot("1","/",1*r===1?n:ot(n,"^",r))}else"*"===a.op||" "===a.op||"("===a.op?a=function e(t,a){return Fe(t)&&Fe(a)?ot(e(t.left,a.left),"/",e(t.right,a.right)):Fe(t)?ot(e(t.left,a),"/",t.right):Fe(a)?ot(e(t,a.left),"/",a.right):1*t===0||1*a===0?0:1*t===1?a:1*a===1?t:ot(t,"*",a)}(n,s):"+"===a.op&&1*s===0?a=n:"+"===a.op&&1*n===0?a=s:"-"===a.op&&1*s===0?a=n:"\u221a"===a.op&&(a=ot(s,"^",ot("1","/","2")))}return L("normalise")&&console.log("normalise(t)=",X(a),t),a}function Le(e,t){null===e&&console.error("commute() called with null inputTree");var a,n=e;L("commute")&&(a=X(e));var s,r=0,o=[];if(!et(n))for(var l=Ct(n.op);!et(n)&&Ct(n.op)===l;)o[r]={right:n.right,op:n.op},n=n.left,r++;if(""===n&&"-"===o[r-1].op?(r--,(n=o.pop()).left="",r===t+1&&(o[r]=n)):r===t+1&&(o[r]={right:n,op:l===Ct("+")?"+":"*"}),r>t){var i;if(r===++t&&("-"===o[0].op?n=He(o[0].right):n=("*"===(s=o[0].op)||"+"===s||" "===s||"("===s||","===s)&&o[0].right),!1!==n)for(i=r-1;i>0;i--)n=t===i?ot(n,o[0].op,o[0].right):ot(n,o[i].op,o[i].right);!1!==n&&(n=rt(o[t].right)&&"+"===o[t].op?ot(n,"-",He(o[t].right)):ot(n,o[t].op,o[t].right))}else n=!1;return L("commute")&&console.log("commute(tree,depth)=",Be(n),Be(a),t),n}function He(e){var t,a=e;return L("change_sign")&&(t=X(e)),a=rt(e)?""===e.left?e.right:ot(He(e.left),e.op,e.right):et(e)||"*"!==e.op&&" "!==e.op&&"("!==e.op?ot("","-",e):ot(He(e.left),e.op,e.right),L("change_sign")&&console.log("change_sign(t)=",X(a),t),a}function Be(e,t,a){var n=e;if("undefined"===typeof a&&(a=""),"undefined"===typeof t&&(t=0),at(e)){var s=Ct(e.op);"-"===e.op&&""===e.left&&(s=Ct("*")),n=Be(e.left,s)+(" "===e.op?"":e.op)+Be(e.right,s,e.op),(s<t||"/"===a&&s===Ct("*")&&"/"!==e.op)&&(n="("+n+")")}return!1===n||""===n?n:Ye(n)&&1*n===0?"0":1*n===1?"1":""+n}function Ue(e){var t=e?function e(t){return at(t)?ot(e(t.left),t.op,e(t.right)):"0.0"===t?0:"1.0"===t?1:t}(function e(t){if(!at(t))return t;var a=" "===t.op||"("===t.op?"*":t.op;var n=e(t.left);var s=e(t.right);var r;!rt(s)||"+"!==t.op&&"-"!==t.op?r=ot(n,t.op,s):(s=He(s),"+"===t.op?(a="-",r=ot(n,"-",s)):"-"===t.op&&(a="+",r=ot(n,"+",s)));"0.0"===n?"*"===a?r="0.0":"+"===a?r=s:"-"===a&&(r="0.0"===s?"0.0":ot("","-",s)):"0.0"===s?"*"===a?r="0.0":"+"===a||"-"===a?r=n:"^"===a&&(r="1.0"):"1.0"===n?"*"===a?r=s:"^"===a&&(r="1.0"):"1.0"===s?"*"!==a&&"^"!==a||(r=n):"*"===a&&(lt(n)?r=ot("","-",s):lt(s)&&(r=ot("","-",n)));return r}(e)):e;return t=rt(t)&&Ye(He(t))?-1*He(t):function(e){var t=e,a=e;if(at(a)){var n="";""===a.left&&"-"===a.op&&at(a.right)&&(n="-",a=a.right),Ze(a.left)&&"\u02fd"===a.op&&at(a.right)&&(n+=a.left+"\u02fd",a=a.right),Ze(a.left)&&"/"===a.op&&Ze(a.right)&&(t=n+=a.left+"/"+a.right)}return L("tree_to_frac")&&console.log("tree_to_frac(t)=",t,X(e)),t}(t)}var Re={"\xb1":"+-","\u2013":"\\-","\u02fd":"\\ ","\u221a":"\\2","\u03c0":"\\p","\u222b":"\\[","\u2248":"~=","\u2260":"\\=","\u2265":">=","\u2264":"<=","\xf7":"\\/","\u2261":"==","\u2026":"...","\u21d2":"=>","\u27fa":"<>","\u2192":"->","\u221e":"\\i","\u03b1":"\\a","\u03b2":"\\b","\u03b3":"\\g","\u03b4":"\\d","\u0394":"\\D","\u03f5":"\\e","\u03bc":"\\m","\u03bb":"\\l","\u03c3":"\\s","\u03a3":"\\S","\u03b8":"\\t","\u03a0":"\\P","\u2229":"\\^","\u222a":"\\v","\xd7":"\\*","\u22c5":"\\.","\xb0":"\\o"},Je={"%":"\\%",du:"du",dy:"dy",dx:"dx","\u03b1":"\u03b1","\u03b2":"\u03b2","\u03b3":"\u03b3","\u03b4":"\u03b4","\u03f5":"\u03f5","\u03bc":"\u03bc","\u03bb":"\u03bb","\u03c0":"\u03c0","\u03c3":"\u03c3","\u03b8":"\u03b8","\u03a3":"\u03a3","\u2026":"\u2026","\xb0":"\xb0","\u0394":"\u0394"},$e={"\u2265":"\u2265","\u2264":"\u2264","\u2260":"\u2260","\u2261":"\u2261","\u2248":"\u2248","\u21d2":"\u21d2","\u221d":"\u221d","\u27fa":"\u27fa"},Ve={"\xf7":"\xf7","\xb1":"\xb1","\u2013":"-","\u221a":"\u221a","\u2229":"\u2229","\u222a":"\u222a","\xd7":"\xd7","\u22c5":"\u22c5","\u02fd":"\u02fd",":":":"},Ke="+-*/^(),=<>{}[]|~\xb1",Ge=["//"];function Xe(e,t){return"symbol"===e?Je[t]||$e[t]||Ve[t]:!!e[t]}function Ye(e){return!isNaN(e)&&""!==e&&!1!==e&&!0!==e&&null!==e}function Ze(e){return Ye(e)&&Number.isInteger(1*e)}function et(e){return"string"===typeof e||Ye(e)}function tt(e){return e&&"object"===Object(ve.a)(e)&&"(,)"===e.op}function at(e){return e&&"object"===Object(ve.a)(e)&&e.op}function nt(e){return at(e)&&Ze(e.left)&&"/"===e.op&&Ze(e.right)&&e.right>0}function st(e){var t=!1;if(Ze(e))t=!0;else{if("string"===typeof e&&-1!==e.indexOf("/")){var a=e.split("/");return 2===a.length&&Ze(a[0])&&Ze(a[1])}at(e)?nt(e)?t=!0:Ze(e.left)&&"\u02fd"===e.op&&nt(e.right)?t=!0:rt(e)&&(t=st(He(e))):t=!1}return L("is_fraction")&&console.log("is_fracion(f)",t,X(e)),t}function rt(e){return at(e)&&(""===e.left&&"-"===e.op||("*"===e.op||" "===e.op||"("===e.op||"/"===e.op)&&rt(e.left))}function ot(e,t,a){var n="undefined"!==typeof t?t:"";if(""!==n)var s={left:e,op:n,right:"undefined"!==typeof a?a:""};else s=e;return s}function lt(e){return at(e)&&""===e.left&&"-"===e.op&&1*e.right===1}function it(e){return"string"===typeof e&&null!==e.match(/([0-9]+)\xb0(?:([0-9]+)')?(?:([0-9]+)'')?$/)}var ct,ut=function(){function e(t,a){Object(l.a)(this,e);var n=[],s="",r=!1;if(t)for(var o=0;o<t.length;o++)"{"===t[o]?r=!0:"}"===t[o]&&(r=!1),-1!==Ke.indexOf(t[o])||Xe("symbol",t[o])?(s.length>0&&(s=this.longest(s,a,n,!0,r)),s=this.longest(t[o],a,n,!0,r)):(s.length>0&&(isNaN(s)&&"."!==s)!==(isNaN(t[o])&&"."!==t[o])&&(s=this.longest(s,a,n,!0,r)),s+=t[o],s=this.longest(s,a,n,!1,r));return s&&this.longest(s,a,n,!0,r),L("Tokens")&&console.log("Tokens(maths,vars)",t,a,n,s),this.tokens=n,this.vars=a,this.pos=0,this}return Object(i.a)(e,[{key:"op_2",value:function(e){return-1!==Ge.indexOf(e)}},{key:"longest",value:function(e,t,a,n,s){var r="";if(a.length&&this.op_2(a[a.length-1]+e))a[a.length-1]+=e,r="";else if("_"===e&&a.length)r=a[a.length-1]+"_",a.length--;else if(n&&a.length&&a[a.length-1].endsWith("_"))a[a.length-1]+=e,r="";else{for(var o=e,l=-1,i="",c=a.length;c>=0&&((kt(o,t)||wt(o,t,s)||it(o))&&(l=c,i=o),0!==c&&-1===Ke.indexOf(a[c-1]));c--)o=""+a[c-1]+o;-1!==l?(l<a.length&&(a.length=l),a[l]=function(e,t){return-1!==xt(t).indexOf(e)?e:-1!==xt(t).indexOf("'"+e)?"'"+e:-1!==xt(t).indexOf(e.replace("_","_'"))?e.replace("_","_'"):-1!==xt(t).indexOf("'"+e.replace("_","_'"))?"'"+e.replace("_","_'"):e}(i,t)):n||1===e.length&&e.match(/[a-z]/i)?a.push(e):r=e}return L("longest")&&console.log("longest(token,vars,ret,store)=",e,t,a,n,r),r}},{key:"peek",value:function(){return this.pos<0||this.end()?"":this.tokens[this.pos]}},{key:"token",value:function(){return this.pos<1?"":this.tokens[this.pos-1]}},{key:"next",value:function(){var e;return this.pos<0||this.end()?e="":(this.pos++,e=this.tokens[this.pos-1]),e}},{key:"end",value:function(){return this.pos===this.tokens.length}}]),e}(),pt=!1;function ht(e,t){var a,n=null,s=new ut(e,t);if(L("expression")&&(a=X(s)),ct="",pt=!1,"undefined"===typeof e||null===e||""===e)n=null;else{if("="===s.peek()||Xe($e,s.peek()))n=ot("",s.next(),vt(bt(s),0,s));else n=vt(bt(s),0,s);s.end()?ct&&("="===s.token()||Xe($e,s.token()))&&(ct=""):ct="E"+s.token(),n=""===ct?Ue(n):null}return L("expression")&&console.log("expression(expression,vars)=",JSON.stringify(n),n,a,s),n}function mt(e,t){return"("===e||kt(e,t.vars)||e.length>0&&-1===Ct(e)&&")"===t.token()?"*":wt(e,t.vars)||"\u221a"===e?" ":e}function ft(e,t){return kt(e,t)?Ct("+")+.5:Ct(mt(e,t))}function dt(e,t,a){var n,s;L("set_var")&&(s=X(a)),a&&a.auto&&(wt(e,a)?n=e:at(e)&&","===e.op&&!qt(e.right)&&wt(e.right,a)&&(n=e.right),ge(t)||(a[n]=t)),L("set_var")&&console.log("variable(lhs,vars)=",n,X(e),s,a)}function vt(e,t,a){if(""!==ct)return"";var n,s,r="",o=a.peek();for(L("expression_1")&&(n=X(a),s=X(e));""===ct&&")"!==o&&"}"!==o&&"|"!==o&&"]"!==o&&ft(o,a)>=t;){r=mt(o,a)!==o?"("===o?"(":mt(o,a):a.next();var l=bt(a);for(o=a.peek();""===ct&&")"!==o&&"}"!==o&&"|"!==o&&"]"!==o&&(ft(o,a)>Ct(r)||gt(o)&&Ct(o)===Ct(r));)l=vt(l,ft(o,a),a),o=a.peek();pt||"="!==r||dt(e,l,a.vars),e=ot(e,","!==r||")"!==o||pt?r:"(,)",l)}return L("expression_1")&&console.log("expression_1(lhs,min_precedence,tokens)=",e,t,n,s,a),e}function gt(e){return"^"===e}function bt(e){if(""!==ct)return"";var t,a=e.token();L("primary")&&(t=X(e));var n=e.next();if("("===n)n=vt(bt(e),0,e),")"!==e.peek()?Nt(")",e):e.next();else if("|"===n)n=vt(bt(e),0,e),"|"!==e.peek()?Nt("|",e):(e.next(),n=ot("","|",n));else if("["===n)n=vt(bt(e),0,e),"]"!==e.peek()?Nt("]",e):(e.next(),n=ot("","[]",n));else if("{"===n){if(pt?Nt("{",e):"'"===e.peek()?e.next():pt=!0,n=vt(bt(e),0,e),"}"!==e.peek())Nt("}",e);else if(e.next(),pt){var s=ye(n,e.vars);n=Ye(s)?s<0?ot("","-",-s):1*s===0?"0.0":1*s===1?"1.0":s:it(s)?s:rt(s)&&Ye(He(s))?s:st(s)?s:Array.isArray(s)?ot(s[0],",",s[1]):s,pt=!1}}else if("\u221a"===n||kt(n,e.vars)){var r=Ct(n);if(kt(n,e)&&"("===e.peek()&&(r=Ct("^")+1),Ot(n)&&"^"===e.peek()){e.next();var o=e.next();"-"===o&&"1"===e.peek()?(o=e.next(),n+="^{-1}"):isNaN(o)?Nt(o,e):n+="^{"+o+"}","("===e.peek()&&(r=Ct("^")+1)}else yt(n)&&-1!==n.indexOf("{")&&(n="log_{"+Et(n,e.vars)+"}");n=ot("",n,vt(bt(e),r,e))}else"-"!==n&&"\xb1"!==n&&"\u2013"!==n||!(kt(e.peek())||wt(e.peek(),e.vars)||St(e.peek())||it(e.peek())||"{"===e.peek()||"("===e.peek()||"\u221a"===e.peek())?"."===n?n="":0!==n.length&&(wt(n,e.vars)||St(n)||it(n))||Nt(n,e):n=ot("",n,vt(bt(e),"^"===a?Ct("^")-1:Ct("\u02fd"),e));return L("primary")&&console.log("primary(tokens)=",n,t,e),n}function kt(e,t){return Ot(e)||yt(e)}function yt(e,t){return"string"===typeof e&&null!==e.match(/^(ln|log|log_[2-9a-z]|log_{.+})$/)}function Et(e,t){var a=!1;return"string"===typeof e&&(a=e.match(/^(log_([2-9])|log_{(.+)})$/))&&(a[2]?a=a[2]:a[3]&&(a=Te(a[3],t))),a}function Ot(e){return"string"===typeof e&&null!==e.match(/^(sin|cos|tan|cosec|sec|cot)(\^{(-1|[0-9]+)})?$/)}function xt(e){return e&&e.xyz?e.xyz.replace(/,/g," ").split(" "):["x","y","z"]}function jt(e,t){return"string"===typeof e&&(-1!==xt(t).indexOf(e)||-1!==xt(t).indexOf("'"+e)||-1!==xt(t).indexOf(e.replace("_","_'"))||-1!==xt(t).indexOf("'"+e.replace("_","_'")))}function wt(e,t,a){var n=!1;return n="string"===typeof e&&(!kt(e)&&(!(!jt(e,t)&&"e"!==e&&!Xe(Je,e))||(!(!e.endsWith("'")||!jt(e.substring(0,e.length-1),t))||!(!a&&!pt)&&(!(!t||void 0===t[e])||qt(e))))),L("algebra")&&console.log("algebra(token,vars)=",e,t,n,pt,a),n}function qt(e){return"string"===typeof e&&("bin"===e||"dp"===e||"sf"===e||"improper"===e||"fractional"===e||"whole"===e||"mixed"===e||"denominator"===e||"numerator"===e||"mixed"===e)}function St(e){return e.match(/^[0-9]*(\.)?[0-9]+$/)}function Ct(e){return"="===e||"<"===e||">"===e||Xe($e,e)?1:","===e?pt?1.5:1:"//"!==e&&"~"!==e||!pt?"+"===e||"-"===e||"\u2013"===e||"\xb1"===e||":"===e?2:"\u02fd"===e?2.5:"*"===e||" "===e||"("===e||"\xd7"===e||"\u22c5"===e?4:"/"===e||"\xf7"===e?4:kt(e)?3:"\u221a"===e||"^"===e?7:-1:1.5}function Nt(e,t){L("error")&&console.error("error(expected),tokens",e,X(t)),ct=""===e?"?":e}var _t="";function At(e,t){var a=null,n=function e(t,a,n,s){var r,o,l,i=null;L("output_tree")&&(o=X(t),l=X(n));a&&(s=s||"/"===t.op||"(,)"===t.op||"^"===t.op&&"right"===a);a?"left"===a?(r=Ne(t.left),n=Ne(t)):"right"===a&&(r=Ne(t.right)):r=Ne(t);if(at(r)){var c=e(r,"left",n,!1,s),u=e(r,"right",n,s),p=r.op;"*"!==p&&"("!==p&&")"!==p&&" "!==p||(p="-"!==u[0]&&isNaN(u[0])&&"\\dfrac"!==u.substring(0,6)?" ":"("===p?"(":"\xd7"),i="/"===p?s?"\\frac{"+c+"}{"+u+"}":"\\dfrac{"+c+"}{"+u+"}":"\u02fd"===p?"{\\Large{"+c+"}}"+u:"^"===p?Tt(t,a)?-1!==c.indexOf("\\dfrac")?"\\Big("+c+"\\Big)^{"+u+"}":"("+c+")^{"+u+"}":c.startsWith("(")&&-1!==c.indexOf("\\dfrac")?"\\Big"+c.substring(0,c.length-1)+"\\Big)^{"+u+"}":c+"^{"+u+"}":"|"===p?"\\left|"+u+"\\right|":"\u221a"===p?"\\sqrt{"+u+"}\\,":"(,)"===p?"("+c+","+u+")":"-"!==p||et(r.right)||"+"!==r.right.op&&"-"!==r.right.op?kt(p)?function e(t){if(et(t))return!1;if(kt(t.op))return!0;if("*"===t.op||"("===t.op||")"===t.op||" "===t.op)return e(t.left)||e(t.right)}(r.right)?"\\"+p+"("+u+")":!Tt(r,"right")||at(r.right)&&"^"===r.right.op?-1!==u.indexOf("\\times")||-1!==u.indexOf("(")?"\\"+p+"("+u+")":"left"===a&&(" "===t.op||"*"===t.op&&Pt(t.right)||"^"===t.op)?"\\"+p+"("+u+")":"right"===a&&at(n)&&!Tt(n,"left")&&("*"===n.op&&Pt(n.right)||" "===n.op)?"\\"+p+"("+u+")":"f"===p?p+"("+u+")":"\\"+p+"{"+u+"}":"f"===p?c+" "+p+"{"+u+"}":c+"\\"+p+"{"+u+"}":Tt(t,a)?"("+c+p+u+")":"("===p?c+"("+u+")":c+p+u:""!==r.right.left?c+p+"("+u+")":c+p+"{"+u+"}",_t="="===p?u:i}else(i=Ye(r)?1*r===0?"0":1*r===1?"1":""+r:"string"===typeof r?r:Array.isArray(r)?r.map(function(t){return e(t)}).join(","):null)&&(_t=i);L("output_tree")&&console.log("output_tree(tree,side,rt,f)=",i,o,a,l,s);"string"!==typeof i&&console.error("output_tree(tree,side,rt,f)=",i,t,a,n,s);return i}(e);return n&&(a=Mt(n).replace(/_('?[a-zA-Z0-9]+)/g,"_{$1}").replace(/'([a-zA-Z][a-zA-Z0-9]*)/g,"\\text{$1}")),L("mj")&&console.log("mj(tree)=",e,n,a),a}function Mt(e){for(var t="",a=0;a<e.length;a++)"undefined"!==typeof Je[e[a]]?t+=Je[e[a]]+" ":"undefined"!==typeof $e[e[a]]?t+=$e[e[a]]+" ":"undefined"!==typeof Ve[e[a]]?t+=Ve[e[a]]+" ":t+=e[a];return t}function Tt(e,t){var a;return"undefined"===typeof t?a=e:"left"===t?a=e.left:"right"===t&&(a=e.right),!!at(a)&&("/"!==e.op&&("right"!==t||"^"!==e.op&&"\u221a"!==e.op)&&(!("^"!==a.op||!at(a.left)||"^"!==a.left.op&&"/"!==a.left.op)||("-"!==a.op||""!==a.left||"^"===e.op)&&Ct(e.op)>Ct(a.op)))}function Pt(e){return!(at(e)&&kt(e.op))}function Wt(e){var t,a;if(L("next_tok")&&(t=X(e)),e.n&&e.buffer.length>e.n)a=e.buffer[e.n++];else if(e.pos>=e.text.length)a=null;else if(a=e.text.charAt(e.pos++),-1!==" \r\n[]\\?".indexOf(a))if("\\"===a&&"("===e.text.charAt(e.pos)){for(a+=e.text.charAt(e.pos++);e.pos<e.text.length-1&&("\\"!==e.text.charAt(e.pos)||")"!==e.text.charAt(e.pos+1));)a+=e.text.charAt(e.pos++);"\\"===e.text.charAt(e.pos)&&")"===e.text.charAt(e.pos+1)?(a+=e.text.charAt(e.pos++),a+=e.text.charAt(e.pos++)):console.error("unterminated latex \\( with no \\)")}else"?"===a?(a=function(e){var t,a,n="?";L("conditional")&&(t=X(e),a=X(_t));if(e.pos<e.text.length&&"{"===e.text.charAt(e.pos)){for(var s=e.pos,r=e.pos++,o=s;r<e.text.length&&-1==="\n:;}".indexOf(e.text.charAt(r));)r++;if("}"===e.text.charAt(r)){e.pos=++r;var l=e.text.substring(s,r);for(s=r;r<e.text.length&&-1==="\n:;".indexOf(e.text.charAt(r));)r++;var i="",c="";if(r>s&&(i=e.text.substring(s,r)),":"===e.text.charAt(r)){for(s=++r;r<e.text.length&&-1==="\n:;".indexOf(e.text.charAt(r));)r++;r>s&&(c=e.text.substring(s,r))}r<e.text.length&&"\n"!==e.text.charAt(r)&&r++,e.pos=r;var u=ht(l,e.vars);n=Ye(u)?1*u!==0?i:c:"?{?"+e.text.substring(o+1,r)}else n="?{"}else if(e.pos<e.text.length&&"="===e.text.charAt(e.pos)){s=r=++e.pos;for(;r<e.text.length&&-1==="\n;?=".indexOf(e.text.charAt(r));)r++;if(r>s){n=e.text.substring(s,r);var p=_t,h=At(ht(n,e.vars));n=null===h?"?=":p===h?"":"="+n,r<e.text.length&&";"===e.text.charAt(r)&&r++,e.pos=r}else n="?="}L("conditional")&&console.log("conditional(o)=",n,t,X(e),a,_t);return n}(e))&&a.indexOf(" ")>0&&(e.buffer=a.split(" "),e.n=0,a=e.buffer[e.n++]):"["===a&&(a=function(e){var t="[",a=!1,n=e.pos;for(;e.pos<e.text.length-1&&"]"!==e.text.charAt(e.pos);)"\n"===e.text.charAt(e.pos)&&(a=!0),t+=e.text.charAt(e.pos++);if("]"===e.text.charAt(e.pos)){if(e.pos++,a)return t+"]";if("_"===e.text.charAt(e.pos)){var s=Ft(e.text,e.pos),r=e.text.substr(e.pos,s-e.pos);e.pos=s,parseError="";var o=At(t.substr(1));return console.log("[]_^",t,o,r,s),""===parseError?"\\(\\Big["+o+"\\Big]"+r+"\\)":"\\(\\Big["+t.substr(1)+"\\Big]"+r+"\\)"}var l=t.substr(1).split(",");return 1===l.length?1===l[0].length?"\\(\\utilde{"+l[0]+"}\\)":0===l[0].indexOf("|")&&l[0].substr(1).indexOf("|")===l[0].length-2?"\\(|\\overrightarrow{"+l[0].substr(1,l[0].length-2)+"}|\\)":"\\(\\overrightarrow{"+l[0]+"}\\)":"\\(\\begin{pmatrix}"+t.substr(1).split(",").join("\\\\")+"\\end{pmatrix}\\)"}return e.pos=n,"["}(e));else for(;e.pos<e.text.length&&-1===" \r\n[]\\?".indexOf(e.text.charAt(e.pos));)a+=e.text.charAt(e.pos++);return e.token=a,L("next_tok")&&console.log("next_tok(o)=",a,t,X(e)),a}function zt(e,t){for(var a,n,s=e;-1!==(a=e.indexOf("{"))&&-1!==(n=e.indexOf("}"));)if(n<a)e=e.substr(n+1);else{for(var r=e.substring(a+1,n);-1!==(a=r.indexOf("{"));)r=r.substr(a+1);if("'"===r[0]){var o=At(ht("{"+r.substr(1)+"}",t));o&&(s=s.replace("{"+r+"}","{"+o+"}"))}e=e.substr(n+1)}return s}function Qt(e,t,a,n){if("\n"===t)e.push({chunk:"\n",type:"newline"});else if(t.startsWith("\\(")){var s=t.indexOf("\\)");s===t.length-2?"integral"===a||-1!==t.indexOf("//Big]_")?Qt(e,Mt(zt(t.substring(2,s),n)).replace(/\\'/g,"\\").replace(/\\dfrac/g,"\\frac"),"latex"):Qt(e,Mt(zt(t.substring(2,s),n)).replace(/\\'/g,"\\"),"latex"):e.push({chunk:t,error:"\\( with no matching \\)",type:"error"})}else e.length>0&&e[e.length-1].type===a?e[e.length-1].chunk+=t:e.length>0&&("maths"===e[e.length-1].type&&"latex"===a||"latex"===e[e.length-1].type&&"maths"===a)?(e[e.length-1].chunk+=t,e[e.length-1].type=a):e.push({chunk:t,type:a})}function Dt(e){var t=e.token,a=null;return(t.endsWith(".")||t.endsWith(","))&&(t=t.substr(0,t.length-1)),-1!==t.indexOf("\\(")||-1!==t.indexOf("</")||-1!==t.indexOf("class=")||-1!==t.indexOf("target=")||t.endsWith("^")||t.endsWith("\u221a")?a=null:(a=ht(t,e.vars))||!e.auto&&!e.token.startsWith(";")||(a=function(e){var t;L("detect_xyz")&&(t=X(e));var a,n;e.token.startsWith(";")?(a=e.token.substr(1),n=e.vars?X(e.vars):{}):(a=e.token,n=X(e.vars));var s,r,o=xt(n),l=!1,i=!1,c=!1,u=new ut(a,n);for(;r=u.next();)-1!=="=^/+*-\u2260\u2265\u2264\xb1\xf7\u221a\u2261\u2248\u2026\u21d2".indexOf(r)?i=!0:"{"===r?c=!0:"}"===r?c=!1:c||!(/['a-zA-Z]/.test(r.charAt(0))||r.indexOf("_")>0)||kt(r)||jt(r,n)||(o.push(r),l=!0);l&&i?(n.xyz=o.join(","),(s=ht(a,n))&&Object.keys(n).forEach(function(t){e.vars[t]=n[t]})):s=ht(a,e.vars);L("detect_xyz")&&console.log("xyz(p)=",s,t,X(e));return s}(e)),a&&(e.token.endsWith(".")||e.token.endsWith(","))&&e.pos--,L("detectMaths")&&console.log("detectMaths(p)",X(e),a),a}function Ft(e,t){return console.log("limits",e.substr(t,5),t),t||(t=0),"_"===e.charAt(t)&&(t++,"{"===e.charAt(t)&&e.indexOf("}",t)>t&&(t=e.indexOf("}",t)),t++,"^"===e.charAt(t)&&(t++,"{"===e.charAt(t)&&e.indexOf("}",t)>t&&(t=e.indexOf("}",t)),t++)),t}function It(e){var t=""+e;return t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<r>/g,'<span class="red">')).replace(/<o>/g,'<span class="amber">')).replace(/<g>/g,'<span class="green">')).replace(/<h>/g,"<h5>")).replace(/<\/r>/g,"</span>")).replace(/<\/o>/g,"</span>")).replace(/<\/g>/g,"</span>")).replace(/<\/h>/g,"</h5>")}function Lt(e){for(var t=0;t<e.length&&-1===" \r\n\\'[](){}.,@".indexOf(e[t]);)t++;return{name:e.substring(0,t),end:t===e.length?"":e.substring(t)}}function Ht(e,t,a,n){L("setVariables")&&console.log("setVariables",e,t,a);var s=Bt(e,t);if(!s){var r,o=function(){var o,l,i={},c=[];"undefined"!==typeof e&&e.length>0&&(c=e.split("\n"));var u=function(){if(-1===c[r].indexOf("=")||-1!==c[r].indexOf("{")&&c[r].indexOf("{")<c[r].indexOf("="))return"continue";var e=c[r].substr(c[r].indexOf("=")+1),t=c[r].substr(0,c[r].indexOf("=")).split(",");e.length>0&&t.length>0&&t.forEach(function(t){"xyz"===(t=t.trim())?o=e:"keys"===t?l=e:t&&(i[t]=a?$t(e):function(e,t){if("undefined"!==typeof window.FreeMaths&&"undefined"!==typeof window.FreeMaths.testing&&window.FreeMaths.testing)return e;if(e.length>0&&!t)for(var a=0;a<e.length;a++){var n=Math.floor(a+Math.random()*(e.length-a)),s=e[a];e[a]=e[n],e[n]=s}return e}($t(e),n))})};for(r=0;r<c.length;r++)u();if(a)return{v:function(e,t){var a={false:0,true:0,opts:[]};a[!1]=0,a[!0]=0;var n=Ut(e);for(;!1!==n&&a[!1]<65e3&&a[!0]<65e3;){var s=Rt(e,n);Kt(s,t)?(a[!0]++,a.opts.push(s)):a[!1]++,n=Jt(e,n)}return a}(i,Vt(e))};(s=function(e,t,a){var n=Ut(e),s=X(n),r=Rt(e,n);for(;!1!==n&&!Kt(r,t,a);)n=Jt(e,n),r=Rt(e,n);if(!1===n){for(console.log("setVals - retry",n,s,e,t,a),n=X(s),r=Rt(e,n);!1!==n&&!Kt(r,t,null);)n=Jt(e,n),r=Rt(e,n);!1===n&&console.error("setVals",n,s,e,t)}n&&r&&Object.keys(r).forEach(function(e){"string"===typeof r[e]&&r[e].startsWith("{")&&(r[e]=ht(r[e],r))});return n?r:null}(i,Vt(e),t))&&o&&(s.xyz=o),s&&l&&(s.keys=l)}();if("object"===Object(ve.a)(o))return o.v}return s}function Bt(e,t){var a=Vt(e),n=!1,s=null;if(t&&t.use.length>0)for(var r=0;!n&&r<t.use.length;)n=Kt(s=JSON.parse(t.use[r++]),a,t);return!!n&&s}function Ut(e){for(var t={},a=Object.keys(e),n=0;n<a.length;n++)t[a[n]]=0;return t}function Rt(e,t){var a={};return Object.keys(e).forEach(function(n){a[n]=e[n][t[n]]}),a}function Jt(e,t){for(var a=Object.keys(t),n=0;n<a.length;n++){if(t[a[n]]++,t[a[n]]<e[a[n]].length)return t;t[a[n]]=0}return!1}function $t(e){var t=[];return e.startsWith("[")?t=function(e){var t=[];if(e.indexOf(",")>0)t=(t=e.split(",")).map(function(e){return Ye(e)?1*e:e});else if(e.indexOf("..")>0){var a=0,n=e.split("..");if(2===n.length)if(n[0].indexOf("/")>0&&n[1].indexOf("/")>0)t=function(e,t){var a,n,s=[],r=e.split("/"),o=t.split("/");if(Ye(r[0])&&Ye(r[1])&&Ye(o[0])&&Ye(o[1]))for(a=1;a<=9*o[0]/o[1];a++)for(n=2;n<=9;n++)a/n>=r[0]/r[1]&&a/n<=o[0]/o[1]&&1===Pe(a,n)&&s.push(a+"/"+n);return s}(n[0],n[1]);else for(var s=1*n[0];s<=n[1];s++)t[a++]=s}return t}(e.substr(1,e.indexOf("]")-1)):Ye(e)?t[0]=1*e:st(ht(e))?t[0]=e:t[0]=ht(e),null===t[0]&&(t[0]=e),t}function Vt(e){var t=e.split("\n"),a=[];return t.forEach(function(e){var t,n;-1!==e.indexOf("]")&&(e=e.substring(e.indexOf("]")+1)),-1!==e.indexOf(":")&&(e=e.substring(e.indexOf("]")+1)),-1!==(t=e.indexOf("{"))&&-1===e.indexOf("{xyz=")&&-1!==(n=e.indexOf("}"))&&n>t&&a.push(e.substring(t,n+1))}),a}function Kt(e,t,a){var n=!0;if(a&&function(e,t){for(var a=!1,n=0;n<t.length&&!a;)a=t[n]===JSON.stringify(e),n++;return a}(e,a.skip))n=!1;else for(var s=0;s<t.length;s++)t[s].startsWith("{\u2260")?function(){var a=t[s].substring(2,t[s].length-1).split(",");a.forEach(function(t){return a.forEach(function(a){t!==a&&e[t]===e[a]&&(n=!1)})})}():n=!(!n||!ht(t[s],e));return n}function Gt(e){var t=e;return 0===t.indexOf("[")&&(t=t.substring(t.indexOf("]")+1)),-1!==t.indexOf("#")&&(t=t.substring(0,t.indexOf("#"))),t.indexOf("[")>0&&(t=t.substring(0,t.indexOf("["))),t}function Xt(e){var t=void 0;return-1!==e.indexOf("#")&&-1!==(t=e.substring(e.indexOf("#")+1)).indexOf("[")&&(t=t.substring(0,e.indexOf("["))),t}function Yt(e){var t=void 0;return 0===e.indexOf("[")&&(e=e.substring(e.indexOf("]"))),e.indexOf("[")>0&&e.endsWith("]")&&(t=e.substring(e.indexOf("[")+1,e.length-1)),t}function Zt(e){return/^(1|0)[xyz]/.test(e)||/[+-\/*]\)](1|0)([xyz])/.test(e)||/^0[+-\/*(]/.test(e)||/[+-\/*)]0/.test(e)}function ea(e,t,a){var n,s=(n=function(e,t){var a=t,n=e.indexOf("]")-1;if(0===e.indexOf("[")&&n>1){var s=e.substring(1,n);t.startsWith(s)?a=t.substr(n):e.indexOf("?")<=n&&(n=e.indexOf("?")-1,s=e.substring(1,n),t.startsWith(s)&&(a=t.substr(n)))}else t.startsWith("=")&&t.length>1&&(a=t.substr(1));return a.startsWith("(")&&a.endsWith(")")&&-1===a.substr(1).indexOf("(")&&(a=a.substr(1,t.length-2)),a}(t,e),n.replace(/^(\d+)(\+| )(\d+\/\d+)$/,"$1\u02fd$3").replace(/^-(\d+)(-| )(\d+\/\d+)$/,"-$1\u02fd$3"));s=s.replace(/\s/g,"");var r,o=!1,l=!1,i=t.split("\n");for(r=0;r<i.length;r++){var c=Gt(i[r]);if(o=We(s,c,Xt(i[r]),a))break;l||(l=Qe(s,c,Xt(i[r]),a))}return o&&Zt(s)&&(o=!1,l=!0),o=!o&&l?i[0].indexOf("#")>0?{attempt:e,correct:"\u2713",diff:null}:{attempt:e,correct:"?\u2713",diff:o?null:ta(s,t,a)}:{attempt:e,correct:o?"\u2713":"\u2717",diff:o?null:ta(s,t,a)},L("checkAnswer")&&console.log("checkAnswer(entered,answer,vars)=",o,e,t,a,s),o}function ta(e,t,a){var n=Be(ht(Gt(t.split("\n")[0]),a));""!==ct&&(n=Gt(t.split("\n")[0]));for(var s="",r=e,o=e.match(/[+-]?[\d]*([a-z]*(\^[\d])?)*/g),l=n.match(/[+-]?[\d]*([a-z]*(\^[\d])?)*/g),i=0;i<o.length;i++)if(o[i].length>0&&"+"!==o[i]&&"-"!==o[i]){var c=r.substr(0,r.indexOf(o[i])+o[i].length);r=r.replace(c,"");for(var u=0;u<l.length&&c.length>0;u++)aa(o[i])===aa(l[u])&&(na(o[i])===na(l[u])?s+=c.replace(o[i],"<g>"+o[i]+"</g>"):s+=c.replace(o[i],"<o>"+o[i]+"</o>"),c="",l.splice(u,1));s+=c}return s+=r,L("mathDiff")&&console.log("mathDiff(a,answer,vars)=",s,e,n,t,o,l),s}function aa(e){return e.length>0&&("+"===e[0]||"-"===e[0])?e.substr(1):e}function na(e){return e.length>0&&"-"===e[0]?"-":"+"}var sa=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={start:0,keypad:!1},a.change=function(e,t){t=t||(a.calcInput?a.calcInput.selectionStart:0);var n=e.length,s=ma(e,t+=e.length-n);s.text!==a.props.answer&&(a.props.change(s.text),a.setState({start:s.caret})),a.calcInput&&a.calcInput.focus()},a.keyboard=function(e){a.change(e.target.value)},a.keypress=function(e){var t=a.calcInput.selectionStart,n=a.calcInput.selectionEnd;a.change(a.props.answer.substring(0,t)+e+a.props.answer.substring(n),t+e.length)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return t.keypad!==this.state.keypad||e.answer!==this.props.answer||e.qid!==this.props.qid||e.vars!==this.props.vars}},{key:"componentDidUpdate",value:function(){this.calcInput&&(this.calcInput.setSelectionRange(this.state.start,this.state.start),this.calcInput.focus())}},{key:"render",value:function(){var e=this;return this.state.keypad?s.a.createElement(ua,{qid:this.props.qid,vars:this.props.vars,answer:this.props.answer,change:this.change,mark:this.props.mark,close:function(){return e.setState({keypad:!1,start:e.props.answer.length})}}):s.a.createElement(y.a,{onSubmit:function(t){t.preventDefault(),e.props.mark()},inline:!0},s.a.createElement(ia,{qid:this.props.qid,vars:this.props.vars}),s.a.createElement("input",{ref:function(t){e.calcInput=t},autoFocus:!0,className:"form-control",inputMode:"numeric",type:F.user.isios?"tel":"text",value:this.props.answer,onChange:this.keyboard}),s.a.createElement(ca,{qid:this.props.qid,vars:this.props.vars}),s.a.createElement(la,{show:function(){return e.setState({keypad:!0})}}),this.props.answer?s.a.createElement(ha,{mark:this.props.mark}):s.a.createElement(oa,null),s.a.createElement("div",null,s.a.createElement(ra,{qid:this.props.qid,vars:this.props.vars,onClick:this.keypress})))}}]),t}(n.Component),ra=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).buttons=function(){var e=["-"],t=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=ht(Gt(e.split("\n")[0]),t);return n=a?[{chunk:e,type:"answer"},{chunk:JSON.stringify(t),type:"vars"},{chunk:At(n),type:"evaluated"},{chunk:Xt(e),type:"dpsf"}]:Be(n),L("evaluateAnswer=")&&console.log("evaluateAnswer(answer,vars)=",e,t,n),n}(B(a.props.qid).answer,a.props.vars);return["+","/","(",")","^","\u221a",",","x","y","z","\u02fd","\xb1"].forEach(function(a){-1!==t.indexOf(a)&&e.push(a)}),L("buttons")&&console.log("buttons,answer,ret,qid,vars",t,e,a.props.qid,a.props.vars),e},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.qid!==this.props.qid||e.vars!==this.props.vars}},{key:"textClass",value:function(e){return-1!==["x","y","z"].indexOf(e)?"keyboard-algebra":"keyboard-text"}},{key:"render",value:function(){var e=this,t={"-":"\u2013"};return this.buttons().map(function(a){return s.a.createElement(w.a,{key:a,className:"keyboard-button",onClick:function(){return e.props.onClick(a)}},s.a.createElement("span",{className:e.textClass(a)},t[a]?t[a]:a))})}}]),t}(n.Component),oa=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={help:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return this.state.help?s.a.createElement(ka,{topic:"keyboard",close:function(){return e.setState({help:!1})}}):s.a.createElement(G,{className:"btn btn-default green",onClick:function(){return e.setState({help:!0})},tooltip:"keyboard help"},"?")}}]),t}(n.Component),la=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return s.a.createElement(G,{className:"btn btn-default kbd",onClick:this.props.show,tooltip:"keyboard"},"\u200b")}}]),t}(n.Component),ia=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e,t=F.data.tests.questions[this.props.qid];if(t.answer.startsWith("[")&&-1!==(e=t.answer.indexOf("]"))){var a=t.answer.substring(1,e);return s.a.createElement(Aa,{vars:this.props.vars},a)}return s.a.createElement(Aa,null,"=")}}]),t}(n.Component),ca=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=F.data.tests.questions[this.props.qid];return Yt(e.answer)?s.a.createElement(Aa,{vars:this.props.vars},Yt(e.answer)):null}}]),t}(n.Component),ua=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).keypress=function(e){"{mark}"===e?a.props.mark():"{clear}"===e?a.props.change(""):"{bs}"===e?a.props.change(a.props.answer.substr(0,a.props.answer.length-1)):a.props.change(a.props.answer+e)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"keys",value:function(){var e=this,t={x:"x",y:"y",z:"z"},a=0;return[["x","y","z","\u02fd","{clear}"],[7,8,9,"+","-"],[4,5,6,"*","/"],[1,2,3,"^","\u221a"],[0,".","(",",",")"],["<",">","=","{bs}","{mark}"]].map(function(n){var r=n.map(function(a){var n=a,r="default",o=t[a]?"keyboard-algebra":"keyboard-text";switch(a){case"{bs}":n=s.a.createElement("img",{src:"/images/backspace.svg",alt:"backspace"});break;case"{mark}":r="success",n="\u2713";break;case"{clear}":n="C",o="keyboard-text red"}return s.a.createElement(pa,{key:"key_"+a,onClick:e.keypress,keyval:""+a,button:r,textClass:o},n)});return s.a.createElement("div",{key:a++},r)})}},{key:"componentDidMount",value:function(){this.scrollKB.scrollIntoView()}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{ref:function(t){e.scrollKB=t},className:"well keypad"},s.a.createElement("button",{className:"close",onClick:this.props.close},"\xd7"),s.a.createElement("input",{className:"form-control",readOnly:!0,value:this.props.answer,onClick:this.props.close}),this.keys())}}]),t}(n.Component),pa=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={style:a.props.button},a.hover=function(){F.user.isMobile||a.setState({style:"primary"})},a.unhover=function(){F.user.isMobile||a.setState({style:a.props.button})},a.click=function(e){a.props.onClick(a.props.keyval)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return s.a.createElement(w.a,{className:"keyboard-button",id:this.props.keyval,onClick:this.click,bsStyle:this.state.style,onMouseEnter:this.hover,onMouseLeave:this.unhover},s.a.createElement("span",{className:this.props.textClass},this.props.children))}}]),t}(n.Component),ha=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return s.a.createElement(G,{className:"btn btn-success",onClick:this.props.mark,tooltip:"mark"},"\u2713")}}]),t}(n.Component);function ma(e,t){var a=e.length;if(-1===e.indexOf("begin")&&Object.keys(Re).forEach(function(t){e=e.replace(Re[t],t,e)}),e=(e=(e=e.replace("/dx","/(dx)",e)).replace("/du","/(du)",e)).replace("/\u0394x","/(\u0394x)",e),t)var n=t+e.length-a;else n=null;return{text:e,caret:n}}var fa=sa,da=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={question:B(a.props.qid),vars:a.props.vars?a.props.vars:Ht(B(a.props.qid).variables),help:"",showHelp:!1},a.save=function(e){var t=a.state.question;e&&((t=X(t)).previous_id=t.id,t.id=0),JSON.stringify(B(a.props.qid))!==JSON.stringify(t)?(F.saveQ(t),a.setState({question:t})):(console.log("Question save: no changes"),a.props.close())},a.updateQuestion=function(e,t){if(a.state.question[e]!==t){var n=JSON.parse(JSON.stringify(a.state.question));n[e]=t,a.setState({question:n})}},a.changeVariables=function(){a.setState({vars:Ht(a.state.question.variables)})},a.setQ=function(e){var t=a.props.questions[e.target.value-1];Y(t.next)||(t.next=""),a.setState({vars:Ht(t.variables),question:t})},a.getQ=function(){var e=a.state.question;return e.topics||(e.topics=""),e},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.qid!==this.state.question.id&&this.setState({question:B(e.qid),vars:Ht(B(e.qid).variables),showHelp:!1})}},{key:"shouldComponentUpdate",value:function(e,t){return JSON.stringify(t.question)!==JSON.stringify(this.state.question)||t.vars!==this.state.vars||t.help!==this.state.help||t.showHelp!==this.state.showHelp}},{key:"render",value:function(){var e=this;return s.a.createElement(S.a,{show:!0,bsSize:"large",onHide:function(){return e.props.close(e.state.question.id)}},s.a.createElement(S.a.Header,{closeButton:!0},s.a.createElement(S.a.Title,null,s.a.createElement(va,{q:this.state.question,qs:this.props.questions,setQ:this.setQ}))),s.a.createElement(S.a.Body,null,s.a.createElement(ga,{fields:this.getQ(),vars:this.state.vars,change:this.changeVariables,update:this.updateQuestion})),s.a.createElement(S.a.Footer,null,s.a.createElement(w.a,{onClick:function(){return e.save(!0)}},"Copy"),s.a.createElement(w.a,{onClick:function(){return e.save(!1)}},"Save")))}}]),t}(n.Component),va=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return Y(this.props.qs)?s.a.createElement("select",{value:this.props.q.id,onChange:this.props.setQ},this.props.qs.map(function(e){return s.a.createElement("option",{value:e.id,key:e.id},e.id,": ",e.topic)})):s.a.createElement("div",null,this.props.q.id,": ",s.a.createElement(Aa,null,this.props.q.topic))}}]),t}(n.Component),ga=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={fields:null},a.renderFields=function(e,t){var n={};Object.keys(e).forEach(function(r){"undefined"!==typeof t?n[r]=s.a.createElement(ba,{auto:a.props.auto,key:r,field:r,text:e[r],vars:t,update:a.props.update,change:a.props.change}):null===a.state.fields||a.props.fields[r]!==e[r]?n[r]=s.a.createElement(ba,{auto:a.props.auto,key:r,field:r,text:e[r],vars:a.props.vars,update:a.props.update,change:a.props.change}):n[r]=a.state.fields[r]}),a.setState({fields:n})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return t.fields!==this.state.fields}},{key:"componentWillReceiveProps",value:function(e){null!==this.state.fields&&(e.vars!==this.props.vars?this.renderFields(e.fields,e.vars):e.fields!==this.props.fields&&this.renderFields(e.fields))}},{key:"componentDidMount",value:function(){this.renderFields(this.props.fields,this.props.vars)}},{key:"render",value:function(){var e=this;if(null===this.state.fields)return null;var t=Object.keys(this.state.fields).map(function(t){return e.state.fields[t]});return s.a.createElement("div",null,t)}}]),t}(n.Component),ba=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={stats:{},text:a.props.text,caret:null},a.update=function(e){var t=a.text.selectionStart;if("json"!==a.props.field)var n=ma(e.target.value,t);else n={text:e.target.value,caret:t};a.setState({text:n.text,caret:n.caret}),a.props.update(a.props.field,n.text)},a.setStats=function(){a.setState({stats:Ht(a.props.text,null,!0)})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(){null!==this.state.caret&&this.state.caret!==this.text.selectionStart&&this.text.setSelectionRange(this.state.caret,this.state.caret)}},{key:"componentWillReceiveProps",value:function(e){e.text!==this.state.text&&this.setState({stats:{},text:e.text})}},{key:"render",value:function(){var e=this;return"undefined"===typeof{json:1,working:1,variables:1,help:1,topic:1,answer:1,question:1,title:1,keywords:1,comment:1,topics:1,next:1}[this.props.field]?null:"variables"===this.props.field?s.a.createElement("div",{className:"EditVariables row"},s.a.createElement("div",{className:"col-sm-1",dangerouslySetInnerHTML:{__html:function(e){for(var t="",a=Object.keys(e),n=0;n<a.length;n++)t+=a[n]+"="+e[a[n]]+"<br />\n";return t}(this.props.vars)}}),s.a.createElement("div",{className:"col-sm-1"},s.a.createElement("i",{className:"btn btn-default btn-sm fa fa-btn fa-repeat",onClick:this.props.change})),s.a.createElement("div",{className:"col-sm-2"},"options: ",this.state.stats[!0],s.a.createElement("br",null),"failed: ",this.state.stats[!1]),s.a.createElement("div",{className:"col-sm-2"},s.a.createElement("i",{className:"btn btn-deafult btn-sm fa fa-btn fa-repeat",onClick:this.setStats})),s.a.createElement("div",{className:"col-sm-6"},s.a.createElement("textarea",{ref:function(t){e.text=t},style:{minWidth:"100%"},placeholder:this.props.field,value:this.state.text,rows:this.state.text.split("\n").length,onChange:this.update}))):"json"===this.props.field?this.state.text.length>0?s.a.createElement("div",{className:"EditField row"},s.a.createElement("div",{className:"col-sm-12"},s.a.createElement("textarea",{ref:function(t){e.text=t},style:{minWidth:"100%"},placeholder:this.props.field,value:this.state.text,rows:this.state.text.split("\n").length,onChange:this.update}))):null:s.a.createElement("div",{className:"EditField row"},s.a.createElement("div",{className:"col-sm-6"},s.a.createElement(Aa,{auto:this.props.auto,edit:!0,vars:this.props.vars},this.state.text)),s.a.createElement("div",{className:"col-sm-6"},s.a.createElement("textarea",{ref:function(t){e.text=t},style:{minWidth:"100%"},placeholder:this.props.field,value:this.state.text?this.state.text:"",rows:this.state.text?this.state.text.split("\n").length:1,onChange:this.update})))}}]),t}(n.Component),ka=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={edit:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){this.props.topic&&F.help(this.props.topic)}},{key:"componentWillReceiveProps",value:function(e){e.topic&&e.topic!==this.props.topic&&F.help(e.topic)}},{key:"render",value:function(){var e=this;if(null===this.props.topic)return null;var t=this.props.topic,a="not found",n=0;return F.data&&F.data.help[this.props.topic]?(n=F.data.help[this.props.topic].id,t=F.data.help[this.props.topic].title,a=F.data.help[this.props.topic].text,"about"===this.props.topic&&(a+="\nVersion: "+F.vers())):console.log("help",this.props.topic,F.data.help),this.state.edit?s.a.createElement(Ea,{id:n,title:t,help:a,close:function(){return e.setState({edit:!1})}}):s.a.createElement(ya,{title:t.split("__")[0].replace(/_/g," "),help:a,edit:function(){console.log("click"),e.setState({edit:!0})},close:this.props.close})}}]),t}(n.Component),ya=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return s.a.createElement(S.a,{name:"help",show:!0,onHide:this.props.close},s.a.createElement(S.a.Header,{closeButton:!0},s.a.createElement(S.a.Title,null,s.a.createElement(Aa,null,this.props.title),this.props.edit&&F.user&&F.user.isAdmin?s.a.createElement("span",{className:"btn-link",onClick:this.props.edit}," ",s.a.createElement("i",{className:"fa fa-btn fa-edit"})):null)),s.a.createElement(S.a.Body,null,s.a.createElement(Aa,null,this.props.help)))}}]),t}(n.Component),Ea=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={title:a.props.title,help:a.props.help,id:a.props.id,error:{}},a.save=function(){a.state.title===a.props.title&&a.state.help===a.props.help||ce("/react_ajax/saveHelp",function(e){e.error?a.setState({error:e.data}):(F.data.help[a.props.title.toLowerCase().replace(/ /g,"_")]=e.data,a.props.close())},{title:a.state.title,text:a.state.help,id:a.state.id})},a.update=function(e,t){"title"===e?a.setState({title:t}):"help"===e&&a.setState({help:t})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return s.a.createElement(S.a,{show:!0,bsSize:"large",onHide:this.props.close},s.a.createElement(S.a.Header,{closeButton:!0},this.state.error.error?s.a.createElement("div",{className:"alert alert-danger"},s.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,s.a.createElement(S.a.Title,null,s.a.createElement(ga,{fields:{title:this.state.title},update:this.update}))),s.a.createElement(S.a.Body,null,s.a.createElement(ga,{fields:{help:this.state.help},update:this.update})),s.a.createElement(S.a.Footer,null,s.a.createElement(w.a,{onClick:this.save},"Save")))}}]),t}(n.Component);function Oa(e,t,a,n,s){var r={width:512,height:512};if(e["x/y"]?e["x/y"]>0?r.scale={x:32,y:32*e["x/y"]}:r.scale={x:32/e["x/y"],y:32}:r.scale={x:32,y:32},e.minmax){var o=e.xmax-e.xmin,l=e.ymax-e.ymin;o>l*r.scale.y/32?r.height=r.height*l/o*r.scale.y/32:l>o*r.scale.x/32&&(r.width=r.width*o/l*r.scale.x/32),r.x0=(0-e.xmin)/o*r.width,r.y0=r.height-(0-e.ymin)/l*r.height,r.scale={x:r.width/o,y:r.height/l}}else r.x0=.5*r.width,r.y0=.5*r.height;return r.x0+=t?t.x:0,r.y0+=t?t.y:0,r.scale={x:r.scale.x*(a?a.x:1),y:r.scale.y*(a?a.y:1)},r.doNegativeX=!0,n&&(n.width=r.width,n.height=r.height,r.ctx=n.getContext("2d"),r.ctx.clearRect(0,0,r.width,r.height),s&&(!function(e,t){var a=e.x0,n=e.width,s=e.y0,r=e.height,o=e.doNegativeX?0:a;e.ctx.beginPath(),e.ctx.strokeStyle=t,e.ctx.moveTo(o,s),e.ctx.lineTo(n,s),e.ctx.moveTo(a,0),e.ctx.lineTo(a,r),e.ctx.stroke()}(r,s),e.xi&&Sa(r,e.xi,0,s),e.xi&&Sa(r,0,e.yi,s))),r}function xa(e,t){return t.y0-e<0||t.y0-e>t.height}function ja(e,t){var a=e;return isFinite(e)&&Math.abs(t.y0-e)>5*t.height&&(a=5*-t.height,t.y0-e<0&&(a=-a)),a}function wa(e,t,a){return a.y0-e<0&&a.y0-t<0||a.y0-e>a.height&&a.y0-t>a.height}function qa(e,t,a,n,s,r){var o=function(e,t,a,n,s,r){for(var o={x:e,y:t},l={x:a,y:n},i={x:0,y:0},c={x:NaN,y:NaN},u=1;u<10;u++){if(i.x=(o.x+l.x)/2,i.y=s.scale.y*r(i.x/s.scale.x),isFinite(i.y)){if(isFinite(l.y)&&(l={x:i.x,y:i.y}),isFinite(o.y)&&(o={x:i.x,y:i.y}),c={x:i.x,y:i.y},xa(i.y,s))break}else isFinite(l.y)||(l={x:i.x,y:i.y}),isFinite(o.y)||(o={x:i.x,y:i.y});if(l.x===o.x)break}return c}(e,t,a,n,s,r),l=o.y>=t&&o.y<=n||o.y>=n&&o.y<=t;if(isFinite(t))if(isFinite(n)){if(l)return void s.ctx.lineTo(s.x0+a,ja(s.y0-n,s));if(xa(t,s)&&xa(n,s))return s.ctx.stroke(),s.ctx.beginPath(),void s.ctx.moveTo(s.x0+a,ja(s.y0-n,s));xa(t,s)?wa(t,o.y,s)?qa(o.x,o.y,a,n,s,r):xa(o.y,s)?(s.ctx.stroke(),s.ctx.beginPath(),s.ctx.moveTo(s.x0+o.x,ja(s.y0-o.y,s))):qa(e,t,o.x,o.y,s,r):xa(n,s)?wa(n,o.y,s)?qa(e,t,o.x,o.y,s,r):xa(o.y,s)?(s.ctx.lineTo(s.x0+o.x,ja(s.y0-o.y,s)),s.ctx.stroke(),s.ctx.beginPath(),s.ctx.moveTo(s.x0+a,ja(s.y0-n,s))):qa(o.x,o.y,a,n,s,r):(qa(e,t,o.x,o.y,s,r),qa(o.x,o.y,a,n,s,r))}else!xa(t,s)&&isFinite(o.y)?s.ctx.lineTo(s.x0+o.x,ja(s.y0-o.y,s)):s.ctx.lineTo(s.x0+e,ja(s.y0-t,s));else isFinite(n)&&(!xa(n,s)&&isFinite(o.y)?s.ctx.moveTo(s.x0+o.x,ja(s.y0-o.y,s)):s.ctx.moveTo(s.x0+a,ja(s.y0-n,s)))}function Sa(e,t,a,n){var s=e.x0+t*e.scale.x,r=e.y0-a*e.scale.y;return!(s<0||s>e.width||r<0||r>e.height)&&(n?(e.ctx.fillStyle=n,e.ctx.beginPath(),e.ctx.arc(s,r,3,0,2*Math.PI,!0),void e.ctx.fill()):{left:s,top:r})}var Ca=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={zoom:{x:1,y:1},dragging:!1,shift:{x:0,y:0}},a.zoom=function(e){var t=e.deltaY<0?1.25:.8;a.state.dragging?a.setState({zoom:{x:a.state.zoom.x*t,y:a.state.zoom.y}}):a.setState({zoom:{x:a.state.zoom.x*t,y:a.state.zoom.y*t}})},a.funcs=function(){var e,t=["rgb(255,0,0)","rgb(0,0,255)","rgb(0,255,0)","rgb(255,0,255)","rgb(0,255,255)","rgb(255,255,0)"],n=0,s={fs:[]},r=a.props.funcs;(e=a.range(r))&&(s.range=e,r=e.f);var o,l=Oa(s.range,a.state.shift,a.state.zoom);if(r&&r.split(";").forEach(function(a){(e=ht(a))&&(tt(e)?(o=Sa(l,ye(e.left),ye(e.right)))&&s.fs.push({f:a,e:e,color:"rgb(0,0,0)",pos:o}):s.fs.push({f:a,e:e,color:t[n++]}))}),s.range&&s.range.xi){var i,c=0;for(e=ht("("+c+++"*"+s.range.xi+",0)");e&&(i=Sa(l,ye(e.left),ye(e.right)));)s.fs.push({f:null,e:e,color:"rgb(0,0,0)",pos:i}),e=ht("("+c+++"*"+s.range.xi+",0)");for(c=-1,e=ht("("+c--+"*"+s.range.xi+",0)");e&&(i=Sa(l,ye(e.left),ye(e.right)));)s.fs.push({f:null,e:e,color:"rgb(0,0,0)",pos:i}),e=ht("("+c--+"*"+s.range.xi+",0)")}return s},a.onMouseDown=function(e){document.addEventListener("mousemove",a.onMouseMove),document.addEventListener("mouseup",a.onMouseUp),0===e.button&&(a.setState({dragging:!0,rel:{x:e.pageX,y:e.pageY},orig:{x:a.state.pos.x,y:a.state.pos.y}}),e.stopPropagation(),e.preventDefault())},a.onMouseUp=function(e){a.setState({dragging:!1}),document.removeEventListener("mousemove",a.onMouseMove),document.removeEventListener("mouseup",a.onMouseUp),e.stopPropagation(),e.preventDefault()},a.onMouseMove=function(e){a.state.dragging&&a.setState({pos:{x:a.state.orig.x+e.pageX-a.state.rel.x,y:a.state.orig.y+e.pageY-a.state.rel.y}})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("mousewheel",this.zoom),this.drawGraph(),this.setState({sf:this.sf})}},{key:"componentDidUpdate",value:function(){var e=this.sf;this.drawGraph(),this.sf!==e&&this.setState({sf:this.sf})}},{key:"range",value:function(e){var t={},a=e.match(/^,?(([^,]+),([^,(;]+))?,?(\((.+),(.+)\),?\((.+),(.+)\))?(,?(.+):([^;]+))?;?(.*)/);return console.log("range",e,a),a&&(a[1]&&(t.xi=a[2],t.yi=a[3]),a[4]&&(t.minmax=a[4],t.xmin=ye(ht(a[5])),t.ymin=ye(ht(a[6])),t.xmax=ye(ht(a[7])),t.ymax=ye(ht(a[8]))),a[9]&&(t["x/y"]=ye(ht(a[10]))/ye(ht(a[11]))),t.f=a[12]),a?t:null}},{key:"drawGraph",value:function(){var e=this.funcs(),t=Oa(e.range,this.state.shift,this.state.zoom,this.canvas,"rgb(128,128,128)");e.fs.forEach(function(e){tt(e.e)?e.pos=Sa(t,ye(e.e.left),ye(e.e.right),e.color):function(e,t,a,n){var s,r,o,l,i=Math.round((e.width-e.x0)/1),c=e.doNegativeX?Math.round(-e.x0/1):0;e.ctx.beginPath(),e.ctx.lineWidth=n,e.ctx.strokeStyle=a;for(var u=c;u<=i;u++)o=s,l=r,s=1*u,r=e.scale.y*t(s/e.scale.x),u===c?e.ctx.moveTo(e.x0+s,ja(e.y0-r,e)):!isFinite(r)||!isFinite(l)||Math.abs(r-l)>4?qa(o,l,s,r,e,t):e.ctx.lineTo(e.x0+s,ja(e.y0-r,e));e.ctx.stroke()}(t,function(t){return ye(e.e,{x:t})},e.color,1)}),this.sf=this.canvas.offsetWidth?this.canvas.offsetWidth/this.canvas.width:1,console.log("drawGraph",e,t,this.canvas.width,this.canvas.offsetWidth,this.sf)}},{key:"render",value:function(){var e=this,t=0;return s.a.createElement("div",{style:{position:"relative"}},s.a.createElement("canvas",{ref:function(t){e.canvas=t},onMouseDown:this.onMouseDown,style:{width:"100%"}}),s.a.createElement("div",{style:{position:"absolute",left:0,top:0,zIndex:1}},this.funcs().fs.map(function(a){return tt(a.e)&&e.sf?0!=ye(a.e.left)&&0!=ye(a.e.right)?s.a.createElement("div",{style:{position:"absolute",left:a.pos.left*e.sf,top:a.pos.top*e.sf,zIndex:1,color:a.color},key:t++},s.a.createElement(Ma,null,At(a.e))):0==ye(a.e.left)?s.a.createElement("div",{style:{position:"absolute",left:a.pos.left*e.sf,top:a.pos.top*e.sf,zIndex:1,color:a.color},key:t++},s.a.createElement(Ma,null,At(a.e.right))):s.a.createElement("div",{style:{position:"absolute",left:a.pos.left*e.sf,top:a.pos.top*e.sf,zIndex:1,color:a.color},key:t++},s.a.createElement(Ma,null,At(a.e.left))):s.a.createElement("div",{key:t++,style:{color:a.color}},s.a.createElement(Ma,null,At(a.e)))})))}}]),t}(n.Component),Na=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={fig:null,sf:0},a.sf=function(){a.setState({sf:a.canvas&&a.canvas.offsetWidth&&a.canvas.width?a.canvas.offsetWidth/a.canvas.width:0})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.sf(),window.addEventListener("resize",this.sf)}},{key:"componentDidUpdate",value:function(){this.drawShapes(),console.log("componentDidUpdate",this.state.sf)}},{key:"drawShapes",value:function(){if(this.state.fig&&this.state.axes&&this.canvas&&this.state.poly){var e=this.state.axes;e.ctx=this.canvas.getContext("2d"),e.ctx.clearRect(0,0,e.width,e.height),function(e,t,a){e.ctx.beginPath(),e.ctx.strokeStyle=a;var n=t[t.length-1];e.ctx.moveTo(n.x,n.y),t.forEach(function(t){e.ctx.lineTo(t.x,t.y)}),e.ctx.stroke(),t.forEach(function(t){t.angle&&(t.angle===Math.PI/2?(e.ctx.moveTo(t.x-20,t.y),e.ctx.lineTo(t.x-20,t.y-20),e.ctx.lineTo(t.x,t.y-20),e.ctx.stroke()):function(e,t,a,n,s){e.ctx.beginPath(),e.ctx.arc(t.x,t.y,a,n,s),e.ctx.stroke()}(e,t,50,Math.PI,Math.PI+t.angle))})}(e,this.state.poly,"rgb(0,0,0)"),console.log("drawShapes",e,this.state.poly)}}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{style:{position:"relative"}},s.a.createElement("canvas",{ref:function(t){e.canvas=t},style:{width:"100%"},width:"512",height:"512"}),this.state.poly&&this.state.sf?this.state.poly.map(function(t){return s.a.createElement("div",{key:t.label,style:{position:"absolute",left:t.x*e.state.sf,top:t.y*e.state.sf,zIndex:1,color:t.color}},s.a.createElement(Ma,null,t.label))}):null)}}],[{key:"getDerivedStateFromProps",value:function(e,a){return e&&a.fig===e.fig?null:t.shapes(e)}},{key:"shapes",value:function(e){var t={width:512,height:512,x0:256,y0:256},a=null;if(e&&e.fig&&e.fig.length>0){a=function(e,t,a,n){a=Math.PI*a/180;var s=e.height/2/t,r={x:10,y:e.height-10},o={x:r.x+t*s,y:r.y,angle:a};return[r,o,{x:o.x-n*s*Math.cos(a),y:o.y-n*s*Math.sin(a)}]}(t,4,90,3);var n=0;a.forEach(function(t){t.label=e.fig.charAt(n++)})}return L("shapes")&&console.log("shapes",t,a),{fig:e?e.fig:null,axes:t,poly:a}}}]),t}(n.Component),_a=a(188),Aa=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={help:""},a.close=function(){a.setState({help:""})},a.table=function(e,n){var r=0,o=0,l=e.split("\n").map(function(e){var n=e.split(",").map(function(e){return e.startsWith(" ")?s.a.createElement("th",{style:{textAlign:"center"},key:o++},s.a.createElement(t,{vars:a.props.vars},e.substring(1))):s.a.createElement("td",{style:{textAlign:"center"},key:o++},s.a.createElement(t,{vars:a.props.vars},e))});return s.a.createElement("tr",{key:r++},n)});return s.a.createElement("table",{className:"table table-condensed table-bordered table-striped",style:{width:"auto"},key:n},s.a.createElement("tbody",null,l))},a.help=function(e,t){a.setState({help:e}),t.currentTarget.blur()},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.children!==this.props.children||e.vars!==this.props.vars||t.help!==this.state.help}},{key:"render",value:function(){var e=this;if(!this.props.children)return null;var t=function(e,t,a){if(!e)return[];var n,s=[];L("maths")&&(n=X(t)),t=t||{},a&&(t.auto=!0);for(var r,o={token:null,pos:0,vars:t,auto:a,text:e};null!==Wt(o);)if(""!==o.token)if("object"===Object(ve.a)(o.token))s.push({chunk:o.token.text,error:o.token.error,type:"error"});else if(o.token.startsWith("\\("))Qt(s,o.token,"latex",o.vars);else if(o.token.startsWith(";")&&(r=Dt(o)))Qt(s,At(r),"maths");else if(o.token.startsWith("'"))Qt(s,It(o.token.substring(1)),"html");else if(o.token.startsWith("{xyz=")&&o.token.endsWith("}"))o.vars.xyz=o.token.substring(5,o.token.length-1);else if(o.token.startsWith("{graph;")&&o.token.endsWith("}"))s.push({chunk:o.token.substring(7,o.token.length-1),type:"graph"});else if(o.token.startsWith("{fig;")&&o.token.endsWith("}"))s.push({chunk:o.token.substring(5,o.token.length-1),type:"fig"});else if(o.token.endsWith(".png"))s.push({chunk:o.token,type:"png"});else if(o.token.startsWith("@")){var l=Lt(o.token.substring(1));Qt(s,l.name,"help"),""!==l.end&&Qt(s,l.end,"text")}else o.token.startsWith("[")&&o.token.endsWith("]")?Qt(s,o.token.substring(1,o.token.length-1),"table"):(r=Dt(o))?Qt(s,At(r),"maths"):Qt(s,It(o.token),"html");return L("maths")&&console.log("maths(text,vars,auto)=",X(s),e,n,t,a),s}(this.props.children,this.props.vars,this.props.auto),a=0,n="",r=t.map(function(t){if("\n"===t.chunk)if(n.endsWith(">")||n.endsWith(" "))var r=null;else r=s.a.createElement("br",{key:a++});else r="latex"===t.type?s.a.createElement(Ma,{key:a++},t.chunk):"error"===t.type?s.a.createElement("div",{key:a++},s.a.createElement("span",null,t.chunk),s.a.createElement("span",{className:"red"}," ",t.error)):"maths"===t.type?s.a.createElement(Ma,{key:a++},t.chunk):"help"===t.type?s.a.createElement("span",{className:"btn-link",key:a++,onClick:function(a){return e.help(t.chunk,a)}},t.chunk.split("__")[0]):"table"===t.type?e.table(t.chunk,a++):"png"===t.type?s.a.createElement("img",{key:a++,alt:"figure",src:t.chunk,style:{maxWidth:"100%"}}):"graph"===t.type?s.a.createElement("div",{key:a++,className:"row"},s.a.createElement(Ca,{funcs:t.chunk})):"fig"===t.type?s.a.createElement("div",{key:a++,className:"row"},s.a.createElement(Na,{fig:t.chunk})):s.a.createElement("span",{key:a++,dangerouslySetInnerHTML:{__html:t.chunk}});return n="html"===t.type?t.chunk:"",r}),o=null;return""!==this.state.help&&(o=s.a.createElement(ka,{edit:this.props.edit,topic:this.state.help,close:this.close})),s.a.createElement("div",{style:{display:"inline"},width:"100%"},r,o)}}]),t}(n.Component),Ma=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e;try{e=s.a.createElement("span",{className:"expression",dangerouslySetInnerHTML:{__html:_a.renderToString(this.props.children)}})}catch(t){e=s.a.createElement("div",null,s.a.createElement("span",null,this.props.children)),console.log("Latex",t.message)}return e}}]),t}(n.Component),Ta=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={message:a.props.text?a.props.text:"",name:"",email:"",maths:!1,error:{},to:"",from:"",sending:!1},a.error=function(e){return a.setState({error:e,sending:!1})},a.contact=function(e){var t=a.props.qkey?a.props.qkey:a.props.reply&&a.props.reply.qkey?a.props.reply.qkey:null,n=t?J(a.props.qkey,!0):null,s={email:a.state.email,name:a.state.name,maths:a.state.maths,message:a.state.message,from:a.state.from,to:a.state.to,qkey:t,question:n};a.props.photo&&(s.photo=a.props.photo.id),a.setState({error:{},sending:!0}),F.contact(s,a.props.reply,a.props.close,a.error)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){if(this.props.reply)this.setState({message:this.props.reply.message,maths:this.props.reply.maths,to:this.props.reply.from,from:this.props.reply.to});else if(this.props.photo)this.setState({message:this.props.photo.comment,maths:this.props.photo.maths});else if(this.props.uid){var e=F.students[this.props.uid];e||console.error("Contact",this.props.uid),this.setState({to:e||null})}}},{key:"render",value:function(){var e=this;return s.a.createElement(S.a,{name:"contact",bsSize:this.state.maths?"lg":null,show:!0,onHide:function(){return e.props.close()}},s.a.createElement(S.a.Header,{closeButton:!0},s.a.createElement(S.a.Title,null,this.props.reply?"Reply to ":"Contact ",this.state.to?this.state.to.name:"FreeMaths.uk"," ",this.props.photo?s.a.createElement(w.a,{bsStyle:"primary",onClick:this.contact},s.a.createElement("i",{className:"fa fa-envelope-o"})):null)),s.a.createElement(S.a.Body,null,this.state.sending?s.a.createElement("div",{className:"alert alert-success"},s.a.createElement("strong",null,"Sending ...")):null,this.state.error.error?s.a.createElement("div",{className:"alert alert-danger"},s.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,s.a.createElement(y.a,{onSubmit:this.contact,horizontal:!0},F.user||this.props.reply?null:s.a.createElement("div",null,s.a.createElement(E.a,{controlId:"name",validationState:Y(this.state.error.name)?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Name"),s.a.createElement(b.a,{sm:9},s.a.createElement(x.a,{type:"name",name:"name",value:this.state.name,placeholder:"First Last",onChange:function(t){return e.setState({name:t.target.value,error:{}})}})),Y(this.state.error.name)?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.name)):null),s.a.createElement(E.a,{controlId:"email",validationState:Y(this.state.error.email)?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Email"),s.a.createElement(b.a,{sm:9},s.a.createElement(x.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.setState({email:t.target.value,error:{}})}})),Y(this.state.error.email)?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.email)):null)),this.props.qkey?s.a.createElement(E.a,null,s.a.createElement(b.a,{componentClass:O.a,sm:2},"Question"),s.a.createElement(b.a,{sm:9},J(this.props.qkey,!0))):null,this.state.maths?s.a.createElement(Pa,{text:this.state.message,update:function(t){return e.setState({message:t})},close:function(){return e.setState({maths:!1})}}):s.a.createElement(E.a,{controlId:"message",validationState:this.state.error.message?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"Message"),s.a.createElement(b.a,{sm:9},s.a.createElement("textarea",{placeholder:"Your message",value:this.state.message,rows:8,style:{minWidth:"100%"},onChange:function(t){return e.setState({message:t.target.value,error:{}})}})),this.state.error.message?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.message)):null,s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(q.a,{checked:!1,onChange:function(t){return e.setState({maths:!0})}},"include maths?")))),this.props.photo?s.a.createElement("img",{width:"100%",src:this.props.photo.jpeg,alt:""}):null,s.a.createElement(S.a.Footer,null,s.a.createElement(w.a,{bsStyle:"primary",onClick:this.contact},s.a.createElement("i",{className:"fa fa-envelope-o"})," ",this.props.reply?"Reply":"Contact Us"))))}}]),t}(n.Component),Pa=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={caret:null,text:a.props.text?a.props.text:""},a.update=function(e){var t=ma(e.target.value,a.text.selectionStart);a.setState({text:t.text,caret:t.caret}),a.props.update&&a.props.update(t.text)},a.key=function(e){e.preventDefault(),a.text.focus();var t=a.state.text,n=a.text.selectionStart,s=a.text.selectionEnd;n&&s||(n=s=0===n&&0===s?0:null!==a.state.caret?a.state.caret:t.length),t=t.substr(0,n)+e.target.value+t.substr(s,t.length-s),a.setState({text:t,caret:n+1}),a.props.update&&a.props.update(t)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(){null!==this.state.caret&&this.text.setSelectionRange(this.state.caret,this.state.caret)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement("div",{className:"EditField row"},s.a.createElement("div",{className:"col-sm-6"},s.a.createElement(Aa,{auto:!0},this.state.text)),s.a.createElement("div",{className:"col-sm-6"},s.a.createElement("textarea",{ref:function(t){e.text=t},style:{minWidth:"100%"},placeholder:"Message",value:this.state.text,rows:8,onChange:this.update}),s.a.createElement("div",null,Object.keys(Re).map(function(t){return s.a.createElement(K,{key:t,tooltip:Re[t]},s.a.createElement(w.a,{onClick:e.key,value:t,bsSize:"small"},t))})),this.props.close?s.a.createElement("div",null,s.a.createElement(q.a,{checked:!0,onChange:this.props.close}," maths? ",s.a.createElement("span",{className:"btn-link",onClick:function(e){e.preventDefault(),F.parent.help("typing_maths")}},"(help)"))):s.a.createElement("div",{className:"btn-link",onClick:function(e){e.preventDefault(),F.parent.help("typing_maths")}},"Help"))))}}]),t}(n.Component),Wa=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={message:null,error:{},reply:!1,photo:null},a.message=function(e){a.setState({message:e}),e.photo&&F.getPhoto(e.photo,function(e){return a.setState({photo:e})})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){F.mail(this.props.token,this.message,this.props.close)}},{key:"render",value:function(){var e=this;return null===this.state.message?null:this.state.reply?s.a.createElement(Ta,{reply:this.state.message,close:function(t){return e.props.close(t)}}):s.a.createElement(S.a,{show:!0,name:"mail",onHide:function(){return e.props.close()}},s.a.createElement(S.a.Header,{closeButton:!0},s.a.createElement(S.a.Title,null,"Message from ",this.state.message.from.name,this.state.message.qkey?s.a.createElement("div",null,"Question: "+J(this.state.message.qkey,!0)):null)),s.a.createElement(S.a.Body,null,this.state.error.error?s.a.createElement("div",{className:"alert alert-danger"},s.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,this.state.message.maths?s.a.createElement(Aa,{auto:!0},this.state.message.message):s.a.createElement("div",null,this.state.message.message),this.state.photo?s.a.createElement("img",{width:"100%",src:this.state.photo.jpeg,alt:""}):null),s.a.createElement(S.a.Footer,null,s.a.createElement(w.a,{bsStyle:"primary",onClick:function(){return e.setState({reply:!0})}},s.a.createElement("i",{className:"fa fa-envelope-o"})," Reply")))}}]),t}(n.Component);function za(e,t){return""===e&&""===t?"":(""===e?0:1*e)+(""===t?0:1*t)}function Qa(e,t,a,n){Y(e[n].c)||(e[n].c=[]),e[n].c.push.apply(e[n].c,t.c[a])}function Da(e,t,a,n,s,r){if(Y(e[a])||(e[a]={"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:0,effort:0,r:[]}),a===n)[":(",":|",":)","\u2717","?\u2713","\u2713"].forEach(function(r){Y(t[r][s])&&t[r][s].forEach(function(o){return e[a][r].push({uid:s,key:n,ts:o.ts,a:o.a,v:o.v,l:r===t.l[s].m||r===t.l[s].f})})}),s===r?t.rs[s].forEach(function(r){return e[a].r.push({uid:s,key:n,mk:r.mk,mks:t.mks,ts:r.ts})}):e[a].r.push({uid:s,key:n,mk:t.l[s].mk,mks:t.mks,ts:t.l[s].ts});else{if(""!==t.l[s].m){var o=t[t.l[s].m][s][t[t.l[s].m][s].length-1];e[a][t.l[s].m].push({uid:s,key:n,ts:o.ts,a:o.a,v:o.v})}if(""!==t.l[s].f){var l=t[t.l[s].f][s][t[t.l[s].f][s].length-1];e[a][t.l[s].f].push({uid:s,key:n,ts:l.ts,a:l.a,v:l.v})}}""!==t.l[s].mk&&(e[a].mks+=t.mks),e[a].mk=za(e[a].mk,t.l[s].mk),e[a].qs++,t.l[s].ts>e[a].ts&&(e[a].ts=t.l[s].ts),e[a].uid=s}function Fa(e,t,a,n){Y(e.l[n])||(e.l[n]={"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:0,effort:0}),""!==t.l[n].m&&e.l[n][t.l[n].m].push({key:a,ts:t[t.l[n].m][n][t[t.l[n].m][n].length-1].ts}),""!==t.l[n].f&&e.l[n][t.l[n].f].push({key:a,ts:t[t.l[n].f][n][t[t.l[n].f][n].length-1].ts}),""!==t.l[n].mk&&(e.l[n].mks+=t.mks),e.l[n].mk=za(e.l[n].mk,t.l[n].mk),t.l[n].ts>e.l[n].ts&&(e.l[n].ts=t.l[n].ts),e.l[n].qs++}function Ia(e,t,a){var n="0"===t.paper?{qs:[{id:t.q}]}:a.data.tests.tests[t.paper];0!==t.paper&&(Y(e.ts[t.paper])||(e.ts[t.paper]={rs:{},qs:{},l:{},c:{}}),Y(e.uids[t.user_id])?0===e.uids[t.user_id].p&&(e.uids[t.user_id].p=t.paper,e.uids[t.user_id].ts=e.uids[t.user_id].ts1=t.ts):e.uids[t.user_id]={p:t.paper,ts1:t.ts,ts:t.ts,l:{},c:{}});var s=e.uids[t.user_id];if(Y(s)&&(t.ts-s.ts>36e5||t.paper!==s.p)){var r={"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:0,effort:0};Object.keys(n.qs).forEach(function(a){var n=s.p+":::"+a.id,o=e.ts[s.p].qs[n];Y(o)&&Y(o.xl[t.user_id])&&(0===r.ts&&(r.ts=o.xl[t.user_id].ts,r.effort=o.xl[t.user_id].ts-s.ts1),""!==o.xl[t.user_id].m&&r[o.xl[t.user_id].m].push({key:n,ts:o[o.xl[t.user_id].m].ts}),""!==o.xl[t.user_id].f&&r[o.xl[t.user_id].f].push({key:n,ts:o[o.xl[t.user_id].f].ts}),r.mks++,r.qs++,r.mk=za(r.mk,o.xl[t.user_id].mk),o.xl[t.user_id]=null)}),Y(e.ts[s.p].rs[t.user_id])||(e.ts[s.p].rs[t.user_id]=[]),0!==s.p&&e.ts[s.p].rs[t.user_id].push(r),e.uids[t.user_id].p=t.paper,e.uids[t.user_id].ts=e.uids[t.user_id].ts1=t.ts}if(0!==t.paper&&("\u2713"===t.event||"\u2717"===t.event||"?\u2713"===t.event||":("===t.event||":|"===t.event||":)"===t.event)){var o=t.paper+":::"+t.q;Y(e.ts[t.paper].qs[o])||(e.ts[t.paper].qs[o]={mks:1,l:{},xl:{},c:{},rs:{},"\u2717":{},":(":{},"?\u2713":{},":|":{},"\u2713":{},":)":{}});var l=e.ts[t.paper].qs[o];Y(l.l[t.user_id])||(l.l[t.user_id]={m:"",f:"",ts:t.ts,mk:0},l.rs[t.user_id]=[]),Y(l.xl[t.user_id])||(l.xl[t.user_id]={m:"",f:"",ts:t.ts,mk:0}),Y(l[t.event][t.user_id])||(l[t.event][t.user_id]=[]),"\u2713"===t.event||"\u2717"===t.event||"?\u2713"===t.event?(l.l[t.user_id].m=l.xl[t.user_id].m=t.event,l[t.event][t.user_id].push({ts:t.ts,a:t.answer,v:t.variables}),"\u2713"===t.event?l.l[t.user_id].mk=l.xl[t.user_id].mk=1:l.l[t.user_id].mk=l.xl[t.user_id].mk=0,l.rs[t.user_id].push({ts:t.ts,mk:l.xl[t.user_id].mk})):":("!==t.event&&":|"!==t.event&&":)"!==t.event||(l.l[t.user_id].f=l.xl[t.user_id].f=t.event,l[t.event][t.user_id].push({ts:t.ts}),t.comment.length>0&&(Y(l.c[t.user_id])||(l.c[t.user_id]=[]),l.c[t.user_id].push({key:o,uid:t.user_id,c:t.comment,f:t.event,ts:t.ts}))),l.l[t.user_id].ts=l.xl[t.user_id].ts=e.uids[t.user_id].ts=t.ts}}function La(e,t){var a=t?F.log:F.user.log;if(!a)return null;if(e){if(0===a.length||e.last===a[a.length-1].id)return e}else e={users:{},log:a,uids:{},ts:{}};return t?Object.keys(F.students).forEach(function(t){e.users[t]||(e.users[t]={name:F.students[t].name,log:[]})}):e.users[F.user.id]||(e.users[F.user.id]={log:[]}),a.forEach(function(t){if(1*t.user_id!==0&&!(e.last&&t.id<=e.last&&e.users[t.user_id].log.length>0)){t.ts=new Date(t.created_at.replace(" ","T")).getTime();var a=t.paper?t.paper.split(":")[0]:"0";"0"===t.paper||F.data.tests.tests[a]?(t.q=t.question,Ia(e,t,F)):"\u2713\u2717"===t.event&&function(e,t){Y(e.ts[t.paper])||(e.ts[t.paper]={rs:{},qs:{},l:{},c:{}}),Y(e.uids[t.user_id])||(e.uids[t.user_id]={p:0,l:{}});var a=JSON.parse(t.variables),n={"":[],"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:t.ts,effort:a.effort};a.marks.forEach(function(a){if(Y(a)){var s=t.paper.indexOf(":")>0?t.paper+":"+a.q:t.paper+":::"+a.q;Y(e.ts[t.paper].qs[s])||(e.ts[t.paper].qs[s]={mks:1*a.mks,l:{},xl:{},c:{},rs:{},"":{},"\u2717":{},":(":{},"?\u2713":{},":|":{},"\u2713":{},":)":{}});var r=e.ts[t.paper].qs[s];Y(r.l[t.user_id])||(r.l[t.user_id]={m:"",f:"",ts:0,mk:0},r.rs[t.user_id]=[]),r.l[t.user_id].ts=t.ts,r.l[t.user_id].mk=a.mk,r.rs[t.user_id].push({ts:t.ts,mk:a.mk}),""!==a.mk&&(n.mks+=1*a.mks),n.mk=za(n.mk,a.mk),n.qs++,r.l[t.user_id].f=a.f,Y(r[a.f][t.user_id])||(r[a.f][t.user_id]=[]),r[a.f][t.user_id].push({ts:t.ts}),n[a.f].push({key:s,ts:t.ts}),r.l[t.user_id].m=a.m,Y(r[a.m][t.user_id])||(r[a.m][t.user_id]=[]),r[a.m][t.user_id].push({ts:t.ts,a:t.answer}),n[a.m].push({key:s,ts:t.ts}),Y(a.c)&&a.c.length>0&&(Y(r.c[t.user_id])||(r.c[t.user_id]=[]),r.c[t.user_id].push({key:s,uid:t.user_id,c:a.c,f:a.f,ts:t.ts}))}}),Y(e.ts[t.paper].rs[t.user_id])||(e.ts[t.paper].rs[t.user_id]=[]),e.ts[t.paper].rs[t.user_id].push(n)}(e,t),e.users[t.user_id].log.unshift(t),e.last=t.id}}),Object.keys(e.uids).forEach(function(t){0!==e.uids[t].p&&Ia(e,{user_id:t,event:"",paper:"0"},e.uids[t].ts)},F),function(e){Object.keys(e.uids).forEach(function(t){return e.uids[t].l={}}),Object.keys(e.ts).forEach(function(t){e.ts[t].l={},Object.keys(e.ts[t].qs).forEach(function(a){Object.keys(e.ts[t].qs[a].l).forEach(function(n){var s=e.ts[t].qs[a];Fa(e.ts[t],s,a,n),Fa(e.uids[n],s,a,n)})})})}(e),e}function Ha(e,t,a){return a?t.ts-e.ts:t[":("].length-e[":("].length!==0?t[":("].length-e[":("].length:t[":|"].length-e[":|"].length!==0?t[":|"].length-e[":|"].length:t["\u2717"].length-e["\u2717"].length!==0?t["\u2717"].length-e["\u2717"].length:t["?\u2713"].length-e["?\u2713"].length!==0?t["?\u2713"].length-e["?\u2713"].length:t.mks-e.mks-(t.mk-e.mk)}function Ba(e){return 0===e.length||Y(e[0].l)&&!e[0].l?0:e.length}var Ua=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return"book"===this.props.type?s.a.createElement(In,{stats:this.props.stats,set:this.props.setTopic,pkey:this.props.pkey}):s.a.createElement("div",null,s.a.createElement("h3",{className:"inline"},"Subject: ")," ",s.a.createElement(Ra,{type:this.props.type,topic:this.props.topic,setTopic:this.props.setTopic}),this.props.topic&&"0"!==this.props.topic?s.a.createElement(On,{type:this.props.type,topic:this.props.topic,stats:this.props.stats,update:this.props.update}):null)}}]),t}(n.Component),Ra=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=[s.a.createElement("option",{key:0,value:"0"},"select")];return["GCSE(9-1)","IGCSE","P1","SM1","C1","C2","C3","C4","FP1","FP2","FP3","D1","D2","S1","S2","S3","S4","M1","M2","M3","M4","M5"].forEach(function(e){t.push(s.a.createElement("option",{key:e},e))}),s.a.createElement("form",{className:"form-horizontal inline"},s.a.createElement("select",{className:"form-control inline",style:{width:"auto"},value:this.props.topic,onChange:function(t){return e.props.setTopic(t.target.value)}},t))}}]),t}(n.Component),Ja=Ua,$a=a(81),Va=a.n($a),Ka=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).takePhoto=function(e){e.preventDefault(),new ImageCapture(a.video.srcObject.getVideoTracks()[0]).grabFrame().then(function(e){a.video.srcObject.getVideoTracks().forEach(function(e){return e.stop()});var t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),a.props.photo(t.toDataURL("image/jpeg"))}).catch(function(e){a.props.error({message:{type:"error",text:"Camera error - "+e.message}})})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.video&&navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(function(t){e.video.srcObject=t}).catch(function(t){e.setState({error:t.message})})}},{key:"componentWillUnmount",value:function(){this.video&&this.video.srcObject&&this.video.srcObject.getVideoTracks().forEach(function(e){return e.stop()})}},{key:"render",value:function(){var e=this;return s.a.createElement("video",{onClick:this.takePhoto,ref:function(t){e.video=t},width:"100%",autoPlay:!0,muted:!0,playsInline:!0})}}]),t}(n.Component),Ga=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={comment:"",maths:!1,jpeg:null,camera:!1},a.comment=function(e,t,n){"comment"===e&&a.setState({comment:t,maths:!!n})},a.photo=function(e){var t=new Image;t.src=e,t.onload=function(){for(var e,n=document.createElement("canvas"),s=n.getContext("2d"),r=0;t.width>>r>1024||t.height>>r>1024;)r++;var o=t.width>>r,l=t.height>>r;switch(Va.a.getData(t,function(){e=Va.a.getTag(this,"Orientation")}),4<e&&e<9?(n.width=l,n.height=o):(n.width=o,n.height=l),e){case 2:s.transform(-1,0,0,1,o,0);break;case 3:s.transform(-1,0,0,-1,o,l);break;case 4:s.transform(1,0,0,-1,0,l);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,l,0);break;case 7:s.transform(0,-1,-1,0,l,o);break;case 8:s.transform(0,-1,1,0,0,o)}s.drawImage(t,0,0,t.width,t.height,0,0,o,l),a.setState({jpeg:n.toDataURL("image/jpeg",.8),exif:e,camera:!1})}},a.savePhoto=function(){F.photo({jpeg:a.state.jpeg,comment:a.state.comment,maths:a.state.maths}),a.props.close()},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(S.a,{name:"photo",show:!0,onHide:function(){return e.props.close()}},s.a.createElement(S.a.Header,{closeButton:!0},this.state.jpeg?s.a.createElement(w.a,{bsStyle:"primary",onClick:this.savePhoto},"Save"):s.a.createElement(S.a.Title,null,"Upload Photo")),s.a.createElement(S.a.Body,null,s.a.createElement(Xa,{jpeg:this.state.jpeg,exif:this.state.exif,photo:this.photo,comment:this.state.comment,update:this.comment})))}}]),t}(n.Component),Xa=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={camera:!1,message:null},a.file=function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(){return a.props.photo("data:"+t.type+";base64,"+btoa(n.result))},n.readAsBinaryString(t)}},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return this.props.jpeg?s.a.createElement("div",null,s.a.createElement(Ya,{comment:this.props.comment,update:this.props.update}),s.a.createElement("img",{width:"100%",src:this.props.jpeg,alt:""}),s.a.createElement("div",null,"Size:",this.props.jpeg.length," ",this.props.exif?"Rotation:"+this.props.exif:null)):s.a.createElement("form",{className:"form-inline",onSubmit:function(e){return e.preventDefault()}},s.a.createElement("div",{className:"form-group row"},F.user.isMobile?s.a.createElement("label",{for:"photo",class:"col-xs-2 col-form-label"},s.a.createElement("i",{className:"fa fa-camera fa-2x"})):this.state.camera?null:s.a.createElement("button",{name:"camera",className:"col-xs-2 btn-link",onClick:function(){return e.setState({camera:!0})}},s.a.createElement("i",{className:"fa fa-camera fa-2x"})),this.state.camera?"Click on photo to take.":s.a.createElement("input",{id:"photo",onChange:this.file,type:"file",className:"form-control-file col-xs-10",capture:"camera",accept:"image/*"}),this.state.camera?s.a.createElement(Ka,{photo:this.props.photo,error:function(t){e.setState({camera:!1,message:t})}}):null))}}]),t}(n.Component),Ya=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={maths:!1,error:{}},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return this.state.maths?s.a.createElement(Pa,{text:this.props.comment,update:function(t){return e.props.update("comment",t,!0)},close:function(){return e.setState({maths:!1})}}):s.a.createElement(E.a,{controlId:"message",validationState:this.state.error.message?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:2},"comment"),s.a.createElement(b.a,{sm:9},s.a.createElement("textarea",{placeholder:"comment",value:this.props.comment,rows:1,style:{minWidth:"100%"},onChange:function(t){return e.props.update("comment",t.target.value,!1)}})),this.state.error.message?s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(j.a,null,this.state.error.message)):null,s.a.createElement(b.a,{smOffset:2,sm:9},s.a.createElement(q.a,{checked:!1,onChange:function(t){return e.setState({maths:!0})}},"include maths?")))}}]),t}(n.Component),Za=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={photo:null},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;F.getPhoto(this.props.log.answer,function(t){return e.setState({photo:t})})}},{key:"render",value:function(){var e=this;return s.a.createElement(S.a,{name:"photo",show:!0,onHide:function(){return e.props.close()}},s.a.createElement(S.a.Header,{closeButton:!0},s.a.createElement(S.a.Title,null,"Photo Log ",s.a.createElement(os,{photo:this.state.photo}))),s.a.createElement(S.a.Body,null,this.state.photo?s.a.createElement("div",null,s.a.createElement(Aa,{auto:this.state.photo.maths},this.state.photo.comment),s.a.createElement("img",{width:"100%",src:this.state.photo.jpeg,alt:""})):null))}}]),t}(n.Component),en=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={log:null},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"processLog",value:function(e){var t=this;L("processLog")&&console.log("processLog",e,F.user.log);var a=e||F.user.log;if(!a.length)return null;if(this.state.log)return s.a.createElement(tn,{log:this.state.log,close:function(){return t.setState({log:null})}});var n={};return a.filter(function(e){return!t.props.uid||1*e.user_id===1*t.props.uid}).sort(function(e,t){return e.id-t.id}).forEach(function(e){var a=t.props.uid?e.created_at.substr(0,10):e.user_id;a&&(n[a]&&e.created_at.substr(0,10)===n[a].date.substr(0,10)?("Start"===e.event?(n[a].msecs+=n[a].end?n[a].end-se(n[a].date):0,n[a].date=e.created_at,n[a].end=null):n[a].end=se(e.created_at),n[a].events.push(e)):n[a]={uid:e.user_id,date:e.created_at,events:[e],msecs:0})}),Object.keys(n).forEach(function(e){n[e].start=se(n[e].date),n[e].msecs+=n[e].end?n[e].end-n[e].start:0}),n}},{key:"render",value:function(){var e=this;if(L("Log")&&console.log("Log",this.props.log,F.user.log),this.state.log)return s.a.createElement(tn,{log:this.state.log,close:function(){return e.setState({log:null})}});var t=this.processLog(this.props.log);return t?(L("Log")&&console.log("Log",t),s.a.createElement("div",{name:"Log"},s.a.createElement("h3",null,"Log ",s.a.createElement("span",{name:"camera",onClick:function(){return e.props.modal("photo")}},s.a.createElement("i",{className:"fa fa-camera"}))),s.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},s.a.createElement("thead",null,s.a.createElement("tr",null,this.props.uid?null:s.a.createElement("th",null,"Name"),s.a.createElement("th",null,"Date"),s.a.createElement("th",null,"Time"),s.a.createElement("th",null,"Events"))),s.a.createElement("tbody",null,Object.keys(t).sort(function(e,a){return t[a].start-t[e].start}).map(function(a){return s.a.createElement("tr",{key:a},e.props.uid?null:s.a.createElement("td",null,s.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setUid(a)}},F.students[a].name)),s.a.createElement("td",{align:"right"},s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({log:t[a].events})}},ne(t[a].start,!0))),s.a.createElement("td",{align:"right"},oe(t[a].msecs)),s.a.createElement("td",{align:"center"},s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({log:t[a].events})}},t[a].events.length)))}))))):null}}]),t}(n.Component),tn=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={log:null},a.qn=function(e){var t=null,a=R(e.paper);if(a&&"vars"===a.type)t=U(e.question,e.paper);else if(a&&("past"===a.type||"book"===a.type)){var n=JSON.parse(e.variables),s=0;n.marks.forEach(function(e){null!==e&&s++}),t=s}return t},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return L("Events")&&console.log("Events",this.props.log),this.state.log?s.a.createElement(an,{log:this.state.log,close:function(){return e.setState({log:null})}}):s.a.createElement($,{name:"Events",close:this.props.close,title:"Activity Log"},s.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"Test"),s.a.createElement("th",null,"Q"),s.a.createElement("th",null,"Event"),s.a.createElement("th",null,"Time"))),s.a.createElement("tbody",null,this.props.log.sort(function(e,t){return e.id-t.id}).map(function(t){return s.a.createElement("tr",{key:t.id},s.a.createElement("td",null,"Help"===t.event?t.answer:J(t.paper,t.question)),s.a.createElement("td",null,s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({log:t})}},e.qn(t))),s.a.createElement("td",{className:$n[t.event],onClick:function(){return e.setState({log:t})}},Gn[t.event]?Gn[t.event]:t.event),s.a.createElement("td",null,function(e,t){if(!Y(e)||0===e)return"";var a,n,s,r,o=new Date(1*e);return t?(n=(a=o).getHours(),(s=a.getMinutes())<10&&(s="0"+s),(r=a.getSeconds())<10&&(r="0"+r),n+":"+s+":"+r):ae(o)}(se(t.created_at),!0)))}))))}}]),t}(n.Component),an=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){if(L("Log")&&console.log("Log",this.props.log),"Help"===this.props.log.event)return s.a.createElement(ka,{topic:this.props.log.answer,close:this.props.close});if("Photo"===this.props.log.event)return s.a.createElement(Za,{log:this.props.log,close:this.props.close});if("Email"===this.props.log.event)return s.a.createElement(Wa,{token:this.props.log.answer,close:this.props.close});var e=R(this.props.log.paper);return"vars"===e.type?s.a.createElement(nn,{log:this.props.log,close:this.props.close}):"past"===e.type?s.a.createElement(sn,{log:this.props.log,close:this.props.close}):"book"===e.type?s.a.createElement(sn,{log:this.props.log,close:this.props.close}):(console.error("Log",e,this.props.log),"Log error")}}]),t}(n.Component),nn=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.log,t=F.data.tests.questions[e.question],a=e.variables?JSON.parse(e.variables):null,n=e.answer?ea(e.answer,t.answer,a):null;return s.a.createElement($,{name:"Log",close:this.props.close,title:J(e.paper)+"Q "+U(e.question,e.paper)},t?s.a.createElement(Aa,{vars:a},t.question):null,e.answer?s.a.createElement("div",null,"\u2713"===n.correct?s.a.createElement(Aa,{vars:a},e.answer):s.a.createElement(Aa,{auto:!1},n.diff),s.a.createElement(vs,{mark:n})):null)}}]),t}(n.Component),sn=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.log,t=JSON.parse(e.variables);return s.a.createElement($,{name:"Log",close:this.props.close,title:J(e.paper)},t.marks.filter(function(e){return null!==e}).map(function(e){return s.a.createElement("div",{key:e.q},"Q",e.q," ",s.a.createElement("span",{className:Xn(e.mk,e.mks)},e.mk,"/",e.mks),"  ",Gn[e.m]," ",Gn[e.f]," ",e.c)}))}}]),t}(n.Component),rn=en,on=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={uid:null,pkey:null,topic:"0",students:null,stats:null,test:null,edit:!1,s:null,q:null,cs:null,log:null,all:F.user.isAdmin},a.toggleAll=function(){a.props.fm.getStudents(!a.state.all),a.setState({all:!a.state.all})},a.setTest=function(e,t){a.setState({test:e.toString(),edit:t})},a.setPaper=function(e){var t=e.split(":"),n=Object(C.a)(t,4),s=n[0],r=n[1],o=n[2];Y(n[3])&&(e=""!==o?s+":"+r+":"+o:s),Y(R(s))&&e===a.state.pkey?a.props.students?a.setState({pkey:null,test:null}):a.setState({test:e}):a.setState({pkey:e,topic:"0"})},a.setQ=function(e){a.setState({test:e})},a.setS=function(e,t){t?a.setState({cs:e}):null!==a.state.s?a.setState({s:null}):Z(e)||a.setState({s:e})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.students&&!F.students?F.getStudents(this.state.all):e.students?this.setState({students:La(null,e.students)}):this.setState({stats:La(null,e.students)}),e.type!==this.props.type&&this.setState({pkey:null,topic:"0"})}},{key:"componentWillMount",value:function(){this.props.students&&!F.students?F.getStudents(this.state.all):this.props.students?this.setState({students:La(null,this.props.students)}):this.setState({stats:La(null,this.props.students)})}},{key:"render",value:function(){var e=this,t=null,a=this.props.students?this.state.students:this.state.stats;if(!a)return s.a.createElement("div",{className:"blue"},"loading...");if(null!==this.state.test){var n=R(this.state.test);"past"===n.type||"book"===n.type?t=s.a.createElement(jn,{user:this.props.user,stats:a,test:this.state.test,close:function(){return e.setState({pkey:null,test:null})}}):"vars"===n.type&&console.error("Students type vars")}return a=function(e,t,a,n,s){return e.t={qs:{},ts:{},uids:{},corrections:{}},Object.keys(e.ts).filter(function(e){return!Y(n)||R(e).type===n}).forEach(function(n){(null===a||"0"===a||a===n.substr(0,a.length)||J(n).startsWith(a))&&(Object.keys(e.ts[n].qs).forEach(function(a){Object.keys(e.ts[n].qs[a].l).forEach(function(s){if(s===t||null===t){var r=e.ts[n].qs[a];Da(e.t.qs,r,a,a,s,t),Da(e.t.ts,r,n,a,s),Da(e.t.uids,r,s,a,s),Qa(e.t.uids,r,s,s),Qa(e.t.ts,r,s,n),Qa(e.t.qs,r,s,a)}})}),Object.keys(e.ts[n].l).forEach(function(a){if(a===t||null===t){var s=e.ts[n].l[a];Y(e.t.uids[a].r)||(e.t.uids[a].r=[]),e.t.uids[a].r.push({uid:a,key:n,mk:s.mk,mks:s.mks,ts:s.ts}),Y(e.t.ts[n].r)||(e.t.ts[n].r=[]),null===t?e.t.ts[n].r.push({uid:a,key:n,mk:s.mk,mks:s.mks,ts:s.ts}):e.ts[n].rs[t].forEach(function(t){t.ts>0&&e.t.ts[n].r.push({uid:a,key:n,mk:t.mk,mks:t.mks,ts:t.ts})})}}))}),e.uid=1===Object.keys(e.t.uids).length?Object.keys(e.t.uids)[0]:"0",Object.keys(e.t.uids).forEach(function(t){return["\u2717","?\u2713",":(",":|"].forEach(function(a){e.t.uids[t][a].forEach(function(t){Y(e.t.corrections[t.key])||(e.t.corrections[t.key]=t)})})}),0===Object.keys(e.t.corrections).length&&(e.t.corrections=null),e}(a,this.props.students?this.state.uid:F.user.id.toString(),this.state.pkey,this.props.type),s.a.createElement("div",null,F.user.isAdmin&&this.props.students?s.a.createElement("button",{className:"btn btn-link",style:{float:"right"}},s.a.createElement("i",{className:"fa fa-btn fa-users",onClick:this.toggleAll})):null,a.t.corrections?s.a.createElement(G,{className:"btn btn-danger",tooltip:"Correct first",onClick:function(){return e.setS((t=a.t.corrections,Object.keys(t).map(function(e){return t[e]})));var t}},"Corrections"):null,this.props.students?s.a.createElement(rn,{log:F.log,uid:this.state.uid,setUid:function(t){return e.setState({uid:t===e.state.uid?null:t})}}):s.a.createElement(Ja,{type:this.props.type,topic:this.state.topic,pkey:this.state.pkey,setTest:this.setTest,setTopic:function(t){return e.setState({pkey:t,topic:t||"0"})},stats:a}),s.a.createElement(ln,{fm:this.props.fm,students:this.props.students,stats:a,uid:this.state.uid,p:this.state.pkey,setUid:function(t){return e.setState({uid:t===e.state.uid?null:t})},setS:this.setS}),s.a.createElement(cn,{type:this.props.type,students:this.props.students,stats:a,uid:this.state.uid,p:this.state.pkey,setPaper:this.setPaper,setS:this.setS}),s.a.createElement(un,{type:this.props.type,students:this.props.students,setQ:this.setQ,stats:a,uid:this.state.uid,p:this.state.pkey,setPaper:this.setPaper,setS:this.setS}),s.a.createElement(is,{s:this.state.s,stats:a,setS:this.setS}),s.a.createElement(us,{cs:this.state.cs,stats:a,setS:this.setS}),t)}}]),t}(n.Component),ln=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={byDate:!0},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=[];return Object.keys(this.props.stats.t.uids).sort(function(t,a){return Ha(e.props.stats.t.uids[t],e.props.stats.t.uids[a],e.state.byDate)}).forEach(function(a){var n=ns(e.props.stats.t.uids[a],e.props.stats,!0,e.props.setS);e.props.students&&n.unshift(s.a.createElement("td",{key:"name"},s.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setUid(a)}},e.props.stats.users[a].name))),t.push(s.a.createElement("tr",{key:a},n))}),0===t.length&&(t=s.a.createElement("tr",null,s.a.createElement("td",{colSpan:this.props.students?9:8,className:"blue",style:{textAlign:"center"}},"No student activity to show yet."))),s.a.createElement("div",{name:"StudentSummary"},s.a.createElement("h3",null,"Summary"),s.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},s.a.createElement("thead",null,s.a.createElement("tr",null,this.props.students?s.a.createElement("th",{style:{textAlign:"center"}},s.a.createElement(hn,{fm:this.props.fm,uid:this.props.uid})):null,as(),s.a.createElement("th",null,"marks"),s.a.createElement("th",{onClick:function(){return e.setState({byDate:!e.state.byDate})}},s.a.createElement("i",{className:"fa fa-file-o","aria-hidden":"true"})),s.a.createElement("th",null,s.a.createElement("i",{className:"fa fa-comments","aria-hidden":"true"})))),s.a.createElement("tbody",null,t)))}}]),t}(n.Component),cn=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={byDate:!0},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=[];return Object.keys(this.props.stats.t.ts).sort(function(t,a){return Ha(e.props.stats.t.ts[t],e.props.stats.t.ts[a],e.state.byDate)}).forEach(function(a){var n=R(a),r=ns(e.props.stats.t.ts[a],e.props.stats,!e.props.students,e.props.setS);t.push(s.a.createElement("tr",{key:a},s.a.createElement("td",null,s.a.createElement("span",{className:"btn-link",onClick:e.props.setPaper.bind(e,a)},J(a,!1,!1,!0))," ",gn(n)),r))}),s.a.createElement("div",null,s.a.createElement("h3",null,"past"===this.props.type?"Past Paper":"book"===this.props.type?"Exercise":"Test"," Analysis"),s.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,s.a.createElement(pn,{type:this.props.type,p:this.props.p,stats:this.props.stats,setPaper:this.props.setPaper})),as(),s.a.createElement("th",null,"marks"),"0"===this.props.stats.uid?s.a.createElement("th",null,s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({byDate:!e.state.byDate})}},s.a.createElement("i",{className:"fa fa-user","aria-hidden":"true"}),s.a.createElement("span",{className:"sr-only"},"user"))):s.a.createElement("th",null,s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({byDate:!e.state.byDate})}},s.a.createElement("i",{className:"fa fa-calendar-o","aria-hidden":"true"}),s.a.createElement("span",{className:"sr-only"},"date"))),s.a.createElement("th",null,s.a.createElement("i",{className:"fa fa-comments","aria-hidden":"true"}),s.a.createElement("span",{className:"sr-only"},"comments")))),s.a.createElement("tbody",null,t)))}}]),t}(n.Component);var un=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={qSort:!1,detail:null},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"qn",value:function(e,t,a){var n=this;if("vars"===e.type){var r=s.a.createElement("span",{className:"btn-link",onClick:function(){return n.props.setQ(a)}},t?t.q:a);Y(e.test)&&(r=s.a.createElement(K,{tooltip:s.a.createElement(Aa,null,t.topic.split(",")[0])},r))}else r=t?gn(e,t,t.q):a;return r}},{key:"render",value:function(){var e=this,t=[];return Object.keys(this.props.stats.t.qs).sort(function(t,a){return function(e,t,a,n){if(n)return e.localeCompare(t,void 0,{numeric:!0});var s=a[t],r=a[e];return Ba(s[":("])-Ba(r[":("])!==0?Ba(s[":("])-Ba(r[":("]):Ba(s[":|"])-Ba(r[":|"])!==0?Ba(s[":|"])-Ba(r[":|"]):Ba(s["\u2717"])-Ba(r["\u2717"])!==0?Ba(s["\u2717"])-Ba(r["\u2717"]):Ba(s["?\u2713"])-Ba(r["?\u2713"])!==0?Ba(s["?\u2713"])-Ba(r["?\u2713"]):s.mks-r.mks-(s.mk-r.mk)}(t,a,e.props.stats.t.qs,e.state.qSort)}).splice(0,50).forEach(function(a){var n=a.split(":")[0],r=e.props.stats.t.qs[a],o=R(n),l=function(e,t){var a=e.split(":"),n=Object(C.a)(a,4),s=n[0],r=n[1],o=n[2],l=n[3];if("0"===s)return{q:l};var i=R(s),c={q:e};return o?c=i.qmap.qs&&i.qmap.qs[r]&&i.qmap.qs[r][o]&&i.qmap.q[r][o][l]?i.qmap.qs[r][o][i.qmap.q[r][o][l]]:{q:e}:i.qs[l]&&(c=i.qs[l]),c.q&&(c.q=l),c}(a,e.props.stats);t.push(s.a.createElement("tr",{key:a},s.a.createElement("td",null,s.a.createElement("span",{className:"btn-link",onClick:e.props.setPaper.bind(e,a)},J(a,!0))),s.a.createElement("td",null,e.qn(o,l,a)),ns(r,e.props.stats,!e.props.students,e.props.setS)))}),s.a.createElement("div",null,s.a.createElement("h3",null,"Question Analysis"),s.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,s.a.createElement(pn,{type:this.props.type,p:this.props.p,stats:this.props.stats,setPaper:this.props.setPaper})),s.a.createElement("th",null,s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({qSort:!e.state.qSort})}},"Q")),as(),s.a.createElement("th",null,"marks"),"0"===this.props.stats.uid?s.a.createElement("th",null,s.a.createElement("i",{className:"fa fa-user","aria-hidden":"true"})):s.a.createElement("th",null,s.a.createElement("i",{className:"fa fa-calendar-o","aria-hidden":"true"})),s.a.createElement("th",null,s.a.createElement("i",{className:"fa fa-comments","aria-hidden":"true"})))),s.a.createElement("tbody",null,t)),this.state.detail)}}]),t}(n.Component),pn=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(!Y(this.props.stats))return null;var t={},a=Object.keys(this.props.stats.ts).filter(function(t){return!e.props.type||R(t).type===e.props.type}).map(function(e){return{id:e,title:J(e)}}).sort(function(e,t){return e.title.localeCompare(t.title)}),n=[s.a.createElement("option",{key:"sel",value:0},"select")];return a.forEach(function(e){var a=e.title.split(" ");a.length>1&&!Y(t[a[0]])&&(t[a[0]]=a[0],n.push(s.a.createElement("option",{key:a[0],value:a[0]},a[0])))}),n=n.concat(a.map(function(e){return s.a.createElement("option",{key:e.id,value:e.id},J(e.title))})),s.a.createElement("select",{value:null===this.props.p?0:this.props.p,onChange:function(t){return e.props.setPaper(t.target.value)}},n)}}]),t}(n.Component),hn=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return this.props.uid&&F.user.isAdmin&&F.students&&F.students[this.props.uid]?s.a.createElement("span",null,s.a.createElement("span",{className:"btn-link",onClick:function(){return F.setUser(e.props.uid)}},s.a.createElement("i",{className:"fa fa-group"}))," ",s.a.createElement(os,{uid:this.props.uid})):null}}]),t}(n.Component),mn=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={paper:a.setPaper(a.props.test),type:null,error:{},q:null},a.update=function(e,t){var n=a.state.paper;n[e]=t,a.setState({paper:n})},a.update=function(e,t){var n=a.state.paper;n.questions[a.state.q][e]=t,a.setState({paper:n})},a.working=function(){var e=a.state.paper.questions[a.state.q],t={};return["topic","question","answer","help","working"].forEach(function(a){t[a]=e[a]?e[a]:""}),t},a.updateQ=function(e,t,n){if("ans"===a.state.type)console.log("updateQ",e),a.setState({q:e});else{var s=a.state.paper.questions;"undefined"===typeof s[e]&&(s[e]={q:"",marks:""}),s[e][t]=n;for(var r=0,o=0;o<e;o++)Z(s[o][t])||(r=1*s[o][t]);if(o=e-1,1*n>=r)for(;o>=0&&Z(s[o][t]);)s[o--][t]=n;var l=a.state.paper;l.questions=s,a.setState({paper:l})}},a.save=function(){ce("/react_ajax/past",function(e){e.error?a.setState({error:e.data}):(a.state.paper.id=e.data.id,a.setState({paper:a.state.paper}),console.log("past",e.data.id))},{test:a.state.paper})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"setPaper",value:function(e){if(!e)return{id:"",name:"",board:"",month:"",year:"",title:"",QP:"",MS:"",ER:"",questions:[]};var t=e.test;return t.title=e.title,t.id=e.id,t.questions=e.test.questions,t}},{key:"render",value:function(){var e=this,t=[],a=0,n=0;for(n=0;n<this.state.paper.questions.length;n++){var r=this.state.paper.questions[n];"edit"===this.state.type?t.push(s.a.createElement(fn,{key:n,i:n,update:this.updateQ,q:r||{q:"",marks:""}})):t.push(s.a.createElement(dn,{key:n,i:n,update:this.updateQ,type:this.state.type,q:r})),"undefined"!==typeof r&&(a+=1*r.marks)}return"edit"===this.state.type&&t.push(s.a.createElement(fn,{key:n,i:n,update:this.updateQ,q:{q:"",marks:""}})),s.a.createElement(S.a,{show:!0,onHide:this.props.close,bsSize:"ans"===this.state.type?"lg":null},s.a.createElement(S.a.Header,{closeButton:!0},s.a.createElement(S.a.Title,null,this.state.paper.title.replace(/_/g," "))),s.a.createElement(S.a.Body,null,this.state.error.error?s.a.createElement("div",{className:"alert alert-danger"},s.a.createElement("strong",null,"Error: ",this.state.error.error)):null,s.a.createElement("input",{type:"text",size:"10",placeholder:"Name",value:this.state.paper.name,onChange:function(t){return e.update("name",t.target.value)}}),s.a.createElement("input",{size:"5",type:"text",placeholder:"Board",value:this.state.paper.board,onChange:function(t){return e.update("board",t.target.value)}}),s.a.createElement("input",{size:"5",type:"text",placeholder:"Month",value:this.state.paper.month,onChange:function(t){return e.update("month",t.target.value)}}),s.a.createElement("input",{size:"5",type:"text",placeholder:"Year",value:this.state.paper.year,onChange:function(t){return e.update("year",t.target.value)}}),s.a.createElement("br",null),s.a.createElement("input",{style:{width:"90%"},type:"text",placeholder:"Paper",value:this.state.paper.QP,onChange:function(t){return e.update("QP",t.target.value)}}),s.a.createElement("br",null),s.a.createElement("input",{style:{width:"90%"},type:"text",placeholder:"Mark Scheme",value:this.state.paper.MS,onChange:function(t){return e.update("MS",t.target.value)}}),s.a.createElement("br",null),s.a.createElement("input",{style:{width:"90%"},placeholder:"Examiners Report",value:this.state.paper.ER,onChange:function(t){return e.update("ER",t.target.value)}}),s.a.createElement("br",null),s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({type:"edit"})}},"Questions & Marks"),s.a.createElement("br",null),s.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.setState({type:"qp"})},href:this.state.paper.QP},"question paper"),"\xa0",s.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.setState({type:"ms"})},href:this.state.paper.MS},"mark scheme"),"\xa0",s.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.setState({type:"er"})},href:this.state.paper.ER},"examiners report"),s.a.createElement("br",null),gn(this.state.paper)," ",bn(this.state.paper)," ",s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({type:"ans"})}},"working"),s.a.createElement("br",null),"qp"===this.state.type?s.a.createElement("input",{type:"text",placeholder:"Extra Pages",value:this.state.paper.qpx?this.state.paper.qpx:"",onChange:function(t){return e.update("qpx",t.target.value)}}):null,s.a.createElement(g.a,null,s.a.createElement(b.a,{sm:3},s.a.createElement("table",{className:"table table-bordered table-condensed table-striped",style:{width:"auto"}},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"Q"),s.a.createElement("th",null,this.state.type))),s.a.createElement("tbody",null,t),s.a.createElement("tfoot",null,s.a.createElement("tr",null,s.a.createElement("th",null,"total"),s.a.createElement("th",null,a))))),"ans"===this.state.type?s.a.createElement(b.a,{sm:9},null!==this.state.q?s.a.createElement("div",null,s.a.createElement("h3",null,"Question ",this.state.paper.questions[this.state.q].q),s.a.createElement(ga,{auto:!0,fields:this.working(),update:this.update})):null):null)),s.a.createElement(S.a.Footer,null,s.a.createElement(w.a,{onClick:this.save},"Save")))}}]),t}(n.Component),fn=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("input",{size:"4",type:"text",value:this.props.q.q,placeholder:"1a",onChange:function(t){return e.props.update(e.props.i,"q",t.target.value)}})),s.a.createElement("td",null,s.a.createElement("input",{style:{width:"3em"},type:"number",placeholder:"0",value:this.props.q.marks,onChange:function(t){return e.props.update(e.props.i,"marks",t.target.value)}})))}}]),t}(n.Component),dn=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return this.props.type?s.a.createElement("tr",null,s.a.createElement("td",null,this.props.q.q),"ans"===this.props.type?s.a.createElement("td",null,s.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.update(e.props.i,e.props.type)}},"edit")):s.a.createElement("td",null,s.a.createElement("input",{style:{width:"3em"},type:"number",placeholder:"0",value:this.props.q[this.props.type]?this.props.q[this.props.type]:"",onChange:function(t){return e.props.update(e.props.i,e.props.type,t.target.value)}}))):null}}]),t}(n.Component),vn=mn;function gn(e,t,a){if(Y(t)&&Z(t.qp))return a||"";Y(e.test)&&(e=e.test);var n=Y(t)&&!Z(t.qp)?e.QP.split("#")[0]+"#page="+t.qp:e.QP;return Y(e)&&!Z(e.QP)?Y(a)?s.a.createElement("a",{className:"btn-link",target:"_blank",rel:"noopener noreferrer",href:n+yn(e)},s.a.createElement(K,{tooltip:"question paper"},a)):s.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:n+yn(e)},s.a.createElement(K,{tooltip:"question paper"},s.a.createElement("i",{style:{fontSize:V()},className:"fa fa-question-circle"}))):""}function bn(e,t,a){if(Y(t)&&Z(t.ms))return Y(a)?a:"";Y(e.test)&&(e=e.test);var n=Y(t)&&!Z(t.ms)?e.MS.split("#")[0]+"#page="+t.ms:e.MS;return Y(e)&&!Z(e.MS)?Y(a)?s.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:n},s.a.createElement(K,{tooltip:"mark scheme"},a)):s.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:n},s.a.createElement(K,{tooltip:"mark scheme"},s.a.createElement("i",{style:{fontSize:V()},className:"fa fa-check-circle"}))):""}function kn(e,t){if(Y(t)&&Z(t.er))return"";Y(e.test)&&(e=e.test);var a=Y(t)&&!Z(t.er)?e.ER.split("#")[0]+"#page="+t.er:e.ER;return Y(e)&&!Z(e.ER)?s.a.createElement("a",{rel:"noopener noreferrer",target:"_blank",href:a},s.a.createElement(K,{tooltip:"examiners report"},s.a.createElement("i",{style:{fontSize:V()},className:"fa fa-info-circle"}))):""}function yn(e){if(!Y(e.qpx))return"";for(var t=e.questions.map(function(e){return e.qp}),a=e.qpx.split(","),n=0,s=0,r=0,o=[];n<t.length&&s<a.length;)1*t[n]>1*a[s]?1*a[s]>r?(r=1*a[s],o.push(a[s++])):s++:1*t[n]>r?(r=1*t[n],o.push(t[n++])):n++;for(;n<t.length;)1*t[n]>r?(r=1*t[n],o.push(t[n++])):n++;for(;s<a.length;)1*a[s]>r?(r=1*a[s],o.push(a[s++])):s++;return"#"+o.join(",")}function En(e,t){var a=t.t.ts[e];return Y(a)&&Y(a.r)&&a.r.length>0?s.a.createElement(K,{placement:"bottom",tooltip:es(a.r,t,!0)},s.a.createElement("span",{className:Xn(a.mk,a.mks)},J(e),"(",a.mk,"/",a.mks,")")):Y(t.ts[e])&&Y(t.ts[e].rs)&&Y(t.ts[e].rs[F.user.id])&&Y(t.ts[e].rs[F.user.id][0])?s.a.createElement(K,{placement:"bottom",tooltip:ne(t.ts[e].rs[F.user.id][0].ts)},s.a.createElement("span",{className:"green"},J(e,t)," (0/0)")):J(e)}var On=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={test:null,mark:!1,bar:!1,edit:!1},a.links=function(e){var t=R(e);if(!t||"past"!==t.type)return null;var n=F.user.isAdmin?s.a.createElement(K,{tooltip:e},s.a.createElement("span",{className:"btn-link",onClick:function(){return a.setState({test:e,edit:!0})}},s.a.createElement("i",{className:t.test.questions.length&&t.test.questions[0].qp?"fa fa-edit green":"fa fa-edit red"}))):null;return s.a.createElement("span",null,"\xa0",gn(t),"\xa0",bn(t),"\xa0",kn(t),"\xa0",n)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t="past"===this.props.type?F.data.past:F.data.books,a=null;if(L("Past")&&console.log("Past render",t,this.props,F),this.props.test||(a=Object.keys(t).filter(function(a){return"version"!==a&&t[a].title.startsWith(e.props.topic)}).sort(function(e,a){return function(e,t){Y(e.test)||(e.test=JSON.parse(e.json));Y(t.test)||(t.test=JSON.parse(t.json));return e=e.test,t=t.test,0!==qn(e.name,t.name)?qn(e.name,t.name):e.board!==t.board?e.board>t.board?1:-1:e.year!==t.year?1*e.year-1*t.year:e.month!==t.month?e.month>t.month?1:-1:e.name.split("_").length>1?t.name.split("_").length>1?e.name.split("_")[1]>t.name.split("_")[1]?1:-1:1:t.name.split("_").length>1?-1:0}(t[e],t[a])}).map(function(t){return s.a.createElement("li",{key:t},s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({test:t})}},En(t,e.props.stats)),e.links(t))})),null!==this.state.test)if(this.state.edit)n=s.a.createElement(vn,{test:t[this.state.test],close:function(){return e.setState({test:null,edit:!1})}});else var n=s.a.createElement(jn,{stats:this.props.stats,test:this.state.test,close:function(){return e.setState({test:null})}});return s.a.createElement("div",null,"GCSE(9-1)"===this.props.topic||"P1"===this.props.topic||"SM1"===this.props.topic?s.a.createElement("p",null,s.a.createElement("span",{className:"red"},"Note:")," Several ",this.props.topic," sample papers are combined into a single PDF. The links below should jump to the correct page but be careful to set a page range if printing."):null,a?s.a.createElement("ul",null,a):s.a.createElement("span",null,ne(this.props.ts)," ",s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({test:e.props.test})}},En(this.props.test,this.props.stats)),this.links(this.props.test)),n)}}]),t}(n.Component);function xn(e,t){var a={key:e},n=e.split(":"),s=Object(C.a)(n,3),r=s[0],o=s[1],l=s[2];return a.t=R(r),a.ts=t.ts[e],Y(l)&&""!==l?(a.qs=Y(a.t.qmap.qs)&&Y(a.t.qmap.qs[o])&&Y(a.t.qmap.qs[o][l])?a.t.qmap.qs[o][l]:null,a.ch=o,a.e=l):Y(a.t.test)&&Y(a.t.test.questions)&&(a.qs=a.t.test.questions),a}var jn=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).setMarks=function(){var e=xn(a.props.test,a.props.stats);return e.qs.map(function(t){var a=e.key.indexOf(":")>0?e.key+":"+t.q:e.key+":::"+t.q,n=Y(e.ts)&&Y(e.ts.qs[a])?e.ts.qs[a].l[F.user.id]:null;return Y(n)?{m:n.m,f:n.f,c:"",mk:n.mk,mks:t.marks,q:t.q}:{m:"",f:"",c:"",mk:"",mks:t.marks,q:t.q}})},a.state={marks:a.setMarks(),effort:0,show:!1},a.save=function(){var e={marks:a.state.marks.map(function(e){return e.show?(delete e.show,e):void 0}),effort:a.state.effort};F.marking(a.props.test,e,function(){return a.props.close()},function(e){return a.setState({error:e})})},a.setEffort=function(e){a.setState({effort:e})},a.mark=function(e,t,n){var s=a.state.marks,r=xn(a.props.test,a.props.stats).qs;s[e].show=!0,"f"===t?s[e].f=n:"mk"===t?(s[e].mk=n,s[e].mks=r[e].marks,""===n?s[e].f="":n===r[e].marks?(s[e].f=":)",s[e].m="\u2713"):"0"===n?(s[e].f=":)",s[e].m="\u2717"):(s[e].f=":)",s[e].m="?\u2713")):s[e].c=n,a.setState({marks:s})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"total",value:function(){var e={marks:0,total:0,f:{":)":0,":|":0,":(":0},m:{"\u2713":0,"?\u2713":0,"\u2717":0},qs:0,qc:0},t=this.state.marks,a=xn(this.props.test,this.props.stats).qs;e.qc=a.length;for(var n=0;n<a.length;n++)(this.state.show||t[n].show||1*a[n].marks!==1*t[n].mk||":)"!==t[n].f)&&(e.qs++,e.total+=1*a[n].marks,e.marks+=1*t[n].mk,t[n].f.startsWith(":")&&e.f[t[n].f]++,""!==t[n].m&&e.m[t[n].m]++);return e}},{key:"render",value:function(){var e=this;if(null===this.props.test)return null;var t=xn(this.props.test,this.props.stats),a=0,n=[],r=!1;t.qs.forEach(function(o){var l=t.key.indexOf(":")>0?t.key+":"+o.q:t.key+":::"+o.q;e.state.show?n.push(s.a.createElement(Sn,{key:a,qkey:l,i:a,test:t.t,update:e.updateQ,q:o,mark:e.mark,marks:!Z(e.state.marks)&&Y(e.state.marks[a])?e.state.marks[a]:{m:"",f:"",c:""}})):e.state.marks[a].show||1*o.marks!==1*e.state.marks[a].mk||":)"!==e.state.marks[a].f?n.push(s.a.createElement(Sn,{qkey:l,key:a,test:t.t,i:a,update:e.updateQ,q:o,mark:e.mark,marks:Y(e.state.marks[a])?e.state.marks[a]:{m:"",f:"",c:"",mk:0}})):r=!0,a++});var o=this.total();if(o.marks===o.total)var l="green";else l=o.marks>.65*o.total?"amber":"red";return s.a.createElement($,{save:{fn:this.save,text:"Save"},close:this.props.close,title:J(this.props.test)},r||this.state.show?s.a.createElement("button",{onClick:function(){return e.setState({show:!e.state.show})},className:"btn btn-default btn-sm"},this.state.show?"Hide":"Show"," ",s.a.createElement("span",{className:"green"},"\u2713",Gn[":)"])):null,s.a.createElement("table",{className:"table table-bordered table-condensed table-striped",style:{width:"auto"}},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"Q ",gn(t.t)),s.a.createElement("th",null,"Marks ",bn(t.t)),s.a.createElement("th",{style:{textAlign:"center"}},Gn[":)"]),s.a.createElement("th",null,"Comment ",kn(t.t)))),s.a.createElement("tbody",null,n),s.a.createElement("tfoot",null,s.a.createElement("tr",null,s.a.createElement("th",{style:{verticalAlign:"middle"}},"Total"),s.a.createElement("th",{style:{verticalAlign:"middle",textAlign:"center"}},s.a.createElement("span",{className:l},o.marks),"/",o.total),s.a.createElement("th",{style:{verticalAlign:"middle",textAlign:"center"}},s.a.createElement("span",{className:"green"},o.f[":)"])," ",s.a.createElement("span",{className:"amber"},o.f[":|"])," ",s.a.createElement("span",{className:"red"},o.f[":("])),s.a.createElement("th",null,s.a.createElement(wn,{total:o,effort:this.state.effort,setEffort:this.setEffort}))))),this.state.error?s.a.createElement("div",{className:"alert alert-danger"},s.a.createElement("strong",null,"Server Error: ",this.state.error)):null)}}]),t}(n.Component),wn=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).update=function(e){var t=e.target.value.split(":");if(3===t.length)var n=1e3*(60*(60*t[0]+t[1])+t[2]);else 2===t.length?n=60*(60*t[0]+t[1])*1e3:1===t.length&&(n=60*t[0]*1e3);a.props.setEffort(n)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=Y(this.props.effort)&&this.props.effort>0?Math.round(this.props.effort/6e4):"";return s.a.createElement("span",null,"Effort: ",s.a.createElement("input",{onChange:this.update,size:"5",type:"text",value:e,placeholder:Math.round(this.props.total.total/75*90)}),"(mins)")}}]),t}(n.Component);function qn(e,t){return(e=e.split("_")[0])===(t=t.split("_")[0])?0:"GCSE(9-1)"===e?-1:"GCSE(9-1)"===t?1:e>t?1:-1}var Sn=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(F.user.isMobile)var t=s.a.createElement("input",{style:{width:"6em"},type:"text",name:"comment",value:this.props.marks.c,onChange:function(t){return e.props.mark(e.props.i,"c",t.target.value)}});else t=s.a.createElement("input",{type:"text",name:"comment",value:this.props.marks.c,onChange:function(t){return e.props.mark(e.props.i,"c",t.target.value)}});return s.a.createElement("tr",null,s.a.createElement("td",null,gn(this.props.test,this.props.q,this.props.q.q)),s.a.createElement("td",{style:{width:"6em"}},s.a.createElement(Cn,{test:this.props.test,q:this.props.q,mk:this.props.marks.mk,i:this.props.i,mark:this.props.mark})),s.a.createElement("td",null,s.a.createElement(Nn,{f:this.props.marks.f,i:this.props.i,mark:this.props.mark})),s.a.createElement("td",null,kn(this.props.test,this.props.q)," ",t," ",this.props.marks.c?s.a.createElement(os,{c:this.props.marks.c,qkey:this.props.qkey}):null))}}]),t}(n.Component),Cn=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){for(var e=this,t=[s.a.createElement("option",{key:"?",value:""},"?")],a=0;a<=this.props.q.marks;a++)t.push(s.a.createElement("option",{key:a},a));if(1*this.props.mk===1*this.props.q.marks)var n=s.a.createElement("span",{className:"green"},this.props.q.marks);else n=this.props.mk>0?s.a.createElement("span",{className:"amber"},this.props.q.marks):"0"===this.props.mk?s.a.createElement("span",{className:"red"},this.props.q.marks):s.a.createElement("span",null,this.props.q.marks);return s.a.createElement("span",null,s.a.createElement("select",{value:this.props.mk,className:"qmark btn btn-default btn-sm",onChange:function(t){return e.props.mark(e.props.i,"mk",t.target.value)}},t),"/",bn(this.props.test,this.props.q,n))}}]),t}(n.Component),Nn=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(":)"===this.props.f)var t="green ";else t=":|"===this.props.f?"amber ":":("===this.props.f?"red ":"";return s.a.createElement("select",{value:this.props.f,className:t+"feedback btn btn-default btn-sm",onChange:function(t){return e.props.mark(e.props.i,"f",t.target.value)}},s.a.createElement("option",{value:""},"?"),s.a.createElement("option",{className:"green"},":)"),s.a.createElement("option",{className:"amber"},":|"),s.a.createElement("option",{className:"red"},":("))}}]),t}(n.Component),_n=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={book:{id:"",name:"",board:"",isbn:"",link:"",chapters:[]}},a.update=function(e,t){var n=a.state.book;n[e]=t,a.setState({book:n})},a.save=function(){var e=a.state.book;e.qmap={qs:{}},e.chapters.forEach(function(t){return t.exercises.forEach(function(a){e.qmap.qs[t]||(e.qmap.qs[t]={}),e.qmap.qs[t][a]=a.qs})}),e=F.saveBook(a.state.book),a.setState(e)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){Y(this.props.id)&&this.setState({book:F.data.books[this.props.id].book})}},{key:"render",value:function(){var e=this;return s.a.createElement(S.a,{show:!0,onHide:this.props.close,bsSize:"lg"},s.a.createElement(S.a.Header,{closeButton:!0},s.a.createElement(S.a.Title,null,this.state.book.name.replace(/_/g," "))),s.a.createElement(S.a.Body,null,s.a.createElement("div",{className:"panel panel-default"},s.a.createElement("input",{type:"text",size:"5",placeholder:"Name",value:this.state.book.name,onChange:function(t){return e.update("name",t.target.value)}}),s.a.createElement("input",{size:"5",type:"text",placeholder:"Board",value:this.state.book.board,onChange:function(t){return e.update("board",t.target.value)}}),s.a.createElement("input",{size:"15",type:"text",placeholder:"ISBN",value:this.state.book.isbn,onChange:function(t){return e.update("isbn",t.target.value)}}),s.a.createElement("br",null),s.a.createElement("input",{size:"100",type:"text",placeholder:"Link",value:this.state.book.link,onChange:function(t){return e.update("link",t.target.value)}}),s.a.createElement(An,{cs:this.state.book.chapters,update:this.update}))),s.a.createElement(S.a.Footer,null,s.a.createElement(w.a,{onClick:this.save},"Save")))}}]),t}(n.Component),An=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={c:0,e:0},a.update=function(e,t){var n=a.props.cs;""===e.chapter&&""===e.topic?n.splice(t,1):n[a.state.c]=e,a.setState({e:null}),a.props.update("chapters",n)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(Mn,{e:this.state.e,c:this.props.cs[this.state.c],i:this.state.c,update:this.update,add:function(){return e.setState({c:e.state.c+1,e:0})},back:function(){return e.setState({c:e.state.c>0?e.state.c-1:0,e:0})}})}}]),t}(n.Component),Mn=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).update=function(e,t){if(Y(a.props.c))var n=a.props.c;else n={chapter:"",topic:"",link:"",exercises:[]};n[e]=t,a.props.update(n,a.props.i)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(Y(this.props.c))var t=this.props.c;else t={chapter:"",topic:"",link:"",exercises:[]};return s.a.createElement("div",null,"Chapter: ",s.a.createElement("input",{size:"2",type:"text",value:t.chapter,placeholder:"1",onChange:function(t){return e.update("chapter",t.target.value)}}),s.a.createElement("input",{size:"15",type:"topic",placeholder:"Topic",value:t.topic,onChange:function(t){return e.update("topic",t.target.value)}}),s.a.createElement("span",{className:"btn-link",onClick:this.props.add},"\xa0",s.a.createElement("i",{className:"fa fa-btn fa-plus-square-o"})),s.a.createElement("span",{className:"btn-link",onClick:this.props.back},"\xa0",s.a.createElement("i",{className:"fa fa-btn fa-minus-square-o"})),s.a.createElement("input",{size:"100",type:"text",placeholder:"Link",value:t.link,onChange:function(t){return e.update("link",t.target.value)}}),s.a.createElement(Tn,{e:this.props.e,es:t.exercises,update:this.update}))}}]),t}(n.Component),Tn=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={e:0},a.update=function(e,t){var n=a.props.es;""===e.exercise&&""===e.topic?n.splice(t,1):n[a.state.e]=e,a.props.update("exercises",n)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillReceiveProps",value:function(e){Y(e.e)&&this.setState({e:e.e})}},{key:"render",value:function(){var e=this;return s.a.createElement(Pn,{e:this.props.es[this.state.e],i:this.state.e,update:this.update,add:function(){return e.setState({e:e.state.e+1})},back:function(){return e.setState({e:e.state.e>0?e.state.e-1:0})}})}}]),t}(n.Component),Pn=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).update=function(e,t){if(Y(a.props.e))var n=a.props.e;else n={exercise:"",topic:"",page:"",qs:[]};n[e]=t,a.props.update(n,a.props.i)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(Y(this.props.e))var t=this.props.e;else t={exercise:"",topic:"",page:"",qs:[]};return s.a.createElement("div",null,"Exercise: ",s.a.createElement("input",{size:"2",type:"text",value:t.exercise,placeholder:"1",onChange:function(t){return e.update("exercise",t.target.value)}}),s.a.createElement("input",{size:"15",type:"topic",placeholder:"Topic",value:t.topic,onChange:function(t){return e.update("topic",t.target.value)}}),s.a.createElement("input",{style:{width:"4em"},type:"number",placeholder:"pg",value:t.page,onChange:function(t){return e.update("page",t.target.value)}}),s.a.createElement("span",{className:"btn-link",onClick:this.props.add},"\xa0",s.a.createElement("i",{className:"fa fa-btn fa-plus-square-o"})),s.a.createElement("span",{className:"btn-link",onClick:this.props.back},"\xa0",s.a.createElement("i",{className:"fa fa-btn fa-minus-square-o"})),s.a.createElement(Wn,{qs:t.qs,update:this.update}))}}]),t}(n.Component),Wn=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).update=function(e,t){var n=a.props.qs;if("string"===typeof e.q&&e.q.indexOf("-")>0){var s=e.q.split("-"),r=Object(C.a)(s,2),o=r[0],l=r[1],i=o.substring(0,o.length-1);if(o.endsWith("a")){if(1===l.length&&l.match(/[b-z]/)){n.splice(t,1);for(var c="a";c!==l;c=String.fromCharCode(c.charCodeAt(0)+1))n.splice(t++,0,{q:i+c,marks:e.marks});n.splice(t,0,{q:i+c,marks:e.marks})}}else if(o.endsWith("i")){var u=["i","ii","iii","iv","v","vi","vii","viii","ix","x"];if(u.includes(l)){for(n.splice(t,1),c=0;u[c]!==l;c++)n.splice(t++,0,{q:i+u[c],marks:e.marks});n.splice(t,0,{q:i+u[c],marks:e.marks})}}else if((l*=1)>(o*=1)&&l-o<99)for(n.splice(t,1),c=o;c<=l;c++)n.splice(t++,0,{q:c,marks:e.marks})}else""===e.q?n.splice(t,1):n[t]=e;a.props.update("qs",n)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=0,a=this.props.qs.map(function(a){return s.a.createElement(zn,{key:t,q:a,i:t++,update:e.update})});return s.a.createElement("div",null,a,s.a.createElement(zn,{key:t,q:void 0,i:t,update:this.update}))}}]),t}(n.Component),zn=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).update=function(e,t){if(Y(a.props.q))var n=a.props.q;else n={q:"",marks:"2"};n[e]=t,a.props.update(n,a.props.i)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(Y(this.props.q))var t=this.props.q;else t={q:"",marks:"2"};return s.a.createElement("div",null,s.a.createElement("input",{size:"4",type:"text",value:t.q,placeholder:"1a",onChange:function(t){return e.update("q",t.target.value)}}),s.a.createElement("input",{style:{width:"4em"},type:"number",placeholder:"0",value:t.marks,onChange:function(t){return e.update("marks",t.target.value)}}))}}]),t}(n.Component),Qn=_n,Dn=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={show:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props.pkey.split(":"),a=Object(C.a)(t,3),n=a[0],r=a[1],o=a[2],l=n+":"+r+":"+o,i=F.data.books[n].book;if(!i)return null;var c=i.chapters.find(function(e){return e.chapter===r});if(c.exercises){var u=c.exercises.find(function(e){return e.exercise=o});if(u)return this.state.show?s.a.createElement(jn,{stats:this.props.stats,test:l,update:this.update,close:function(){return e.setState({show:!1})}}):s.a.createElement("span",null,s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({show:!0})}},u.exercise,"  ",s.a.createElement(Aa,null,u.topic)),s.a.createElement(Un,{stats:this.props.stats,ekey:l}),"\xa0",Fn(c.link,u.page,u.exercise))}}}]),t}(n.Component);function Fn(e,t,a){var n=e+"#page="+t;return e.indexOf("$pg")>0&&(n=t>1e4?e.replace(/r00\/.*\$pg/,"r00/r00"+Math.floor(t/1e4)+"/r00"+Math.floor(t/100)+"/r00"+t).replace("$ex",a):e.replace("$pg",t).replace("$ex",a)),s.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:n},s.a.createElement(K,{tooltip:"solution bank"},s.a.createElement("i",{style:{fontSize:V()},className:"fa fa-check-circle"})))}var In=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=[237,238,240,241,242].map(function(t){var a=F.data.books[t],n=0;return a.book.chapters.forEach(function(e){e.n=n++;var t=0;e.exercises.forEach(function(e){return e.n=t++})}),s.a.createElement(Ln,{key:a.id,bk:a,stats:e.props.stats,pkey:e.props.pkey,set:e.props.set})});return s.a.createElement("div",null,t)}}]),t}(n.Component),Ln=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={show:!1,edit:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=1===F.user.id?s.a.createElement(K,{tooltip:this.props.bk.id},s.a.createElement("button",{className:"btn btn-link",onClick:function(){return e.setState({edit:!0})}},s.a.createElement("i",{className:"fa fa-edit green"}))):null;return this.state.edit?s.a.createElement(Qn,{close:function(){return e.setState({edit:!1})},id:this.props.bk.id}):s.a.createElement("div",null,s.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.set(e.props.pkey?null:e.props.bk.id+"")}},J(this.props.bk.title)),s.a.createElement(Un,{bk:this.props.bk,stats:this.props.stats})," ",t,this.props.pkey?s.a.createElement(Hn,{pkey:this.props.pkey,set:this.props.set,bk:this.props.bk,stats:this.props.stats}):null)}}]),t}(n.Component),Hn=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props.pkey.split(":");if(0===t.length||1*t[0]!==1*this.props.bk.id)return null;var a=t[0],n=this.props.bk.book.chapters.map(function(t){var n=a+":"+t.chapter;return s.a.createElement("li",{key:t.chapter},s.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.set(e.props.pkey===n?a:n)}},t.chapter," ",s.a.createElement(Aa,null,t.topic)),s.a.createElement(Un,{bk:e.props.bk,stats:e.props.stats,ch:t.chapter}),s.a.createElement(Bn,{stats:e.props.stats,set:e.props.set,bk:e.props.bk,chapter:t,pkey:e.props.pkey}))});return s.a.createElement("ul",null,n)}}]),t}(n.Component),Bn=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props.pkey.split(":");if(t.length<2||t[1]!==this.props.chapter.chapter)return null;var a=t[0]+":"+t[1],n=this.props.chapter.exercises.map(function(n){var r=a+":"+n.exercise;return s.a.createElement("li",{key:n.exercise},s.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.set(e.props.pkey===r?a:r)}},n.exercise,"  ",s.a.createElement(Aa,null,n.topic)),s.a.createElement(Un,{stats:e.props.stats,bk:e.props.bk,ch:t[1],e:n.exercise}),"\xa0",Fn(e.props.chapter.link,n.page,n.exercise))}),r=3===t.length?s.a.createElement(jn,{stats:this.props.stats,test:this.props.pkey,close:function(){return e.props.set(a)}}):null;return s.a.createElement("div",null,s.a.createElement("ul",null,n),r)}}]),t}(n.Component);var Un=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e,t,a,n,r=function(e,t){var a={"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:0,effort:0,r:[]};return Object.keys(t.t.ts).filter(function(t){return t.startsWith(e)}).forEach(function(e){var n=t.t.ts[e];[":(",":|",":)","\u2717","?\u2713","\u2713"].forEach(function(e){return a[e].push.apply(a[e],n[e])}),a.r.push.apply(a.r,n.r),a.mks+=n.mks,a.mk=za(a.mk,n.mk),a.qs+=n.qs,n.ts>a.ts&&(a.ts=n.ts)}),a}(this.props.ekey?this.props.ekey:(e=this.props.bk.id,t=this.props.ch,a=this.props.e,n=e,Y(t)&&(n+=":"+t,Y(a)&&(n+=":"+a)),n),this.props.stats);return r&&0!==r.mks?s.a.createElement("span",{className:Xn(r.mk,r.mks)}," (",r.mk,"/",r.mks,")"):null}}]),t}(n.Component),Rn={":(":!0,":|":!0,":)":!0},Jn={"\u2717":!0,"?\u2713":!0,"\u2713":!0},$n={"\u2717":"red","?\u2713":"amber","\u2713":"green",":)":"green",":|":"amber",":(":"red",Help:"blue"},Vn=[":(",":|","\u2717","?\u2713","\u2713"],Kn=[":(",":|",":)","\u2717","?\u2713","\u2713"],Gn={"\u2717":"\u2717","?\u2713":"\u2713","\u2713":"\u2713",Q:"Q",":)":s.a.createElement("i",{name:"smile",className:"fa fa-smile-o green"}),":|":s.a.createElement("i",{name:"meh",className:"fa fa-meh-o amber"}),":(":s.a.createElement("i",{name:"frown",className:"fa fa-frown-o red"}),Show:s.a.createElement("i",{className:"fa fa-eye"}),Help:s.a.createElement("i",{className:"fa fa-book"}),"Re-try":s.a.createElement("i",{className:"fa fa-repeat"}),"\u2713\u2717":s.a.createElement("i",{className:"fa fa-check-square-o"}),Photo:s.a.createElement("i",{className:"fa fa-camera"}),Email:s.a.createElement("i",{className:"fa fa-envelope-o"})};function Xn(e,t){return 1*e===1*t?"green":e>.65*t?"amber":"red"}function Yn(e){var t=0,a=null;return e[":)"].forEach(function(e){e.ts>t&&(a=":)",t=e.ts)}),e[":|"].forEach(function(e){e.ts>t&&(a=":|",t=e.ts)}),e[":("].forEach(function(e){e.ts>t&&(a=":(",t=e.ts)}),a?Gn[a]:null}function Zn(e,t,a,n){return s.a.createElement("td",{key:"mks",onClick:n?function(){return n(e.r)}:null,style:{textAlign:"center"},className:Xn(""===e.mk?0:e.mk,e.mks)},s.a.createElement(K,{placement:"bottom",tooltip:function(e,t,a){var n=0;return e.sort(function(e,t){return t.ts-e.ts}).map(function(r){var o=r.uid?r.uid:e.uid?e.uid:null;return s.a.createElement("div",{key:n++,style:{textAlign:"left"}},ne(r.ts)," ",a?"":Y(o)?t.users[o].name:""," ",r.key?J(r.key,!0):""," ",""!==r.mk?s.a.createElement("span",{className:Xn(r.mk,r.mks)},r.mk,"/",r.mks):"?/?")})}(e.r,t,a)},""===e.mk?0:e.mk,"/",e.mks))}function es(e,t,a){var n=0;return e.sort(function(e,t){return t.ts-e.ts}).map(function(r){var o=r.uid?r.uid:e.uid?e.uid:null;return s.a.createElement("div",{key:n++,style:{textAlign:"left"}},ne(r.ts)," ",a?"":Y(o)?t.users[o].name:""," ",r.key?J(r.key,!0):""," ",""!==r.mk?s.a.createElement("span",{className:Xn(r.mk,r.mks)},r.mk,"/",r.mks):"")})}function ts(e,t,a,n,r){return 0===e[t].length?s.a.createElement("td",{key:t}):s.a.createElement("td",{key:t,onClick:r?function(){return r(e[t])}:null,className:Y(e[t][0].l)&&!e[t][0].l?"grey":$n[t]},s.a.createElement(K,{placement:"bottom",tooltip:function(e,t,a,n,r){var o=0,l=e[t].sort(function(e,t){return t.ts-e.ts===0?e.key.localeCompare(t.key):t.ts-e.ts}).slice(0,20).map(function(t){var l=t.uid?t.uid:e.uid?e.uid:null;return s.a.createElement("div",{key:o++,style:{textAlign:"left"}},ne(t.ts)," ",n?"":Y(l)?a.users[l].name:""," ",t.key?s.a.createElement("span",{className:r},J(t.key,!0)):"")});e[t].length>20&&l.push(s.a.createElement("div",{key:"dots",style:{textAlign:"center"}},"\u2026"));return l}(e,t,a,n,$n[t])},e[t].length))}function as(){return Vn.map(function(e){return s.a.createElement("th",{key:e,className:$n[e]},Gn[e])})}function ns(e,t,a,n){var r=Vn.map(function(s){return ts(e,s,t,a,n)});return r.push(Zn(e,t,a,n)),r.push(function(e,t,a,n){return s.a.createElement("td",{key:"n",onClick:n?function(){return n(e.r)}:null},s.a.createElement(K,{placement:"bottom",tooltip:es(e.r,t,a)},e.r.length))}(e,t,a,n)),r.push(function(e,t,a,n){var r=0;if(0===e.length)return s.a.createElement("td",{key:r++});var o=e.sort(function(e,t){return t.ts-e.ts}).map(function(e){return s.a.createElement("div",{key:r++,style:{textAlign:"left"}},ne(e.ts)," ",a?"":t.users[e.uid].name," ",J(e.key,!0),a?" ":s.a.createElement("br",null),s.a.createElement("span",{style:{textAlign:"left"},className:$n[e.f]},s.a.createElement(Aa,null,e.c)))});return s.a.createElement("td",{key:"comments",onClick:n?function(){return n(e,!0)}:null,style:{textAlign:"center"}},s.a.createElement(K,{tooltip:o,placement:"bottom"},e.length))}(e.c,t,a,n)),r}function ss(e,t){return Kn.map(function(a){return function(e,t,a){return 0===Object.keys(e[t]).length?s.a.createElement("td",{key:t}):s.a.createElement("td",{key:t,onClick:a?function(){return a(e[t])}:null,className:$n[t]},s.a.createElement(K,{placement:"bottom",tooltip:function(e,t){var a=F.data.tests.questions;return Object.keys(e[t]).sort(function(a,n){return e[t][n].ts-e[t][a].ts}).map(function(n){return e[t][n].variables||console.log("tipT0",e[t][n],e,t,a,n),s.a.createElement("div",{key:n,style:{textAlign:"left"}},ne(e[t][n].ts)," ",s.a.createElement("span",{className:$n},"Q",n," ",s.a.createElement(Aa,{vars:e[t][n].variables?JSON.parse(e[t][n].variables):null},a[n].topic)))})}(e,t)},Object.keys(e[t]).length))}(e,a,t)})}function rs(e,t,a){var n=0,r="",o="",l="",i="",c="";return e.sort(function(e,t){return e.mks?t.ts-e.ts:e.key.localeCompare(t.key,void 0,{numeric:!0})}).map(function(e){var u=e.key.split(":"),p=Object(C.a)(u,4),h=p[0],m=p[1],f=p[2],d=p[3],v=Y(e.mk)?e.mk:t.t.qs[e.key].mk,g=Y(e.mks)?e.mks:t.t.qs[e.key].mks,b=R(h).type,k=s.a.createElement("div",{key:n++},f?h!==l||m!==r||f!==o?s.a.createElement("h5",null,ne(e.ts)," ",J(h)," ",s.a.createElement(Dn,{pkey:e.key,stats:t})):null:h!==l?s.a.createElement("h5",null,a?s.a.createElement("span",{className:"btn-link",onClick:a},ne(e.ts)):ne(e.ts)," ",J(h)," ",s.a.createElement("span",{className:Xn(v,g)},"(",v,"/",g,")")):null,!d||"vars"===b||h===l&&m===r&&f===o&&d===i&&c===e.c?null:s.a.createElement("div",null,ne(e.ts)," Q ",function(e,t){var a=e.split(":"),n=Object(C.a)(a,4),s=n[0],r=n[3],o=R(s);return o&&"past"===o.type?gn(o,o.qs[r],r):r}(e.key)," ",s.a.createElement("span",{className:Xn(v,g)},"(",v,"/",g,")")," ",function(e,t,a){var n=e.split(":"),r=Object(C.a)(n,4),o=r[0],l=r[3],i=R(o);if(!i||"past"!==i.type)return null;var c=i.qs[l];return s.a.createElement("span",null,bn(i,c)," ",kn(i,c))}(e.key)," ",Yn(t.t.qs[e.key])," ",s.a.createElement(ls,{qkey:e.key,stats:t})," ",s.a.createElement(os,{qkey:e.key,stats:t})," ",e.c?e.c:null),d&&"vars"===b?s.a.createElement(cs,{x:e,stats:t}):null);return l=h,r=m,o=f,i=d,c=e.c,k})}var os=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={contact:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(this.state.contact){var t="",a=this.props.uid?this.props.uid:null;return this.props.c&&(t=this.props.c+"\n"),this.props.stats&&(1*this.props.stats.uid!==1*F.user.id&&(a=this.props.stats.uid),this.props.qkey&&this.props.stats.t.qs[this.props.qkey].c.forEach(function(e){t+=e.c+"\n"})),s.a.createElement(Ta,{text:t,uid:a,fm:window.FreeMaths,qkey:this.props.qkey,photo:this.props.photo,close:function(){return e.setState({contact:!1})}})}return s.a.createElement(K,{tooltip:"Ask FreeMaths.uk",placement:"bottom"},s.a.createElement("i",{className:(this.props.btn?this.props.btn:"btn btn-default btn-sm")+" fa fa-envelope-o blue",onClick:function(){return e.setState({contact:!0})}}))}}]),t}(n.Component),ls=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.stats.t.qs[this.props.qkey].c;if(0===e.length)return null;var t=0,a=e.sort(function(e,t){return t.ts-e.ts}).map(function(e){return s.a.createElement("div",{key:t++,style:{textAlign:"left"}},ne(e.ts)," ",s.a.createElement("span",{style:{textAlign:"left"},className:$n[e.f]},s.a.createElement(Aa,null,e.c)))});return s.a.createElement(K,{tooltip:a,placement:"bottom"},s.a.createElement("i",{className:"fa fa-comments","aria-hidden":"true"}))}}]),t}(n.Component),is=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={ts:null},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"s",value:function(e){var t=this,a=[e];return Object.keys(this.props.stats.ts[e.key].qs).forEach(function(n){t.props.stats.ts[e.key].qs[n].rs[e.uid]&&t.props.stats.ts[e.key].qs[n].rs[e.uid].filter(function(t){return"vars"===R(e.key).type?e.ts-t.ts<3600:t.ts===e.ts}).forEach(function(e){a.push({ts:e.ts,mk:e.mk,key:n})})}),a}},{key:"render",value:function(){var e=this;if(!this.props.s)return null;var t=null;return t=-1===this.props.s[0].key.indexOf(":")?this.props.s.map(function(t){return t.ts&&t.ts===e.state.ts?rs(e.s(t),e.props.stats,function(){return e.setState({ts:null})}):rs([t],e.props.stats,function(){return e.setState({ts:t.ts})})}):rs(this.props.s,this.props.stats),s.a.createElement($,{close:function(){return e.props.setS(null)},title:"Corrections"},t)}}]),t}(n.Component),cs=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={expand:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"topic",value:function(e){if(!e.topics)return null;var t=e.topics.split(",")[0];return ee(t.substr(0,t.length-1))+" level "+t.substr(t.length-1,1)}},{key:"render",value:function(){var e=this;if(null===this.props.x)return null;var t=this.props.x,a=t.key.split(":"),n=Object(C.a)(a,4)[3],r=F.data.tests.questions[n];if(!r)return console.error("Adaptive",t,n),null;var o=t.v?JSON.parse(t.v):null,l=t.a?ea(t.a,r.answer,o):null;return s.a.createElement("div",null,s.a.createElement("div",null,ne(t.ts)," ",s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({expand:!e.state.expand})}},"Q ",n)," ",this.topic(r)," ",s.a.createElement(vs,{mark:l})," ",Yn(this.props.stats.t.qs[t.key])," ",s.a.createElement(ls,{qkey:t.key,stats:this.props.stats})," ",s.a.createElement(os,{qkey:t.key,stats:this.props.stats})," ",t.c?t.c:null),this.state.expand&&t.v?s.a.createElement("div",null,s.a.createElement(Aa,{vars:o},r.question)):null,this.state.expand&&t.a?s.a.createElement("div",null,s.a.createElement(Es,{noBox:!0,answer:t.a,vars:o,mark:l,keyboard:!1})):null)}}]),t}(n.Component),us=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return null===this.props.cs?null:s.a.createElement($,{close:function(){return e.props.setS(null,!0)},title:"Comments"},rs(this.props.cs,this.props.stats))}}]),t}(n.Component);function ps(e,t,a){if("undefined"===typeof e.e[t])return s.a.createElement("td",null);var n="m"===a?{"\u2713":"green","?\u2713":"amber","\u2717":"red"}:{":)":"green",":|":"amber",":(":"red"},r=e.e[t].length,o=!1,l=0;if(r>0)var i=e.e[t].map(function(e){return"undefined"!==typeof e.comment&&e.comment.length>0?(o=!0,s.a.createElement("div",{className:n[t],style:{textAlign:"left"},key:l++},e.comment)):null});return 0===r&&(r=""),o?("s"===a&&(r=s.a.createElement("u",null,r)),t===e[a]?s.a.createElement("td",null,s.a.createElement(K,{className:n[t],tooltip:i},r)):s.a.createElement("td",null,s.a.createElement(K,{tooltip:i},r))):t===e[a]?s.a.createElement("td",{className:n[t]},r):s.a.createElement("td",null,r)}n.Component;var hs=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=["negatives","fractions","algebra","powers","surds","quadratics"].map(function(t){var a=e.props.stats[t]?ss(e.props.stats[t],e.props.setQs):[s.a.createElement("td",{key:"1"}),s.a.createElement("td",{key:"2"}),s.a.createElement("td",{key:"3"}),s.a.createElement("td",{key:"4"}),s.a.createElement("td",{key:"5"}),s.a.createElement("td",{key:"6"})];return s.a.createElement("tr",{key:t},s.a.createElement("td",null,s.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setTest(t)}},ee(t))),s.a.createElement("td",{className:"tdcenter"},e.props.stats[t]?e.props.stats[t].level:""),a)});return s.a.createElement("div",{name:"topics"},s.a.createElement("h3",null,"Topic Summary"),s.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"Topic"),s.a.createElement("th",null,"level"),Kn.map(function(e){return s.a.createElement("th",{key:e,className:$n[e]},Gn[e])}))),s.a.createElement("tbody",null,t)))}}]),t}(n.Component),ms=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={correct:null,log:null,tid:null,qid:null,vars:null,tree:null,topic:null,last_log:null,edit:!1,qs:null,i:0},a.setQs=function(e){var t=Object.keys(e);L("setQs")&&console.log("setQs(s) qs",e,t);var n=e[t[0]].variables?JSON.parse(e[t[0]].variables):Ht(B(t[0]).variables,a.state.log[t[0]]);a.setState({qid:t[0],vars:n,i:1,qs:X(e)})},a.setTest=function(e){var t=F.data.tests.tests,n=null,s=null,r=null;Object.keys(t).forEach(function(a){t[a].title.endsWith(ee(e))&&(n=a)}),n&&(r=Ht(B(s=t[n].qs[1].qid).variables,a.state.log[s])),a.setState({qid:s,vars:r,tid:n,topic:e,correct:null})},a.setTopic=function(e){var t=null;e=F.cache.qTree.topics[e]?e:null;var n=a.state.log.stats[e]?a.state.log.stats[e].level:null,s=Ht(B(t=e?a.chooseQ(a.topicOptions(e,n)):a.setQ()).variables,a.state.log[t]);a.setState({qid:t,vars:s,topic:e})},a.logEvent=function(e,t,n){a.state.correct||"\u2713"!==e&&"?\u2713"!==e?"\u2717"!==e&&"?\u2717"!==e&&"Show"!==e||a.setState({correct:!1}):(a.setState({correct:e}),"\u2713"===e&&setTimeout(function(){return a.nextQ(":)")},1e3)),e.startsWith(":")&&a.nextQ(e),F.updateLog({paper:a.state.tid?a.state.tid:0,question:a.state.qid,event:e,vars:a.state.vars,answer:t,comment:n})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){L("AutoTestMount")&&console.log("AutoTest componentDidMount(),props,state",this.props,this.state);var e=this.filterLog(F.user.log),t=this.props.qid&&!this.props.vars?Ht(B(this.props.qid).variables,e[this.props.qid]):this.props.vars;this.setState({tid:this.props.tid,qid:this.props.qid,vars:t,log:e,last_log:F.user.log.length>0?F.user.log[F.user.log.length-1].id:0})}},{key:"shouldComponentUpdate",value:function(e,t){var a=F.data.savedQ||t.last_log!==this.state.last_log||t.retry!==this.state.retry||t.correct!==this.state.correct||t.qid!==this.state.qid||t.vars!==this.state.vars||t.edit!==this.state.edit;return L("AutoTestUpdate")&&console.log("AutoTest shouldComponentUpdate(p, s),props,state",e,t,this.props,this.state),a}},{key:"componentWillReceiveProps",value:function(e){if(L("AutoTestProps")&&console.log("AutoTest componentWillReceiveProps(p),props,state",e,this.props,this.state),this.state.log)F.user.log.length>0&&F.user.log[F.user.log.length-1].id!==this.state.last_log&&this.setState({log:this.updateLog(F.user.log),last_log:F.user.log[F.user.log.length-1].id});else{var t=this.filterLog(F.user.log);this.setState({log:t,last_log:F.user.log.length>0?F.user.log[F.user.log.length-1].id:0})}}},{key:"maxLevel",value:function(){var e=this,t=3;return this.state.log.stats&&Object.keys(this.state.log.stats).forEach(function(a){e.state.log.stats[a].level>t&&(t=e.state.log.stats[a].level)}),t}},{key:"updateStats",value:function(e,t,a){var n=t;return Q(e.question).forEach(function(t){Y(n[t.topic])||(n[t.topic]={level:null,":(":{},":|":{},":)":{},"\u2717":{},"?\u2713":{},"\u2713":{},f:{},m:{}}),!Rn[e.event]||n[t.topic].f[e.question]&&!a||(n[t.topic].f[e.question]&&n[t.topic][n[t.topic].f[e.question]][e.question]&&delete n[t.topic][n[t.topic].f[e.question]][e.question],n[t.topic][e.event][e.question]=e,n[t.topic].f[e.question]=e.event),!Jn[e.event]||n[t.topic].m[e.question]&&!a||(n[t.topic].m[e.question]&&delete n[t.topic][n[t.topic].m[e.question]][e.question],n[t.topic][e.event][e.question]=e,n[t.topic].m[e.question]=e.event),"\u2713"===e.event&&(t.level>n[t.topic].level&&(n[t.topic].level=t.level),n[t.topic].f[e.question]&&n[t.topic][n[t.topic].f[e.question]][e.question]&&delete n[t.topic][n[t.topic].f[e.question]][e.question],n[t.topic].f[e.question]=":)")}),n}},{key:"corrections",value:function(e){var t={};return Object.keys(e).forEach(function(a){return["\u2717","?\u2713",":(",":|"].forEach(function(n){Object.keys(e[a][n]).forEach(function(s){t[s]||(t[s]=e[a][n][s])})})}),0===Object.keys(t).length&&(t=null),t}},{key:"challenges",value:function(){var e={};return F.user.challenges&&F.user.challenges.forEach(function(t){var a=JSON.parse(t.json),n=new Date(t.created_at.replace(" ","T")).getTime();a.qs.forEach(function(t){e[t]={id:t,ts:n}})}),0===Object.keys(e).length&&(e=null),console.log("challenges",e,F.user.challenges),e}},{key:"updateLog",value:function(e){var t=this.state.log,a=e[e.length-1],n=new Date(a.created_at?a.created_at.replace(" ","T"):null).getTime();return t[a.question]?t[a.question].ts=n:t[a.question]={use:[],skip:[],ts:n},"\u2713"===a.event&&t.challenges&&t.challenges[a.question]&&n>t.challenges[a.question].ts&&delete t.challenges[a.question],t[a.question].skip.includes(a.variables)||t[a.question].skip.push(a.variables),t[a.question].use.includes(a.variables)&&t[a.question].use.splice(t[a.question].use.indexOf(a.variables),1),t.stats=this.updateStats(a,t.stats,!0),t.corrections=this.corrections(t.stats),t.challenges&&0===Object.keys(t.challenges).length&&(t.challenges=null),t}},{key:"filterLog",value:function(e){for(var t={session:[],stats:{},corrections:null,challenges:this.challenges()},a=F.data.tests.questions,n=e.length-1;n>0;n--){var s=e[n];if(s.question&&s.variables&&Y(a[s.question])&&Y(a[s.question].topics)&&s.variables.length>0&&-1===s.variables.indexOf("$")){var r=new Date(s.created_at.replace(" ","T")).getTime(),o=Date.now()-r<864e5;t[s.question]||(t[s.question]={use:[],skip:[],ts:r}),"\u2713"===s.event&&t.challenges&&t.challenges[s.question]&&r>t.challenges[s.question].ts&&delete t.challenges[s.question],t[s.question].skip.includes(s.variables)||t[s.question].use.includes(s.variables)||(o||"\u2713"===s.event?t[s.question].skip.push(s.variables):"\u2717"===s.event&&t[s.question].use.push(s.variables)),t.stats=this.updateStats(s,t.stats)}}return t.corrections=this.corrections(t.stats),t.challenges&&0===Object.keys(t.challenges).length&&(t.challenges=null),t}},{key:"setQ",value:function(e,t){t=t||null;for(var a=F.data.tests.questions,n=Object.keys(this.state.log),s=0;null===t&&s<a.length;)Y(this.state.log[n[s]].use)&&Y(a[n[s]].topics)&&Bt(a[n[s]].variables,this.state.log[n[s]])?t=n[s]:s++;if(null===t&&(t=this.chooseQ(this.levelOptions(null,this.maxLevel()))),L("setQ")&&console.log("setQ(set,qid)",e,t),!e)return t;this.setState({qid:t,vars:Ht(B(t).variables,this.state.log[t]),correct:null,edit:!1})}},{key:"chooseQ",value:function(e){for(var t=null,a=0;null===t&&a<e.length;)Y(this.state.log[e[a]])&&!Z(this.state.log[e[a]].skip)?a++:t=e[a];return null===t&&e.length>0&&(t=e[0]),t}},{key:"topicOptions",value:function(e,t){var a=this,n=[];return F.cache.qTree.topics[e]&&(F.cache.qTree.topics[e][t]?F.cache.qTree.topics[e][t].forEach(function(e){n.includes(e)||n.push(e)}):Object.keys(F.cache.qTree.topics[e]).forEach(function(t){return F.cache.qTree.topics[e][t].forEach(function(e){n.includes(e)||n.push(e)})}),n.sort(function(e,t){return a.state.log[e]?a.state.log[t]?a.state.log[e].ts-a.state.log[t].ts:1:-1})),n}},{key:"levelOptions",value:function(e,t){var a=[];return Y(F.cache.qTree.levels[t])&&Object.keys(F.cache.qTree.levels[t]).forEach(function(n){n!==e&&F.cache.qTree.levels[t][n].forEach(function(e){a.includes(e)||a.push(e)})}),a}},{key:"questionTopic",value:function(e){return Q(e)[0]?Q(e)[0].topic:null}},{key:"questionSelect",value:function(e){var t=this;if(null!==this.state.correct&&"\u2713"!==this.state.correct)return s.a.createElement(ys,{logEvent:this.logEvent});if(this.state.tid)return s.a.createElement("span",null,s.a.createElement(Os,{tid:this.state.tid,qid:this.state.qid,selectQ:function(e){return t.setQ(!0,e)}}),s.a.createElement("button",{className:"btn btn-link",onClick:function(){return t.setQ(!0,t.state.qid)}},s.a.createElement("i",{className:"fa fa-btn fa-random"})));var a=Q(e)[0]?Q(e)[0]:{topic:"",level:0};return this.state.qs&&this.state.i?s.a.createElement("span",null,"Question ",this.state.i," of ",Object.keys(this.state.qs).length," (",a.topic," level ",a.level,")",s.a.createElement("button",{className:"btn btn-link",onClick:function(){return t.nextQ()}},s.a.createElement("i",{className:"fa fa-btn fa-random"}))):s.a.createElement("span",null,s.a.createElement(xs,{tree:F.cache.qTree,topic:a.topic,setTopic:this.setTopic}),this.level(a.level-1)?s.a.createElement("button",{className:"btn btn-link",onClick:function(){return t.nextQ("-")}},s.a.createElement("i",{className:"fa fa-btn fa-minus-circle"})):null,"level ",a.level,this.level(a.level+1)?s.a.createElement("button",{className:"btn btn-link",onClick:function(){return t.nextQ("+")}},s.a.createElement("i",{className:"fa fa-btn fa-plus-circle"})):null,s.a.createElement("button",{className:"btn btn-link",onClick:function(){return t.nextQ()}},s.a.createElement("i",{className:"fa fa-btn fa-random"})))}},{key:"level",value:function(e){return null===this.state.topic?F.cache.qTree&&Y(F.cache.qTree.levels[e]):Y(F.cache.qTree.topics[this.state.topic][e])}},{key:"questionOptions",value:function(e){var t=[],a=Q(this.state.qid)[0],n=a.topic,s=a.level;return":)"===e&&this.state.correct&&this.level(s+1)?s++:"+"===e&&this.level(s+1)?s++:":("!==e&&"-"!==e||!this.level(s-1)||s--,0===(t=this.state.correct&&null===this.state.topic?this.levelOptions(n,s):this.topicOptions(n,s)).length&&(t=this.levelOptions(null,s)),t}},{key:"setVars",value:function(e){return Ht(B(e=e||this.state.qid).variables,this.state.log[e])}},{key:"nextQ",value:function(e){var t=this;if(this.state.tid)if(this.state.correct&&":|"!==e&&":("!==e){var a=R(this.state.tid),n=a.qs.find(function(e){return e&&e.qid==t.state.qid}).qn,s=a.qs[n+1]?a.qs[n+1].qid:null;this.setState({qid:s,tid:s?this.state.tid:null,vars:s?this.setVars(s):null,correct:null})}else this.setState({vars:this.setVars(),correct:null});else if(this.state.correct||":|"!==e&&":)"!==e)if(this.state.i){var r=Object.keys(this.state.qs);if(this.state.i>=r.length)this.setState({qid:null,vars:null,qs:null,i:0,correct:null,retry:0});else{var o=this.state.qs[r[this.state.i]].variables?JSON.parse(this.state.qs[r[this.state.i]].variables):Ht(B(r[this.state.i]).variables,this.state.log[r[this.state.i]]);this.setState({qid:r[this.state.i],vars:o,i:this.state.i+1,retry:0,correct:null})}}else{var l=this.chooseQ(this.questionOptions(e));l!==this.state.qid?this.setState({qid:l,correct:null,vars:this.setVars(l)}):this.setState({correct:null,vars:this.setVars()})}else this.setState({vars:this.setVars(),correct:null})}},{key:"render",value:function(){var e=this;return this.state.log?this.state.qid?!0===this.state.edit?s.a.createElement(da,{fm:this.props.fm,qid:this.state.qid,vars:this.state.vars,close:function(t){return e.setQ(!0,t)}}):s.a.createElement($,{name:"question",close:this.props.close?this.props.close:function(){return e.setState({tid:null,qid:null,vars:null,qs:{},topic:null,correct:null})},title:this.questionSelect(this.state.qid)},s.a.createElement("div",null,"See ",s.a.createElement(Aa,null,"@"+this.questionTopic(this.state.qid)),s.a.createElement("br",null),s.a.createElement("span",{style:{float:"right"}}),F.user.isAdmin?s.a.createElement(K,{tooltip:this.state.qid},s.a.createElement("button",{className:"btn btn-link",style:{float:"right"}},s.a.createElement("i",{className:"fa fa-btn fa-edit",onClick:function(){return e.setState({edit:!0})}}))):null,s.a.createElement(fs,{qid:this.state.qid,vars:this.state.vars,logEvent:this.logEvent}))):s.a.createElement("div",null,this.state.log.corrections?s.a.createElement(G,{className:"btn btn-danger",tooltip:"Correct first",onClick:function(){return e.setQs(e.state.log.corrections)}},"Corrections"):null,this.state.log.challenges?s.a.createElement(G,{className:"btn btn-primary",tooltip:"Adaptive test and learn",onClick:function(){return e.setQs(e.state.log.challenges)}},"Test"):s.a.createElement(G,{className:"btn btn-primary",tooltip:"Adaptive test and learn",onClick:function(){return e.setQ(!0)}},"Test"),"\xa0",s.a.createElement(Aa,null,"@instructions__home"),null===this.state.log?null:s.a.createElement(hs,{setQs:this.setQs,setTest:this.setTest,stats:this.state.log.stats})):null}}]),t}(n.Component),fs=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={help:!1,working:!1,correct:null},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.qid===this.props.qid&&e.vars===this.props.vars||(this.setState({help:!1,working:!1,correct:null}),e.qid&&e.logEvent("Q"))}},{key:"componentDidMount",value:function(){this.props.qid&&this.props.logEvent("Q")}},{key:"render",value:function(){var e=F.data.tests.questions[this.props.qid];return s.a.createElement("div",{id:"Question_"+this.props.qid},s.a.createElement("div",{className:"PQ"},s.a.createElement(Aa,{vars:this.props.vars},e.question)),s.a.createElement(ds,{qid:this.props.qid,vars:this.props.vars,logEvent:this.props.logEvent}))}}]),t}(n.Component),ds=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={answer:"",hint:!1,show:!1,mark:null},a.hintShow=function(e,t){t.currentTarget.blur(),"hint"===e?(a.props.logEvent("Hint"),a.setState({keyboard:!1,hint:!0})):"show"===e&&(a.props.logEvent("Show"),a.setState({keyboard:!1,hint:!0,show:!0}))},a.mark=function(){var e=F.data.tests.questions[a.props.qid].answer;if(a.state.answer.length>0){var t=ea(a.state.answer,e,a.props.vars);a.props.logEvent(t.correct,a.state.answer),a.setState({mark:t})}else a.setState({mark:null})},a.logmark=function(e,t,n){a.props.log("M",n),a.setState({mark:{correct:"?\u2713",m:n}})},a.log=function(e,t,n,s){a.props.logEvent(e,n,s)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.qid===this.props.qid&&e.vars===this.props.vars||this.setState({answer:"",hint:!1,show:!1,mark:null})}},{key:"render",value:function(){var e=this,t=this.state.mark&&"\u2713"===this.state.mark.correct;return s.a.createElement("div",null,t?null:s.a.createElement(bs,{hint:this.state.hint,show:this.state.show,hintShow:this.hintShow,mark:this.state.mark,change:this.props.change}),s.a.createElement(Es,{answer:this.state.answer,mark:this.state.mark,vars:this.props.vars}),s.a.createElement(os,{btn:"btn btn-default",c:"",qkey:(this.props.tid?this.props.tid:0)+":::"+this.props.qid}),t?null:s.a.createElement("div",null,this.state.show?null:s.a.createElement(fa,{answer:this.state.answer,mark:this.mark,change:function(t){return e.setState({answer:t})},qid:this.props.qid,vars:this.props.vars}),s.a.createElement(ks,{qid:this.props.qid,vars:this.props.vars,hint:this.state.hint,show:this.state.show})))}}]),t}(n.Component),vs=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return null===this.props.mark?null:"\u2713"===this.props.mark.correct?s.a.createElement("span",{className:"green"},"\u2713"):"?\u2713"===this.props.mark.correct?s.a.createElement("span",{className:"amber"},"\u2713"):"?\u2717"===this.props.mark.correct?s.a.createElement("span",{className:"amber"},"\u2717"):s.a.createElement("span",{className:"red"},"\u2717")}}]),t}(n.Component),gs=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={help:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(!this.props.mark)return null;var t="amber";if("\u2713"===this.props.mark.correct?t="green":"\u2717"===this.props.mark.correct&&(t="red"),this.state.help){var a="Freemaths does its best to check your answer (re-arranging as needed).\n<g>\u2713</g> means your answer matched.\n<o>\u2713</o> means your answer is numerically correct but not as expected, can you simplify?\n<r>\u2717</r> means our tests suggest your answer is wrong (but the tests aren't perfect).\n";return"\u2713"!==this.props.mark.correct?(a+="\nHave you have provided the answer in exactly the format requested?\n<g>Green</g> terms are in the expected answer. <o>Amber</o> terms have a sign error. Check other terms carefully for calculation errors.",a+="\n\nUse <r>Show</r> to see a model answer and working."):a+="\nUse <g>Show</g> to see a model answer and working.",s.a.createElement(ya,{title:"Marking Help",help:a,close:function(){return e.setState({help:!1})}})}return s.a.createElement(G,{className:"btn btn-default btn-sm "+t,onClick:function(){return e.setState({help:!0})},tooltip:"marking help"},"?")}}]),t}(n.Component),bs=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props.hint||null!==this.props.mark&&"\u2713"===this.props.mark.correct,a=null===this.props.mark?"red":"\u2713"===this.props.mark.correct?"green":"red";return s.a.createElement("span",null,t?null:s.a.createElement(G,{className:"btn btn-default amber",onClick:function(t){return e.props.hintShow("hint",t)},tooltip:"show hint"},"Hint"),this.props.show?null:s.a.createElement(G,{className:"btn btn-default "+a,onClick:function(t){return e.props.hintShow("show",t)},tooltip:"show answer"},"Show"))}}]),t}(n.Component),ks=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,this.props.show?s.a.createElement("div",{name:"show",className:"box"},s.a.createElement(Aa,{vars:this.props.vars},B(this.props.qid).working)):null,this.props.show&&this.props.hint?s.a.createElement("br",null):null,this.props.hint?s.a.createElement("div",{name:"hint",className:"box"},s.a.createElement(Aa,{vars:this.props.vars},B(this.props.qid).help)):null)}}]),t}(n.Component),ys=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={help:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=null;if(!this.state.help)return s.a.createElement("div",{name:"rate"},s.a.createElement(G,{id:"rate",tooltip:"rate to move on",onClick:function(){return e.setState({help:!0})}},"Rate:"),s.a.createElement(G,{id:"FG",value:":)",className:"btn btn-default green",tooltip:"understood",onClick:function(){return e.props.logEvent(":)")}},Gn[":)"]),s.a.createElement(G,{id:"FA",value:":|",className:"btn btn-default amber",tooltip:"practice needed",onClick:function(){return e.props.logEvent(":)")}},Gn[":|"]),s.a.createElement(G,{id:"FR",value:":(",className:"btn btn-default red",tooltip:"help needed",onClick:function(){return e.props.logEvent(":)")}},Gn[":("]),s.a.createElement("div",null,t));t=s.a.createElement(ka,{topic:"rating",close:function(){return e.setState({help:!1})}})}}]),t}(n.Component),Es=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.answer.replace(/^(-?)(\d+)(\u02fd| )(\d+\/\d+)$/,"$1{$2\u02fd$4}").replace(/\s/g,"");if(!e||""===e)return null;var t=this.props.mark,a=this.props.vars,n=null,r=null;return t&&t.attempt==this.props.answer?(n=s.a.createElement(vs,{mark:t}),r="\u2713"===t.correct?s.a.createElement(Aa,{vars:a},e):s.a.createElement(Aa,{auto:!1},t.diff)):r=s.a.createElement(Aa,{vars:a},e),n?s.a.createElement("div",{name:"answer",className:"inline"},s.a.createElement("div",{className:"maths border"},r,n),this.props.hide?null:s.a.createElement(gs,{mark:t})):s.a.createElement("div",{className:"maths border inline"},r)}}]),t}(n.Component),Os=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.tid!==this.props.tid||e.qid!==this.props.qid}},{key:"render",value:function(){var e=this,t=F.data.tests.tests[this.props.tid],a=F.data.tests.questions[this.props.qid];if(!t||!a)return null;var n=t.qs.map(function(e){return e?s.a.createElement("option",{value:e.qid,key:e.qid},e.qn):null});return s.a.createElement("span",null,"Question ",s.a.createElement("select",{value:this.props.qid,className:"btn btn-default",onChange:function(t){return e.props.selectQ(t.target.value)}},n)," of ",t.qs.length-1)}}]),t}(n.Component),xs=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=[s.a.createElement("option",{key:0,value:"0"},"select")];return Object.keys(this.props.tree.topics).sort(function(e,t){return e.localeCompare(t)}).forEach(function(e){t.push(s.a.createElement("option",{key:e},e))}),s.a.createElement("form",{className:"form-horizontal inline"},s.a.createElement("select",{className:"form-control inline",style:{width:"auto"},value:this.props.topic,onChange:function(t){return e.props.setTopic(t.target.value)}},t))}}]),t}(n.Component),js=ms,ws=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={tutor:["","","",""],remove:[],error:{}},a.tutor=function(e){e.preventDefault(),ce("/react_ajax/tutor",function(e){if(e.error)a.setState({error:e.data});else{var t=a.props.fm.state.user;t.tutors=e.data.tutors,a.setState({tutor:["","","",""],remove:[],error:{added:e.data.added,removed:e.data.removed}}),a.props.fm.setState({user:t})}},{tutor:a.state.tutor,remove:a.state.remove,token:a.props.fm.state.user.token})},a.add=function(e,t){var n=a.state.tutor;n[e]=t,a.setState({tutor:n,error:{}})},a.remove=function(e){var t=a.state.remove,n=t.indexOf(e);-1!==n?t.splice(n,1):t.push(e),a.setState({remove:t,error:{}})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"button",value:function(){var e={style:"primary",text:"Add"};return this.state.remove.length>0&&(e.style="danger",this.state.tutor.join("")?e.text="Add & Remove":e.text="Remove"),e}},{key:"render",value:function(){var e=this;return s.a.createElement(S.a,{show:!0,onHide:this.props.close},s.a.createElement(S.a.Header,{closeButton:!0},s.a.createElement(S.a.Title,null,"Parents, Teachers & Tutors")),s.a.createElement(S.a.Body,null,this.state.error.added?s.a.createElement("div",{className:"alert alert-success"},s.a.createElement("strong",null,this.state.error.added," tutors added")):null,this.state.error.removed?s.a.createElement("div",{className:"alert alert-success"},s.a.createElement("strong",null,this.state.error.removed," tutors removed")):null,this.state.error.error?s.a.createElement("div",{className:"alert alert-danger"},s.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,s.a.createElement(y.a,{onSubmit:this.tutor,horizontal:!0},[1,2,3].map(function(t){return s.a.createElement(qs,{key:t,i:t,email:e.state.tutor[t],error:e.state.error,add:e.add})}),s.a.createElement(E.a,null,s.a.createElement(b.a,{smOffset:3,sm:4},s.a.createElement(w.a,{bsStyle:this.button().style,type:"submit"},s.a.createElement("i",{className:"fa fa-mortar-board"})," ",this.button().text))),this.props.fm.state.user.tutors?s.a.createElement("div",null,s.a.createElement(E.a,null,this.props.fm.state.user.tutors.map(function(t){return s.a.createElement(b.a,{key:t.email,smOffset:3,sm:8},s.a.createElement(q.a,{value:!!e.state.remove[t.email]&&"checked",onChange:function(a){return e.remove(t.email)}},s.a.createElement("i",{className:"fa fa-trash"})," ",s.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.fm.setState({email:t.email,modal:"contact"})}},t.name?t.name:t.email)))}))):null)))}}]),t}(n.Component),qs=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(E.a,{controlId:"tutor"+this.props.i,validationState:this.props.error["tutor."+this.props.i]?"error":null},s.a.createElement(b.a,{componentClass:O.a,sm:3},"Tutor Email"),s.a.createElement(b.a,{sm:8},s.a.createElement(x.a,{type:"email",name:"email",value:this.props.email,placeholder:"Email",onChange:function(t){return e.props.add(e.props.i,t.target.value)}})),this.props.error["tutor."+this.props.i]?s.a.createElement(b.a,{smOffset:3,sm:8},s.a.createElement(j.a,null,this.props.error["tutor."+this.props.i])):null)}}]),t}(n.Component),Ss=ws,Cs=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={list:!1,topic:null,level:null,qid:null},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"tests",value:function(e,t){var a=null;return t[e]&&(a=t[e].map(function(e){return F.data.tests.tests[e.tid].title+" Q"+e.qn})),a}},{key:"render",value:function(){var e=this;if(this.state.qid)return s.a.createElement(js,{qid:this.state.qid,close:function(){return e.setState({qid:null})}});var t=D(),a={};Object.keys(F.data.tests.tests).forEach(function(e){F.data.tests.tests[e].qs.forEach(function(e){e&&(a[e.qid]?a[e.qid].push(e):a[e.qid]=[e])})});var n=Object.keys(t.topics).map(function(t){return s.a.createElement("span",{key:t,className:"btn-link",onClick:function(){return e.setState({topic:t!==e.state.topic?t:null})}},e.state.topic===t?s.a.createElement("span",{className:"green"},t," "):s.a.createElement("span",null,t," "))}),r=Object.keys(t.levels).map(function(t){return s.a.createElement("span",{key:t,className:"btn-link",onClick:function(){return e.setState({level:t!==e.state.level?t:null})}},e.state.level===t?s.a.createElement("span",{className:"red"},t," "):s.a.createElement("span",null,t," "))}),o=Object.keys(F.data.tests.questions).map(function(t){var n=F.data.tests.questions[t],r=!0;return!e.state.topic&&!e.state.level||n.topics?e.state.topic&&-1===n.topics.indexOf(e.state.topic)?r=!1:e.state.level&&-1===n.topics.indexOf(e.state.level)&&(r=!1):r=!1,r?s.a.createElement("div",{key:n.id},s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({qid:n.id})}},n.id)," ",s.a.createElement(Aa,null,n.topic)," ",s.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setQ(n.id,!0)}},"[",n.topics,"]")," ",e.tests(n.id,a)):null});return this.state.newQ?s.a.createElement(da,{qid:F.qNew(),close:function(t){return e.setState({newQ:!1,qid:t})}}):s.a.createElement("div",null,s.a.createElement("button",{onClick:function(){return e.setState({newQ:!0})}},"New"),n,r,o)}}]),t}(n.Component),Ns=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={students:!!F.students,uid:null,uids:"",qs:""},a.set=function(){var e=null,t=a.state.uids.split(",").map(function(e){return F.students[e]?e:null}),n=a.state.qs.split(",").map(function(e){return F.data.tests.questions[e]?e:null});n.length&&t.length&&(e={},t.forEach(function(t){e[t]={qs:n}})),e&&F.setChallenge(e,function(){return a.setState({uids:"",qs:""})})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){var e=this;this.state.students||F.getStudents(!0,function(t){return e.setState({students:t})})}},{key:"render",value:function(){var e=this;if(!this.state.students)return null;var t=null,a=this.state.uids;return this.state.uid&&(a?-1===a.indexOf(this.state.uid)&&(a+=","+this.state.uid):a=""+this.state.uid,t=s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({uid:null,uids:a})}},this.state.uid," ",F.students[this.state.uid].name)),s.a.createElement("div",null,t," Uids:",s.a.createElement("input",{onChange:function(t){return e.setState({uids:t.target.value,uid:null})},name:"uids",type:"text",value:a}),"Qs:",s.a.createElement("input",{onChange:function(t){return e.setState({qs:t.target.value})},name:"qs",type:"text",value:this.state.qs}),s.a.createElement("button",{onClick:this.set},"Set"),s.a.createElement(rn,{log:F.log,uid:this.state.uid,setUid:function(t){return e.setState({uid:t===e.state.uid?null:t})},students:!0}))}}]),t}(n.Component),_s=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={users:null,data:null,tables:null,past:!1,book:!1,qs:!1,diffs:null,lz:null,debug:null},a.message=function(e){return a.setState({message:e})},a.check=function(e){console.log("updates",e),a.setState({message:{type:"danger",text:"Update - see console for details - dismiss message or click again to send"}})},a.send=function(){var e=a.check;a.state.message&&a.state.message.text.startsWith("Update")&&(e=!1),F.send(a.message,a.message,e)},a.compare=function(){var e={help:a.diff("help"),tests:a.diff("tests"),questions:a.diff("questions")};a.setState({diffs:e}),console.log("diffs",e)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"diff",value:function(e){var t=this,a={};return Object.keys(this.state.data[e]).forEach(function(n){var s=F.data[e][n],r=t.state.data[e][n];s&&r&&s.updated_at===r.updated_at||(a[n]={live:s,comp:r})}),Object.keys(F.data[e]).forEach(function(n){var s=F.data[e][n],r=t.state.data[e][n];s&&r&&s.updated_at===r.updated_at||a[n]||(a[n]={live:s,comp:r})}),a}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,this.state.message?s.a.createElement("div",{className:"alert alert-dismissible alert-"+this.state.message.type},s.a.createElement("button",{type:"button",onClick:function(){return e.setState({message:null})},className:"close","data-dismiss":"alert"},"\xd7"),s.a.createElement("strong",null,this.state.message.text)):null,s.a.createElement("span",{className:"btn-link",onClick:this.send},"Send Data"),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({debug:!e.state.debug})}},"Debug"),this.state.debug?s.a.createElement(As,null):null,s.a.createElement("br",null),s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({users:!e.state.users})}},"Users"),this.state.users?s.a.createElement(Ms,{fm:this.props.fm}):null,s.a.createElement("br",null),s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({past:!e.state.past})}},"Past Papers"),this.state.past?s.a.createElement(vn,{close:function(){return e.setState({past:!1})},fm:this.props.fm}):null,s.a.createElement("br",null),s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({book:!e.state.book})}},"Books"),this.state.book?s.a.createElement(Qn,{close:function(){return e.setState({book:!1})},fm:this.props.fm}):null,s.a.createElement("br",null),s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({qs:!e.state.qs})}},"Questions"),this.state.qs?s.a.createElement(Cs,null):null,s.a.createElement("br",null),s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({chal:!e.state.chal})}},"Challenges"),this.state.chal?s.a.createElement(Ns,null):null)}}]),t}(n.Component),As=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={debugs:I,name:""},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"debug",value:function(e){!e&&this.state.name?H(this.state.name):H(e),this.setState({debugs:I})}},{key:"render",value:function(){var e=this;if(this.state.debugs)return s.a.createElement("div",null,s.a.createElement("div",null,F.user.token),s.a.createElement("input",{type:"text",size:"3",value:this.state.name,onChange:function(t){e.setState({name:t.target.value})}}),s.a.createElement("button",{onClick:function(){return e.debug()}},"Set"),Object.keys(this.state.debugs).map(function(t){return s.a.createElement("span",{key:t,className:"btn-link",onClick:function(){e.debug(t)}},I[t].show?s.a.createElement("span",{className:"green"},t,":",I[t].n," "):s.a.createElement("span",null,t,":",I[t].n," "))}))}}]),t}(n.Component),Ms=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={users:F.users,sort:"visit",error:{}},a.sort=function(e,t){switch(e=a.state.users[e],t=a.state.users[t],a.state.sort){case"visit":return e.ts=new Date((e.visited_at?e.visited_at:e.updated_at).replace(" ","T")).getTime(),t.ts=new Date((t.visited_at?t.visited_at:t.updated_at).replace(" ","T")).getTime(),t.ts-e.ts;case"login":return e.ts=new Date(e.updated_at.replace(" ","T")).getTime(),t.ts=new Date(t.updated_at.replace(" ","T")).getTime(),t.ts-e.ts;case"register":return e.ts=new Date(e.created_at.replace(" ","T")).getTime(),t.ts=new Date(t.created_at.replace(" ","T")).getTime(),t.ts-e.ts;case"name":return e.name.localeCompare(t.name);case"email":return e.email.localeCompare(t.email);default:return t[a.state.sort]-e[a.state.sort]}},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){var e=this;this.state.users||F.getUsers(function(t){return e.setState({users:t})},function(t){return e.setState({message:{type:"danger",text:t}})})}},{key:"render",value:function(){var e=this;if(!this.state.users)return s.a.createElement("div",null,"loading...");var t=["name","email","visited_at","updated_at","created_at"],a=Object.keys(this.state.users).sort(this.sort).map(function(a){return a=e.state.users[a],s.a.createElement("tr",{key:a.id},s.a.createElement("td",null,a.id,s.a.createElement(os,{uid:a.id})),t.map(function(e){return s.a.createElement("td",{key:e},a[e])}))});return s.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},s.a.createElement("thead",null,s.a.createElement("tr",null,["id","name","email","visit","login","register"].map(function(t){return s.a.createElement("th",{key:t},s.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({sort:t})}},t))}))),s.a.createElement("tbody",null,a))}}]),t}(n.Component),Ts=_s,Ps=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={page:"Home",modal:null,message:null,token:null,help:null,update:0,ready:!1},a.help=function(e){a.setState({help:e,message:null})},a.nav=function(e){a.setState({page:e,message:null})},a.modal=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;a.setState({modal:e,email:t,message:null})},a.closeModal=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a.setState({modal:null,message:e})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"update",value:function(){this.setState({update:this.state.update+1})}},{key:"componentWillMount",value:function(){if(F.serviceWorker(this,-1!==window.location.href.indexOf("://app.")),window.location.search)if(window.location.search.startsWith("?reset="))this.setState({modal:"reset",token:window.location.search.substr(7)});else if(window.location.search.startsWith("?contact"))this.setState({modal:"contact"});else if(window.location.search.startsWith("?mail="))this.setState({modal:"mail",token:window.location.search.substr(6)});else if(window.location.search.startsWith("?Q")){var e=window.location.search.substr(2).split("&"),t=e[0],a=null;e.length>1&&(e.shift(),a={},e.forEach(function(e){e=decodeURIComponent(e).split("="),a[e[0]]=e[1]})),console.log("Q",t,a,this.state),this.setState({qid:t,vars:a})}window.history.pushState("object or string","Title","/")}},{key:"showPage",value:function(){var e;if(!this.state.ready||this.state.password)e="Admin"===this.state.page?s.a.createElement(Ts,null):s.a.createElement(ue,{modal:this.modal,app:-1!==window.location.href.indexOf("://app.")});else switch(this.state.page){case"Students":e=s.a.createElement(on,{students:!0});break;case"Past":e=s.a.createElement(on,{type:"past"});break;case"Books":e=s.a.createElement(on,{type:"book"});break;case"Working":e=s.a.createElement(Pa,null);break;case"Admin":e=s.a.createElement(Ts,null);break;default:e=s.a.createElement("div",null,s.a.createElement(js,{qid:this.state.qid,vars:this.state.vars}),s.a.createElement(rn,{uid:F.user.id,modal:this.modal,update:this.state.update}))}return e}},{key:"showModal",value:function(){switch(this.state.modal){case"contact":return s.a.createElement(Ta,{close:this.closeModal});case"mail":return s.a.createElement(Wa,{token:this.state.token,close:this.closeModal});case"register":return s.a.createElement(de,{close:this.closeModal});case"update":return s.a.createElement(fe,{close:this.closeModal});case"photo":return s.a.createElement(Ga,{jpeg:this.state.jpeg,close:this.closeModal});case"tutor":return s.a.createElement(Ss,{close:this.closeModal});case"forgot":return s.a.createElement(pe,{email:this.state.email,close:this.closeModal});case"reset":return s.a.createElement(he,{close:this.closeModal,token:this.state.token});default:return null}}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(Ws,{page:this.state.page,nav:this.nav,modal:this.modal,help:this.help}),s.a.createElement("div",{id:"modalRoot"}),s.a.createElement("div",{id:"page",className:"container"},this.state.message?s.a.createElement("div",{name:"alert",className:"alert alert-dismissible alert-"+this.state.message.type},s.a.createElement("button",{type:"button",className:"close",onClick:this.state.message.close?this.state.message.close:function(){return e.setState({message:null})},"data-dismiss":"alert"},"\xd7"),s.a.createElement("strong",null,this.state.message.text)):null,this.showPage(),this.showModal(),this.state.password&&"mail"!==this.state.modal?s.a.createElement(me,{auth:function(){return e.setState({ready:F.ready(!0),password:null})},close:function(){return e.setState({ready:!1,password:null})}}):null,this.state.help?s.a.createElement(ka,{topic:this.state.help,close:function(){return e.setState({help:null})}}):null),this.state.token?s.a.createElement("span",{id:"debug",style:{display:"none"}},this.state.token):null)}}]),t}(n.Component),Ws=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e,t=this;return e=null!==F.user?s.a.createElement("div",null,s.a.createElement(h.a,{activeKey:this.props.page},s.a.createElement(m.a,{id:"tests",eventKey:"Home",onClick:function(){return t.props.nav("Home")}},"Tests"),s.a.createElement(m.a,{id:"books",eventKey:"Books",onClick:function(){return t.props.nav("Books")}},"Books"),s.a.createElement(m.a,{id:"past",eventKey:"Past",onClick:function(){return t.props.nav("Past")}},"Past Papers"),1===F.user.id?s.a.createElement(m.a,{id:"working",eventKey:"Working",onClick:function(){return t.props.nav("Working")}},"Working"):null),s.a.createElement(h.a,{pullRight:!0},s.a.createElement(f.a,{title:F.user.name,id:"user"},s.a.createElement(d.a,{id:"logout",eventKey:"logout",onSelect:F.logout},s.a.createElement("i",{className:"fa fa-sign-out"})," Logout"),s.a.createElement(d.a,{id:"contact",eventKey:"contact",onSelect:function(){return t.props.modal("contact")}},s.a.createElement("i",{className:"fa fa-envelope-o"})," Contact Us"),s.a.createElement(d.a,{id:"tutor",eventKey:"Tutor",onSelect:function(){return t.props.modal("tutor")}},s.a.createElement("i",{className:"fa fa-mortar-board"})," Add Tutor"),s.a.createElement(d.a,{id:"update",eventKey:"Update",onSelect:function(){return t.props.modal("update")}},s.a.createElement("i",{className:"fa fa-user"})," Update Details"),F.user.isTutor?s.a.createElement(d.a,{id:"students",eventKey:"Students",onSelect:function(){return t.props.nav("Students")}},s.a.createElement("i",{className:"fa fa-group"})," Students"):null,F.user.isAdmin?s.a.createElement(d.a,{id:"admin",eventKey:"Admin",onSelect:function(){return t.props.nav("Admin")}},s.a.createElement("i",{className:"fa fa-key"})," Admin"):null,s.a.createElement(d.a,{id:"update",eventKey:"About",onSelect:function(){return t.props.help("about")}},s.a.createElement("i",{className:"fa fa-info-circle"})," About")))):s.a.createElement("div",null,F.data.help?s.a.createElement(h.a,null,s.a.createElement(m.a,{id:"about",eventKey:"about",onClick:function(){return t.props.help("about")}},"About")):null,s.a.createElement(h.a,{pullRight:!0},s.a.createElement(m.a,{id:"register",eventKey:"register",onClick:function(){return t.props.modal("register")}},"Register"),s.a.createElement(m.a,{id:"contact",eventKey:"contact",onSelect:function(){return t.props.modal("contact")}},"Contact Us"))),s.a.createElement("div",{id:"nav"},s.a.createElement(v.a,{collapseOnSelect:!0,fixedTop:!0},s.a.createElement(v.a.Header,null,s.a.createElement(v.a.Brand,null,s.a.createElement("a",{href:"https://freemaths.uk/"},"FreeMaths.uk")),s.a.createElement(v.a.Toggle,null)),s.a.createElement(v.a.Collapse,null,e)),s.a.createElement("div",{className:"navbarSpacer"}))}}]),t}(n.Component),zs=Ps;o.a.render(s.a.createElement(zs,null),document.getElementById("root"))}},[[112,2,1]]]);
//# sourceMappingURL=main.386ae061.chunk.js.map