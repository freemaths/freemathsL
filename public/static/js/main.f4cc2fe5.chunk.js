(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{110:function(e,t,a){e.exports=a(202)},177:function(e,t,a){},202:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(17),l=a.n(s),o=a(4),i=a(5),c=a(7),u=a(6),p=a(8),h=a(16),m=a(215),d=a(101),f=a(219),v=a(203),g=a(75),b=a.n(g);function k(e,t,a,r){var n=!1;fetch(e,function(e,t){var a;a=e?{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","Content-Type":"application/json","FM-Token":t||(E.user?E.user.token:null)},credentials:"include",method:"post",cache:"no-cache",body:JSON.stringify(e)}:{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","FM-Token":E.user?E.user.token:null,"FM-Env":JSON.stringify(Object({NODE_ENV:"production",PUBLIC_URL:""}))},credentials:"include",method:"get",cache:"default"};return a}(a,r)).then(function(t){return t.ok||(n=t.statusText),e.endsWith(".gz")?t.text():t.json()}).then(function(e){t&&t({error:n,data:e})}).catch(function(a){console.error(e,n),t&&t({error:a,data:{error:n||a.message}})})}var E=new(function(){function e(){var t=this;Object(o.a)(this,e),this.setUser=function(e){var a=t.user;a.logout||(a.logout={name:a.name,id:a.id,log:a.log,token:a.token});var r=t.log.filter(function(t){return t.user_id===1*e});a.name=t.students[e].name,a.id=1*e,a.log=r,a.token=null,a.isAdmin=a.isTutor=!1,t.parent.setState({page:null,message:{type:"success",text:"Switched user to: "+a.name}})},this.login=function(e,a){k("/react_ajax/login",function(e){e.error?a(e.data):(t.user=w(e.data),t.ready())},e)},this.lastLogId=function(){return t.user&&t.user.log.length?t.user.log[t.user.log.length-1].id:0},this.password=function(e,a,r){k("/react_ajax/password",function(e){e.error?r(e.data):(t.user=w(e.data,t.user),a())},{password:e,lastLogId:t.lastLogId()})},this.register=function(e,a,r){k("/react_ajax/"+(t.user?"update":"register"),function(e){e.error?r(e.data):t.user?(t.user.email=e.data.email,t.user.name=e.data.name,a({type:"success",text:"Details updated"})):a({type:"success",text:"Account registered. Use Test to check you knowledge."})},e)},this.mail=function(e,t,a){k("/react_ajax/mail",function(e){e.error?a({type:"danger",text:e.data.error}):t(e.data)},{token:e})},this.contact=function(e,t,a,r){k("/react_ajax/contact",function(e){e.error?r(e.data):a({type:"success",text:t?"Reply sent.":"Message sent. We aim to respond within 24 hours."})},e)},this.logout=function(){t.user.logout?(t.user.id=t.user.logout.id,t.user.name=t.user.logout.name,t.user.log=t.user.logout.log,t.user.token=t.user.logout.token,t.user.isAdmin=t.user.isTutor=!0,t.user.logout=null,t.parent.setState({page:"Students",message:{type:"success",text:"Switched user to:"+t.user.name}})):(window.localStorage&&window.localStorage.removeItem("FMuser"),t.user=null,k("/react_ajax/logout"),t.parent.setState({ready:!1,page:null,message:null,password:!1}))},this.reset=function(e,t,a){k("/react_ajax/reset",function(e){e.error?a(e.data):t({type:"success",text:"Your password has been reset."})},e)},this.updateLog=function(e){O("updateLog")&&console.log("updateLog(l)",e),k("/react_ajax/log_event",function(a){var r=null;a.error&&(r={type:"danger",text:"Working offline"});var n=t.user;a.data.log||(a.data.log={id:t.lastLogId()+1,event:e.event,paper:e.paper,question:e.question,variables:JSON.stringify(e.vars),answer:e.answer?e.answer:"",comment:e.comment?e.comment:"",user_id:n.id}),n.log.push(a.data.log),r?t.parent.setState({message:r}):t.parent.setState({message:null})},{log:e})},this.saveQ=function(e){e&&k("/react_ajax/saveQ",function(e){(console.log("saveQ",e),e.error)||(t.data.tests.questions[e.data.id]=e.data,t.parent.setState({reload:!0}))},{question:e,token:t.state.user.token})},this.send=function(e,a,r){var n={freemaths:{version:t.version}};["help","tests","books","past"].forEach(function(e){var a=x(t.data[e]);a===t.zips[e]?n[e]={version:t.data[e].version}:n[e]={version:t.data[e].version,size:a.length,change:a.length-t.zips[e].length,zip:a}}),r?r(n):k("/react_ajax/update_data",function(t){t.error?a({type:"danger",text:"Server Error: "+t.data.error}):e({type:"success",text:"Data updated"})},{updates:n})},this.version=2,this.versions=null,this.state=null,this.user=null,this.data={},this.zips={},this.parent=null,this.students=null,this.log=null}return Object(i.a)(e,[{key:"onUpdate",value:function(e){this.parent&&this.parent.setState({ready:!1,message:{type:"danger",text:"Software Updating - page will reload"}}),setTimeout(function(){window.location.reload()},2e3)}},{key:"onSuccess",value:function(e){this.parent&&this.parent.setState({type:"success",text:"Content is cached for offline use."})}},{key:"set_versions",value:function(){return{freemaths:this.version,books:{version:this.data.books.version},tests:{version:this.data.tests.version},past:{version:this.data.past.version},help:{version:this.data.help.version}}}},{key:"ready",value:function(e,t){var a=this;if(e)return this.data.help&&this.data.tests&&this.data.books&&this.data.past&&this.user;if(this.data.help&&this.data.tests&&this.data.books&&this.data.past&&this.user){this.versions=this.user.versions?JSON.parse(this.user.versions):this.set_versions(),this.version===this.versions.freemaths?console.log("freemaths",this.version,this.versions):console.error("freemaths",this.version,this.versions);var r=!0;["tests","help","past","books"].forEach(function(e){a.data[e].version!==a.versions[e].version&&(t?console.error("version",e,a.data[e].version,a.versions[e].version):console.log("version",e,a.data[e].version,a.versions[e].version),t||(a.loadFile(e,!0),r=!1))}),this.parent.setState({ready:r})}else this.parent.setState({ready:!1})}},{key:"swState",value:function(e){this.state=e,console.log("FM Service Worker: ",e)}},{key:"loadFile",value:function(e,t){var a=this;k(t?"react_ajax/get_file":e+".gz",function(r){r.error?a.parent.setState({message:{type:"danger",text:e+" Error: "+r.data.error}}):(a.zips[e]=r.data,a.data[e]=q(r.data),a.data[e].version||(a.data[e].version=1),a.ready(!1,t))},t?{name:e}:null)}},{key:"loadData",value:function(e){var t=this;this.parent=e,["help","tests","books","past"].forEach(function(e){return t.loadFile(e)})}},{key:"loadUser",value:function(){var e=this;this.user=function(){var e=null;if(window.localStorage&&window.localStorage.FMuser)try{(e=q(window.localStorage.getItem("FMuser"))).id||(e=null)}catch(t){console.error("failed to unzip user from localStorage",t),window.localStorage.removeItem("FMuser"),e=null}return e}(),this.ready(),this.user&&k("/react_ajax/user",function(t){t.error?e.parent.setState({message:{type:"danger",text:"user Error: "+t.data.error}}):"password"===t.data?e.parent.setState({password:!0}):t.data.id?e.user=w(t.data,e.user):e.user=null,e.ready()},this.user?{id:this.user.id,token:this.user.token,lastLogId:this.lastLogId()}:null,this.user?this.user.token:null)}},{key:"getStudents",value:function(e){var t=this;console.log("getStudents",e),k("/react_ajax/students",function(a){if(a.error)t.parent.setState({message:{type:"danger",text:"Server Error: "+a.data.error,page:"Home"}});else{var r={},n=q(a.data.log);q(a.data.users).forEach(function(e){r[e.id]=e}),n.length?(t.students=r,t.log=n,t.parent.setState({students:!0})):(t.students=null,t.parent.setState({message:{type:"danger",text:"Data Error"}})),console.log("getStudents",e,Object.keys(r).length)}},{all:e})}}]),e}()),y={};function O(e){if(y[e]?y[e].n++:(y[e]={n:1},Object.keys(y).forEach(function(t){t!==e&&e.startsWith(t)&&y[t].show&&(y[e].show=!0)})),y[e].show)return!0}function j(){for(var e=arguments,t=function(){var t=e[a];y[t]?y[t].show=!y[t].show:y[t]={n:0,show:!0},Object.keys(y).forEach(function(e){e!==t&&e.startsWith(t)&&(y[e].show=!0)})},a=0;a<arguments.length;a++)t()}function w(e,t){var a;if(t&&t.id===e.id&&(e.log=t.log.concat(e.log)),window.localStorage)try{a=x(e),window.localStorage.setItem("FMuser",a)}catch(r){console.error("user not stored",r.name,a,e)}return e.debug&&(e.debug.split(" ").forEach(function(e){return j(e)}),console.log("set_debug",e.debug)),e}function x(e){var t=btoa(b.a.deflate(JSON.stringify(e),{to:"string"}));return O("zip")&&console.log("zip",e,JSON.stringify(e).length,t.length),t}function q(e){var t=JSON.parse(b.a.inflate(atob(e),{to:"string"}));return O("unzip")&&console.log("unzip",t,JSON.stringify(t).length,e.length),t}function S(e){return E.data.tests.questions[e]}function C(e,t){var a=e;if(t){var r=N(t);r&&r.qs&&r.qs.length&&r.qs.forEach(function(t){t&&1*t.qid===1*e&&(a=t.qn)})}return a}function N(e,t){var a=E.data;"string"===typeof e&&e.indexOf(":")>0&&(e=e.split(":")[0]);var r=a.tests.tests[e]?a.tests.tests[e]:a.books[e]?a.books[e]:a.past[e]?a.past[e]:null;if(0===e||"0"===e||null===e&&t){var n=t?S(t):null;r=n&&n.topics?{id:0,type:"var",title:n.topics.split(",")[0]}:{id:0,type:"vars",title:"Adaptive"}}return O("test")&&console.log("test(p,qid)=",e,t,r,E.data),r}function _(e,t,a,r){if(!e)return null;if("string"===typeof e&&e.indexOf(":")>0){var s=e.split(":"),l=Object(h.a)(s,4),o=l[0],i=l[1],c=l[2],u=l[3];e=o}var p=N(e)?N(e).title.replace(/Edexcel_/,"").replace(/_/g," "):e;return P(c)&&""!==c?p+=" "+c:P(i)&&""!==i&&(p+=" "+i),a&&(p=""),P(u)&&t&&(p+=" Q"+u),E.user&&E.user.isAdmin&&r&&(p=n.a.createElement(T,{tooltip:e},p)),p}var A=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){if("undefined"!==typeof this.props.save)var e=n.a.createElement(m.a.Footer,null,n.a.createElement(d.a,{className:"btn btn-sm btn-primary",onClick:this.props.save.fn},this.props.save.text));else e=null;return n.a.createElement(m.a,{show:!0,name:this.props.name,bsSize:"large",onHide:this.props.close},n.a.createElement(m.a.Header,{closeButton:!0},n.a.createElement(m.a.Title,null,this.props.title)),n.a.createElement(m.a.Body,null,this.props.children),e)}}]),t}(r.Component);function M(){return E.user&&E.user.isMobile?"large":"medium"}var T=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return E.user&&E.user.isMobile?n.a.createElement("span",{className:this.props.className},this.props.children):n.a.createElement(f.a,{placement:this.props.placement?this.props.placement:"top",overlay:n.a.createElement(v.a,{id:"tooltip"},this.props.tooltip)},n.a.createElement("span",{className:this.props.className},this.props.children))}}]),t}(r.Component),W=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return E.user&&E.user.isMobile?n.a.createElement("span",{className:this.props.className?this.props.className:"btn-link",onClick:this.props.onClick},this.props.children):n.a.createElement(f.a,{placement:"top",overlay:n.a.createElement(v.a,{id:"tooltip"},this.props.tooltip)},n.a.createElement("span",{className:this.props.className?this.props.className:"btn-link",onClick:this.props.onClick},this.props.children))}}]),t}(r.Component);function Q(e){return e===Object(e)?JSON.parse(JSON.stringify(e)):e}function P(e){return"undefined"!==typeof e&&null!==e}function z(e){return"undefined"===typeof e||null===e||0===e.length}function D(e){return e[0].toUpperCase()+e.substr(1,e.length-1)}function F(e){var t=e.getDate();t<10&&(t="0"+t);var a=e.getMonth()+1;return a<10&&(a="0"+a),t+"/"+a}function H(e){var t=e.getHours();t<10&&(t="0"+t);var a=e.getMinutes();return a<10&&(a="0"+a),t+":"+a}function B(e,t){if(!P(e)||0===e)return"";var a=new Date(1*e);return t?function(e){var t=e.getDate();t<10&&(t="0"+t);var a=e.getMonth()+1;a<10&&(a="0"+a);var r=e.getFullYear()%100;return r<10&&(r="0"+r),t+"/"+a+"/"+r}(a):F(a)}function L(e){return new Date(e.replace(" ","T")).getTime()}function R(e,t){if(!P(e))return"";"undefined"===typeof t&&(t="");var a=Math.floor(e/1e3);if(0===a)return"";var r=Math.floor(a/60);a-=60*r;var n=Math.floor(r/60);if(r-=60*n,a<10&&(a="0"+a),n>0){r<10&&(r="0"+r);var s=n+":"+r+":"+a}else s=r+":"+a;return t+s}a(177);var I=a(211),U=a(212),J=a(216),$=a(213),K=a(217),V=a(204),G=a(205),X=a(214),Y=a(206),Z=a(207),ee=a(208),te=a(218),ae=a(209),re=a(210),ne=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={email:"",password:"",remember:!!a.props.app,error:{}},a.error=function(e){a.setState({error:e})},a.login=function(e){e.preventDefault(),E.login(a.state,a.error)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement(V.a,null,n.a.createElement(G.a,{smOffset:2,sm:8},n.a.createElement(X.a,null,n.a.createElement(X.a.Heading,null,n.a.createElement(X.a.Title,{componentClass:"h3"},"Login")),n.a.createElement(X.a.Body,null,this.state.error.error?n.a.createElement("div",{className:"alert alert-danger"},n.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,n.a.createElement(Y.a,{onSubmit:this.login,horizontal:!0},n.a.createElement(Z.a,{controlId:"formEmail",validationState:this.state.error.email?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Email"),n.a.createElement(G.a,{sm:9},n.a.createElement(te.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.setState({email:t.target.value,error:""})}})),this.state.error.email?n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.email)):null),n.a.createElement(Z.a,{controlId:"formPassword",validationState:this.state.error.password?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Password"),n.a.createElement(G.a,{sm:9},n.a.createElement(te.a,{type:"password",name:"password",value:this.state.password,placeholder:"Password",onChange:function(t){return e.setState({password:t.target.value,error:""})}})),this.state.error.password?n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.password)):null),n.a.createElement(Z.a,null,n.a.createElement(G.a,{smOffset:2,sm:4},n.a.createElement(d.a,{name:"login",bsStyle:"primary",type:"submit"},n.a.createElement("i",{className:"fa fa-btn fa-sign-in"})," Login")),n.a.createElement(G.a,{sm:4},n.a.createElement(d.a,{name:"forgot",bsStyle:"link",onClick:function(t){t.currentTarget.blur(),e.props.modal("forgot",e.state.email)}},"Forgot your password?"))),n.a.createElement(Z.a,null,n.a.createElement(G.a,{smOffset:2,sm:4},n.a.createElement(re.a,{checked:!!this.state.remember,onChange:function(){return e.setState({remember:!e.state.remember})}},"remember me")),n.a.createElement(G.a,{sm:4},n.a.createElement(d.a,{name:"register",bsStyle:"link",onClick:function(t){t.currentTarget.blur(),e.props.modal("register")}},n.a.createElement("i",{className:"fa fa-btn fa-user"}),"Register"))))))))}}]),t}(r.Component),se=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={email:a.props.email?a.props.email:"",error:{},sending:!1},a.send=function(e){e.preventDefault(),a.setState({sending:!0}),k("/react_ajax/forgot",function(e){e.error?a.setState({error:e.data,sending:!1}):a.props.close({type:"success",text:"We have e-mailed your password reset link!"})},{email:a.state.email})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement(m.a,{name:"forgot",show:!0,onHide:function(){return e.props.close()}},n.a.createElement(m.a.Header,{closeButton:!0},n.a.createElement(m.a.Title,null,"Reset Password")),n.a.createElement(m.a.Body,null,this.state.sending?n.a.createElement("div",{className:"alert alert-success"},n.a.createElement("strong",null,"Sending...")):null,this.state.error.error?n.a.createElement("div",{className:"alert alert-danger"},n.a.createElement("strong",null,"Error: ",this.state.error.error)):null,n.a.createElement(Y.a,{onSubmit:this.send,horizontal:!0},n.a.createElement(Z.a,{controlId:"formHorizontalEmail",validationState:this.state.error.email?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Email"),n.a.createElement(G.a,{sm:9},n.a.createElement(te.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.setState({email:t.target.value,error:{}})}})),""===this.state.error.email?null:n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.email))),n.a.createElement(Z.a,null,n.a.createElement(G.a,{smOffset:2,sm:6},n.a.createElement(d.a,{bsStyle:"primary",type:"submit"},n.a.createElement("i",{className:"fa fa-btn fa-envelope"})," Send Password Reset Link"))))))}}]),t}(r.Component),le=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={email:"",password:"",password_confirmation:"",error:{}},a.error=function(e){return a.setState({error:e})},a.reset=function(e){e.preventDefault();var t={email:a.state.email,password:a.state.password,password_confirmation:a.state.password_confirmation,token:a.props.token};E.reset(t,a.props.close,a.error)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement(m.a,{name:"reset",show:!0,onHide:function(){return e.props.close()}},n.a.createElement(m.a.Header,{closeButton:!0},n.a.createElement(m.a.Title,null,"Reset Password")),n.a.createElement(m.a.Body,null,this.state.error.error?n.a.createElement("div",{className:"alert alert-danger"},n.a.createElement("strong",null,"Error: ",this.state.error.error)):null,this.state.error.token?n.a.createElement("div",{className:"alert alert-danger"},n.a.createElement("strong",null,"Error: ",this.state.error.token)):null,n.a.createElement(Y.a,{onSubmit:this.reset,horizontal:!0},n.a.createElement(Z.a,{controlId:"email1",validationState:this.state.error.email?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Email"),n.a.createElement(G.a,{sm:9},n.a.createElement(te.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.setState({email:t.target.value,error:{}})}})),this.state.error.email?n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.email)):null),n.a.createElement(Z.a,{controlId:"password1",validationState:this.state.error.password?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Password"),n.a.createElement(G.a,{sm:9},n.a.createElement(te.a,{type:"password",name:"password",value:this.state.password,placeholder:"Password",onChange:function(t){return e.setState({password:t.target.value,error:{}})}})),P(this.state.error.password)?n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.password)):null),n.a.createElement(Z.a,{controlId:"confirm1",validationState:this.state.error.password_confirmation?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Confirm"),n.a.createElement(G.a,{sm:9},n.a.createElement(te.a,{type:"password",name:"password_confirmation",value:this.state.password_confirmation,placeholder:"Password",onChange:function(t){return e.setState({password_confirmation:t.target.value,error:{}})}})),this.state.error.password_confirmation?n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.password_confirmation)):null),n.a.createElement(Z.a,null,n.a.createElement(G.a,{smOffset:2,sm:4},n.a.createElement(d.a,{bsStyle:"primary",type:"submit"},n.a.createElement("i",{className:"fa fa-btn fa-refresh"})," Reset Password"))))))}}]),t}(r.Component),oe=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={password:"",error:{}},a.error=function(e){return a.setState({error:e})},a.password=function(e){e.preventDefault(),E.password(a.state.password,a.props.auth,a.error)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement(m.a,{name:"password",show:!0,onHide:function(){return e.props.close()}},n.a.createElement(m.a.Header,{closeButton:!0},n.a.createElement(m.a.Title,null,"Enter Password")),n.a.createElement(m.a.Body,null,this.state.error.error?n.a.createElement("div",{className:"alert alert-danger"},n.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,n.a.createElement(Y.a,{onSubmit:this.password,horizontal:!0},n.a.createElement(Z.a,{controlId:"password",validationState:this.state.error.password?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Password"),n.a.createElement(G.a,{sm:9},n.a.createElement(te.a,{type:"password",name:"password",value:this.state.password,placeholder:"Password",onChange:function(t){return e.setState({password:t.target.value,error:""})}})),this.state.error.password?n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.password)):null),n.a.createElement(Z.a,null,n.a.createElement(G.a,{smOffset:2,sm:4},n.a.createElement(d.a,{bsStyle:"primary",type:"submit"},n.a.createElement("i",{className:"fa fa-btn fa-sign-in"})," Confirm")),E.user?null:n.a.createElement(G.a,{sm:4},n.a.createElement(d.a,{bsStyle:"link",onClick:function(){return e.props.close()}},"Switch user?"))))))}}]),t}(r.Component),ie=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={auth:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return this.state.auth?n.a.createElement(ce,{close:this.props.close}):n.a.createElement(oe,{close:this.props.close,auth:function(){return e.setState({auth:!0})}})}}]),t}(r.Component),ce=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state=E.user?{name:E.user.name,email:E.user.email,password:"",password_confirmation:"",error:{},pw:!1}:{name:"",email:"",password:"",password_confirmation:"",error:{},pw:!0},a.error=function(e){return a.setState({error:e})},a.register=function(e){e.preventDefault(),E.register(a.state,a.props.close,a.error)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"update",value:function(e,t){var a=this.state;a[e]=t,P(a.error[e])&&delete a.error[e],this.setState(a)}},{key:"render",value:function(){var e=this;return n.a.createElement(m.a,{name:"register",show:!0,onHide:function(){return e.props.close()}},n.a.createElement(m.a.Header,{closeButton:!0},n.a.createElement(m.a.Title,null,E.user?"Update Details":"Register")),n.a.createElement(m.a.Body,null,this.state.error.error?n.a.createElement("div",{className:"alert alert-danger"},n.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,n.a.createElement(Y.a,{onSubmit:this.register,horizontal:!0},n.a.createElement(Z.a,{controlId:"formName",validationState:P(this.state.error.name)?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Name"),n.a.createElement(G.a,{sm:9},n.a.createElement(te.a,{type:"name",name:"name",value:this.state.name,placeholder:"First Last",onChange:function(t){return e.update("name",t.target.value)}})),P(this.state.error.name)?n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.name)):null),n.a.createElement(Z.a,{controlId:"formEmail",validationState:P(this.state.error.email)?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Email"),n.a.createElement(G.a,{sm:9},n.a.createElement(te.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.update("email",t.target.value)}})),P(this.state.error.email)?n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.email)):null),this.state.pw?n.a.createElement("div",null,n.a.createElement(Z.a,{controlId:"formPassword",validationState:P(this.state.error.password)?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Password"),n.a.createElement(G.a,{sm:9},n.a.createElement(te.a,{type:"password",name:"password",value:this.state.password,placeholder:E.user?"New Password":"Password",onChange:function(t){return e.update("password",t.target.value)}})),P(this.state.error.password)?n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.password)):null),n.a.createElement(Z.a,{controlId:"formConfirm",validationState:P(this.state.error.password_confirmation)?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Confirm"),n.a.createElement(G.a,{sm:9},n.a.createElement(te.a,{type:"password",name:"password_confirmation",value:this.state.password_confirmation,placeholder:E.user?"New Password":"Password",onChange:function(t){return e.update("password_confirmation",t.target.value)}})),P(this.state.error.password_confirmation)?n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.password_confirmation)):null)):n.a.createElement(Z.a,null,n.a.createElement(G.a,{sm:4},n.a.createElement(d.a,{bsStyle:"link",onClick:function(t){e.setState({pw:!0})}},"Change password?"))),n.a.createElement(Z.a,null,n.a.createElement(G.a,{smOffset:2,sm:4},n.a.createElement(d.a,{bsStyle:"primary",type:"submit"},n.a.createElement("i",{className:"fa fa-btn fa-user"})," ",E.user?"Update":"Register"))))))}}]),t}(r.Component),ue=a(30);function pe(e){return"string"===typeof e&&-1!==e.indexOf("?")}function he(e){var t=we(e);return!(!t.d||0===t.d)}function me(e,t){return!!(Ue(e)||he(e)||t&&""===e)}function de(e,t,a){var r,n,s,l,o=null;if(O("evaluate")&&(n=Q(t),r=Q(a)),he(e)||gt(e)||pe(e))o=e;else if(Ue(e))o=1*e;else if($e(e))o=function(e,t,a){var r;O("substitute")&&(r=Q(a));var n=e;!function(e,t){return"string"===typeof e&&t&&void 0!==t[e]}(e,t)?n=ft(e,t)?"?"+e:function(e){var t=e;if("string"===typeof e&&-1!==t.indexOf("/")){var a=t.startsWith("-");a&&(t=t.substring(1));var r=t.split("/"),n=Object(h.a)(r,2),s=n[0],l=n[1];t=Ye(s,"/",l),a&&(t=Ye("","-",t))}O("checkFraction")&&console.log("checkFraction(f)=",e,t);return t}(e):(a||(a=[]),-1===a.indexOf(e)?(a.push(e),n=de(function(e,t){return t&&void 0!==t[e]?t[e]:"?"+e}(e,t),t,a)):n="?"+e);"\u03c0"===n?n=Math.PI:"e"===n?n=Math.E:et(n)&&(n=function(e){var t=e;et(e)&&(t=e.replace(/([0-9]+)\xb0(?:([0-9]+)')?(?:([0-9]+)'')?$/,function(e,t,a,r,n,s){var l=(1*t+(a||0)/60+(r||0)/360)*Math.PI/180;return O("radians")&&console.log("radians",l,e,t,a,r,n,s),l}));return t}(n));O("substitute")&&console.log("substitute(s,vars,done)=",n,e,t,r,Q(a));return n}(e,t,a);else if(e){var i=me(e.left,!0)?fe(e.left):de(e.left,t),c=me(e.right)?fe(e.right):de(e.right,t);pe(c)?o=c:pe(i)?o=i:Ue(i)&&Ue(c)?o=be(i,c,e.op):he(i)&&(s=c,l=e.op,he(s)||","===l&&"dp"!==s&&"sf"!==s&&gt(s))?o=qe(Ye(i,e.op,c)):""===i&&he(c)?o=qe(Ye(0,e.op,c)):me(i,!0)&&me(c)?o=be(ve(i),ve(c),e.op):" "!==e.op||"dp"!==c&&"sf"!==c||!Je(i)?me(i)&&","===e.op&&ge(c)?o=function(e,t){var a=e;if(Ue(e)&&ge(t)){var r=t.substr(0,t.length-2);a=t.endsWith("dp")?(1*e).toFixed(r):(1*e).toPrecision(1*r>0?r:1)}else a=""+e+t;return a}(ve(i),c):(Array.isArray(i)||Array.isArray(c))&&(o=function(e,t,a){var r,n,s=[];O("eval_multi")&&(r=Q(e),n=Q(a));Array.isArray(e)?s=e.map(function(e){return de({left:e,op:t,right:a})}):Array.isArray(a)&&(s=a.map(function(a){return de({left:e,op:t,right:a})}));s.length&&(s=s.map(function(e){return Ge(e)?xe(we(e)):e}));O("eval_multi")&&console.log("eval_multi",Q(s),r,t,n);return s}(i,e.op,c)):o=""+i+c}else console.error("evaluate",e,t,a,(new Error).stack);return O("evaluate")&&console.log("evaluate(t,vars)=",o,e,n,r,t,a),o}function fe(e){var t,a=e;return(t=we(e))?a=xe(ke(t)):Ue(e)&&(a=1*e),a}function ve(e){var t,a=e;return(t=we(e))&&(a=t.n/t.d),a}function ge(e){return"string"===typeof e&&(e.endsWith("dp")||e.endsWith("sf"))}function be(e,t,a){var r=0;switch(a){case"+":case"\u02fd":r=1*e+1*t;break;case"\xb1":r=[1*e+1*t,1*e-1*t];break;case"-":r=e-t;break;case"*":case" ":case"(":case"\xd7":r=e*t;break;case"\xf7":case"/":r=1*t!==0?Je(e)&&Je(t)?fe(e+"/"+t):e/t:"?"+e+"/0";break;case"^":r=Math.pow(e,t);break;case"|":r=Math.abs(t);break;case"\u221a":r=t>=0?Math.pow(t,.5):"?\u221a"+t;break;case"~":r=Se(1*e,1*t);break;case"=":r=rt?1*e===1*t?1:0:"@"+e+"="+t;break;case"\u2260":r=rt?1*e===1*t?0:1:"@"+e+"\u2260"+t;break;case">":r=rt?1*e>1*t?1:0:"@"+e+">"+t;break;case"<":r=rt?1*e<1*t?1:0:"@"+e+"<"+t;break;case"\u2265":r=rt?1*e>=1*t?1:0:"@"+e+"\u2265"+t;break;case"\u2264":r=rt?1*e<=1*t?1:0:"@"+e+"\u2264"+t;break;case",":r=[e,t];break;default:r=pt(a)?function(e,t){var a,r="",n=e.indexOf("^");n>0&&(r=e.substring(n+2,e.length-1),e=e.substring(0,n),1*r===-1&&(e="a"+e));if(Ue(t))switch(e){case"sin":a=Math.sin(t);break;case"cos":a=Math.cos(t);break;case"tan":a=Math.tan(t);break;case"cosec":a=1/Math.sin(t);break;case"sec":a=1/Math.cos(t);break;case"cot":a=1/Math.tan(t);break;case"asin":a=Math.asin(t);break;case"acos":a=Math.acos(t);break;case"atan":a=Math.atan(t);break;case"acosec":a=Math.asin(1/t);break;case"asec":a=Math.acos(1/t);break;case"acot":a=Math.atan(1/t);break;case"ln":a=Math.log(t);break;default:console.error("evaluate not yet supported",e,t),a=[e,t]}else a=[e,t];r>0&&(a=Math.pow(a,r));return a.toString()}(a,t):"@@"+e+a+t}return r}function ke(e){var t=Se(e.n,e.d),a=e.d<0?-1:1;return{n:e.n*a/t,d:e.d*a/t}}function Ee(e,t){return ke({n:e.n*t.d+t.n*e.d,d:e.d*t.d})}function ye(e,t){return ke({n:e.n*t.n,d:e.d*t.d})}function Oe(e,t){var a,r,n;if("numerator"===t)a=e.n;else if("denominator"===t)a=e.d;else if("whole"===t)a=Math.floor(e.n/e.d);else if("fractional"===t)a={n:e.n-Math.floor(e.n/e.d)*e.d,d:e.d};else if("improper"===t)a=e.n>e.d?1:0;else{var s=(r=e.d,n=t.d,r*n/Se(r,n)/e.d);a={n:e.n*s,d:e.d*s}}return a}function je(e){var t=!1;if("string"===typeof e&&-1!==e.indexOf("/")){var a=e.split("/"),r=Object(h.a)(a,2),n=r[0],s=r[1],l=0,o=1;if(-1!==n.indexOf("\u02fd")){var i=n.split("\u02fd"),c=Object(h.a)(i,2);l=c[0],n=c[1],l*=o=l<0?-1:1}else n*=o=n<0?-1:1;Je(l)&&Je(n)&&Je(s)&&(t=Ye(1*n,"/",1*s),l&&(t=Ye(l,"\u02fd",t)),o<0&&(t=Ye("","-",t)))}return O("stof")&&console.log("stof(s)=",Q(t),Q(e)),t||e}function we(e,t){var a=!1;if(t&&gt(e))a=e;else if(Je(e))a={n:1*e,d:1};else if("string"===typeof e&&-1!==e.indexOf("/")){var r=e.split("/"),n=Object(h.a)(r,2),s=n[0],l=n[1],o=0;if(-1!==s.indexOf("\u02fd")){var i=s.split("\u02fd"),c=Object(h.a)(i,2);o=c[0],s=c[1]}var u=o<0?-1:1;Je(o)&&Je(s)&&Je(l)&&(a={n:o*l+s*u,d:1*l})}return O("stof")&&console.log("stof(s)=",Q(a),Q(e)),a}function xe(e,t){var a,r=Q(e),n=r.n<0?-1:1,s=Math.floor(r.n*n/r.d);return a=1===r.d?r.n:t&&0!==s?(n>0?"":"-")+s+"\u02fd"+(r.n*n-s*r.d)+"/"+r.d:r.n+"/"+r.d,O("ftos")&&console.log("ftos(f,mixed)",a,e,t),a}function qe(e){var t=e,a=!1,r=we(e.left),n=we(e.right,","===e.op);if(!1!==r&&!1!==n)switch(e.op){case"\u02fd":a=!0,t=r.n<0?Ee(r,{n:-n.n,d:n.d}):Ee(r,n);break;case"+":t=Ee(r,n);break;case"-":a=0===r.n&&"string"===typeof e.right&&-1!==e.right.indexOf("\u02fd"),t=Ee(r,{n:-n.n,d:n.d});break;case"\xb1":t=[xe(Ee(r,n)),xe(Ee(r,{n:-n.n,d:n.d}))];break;case"*":case"(":case" ":case"\xd7":t=ye(r,n);break;case"\xf7":case"/":t=ye(r,{n:n.d,d:n.n});break;case"^":t=function(e,t){var a=ke(e),r=ke(t),n=!1;return r.n<0&&(r.n=-r.n,n=!0),r.d>1&&(a={n:Math.pow(a.n,1/r.d),d:Math.pow(a.d,1/r.d)}),a={n:Math.pow(a.n,r.n),d:Math.pow(a.d,r.n)},n&&(a={n:a.d,d:a.n}),Je(a.n)&&Je(a.d)||(a=Math.pow(e.n/e.d,t.n/t.d)),O("frac_pow")&&console.log("frac_pow(f1,f2)=",a,Q(e),Q(t)),a}(r,n);break;case",":"mixed"===n?(a=!0,t=r):gt(n)?t=Oe(r,n):(O("warn")&&console.log(", fractions",r,n),t=[xe(r),xe(n)]);break;case"//":t=Oe(r,n);break;case"~":t=1===r.d&&1===n.d?Se(r.n,n.n):{n:r.n/Se(r.n,n.d),d:r.d/Se(r.d,n.n)};break;case"=":t=r.n===n.n&&r.d===n.d?1:0;break;case"\u2260":t=r.n===n.n&&r.d===n.d?0:1;break;case">":t=r.n*n.d>n.n*r.d?1:0;break;case"<":t=r.n*n.d<n.n*r.d?1:0;break;case"\u2265":t=r.n*n.d>=n.n*r.d?1:0;break;case"\u2264":t=r.n*n.d<=n.n*r.d?1:0;break;default:t=be(r.n/r.d,n.n/n.d,e.op)}return t&&t.d?t=xe(t,a):0===t.d&&(t="?"+t.n+"/0"),O("fraction_op")&&console.log("fraction_op(t)=",t,Q(e)),t}function Se(e,t){var a=1;return Ue(e)&&Ue(t)&&(a=1*t===0?1*e:1*t===1?e%t:Se(t,e%t)),a>0?a:0===a?1:-a}function Ce(e,t,a,r){var n,s,l;return n=e===t||((s=me(e)?e:nt(e,r))===(l=me(t)?t:nt(t,r))||!1!==s&&!1!==l&&Ae(Te(s),Te(l),!0,a)),O("compare")&&console.log("compare(a,b,dpsf,vars)=",n,e,"=",s,t,"=",l,a,r),n}function Ne(e,t,a){var r,n,s;return r=ve(e),n=ve(t),Ue(r)&&Ue(n)&&r!==n?!(s=r.toPrecision(10)===n.toPrecision(10))&&a&&""!==a&&(a.endsWith("sf")?s=r.toPrecision(a[0])===n.toPrecision(a[0]):a.endsWith("dp")&&(s=r.toFixed(a[0])===n.toFixed(a[0]))):s=r===n,O("compare_dpsf")&&console.log("compare_dpsf(a,b,dpsf)=",s,e,"=",r,t,"=",n,a),s}function _e(e,t,a,r){var n,s,l,o,i;return s=nt(e,r),l=(l=nt(t,r))||t,null===(s=s||e)||null===l||s===l?n=s===l:(o=(o=de(s,r))||s,i=(i=de(l,r))||l,n=Array.isArray(o)||Array.isArray(i)?function(e,t,a){if(!Array.isArray(e)||!Array.isArray(t)||0===e.length||e.length!==t.length)return!1;for(var r=!0,n=0,s=[];r&&n<e.length;){if(a&&","===a[0]){for(var l=!1,o=0;o<t.length&&!l;o++)s.includes(o)||(l=Ne(e[n],t[o],a.substr(1)));l&&s.push(o-1),r=l}else r=Ne(e[n],t[n],a);n++}return O("compare_multi")&&console.log("compare_multi(a,b,dpsf)=",r,Q(e),Q(t)),r}(o,i,a):Ne(o,i,a)),O("compare_eval")&&console.log("compare_eval(a,b,dpsf,vars)=",n,e,"=",s,"=",o,t,"=",l,"=",i,a,r),n}function Ae(e,t,a,r){"undefined"===typeof a&&(a=!0);var n,s,l=!1;if(O("compare_tree")&&(n=Q(e),s=Q(t)),Ue(e)&&Ue(t))l=Ne(e,t,r);else if(null===e||null===t)l=e===t;else if($e(e)&&$e(t))l=e===t;else if($e(e)||$e(t))l=!1;else if(Ae(e.right,t.right,!0,r))" "!==e.op&&"("!==e.op&&"\xd7"!==e.op||(e.op="*")," "!==t.op&&"("!==t.op&&"\xd7"!==t.op||(t.op="*"),l=e.op===t.op&&Ae(e.left,t.left,!0,r);else if(Xe(e)&&Ae(Qe(e),Qe(t),!1,r))l=!0;else if(a)for(var o,i=0;!1===l&&(o=We(t,i++));)l=Ae(e,o,!1,r);else l=!1;return O("compare_tree")&&console.log("compare_tree(a,b,commut,dpsf)=",Q(l),n,s,a,r),l}function Me(e){return Ke(e)&&"/"===e.op}function Te(e){"undefined"===typeof e&&console.error("normalise() called with null tree");var t,a=e,r={op:null};if(O("normalise")&&(t=Q(e)),a&&!$e(a)){r=Q(a);var n=Te(a.left),s=Te(a.right);if("^"===(a=Ye(n,a.op,s)).op&&Xe(s)){var l=Qe(s);a=Ye("1","/",1*l===1?n:Ye(n,"^",l))}else"*"===a.op||" "===a.op||"("===a.op?a=function e(t,a){return Me(t)&&Me(a)?Ye(e(t.left,a.left),"/",e(t.right,a.right)):Me(t)?Ye(e(t.left,a),"/",t.right):Me(a)?Ye(e(t,a.left),"/",a.right):1*t===0||1*a===0?0:1*t===1?a:1*a===1?t:Ye(t,"*",a)}(n,s):"+"===a.op&&1*s===0?a=n:"+"===a.op&&1*n===0?a=s:"-"===a.op&&1*s===0?a=n:"\u221a"===a.op&&(a=Ye(s,"^",Ye("1","/","2")));(pe(a)||null===a)&&(a=r)}return O("normalise")&&console.log("normalise(t)=",Q(a),t),a}function We(e,t){null===e&&console.error("commute() called with null inputTree");var a,r=e;O("commute")&&(a=Q(e));var n,s=0,l=[];if(!$e(r))for(var o=kt(r.op);!$e(r)&&kt(r.op)===o;)l[s]={right:r.right,op:r.op},r=r.left,s++;if(""===r&&"-"===l[s-1].op?(s--,(r=l.pop()).left="",s===t+1&&(l[s]=r)):s===t+1&&(l[s]={right:r,op:o===kt("+")?"+":"*"}),s>t){var i;if(s===++t&&("-"===l[0].op?r=Qe(l[0].right):r=("*"===(n=l[0].op)||"+"===n||" "===n||"("===n||","===n)&&l[0].right),!1!==r)for(i=s-1;i>0;i--)r=t===i?Ye(r,l[0].op,l[0].right):Ye(r,l[i].op,l[i].right);!1!==r&&(r=Xe(l[t].right)&&"+"===l[t].op?Ye(r,"-",Qe(l[t].right)):Ye(r,l[t].op,l[t].right))}else r=!1;return O("commute")&&console.log("commute(tree,depth)=",Pe(r),Pe(a),t),r}function Qe(e){var t,a=e;return O("change_sign")&&(t=Q(e)),a=Xe(e)?""===e.left?e.right:Ye(Qe(e.left),e.op,e.right):$e(e)||"*"!==e.op&&" "!==e.op&&"("!==e.op?Ye("","-",e):Ye(Qe(e.left),e.op,e.right),O("change_sign")&&console.log("change_sign(t)=",Q(a),t),a}function Pe(e,t,a){var r=e;if("undefined"===typeof a&&(a=""),"undefined"===typeof t&&(t=0),Ke(e)){var n=kt(e.op);"-"===e.op&&""===e.left&&(n=kt("*")),r=Pe(e.left,n)+(" "===e.op?"":e.op)+Pe(e.right,n,e.op),(n<t||"/"===a&&n===kt("*")&&"/"!==e.op)&&(r="("+r+")")}return!1===r||""===r?r:Ue(r)&&1*r===0?"0":1*r===1?"1":""+r}function ze(e){var t=e?function e(t){return Ke(t)?Ye(e(t.left),t.op,e(t.right)):"0.0"===t?0:"1.0"===t?1:t}(function e(t){if(!Ke(t))return t;var a=" "===t.op||"("===t.op?"*":t.op;var r=e(t.left);var n=e(t.right);var s;!Xe(n)||"+"!==t.op&&"-"!==t.op?s=Ye(r,t.op,n):(n=Qe(n),"+"===t.op?(a="-",s=Ye(r,"-",n)):"-"===t.op&&(a="+",s=Ye(r,"+",n)));"0.0"===r?"*"===a?s="0.0":"+"===a?s=n:"-"===a&&(s="0.0"===n?"0.0":Ye("","-",n)):"0.0"===n?"*"===a?s="0.0":"+"===a||"-"===a?s=r:"^"===a&&(s="1.0"):"1.0"===r?"*"===a?s=n:"^"===a&&(s="1.0"):"1.0"===n?"*"!==a&&"^"!==a||(s=r):"*"===a&&(Ze(r)?s=Ye("","-",n):Ze(n)&&(s=Ye("","-",r)));return s}(e)):e;return t=Xe(t)&&Ue(Qe(t))?-1*Qe(t):function(e){var t=e,a=e;if(Ke(a)){var r="";""===a.left&&"-"===a.op&&Ke(a.right)&&(r="-",a=a.right),Je(a.left)&&"\u02fd"===a.op&&Ke(a.right)&&(r+=a.left+"\u02fd",a=a.right),Je(a.left)&&"/"===a.op&&Je(a.right)&&(t=r+=a.left+"/"+a.right)}return O("tree_to_frac")&&console.log("tree_to_frac(t)=",t,Q(e)),t}(t)}var De={"\xb1":"+-","\u2013":"\\-","\u02fd":"\\ ","\u221a":"\\2","\u03c0":"\\p","\u222b":"\\[","\u2248":"~=","\u2260":"\\=","\u2265":">=","\u2264":"<=","\xf7":"\\/","\u2261":"==","\u2026":"...","\u21d2":"=>","\u27fa":"<>","\u2192":"->","\u221e":"\\i","\u03b1":"\\a","\u03b2":"\\b","\u03b3":"\\g","\u03b4":"\\d","\u0394":"\\D","\u03f5":"\\e","\u03bc":"\\m","\u03bb":"\\l","\u03c3":"\\s","\u03a3":"\\S","\u03b8":"\\t","\u03a0":"\\P","\u2229":"\\^","\u222a":"\\v","\xd7":"\\*","\u22c5":"\\.","\xb0":"\\o"},Fe={"%":"\\%",du:"du",dy:"dy",dx:"dx","\u03b1":"\u03b1","\u03b2":"\u03b2","\u03b3":"\u03b3","\u03b4":"\u03b4","\u03f5":"\u03f5","\u03bc":"\u03bc","\u03bb":"\u03bb","\u03c0":"\u03c0","\u03c3":"\u03c3","\u03b8":"\u03b8","\u03a3":"\u03a3","\u2026":"\u2026","\xb0":"\xb0","\u0394":"\u0394"},He={"\u2265":"\u2265","\u2264":"\u2264","\u2260":"\u2260","\u2261":"\u2261","\u2248":"\u2248","\u21d2":"\u21d2","\u221d":"\u221d","\u27fa":"\u27fa"},Be={"\xf7":"\xf7","\xb1":"\xb1","\u2013":"-","\u221a":"\u221a","\u2229":"\u2229","\u222a":"\u222a","\xd7":"\xd7","\u22c5":"\u22c5","\u02fd":"\u02fd",":":":"},Le="+-*/^(),=<>{}[]|~\xb1",Re=["//"];function Ie(e,t){return"symbol"===e?Fe[t]||He[t]||Be[t]:!!e[t]}function Ue(e){return!isNaN(e)&&""!==e&&!1!==e&&!0!==e&&null!==e}function Je(e){return Ue(e)&&Number.isInteger(1*e)}function $e(e){return"string"===typeof e||Ue(e)}function Ke(e){return e&&"object"===Object(ue.a)(e)&&e.op}function Ve(e){return Ke(e)&&Je(e.left)&&"/"===e.op&&Je(e.right)&&e.right>0}function Ge(e){var t=!1;if(Je(e))t=!0;else{if("string"===typeof e&&-1!==e.indexOf("/")){var a=e.split("/");return 2===a.length&&Je(a[0])&&Je(a[1])}Ke(e)?Ve(e)?t=!0:Je(e.left)&&"\u02fd"===e.op&&Ve(e.right)?t=!0:Xe(e)&&(t=Ge(Qe(e))):t=!1}return O("is_fraction")&&console.log("is_fracion(f)",t,Q(e)),t}function Xe(e){return Ke(e)&&(""===e.left&&"-"===e.op||("*"===e.op||" "===e.op||"("===e.op||"/"===e.op)&&Xe(e.left))}function Ye(e,t,a){var r="undefined"!==typeof t?t:"";if(""!==r)var n={left:e,op:r,right:"undefined"!==typeof a?a:""};else n=e;return n}function Ze(e){return Ke(e)&&""===e.left&&"-"===e.op&&1*e.right===1}function et(e){return"string"===typeof e&&null!==e.match(/([0-9]+)\xb0(?:([0-9]+)')?(?:([0-9]+)'')?$/)}var tt,at=function(){function e(t,a){Object(o.a)(this,e);for(var r=[],n="",s=!1,l=0;l<t.length;l++)"{"===t[l]?s=!0:"}"===t[l]&&(s=!1),-1!==Le.indexOf(t[l])||Ie("symbol",t[l])?(n.length>0&&(n=this.longest(n,a,r,!0,s)),n=this.longest(t[l],a,r,!0,s)):(n.length>0&&(isNaN(n)&&"."!==n)!==(isNaN(t[l])&&"."!==t[l])&&(n=this.longest(n,a,r,!0,s)),n+=t[l],n=this.longest(n,a,r,!1,s));return n&&this.longest(n,a,r,!0,s),O("Tokens")&&console.log("Tokens(maths,vars)",t,a,r,n),this.tokens=r,this.vars=a,this.pos=0,this}return Object(i.a)(e,[{key:"op_2",value:function(e){return-1!==Re.indexOf(e)}},{key:"longest",value:function(e,t,a,r,n){var s="";if(a.length&&this.op_2(a[a.length-1]+e))a[a.length-1]+=e,s="";else if("_"===e&&a.length)s=a[a.length-1]+"_",a.length--;else if(r&&a.length&&a[a.length-1].endsWith("_"))a[a.length-1]+=e,s="";else{for(var l=e,o=-1,i="",c=a.length;c>=0&&((pt(l,t)||vt(l,t,n)||et(l))&&(o=c,i=l),0!==c&&-1===Le.indexOf(a[c-1]));c--)l=""+a[c-1]+l;-1!==o?(o<a.length&&(a.length=o),a[o]=function(e,t){return-1!==dt(t).indexOf(e)?e:-1!==dt(t).indexOf("'"+e)?"'"+e:-1!==dt(t).indexOf(e.replace("_","_'"))?e.replace("_","_'"):-1!==dt(t).indexOf("'"+e.replace("_","_'"))?"'"+e.replace("_","_'"):e}(i,t)):r||1===e.length&&e.match(/[a-z]/i)?a.push(e):s=e}return O("longest")&&console.log("longest(token,vars,ret,store)=",e,t,a,r,s),s}},{key:"peek",value:function(){return this.pos<0||this.end()?"":this.tokens[this.pos]}},{key:"token",value:function(){return this.pos<1?"":this.tokens[this.pos-1]}},{key:"next",value:function(){var e;return this.pos<0||this.end()?e="":(this.pos++,e=this.tokens[this.pos-1]),e}},{key:"end",value:function(){return this.pos===this.tokens.length}}]),e}(),rt=!1;function nt(e,t){var a,r=null,n=new at(e,t);if(O("expression")&&(a=Q(n)),tt="",rt=!1,"undefined"===typeof e||null===e||""===e)r=null;else{if("="===n.peek()||Ie(He,n.peek()))r=Ye("",n.next(),it(ut(n),0,n));else r=it(ut(n),0,n);n.end()?tt&&("="===n.token()||Ie(He,n.token()))&&(tt=""):tt="E"+n.token(),r=""===tt?ze(r):null}return O("expression")&&console.log("expression(expression,vars)=",JSON.stringify(r),r,a,n),r}function st(e,t){return"("===e||pt(e,t.vars)||e.length>0&&-1===kt(e)&&")"===t.token()?"*":vt(e,t.vars)||"\u221a"===e?" ":e}function lt(e,t){return pt(e,t)?kt("+")+.5:kt(st(e,t))}function ot(e,t,a){var r,n;O("set_var")&&(n=Q(a)),a&&a.auto&&(vt(e,a)?r=e:Ke(e)&&","===e.op&&!gt(e.right)&&vt(e.right,a)&&(r=e.right),pe(t)||(a[r]=t)),O("set_var")&&console.log("variable(lhs,vars)=",r,Q(e),n,a)}function it(e,t,a){if(""!==tt)return"";var r,n,s="",l=a.peek();for(O("expression_1")&&(r=Q(a),n=Q(e));""===tt&&")"!==l&&"}"!==l&&"|"!==l&&"]"!==l&&lt(l,a)>=t;){s=st(l,a)!==l?"("===l?"(":st(l,a):a.next();var o=ut(a);for(l=a.peek();""===tt&&")"!==l&&"}"!==l&&"|"!==l&&"]"!==l&&(lt(l,a)>kt(s)||ct(l)&&kt(l)===kt(s));)o=it(o,lt(l,a),a),l=a.peek();rt||"="!==s||ot(e,o,a.vars),e=Ye(e,","!==s||")"!==l||rt?s:"(,)",o)}return O("expression_1")&&console.log("expression_1(lhs,min_precedence,tokens)=",e,t,r,n,a),e}function ct(e){return"^"===e}function ut(e){if(""!==tt)return"";var t,a=e.token();O("primary")&&(t=Q(e));var r=e.next();if("("===r)r=it(ut(e),0,e),")"!==e.peek()?Et(")",e):e.next();else if("|"===r)r=it(ut(e),0,e),"|"!==e.peek()?Et("|",e):(e.next(),r=Ye("","|",r));else if("["===r)r=it(ut(e),0,e),"]"!==e.peek()?Et("]",e):(e.next(),r=Ye("","[]",r));else if("{"===r){if(rt?Et("{",e):"'"===e.peek()?e.next():rt=!0,r=it(ut(e),0,e),"}"!==e.peek())Et("}",e);else if(e.next(),rt){var n=de(r,e.vars);r=Ue(n)?n<0?Ye("","-",-n):1*n===0?"0.0":1*n===1?"1.0":n:et(n)?n:Xe(n)&&Ue(Qe(n))?n:Ge(n)?n:Array.isArray(n)?Ye(n[0],",",n[1]):n,rt=!1}}else if("\u221a"===r||pt(r,e.vars)){var s=kt(r);if(pt(r,e)&&"("===e.peek()&&(s=kt("^")+1),mt(r)&&"^"===e.peek()){e.next();var l=e.next();"-"===l&&"1"===e.peek()?(l=e.next(),r+="^{-1}"):isNaN(l)?Et(l,e):r+="^{"+l+"}","("===e.peek()&&(s=kt("^")+1)}else if("log_"===r&&"{"===e.peek()){e.next();var o=e.next();"}"!==e.peek()?Et("}",e):e.next(),r+="{"+o+"}"}r=Ye("",r,it(ut(e),s,e))}else"-"!==r&&"\xb1"!==r&&"\u2013"!==r||!(pt(e.peek())||vt(e.peek(),e.vars)||bt(e.peek())||et(e.peek())||"{"===e.peek()||"("===e.peek()||"\u221a"===e.peek())?"."===r?r="":0!==r.length&&(vt(r,e.vars)||bt(r)||et(r))||Et(r,e):r=Ye("",r,it(ut(e),"^"===a?kt("^")-1:kt("\u02fd"),e));return O("primary")&&console.log("primary(tokens)=",r,t,e),r}function pt(e,t){return mt(e)||ht(e)}function ht(e){return"string"===typeof e&&null!==e.match(/^(ln|log(_[0-9]+)?)$/)}function mt(e){return"string"===typeof e&&null!==e.match(/^(sin|cos|tan|cosec|sec|cot)(\^{(-1|[0-9]+)})?$/)}function dt(e){return e&&e.xyz?e.xyz.replace(/,/g," ").split(" "):["x","y","z"]}function ft(e,t){return"string"===typeof e&&(-1!==dt(t).indexOf(e)||-1!==dt(t).indexOf("'"+e)||-1!==dt(t).indexOf(e.replace("_","_'"))||-1!==dt(t).indexOf("'"+e.replace("_","_'")))}function vt(e,t,a){var r=!1;return r="string"===typeof e&&(!pt(e)&&(!(!ft(e,t)&&"e"!==e&&!Ie(Fe,e))||(!(!e.endsWith("'")||!ft(e.substring(0,e.length-1),t))||!(!a&&!rt)&&(!(!t||void 0===t[e])||gt(e))))),O("algebra")&&console.log("algebra(token,vars)=",e,t,r,rt,a),r}function gt(e){return"string"===typeof e&&("dp"===e||"sf"===e||"improper"===e||"fractional"===e||"whole"===e||"mixed"===e||"denominator"===e||"numerator"===e||"mixed"===e)}function bt(e){return e.match(/^[0-9]*(\.)?[0-9]+$/)}function kt(e){return"="===e||"<"===e||">"===e||Ie(He,e)?1:","===e?rt?1.5:1:"//"!==e&&"~"!==e||!rt?"+"===e||"-"===e||"\u2013"===e||"\xb1"===e||":"===e?2:"\u02fd"===e?2.5:"*"===e||" "===e||"("===e||"\xd7"===e||"\u22c5"===e?4:"/"===e||"\xf7"===e?4:pt(e)?3:"\u221a"===e||"^"===e?7:-1:1.5}function Et(e,t){O("error")&&console.error("error(expected),tokens",e,Q(t)),tt=""===e?"?":e}var yt="";function Ot(e){var t=null,a=function e(t,a,r,n){var s,l,o,i=null;O("output_tree")&&(l=Q(t),o=Q(r));a&&(n=n||"/"===t.op||"^"===t.op&&"right"===a);a?"left"===a?(s=je(t.left),r=je(t)):"right"===a&&(s=je(t.right)):s=je(t);if(Ke(s)){var c=e(s,"left",r,!1,n),u=e(s,"right",r,n),p=s.op;"*"!==p&&"("!==p&&")"!==p&&" "!==p||(p="-"!==u[0]&&isNaN(u[0])&&"\\dfrac"!==u.substring(0,6)?" ":"("===p?"(":"\xd7"),i="/"===p?n?"\\frac{"+c+"}{"+u+"}":"\\dfrac{"+c+"}{"+u+"}":"\u02fd"===p?"{\\Large{"+c+"}}"+u:"^"===p?wt(t,a)?-1!==c.indexOf("\\dfrac")?"\\Big("+c+"\\Big)^{"+u+"}":"("+c+")^{"+u+"}":c.startsWith("(")&&-1!==c.indexOf("\\dfrac")?"\\Big"+c.substring(0,c.length-1)+"\\Big)^{"+u+"}":c+"^{"+u+"}":"|"===p?"\\left|"+u+"\\right|":"\u221a"===p?"\\sqrt{"+u+"}\\,":"(,)"===p?"("+c+","+u+")":"-"!==p||$e(s.right)||"+"!==s.right.op&&"-"!==s.right.op?pt(p)?function e(t){if($e(t))return!1;if(pt(t.op))return!0;if("*"===t.op||"("===t.op||")"===t.op||" "===t.op)return e(t.left)||e(t.right)}(s.right)?"\\"+p+"("+u+")":!wt(s,"right")||Ke(s.right)&&"^"===s.right.op?-1!==u.indexOf("\\times")||-1!==u.indexOf("(")?"\\"+p+"("+u+")":"left"===a&&(" "===t.op||"*"===t.op&&xt(t.right)||"^"===t.op)?"\\"+p+"("+u+")":"right"===a&&Ke(r)&&!wt(r,"left")&&("*"===r.op&&xt(r.right)||" "===r.op)?"\\"+p+"("+u+")":"f"===p?p+"("+u+")":"\\"+p+"{"+u+"}":"f"===p?c+" "+p+"{"+u+"}":c+"\\"+p+"{"+u+"}":wt(t,a)?"("+c+p+u+")":"("===p?c+"("+u+")":c+p+u:""!==s.right.left?c+p+"("+u+")":c+p+"{"+u+"}",yt="="===p?u:i}else(i=Ue(s)?1*s===0?"0":1*s===1?"1":""+s:"string"===typeof s?s:Array.isArray(s)?s.map(function(t){return e(t)}).join(","):null)&&(yt=i);O("output_tree")&&console.log("output_tree(tree,side,rt,f)=",i,l,a,o,n);"string"!==typeof i&&console.error("output_tree(tree,side,rt,f)=",i,t,a,r,n);return i}(e);return a&&(t=jt(a).replace(/_('?[a-zA-Z0-9]+)/g,"_{$1}").replace(/'([a-zA-Z][a-zA-Z0-9]*)/g,"\\text{$1}")),O("mj")&&console.log("mj(tree)=",e,a,t),t}function jt(e){for(var t="",a=0;a<e.length;a++)"undefined"!==typeof Fe[e[a]]?t+=Fe[e[a]]+" ":"undefined"!==typeof He[e[a]]?t+=He[e[a]]+" ":"undefined"!==typeof Be[e[a]]?t+=Be[e[a]]+" ":t+=e[a];return t}function wt(e,t){var a;return"undefined"===typeof t?a=e:"left"===t?a=e.left:"right"===t&&(a=e.right),!!Ke(a)&&("/"!==e.op&&("right"!==t||"^"!==e.op&&"\u221a"!==e.op)&&(!("^"!==a.op||!Ke(a.left)||"^"!==a.left.op&&"/"!==a.left.op)||("-"!==a.op||""!==a.left||"^"===e.op)&&kt(e.op)>kt(a.op)))}function xt(e){return!(Ke(e)&&pt(e.op))}function qt(e){var t,a;if(O("next_tok")&&(t=Q(e)),e.pos>=e.text.length)a=null;else if(a=e.text.charAt(e.pos++),-1!==" \r\n[]\\?".indexOf(a))if("\\"===a&&"("===e.text.charAt(e.pos)){for(a+=e.text.charAt(e.pos++);e.pos<e.text.length-1&&("\\"!==e.text.charAt(e.pos)||")"!==e.text.charAt(e.pos+1));)a+=e.text.charAt(e.pos++);"\\"===e.text.charAt(e.pos)&&")"===e.text.charAt(e.pos+1)?(a+=e.text.charAt(e.pos++),a+=e.text.charAt(e.pos++)):console.error("unterminated latex \\( with no \\)")}else"?"===a?a=function(e){var t,a,r="?";O("conditional")&&(t=Q(e),a=Q(yt));if(e.pos<e.text.length&&"{"===e.text.charAt(e.pos)){for(var n=e.pos,s=e.pos++,l=n;s<e.text.length&&-1==="\n:;}".indexOf(e.text.charAt(s));)s++;if("}"===e.text.charAt(s)){e.pos=++s;var o=e.text.substring(n,s);for(n=s;s<e.text.length&&-1==="\n:;".indexOf(e.text.charAt(s));)s++;var i="",c="";if(s>n&&(i=e.text.substring(n,s)),":"===e.text.charAt(s)){for(n=++s;s<e.text.length&&-1==="\n:;".indexOf(e.text.charAt(s));)s++;s>n&&(c=e.text.substring(n,s))}s<e.text.length&&"\n"!==e.text.charAt(s)&&s++,e.pos=s;var u=nt(o,e.vars);r=Ue(u)?1*u!==0?i:c:"?{?"+e.text.substring(l+1,s)}else r="?{"}else if(e.pos<e.text.length&&"="===e.text.charAt(e.pos)){n=s=++e.pos;for(;s<e.text.length&&-1==="\n;?=".indexOf(e.text.charAt(s));)s++;if(s>n){r=e.text.substring(n,s);var p=yt,h=Ot(nt(r,e.vars));r=null===h?"?=":p===h?"":"="+r,s<e.text.length&&";"===e.text.charAt(s)&&s++,e.pos=s}else r="?="}O("conditional")&&console.log("conditional(o)=",r,t,Q(e),a,yt);return r}(e):"["===a&&(a=function(e){var t="[",a=!1,r=e.pos;for(;e.pos<e.text.length-1&&"]"!==e.text.charAt(e.pos);)"\n"===e.text.charAt(e.pos)&&(a=!0),t+=e.text.charAt(e.pos++);if("]"===e.text.charAt(e.pos)){if(e.pos++,a)return t+"]";if("_"===e.text.charAt(e.pos)){var n=_t(e.text,e.pos),s=e.text.substr(e.pos,n-e.pos);e.pos=n,parseError="";var l=Ot(t.substr(1));return console.log("[]_^",t,l,s,n),""===parseError?"\\(\\Big["+l+"\\Big]"+s+"\\)":"\\(\\Big["+t.substr(1)+"\\Big]"+s+"\\)"}var o=t.substr(1).split(",");return 1===o.length?1===o[0].length?"\\(\\utilde{"+o[0]+"}\\)":0===o[0].indexOf("|")&&o[0].substr(1).indexOf("|")===o[0].length-2?"\\(|\\overrightarrow{"+o[0].substr(1,o[0].length-2)+"}|\\)":"\\(\\overrightarrow{"+o[0]+"}\\)":"\\(\\begin{pmatrix}"+t.substr(1).split(",").join("\\\\")+"\\end{pmatrix}\\)"}return e.pos=r,"["}(e));else for(;e.pos<e.text.length&&-1===" \r\n[]\\?".indexOf(e.text.charAt(e.pos));)a+=e.text.charAt(e.pos++);return e.token=a,O("next_tok")&&console.log("next_tok(o)=",a,t,Q(e)),a}function St(e,t){for(var a,r,n=e;-1!==(a=e.indexOf("{"))&&-1!==(r=e.indexOf("}"));)if(r<a)e=e.substr(r+1);else{for(var s=e.substring(a+1,r);-1!==(a=s.indexOf("{"));)s=s.substr(a+1);if("'"===s[0]){var l=Ot(nt("{"+s.substr(1)+"}",t));l&&(n=n.replace("{"+s+"}","{"+l+"}"))}e=e.substr(r+1)}return n}function Ct(e,t,a,r){if("\n"===t)e.push({chunk:"\n",type:"newline"});else if(t.startsWith("\\(")){var n=t.indexOf("\\)");n===t.length-2?"integral"===a||-1!==t.indexOf("//Big]_")?Ct(e,jt(St(t.substring(2,n),r)).replace(/\\'/g,"\\").replace(/\\dfrac/g,"\\frac"),"latex"):Ct(e,jt(St(t.substring(2,n),r)).replace(/\\'/g,"\\"),"latex"):e.push({chunk:t,error:"\\( with no matching \\)",type:"error"})}else e.length>0&&e[e.length-1].type===a?e[e.length-1].chunk+=t:e.length>0&&("maths"===e[e.length-1].type&&"latex"===a||"latex"===e[e.length-1].type&&"maths"===a)?(e[e.length-1].chunk+=t,e[e.length-1].type=a):e.push({chunk:t,type:a})}function Nt(e){var t=e.token,a=null;return(t.endsWith(".")||t.endsWith(","))&&(t=t.substr(0,t.length-1)),-1!==t.indexOf("\\(")||-1!==t.indexOf("</")||-1!==t.indexOf("class=")||-1!==t.indexOf("target=")||t.endsWith("^")||t.endsWith("\u221a")?a=null:!(a=nt(t,e.vars))&&e.auto&&(a=function(e){var t;O("detect_xyz")&&(t=Q(e));var a,r,n=e.token.startsWith("''")?e.token.substr(1):e.token,s=Q(e.vars),l=dt(e.vars),o=!1,i=!1,c=!1,u=new at(n,s);for(;r=u.next();)-1!=="=^/+*-\u2260\u2265\u2264\xb1\xf7\u221a\u2261\u2248\u2026\u21d2".indexOf(r)?i=!0:"{"===r?c=!0:"}"===r?c=!1:c||!(/['a-zA-Z]/.test(r.charAt(0))||r.indexOf("_")>0)||pt(r)||ft(r,s)||(l.push(r),o=!0);o&&i?(s.xyz=l.join(","),(a=nt(n,s))&&Object.keys(s).forEach(function(t){e.vars[t]=s[t]})):a=nt(n,e.vars);O("detect_xyz")&&console.log("xyz(p)=",a,t,Q(e));return a}(e)),a&&(e.token.endsWith(".")||e.token.endsWith(","))&&e.pos--,O("detectMaths")&&console.log("detectMaths(p)",Q(e),a),a}function _t(e,t){return console.log("limits",e.substr(t,5),t),t||(t=0),"_"===e.charAt(t)&&(t++,"{"===e.charAt(t)&&e.indexOf("}",t)>t&&(t=e.indexOf("}",t)),t++,"^"===e.charAt(t)&&(t++,"{"===e.charAt(t)&&e.indexOf("}",t)>t&&(t=e.indexOf("}",t)),t++)),t}function At(e){var t=""+e;return t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<r>/g,'<span class="red">')).replace(/<o>/g,'<span class="amber">')).replace(/<g>/g,'<span class="green">')).replace(/<h>/g,"<h5>")).replace(/<\/r>/g,"</span>")).replace(/<\/o>/g,"</span>")).replace(/<\/g>/g,"</span>")).replace(/<\/h>/g,"</h5>")}function Mt(e){for(var t=0;t<e.length&&-1===" \r\n\\'[](){}.,@".indexOf(e[t]);)t++;return{name:e.substring(0,t),end:t===e.length?"":e.substring(t)}}function Tt(e,t,a,r){O("setVariables")&&console.log("setVariables",e,t,a);var n=Wt(e,t);if(!n){var s,l=function(){var l,o,i={},c=[];"undefined"!==typeof e&&e.length>0&&(c=e.split("\n"));var u=function(){if(-1===c[s].indexOf("=")||-1!==c[s].indexOf("{")&&c[s].indexOf("{")<c[s].indexOf("="))return"continue";var e=c[s].substr(c[s].indexOf("=")+1),t=c[s].substr(0,c[s].indexOf("=")).split(",");e.length>0&&t.length>0&&t.forEach(function(t){"xyz"===(t=t.trim())?l=e:"keys"===t?o=e:t&&(i[t]=a?Dt(e):function(e,t){if("undefined"!==typeof window.FreeMaths&&"undefined"!==typeof window.FreeMaths.testing&&window.FreeMaths.testing)return e;if(e.length>0&&!t)for(var a=0;a<e.length;a++){var r=Math.floor(a+Math.random()*(e.length-a)),n=e[a];e[a]=e[r],e[r]=n}return e}(Dt(e),r))})};for(s=0;s<c.length;s++)u();if(a)return{v:function(e,t){var a={false:0,true:0,opts:[]};a[!1]=0,a[!0]=0;var r=Qt(e);for(;!1!==r&&a[!1]<65e3&&a[!0]<65e3;){var n=Pt(e,r);Ht(n,t)?(a[!0]++,a.opts.push(n)):a[!1]++,r=zt(e,r)}return a}(i,Ft(e))};(n=function(e,t,a){var r=Qt(e),n=Q(r),s=Pt(e,r);for(;!1!==r&&!Ht(s,t,a);)r=zt(e,r),s=Pt(e,r);if(!1===r){for(console.log("setVals - retry",r,n,e,t,a),r=Q(n),s=Pt(e,r);!1!==r&&!Ht(s,t,null);)r=zt(e,r),s=Pt(e,r);!1===r&&console.error("setVals",r,n,e,t)}return r?s:null}(i,Ft(e),t))&&l&&(n.xyz=l),n&&o&&(n.keys=o)}();if("object"===Object(ue.a)(l))return l.v}return n}function Wt(e,t){var a=Ft(e),r=!1,n=null;if(t&&t.use.length>0)for(var s=0;!r&&s<t.use.length;)r=Ht(n=JSON.parse(t.use[s++]),a,t);return!!r&&n}function Qt(e){for(var t={},a=Object.keys(e),r=0;r<a.length;r++)t[a[r]]=0;return t}function Pt(e,t){var a={};return Object.keys(e).forEach(function(r){a[r]=e[r][t[r]]}),a}function zt(e,t){for(var a=Object.keys(t),r=0;r<a.length;r++){if(t[a[r]]++,t[a[r]]<e[a[r]].length)return t;t[a[r]]=0}return!1}function Dt(e){var t=[];return e.startsWith("[")?t=function(e){var t=[];if(e.indexOf(",")>0)t=(t=e.split(",")).map(function(e){return Ue(e)?1*e:e});else if(e.indexOf("..")>0){var a=0,r=e.split("..");if(2===r.length)if(r[0].indexOf("/")>0&&r[1].indexOf("/")>0)t=function(e,t){var a,r,n=[],s=e.split("/"),l=t.split("/");if(Ue(s[0])&&Ue(s[1])&&Ue(l[0])&&Ue(l[1]))for(a=1;a<=9*l[0]/l[1];a++)for(r=2;r<=9;r++)a/r>=s[0]/s[1]&&a/r<=l[0]/l[1]&&1===Se(a,r)&&n.push(a+"/"+r);return n}(r[0],r[1]);else for(var n=1*r[0];n<=r[1];n++)t[a++]=n}return t}(e.substr(1,e.indexOf("]")-1)):Ue(e)?t[0]=1*e:Ge(nt(e))?t[0]=e:t[0]=de(nt(e)),t}function Ft(e){var t=e.split("\n"),a=[];return t.forEach(function(e){var t,r;-1!==e.indexOf("]")&&(e=e.substring(e.indexOf("]")+1)),-1!==e.indexOf(":")&&(e=e.substring(e.indexOf("]")+1)),-1!==(t=e.indexOf("{"))&&-1===e.indexOf("{xyz=")&&-1!==(r=e.indexOf("}"))&&r>t&&a.push(e.substring(t,r+1))}),a}function Ht(e,t,a){var r=!0;if(a&&function(e,t){for(var a=!1,r=0;r<t.length&&!a;)a=t[r]===JSON.stringify(e),r++;return a}(e,a.skip))r=!1;else for(var n=0;n<t.length;n++)t[n].startsWith("{\u2260")?function(){var a=t[n].substring(2,t[n].length-1).split(",");a.forEach(function(t){return a.forEach(function(a){t!==a&&e[t]===e[a]&&(r=!1)})})}():r=!(!r||!nt(t[n],e));return r}function Bt(e){var t=e;return 0===t.indexOf("[")&&(t=t.substring(t.indexOf("]")+1)),-1!==t.indexOf("#")&&(t=t.substring(0,t.indexOf("#"))),t.indexOf("[")>0&&(t=t.substring(0,t.indexOf("["))),t}function Lt(e){var t=void 0;return-1!==e.indexOf("#")&&-1!==(t=e.substring(e.indexOf("#")+1)).indexOf("[")&&(t=t.substring(0,e.indexOf("["))),t}function Rt(e){var t=void 0;return 0===e.indexOf("[")&&(e=e.substring(e.indexOf("]"))),e.indexOf("[")>0&&e.endsWith("]")&&(t=e.substring(e.indexOf("[")+1,e.length-1)),t}function It(e){return/^(1|0)[xyz]/.test(e)||/[+-\/*]\)](1|0)([xyz])/.test(e)||/^0[+-\/*(]/.test(e)||/[+-\/*)]0/.test(e)}function Ut(e,t,a){var r,n=(r=function(e,t){var a=t,r=e.indexOf("]")-1;if(0===e.indexOf("[")&&r>1){var n=e.substring(1,r);t.startsWith(n)?a=t.substr(r):e.indexOf("?")<=r&&(r=e.indexOf("?")-1,n=e.substring(1,r),t.startsWith(n)&&(a=t.substr(r)))}else t.startsWith("=")&&t.length>1&&(a=t.substr(1));return a.startsWith("(")&&a.endsWith(")")&&-1===a.substr(1).indexOf("(")&&(a=a.substr(1,t.length-2)),a}(t,e),r.replace(/^(\d+)(\+| )(\d+\/\d+)$/,"$1\u02fd$3").replace(/^-(\d+)(-| )(\d+\/\d+)$/,"-$1\u02fd$3"));n=n.replace(/\s/g,"");var s,l=!1,o=!1,i=t.split("\n");for(s=0;s<i.length;s++){var c=Bt(i[s]);if(l=Ce(n,c,Lt(i[s]),a))break;o||(o=_e(n,c,Lt(i[s]),a))}return l&&It(n)&&(l=!1,o=!0),l=!l&&o?i[0].indexOf("#")>0?{attempt:e,correct:"\u2713",diff:null}:{attempt:e,correct:"?\u2713",diff:l?null:Jt(n,t,a)}:{attempt:e,correct:l?"\u2713":"\u2717",diff:l?null:Jt(n,t,a)},O("checkAnswer")&&console.log("checkAnswer(entered,answer,vars)=",l,e,t,a,n),l}function Jt(e,t,a){var r=Pe(nt(Bt(t.split("\n")[0]),a));""!==tt&&(r=Bt(t.split("\n")[0]));for(var n="",s=e,l=e.match(/[+-]?[\d]*([a-z]*(\^[\d])?)*/g),o=r.match(/[+-]?[\d]*([a-z]*(\^[\d])?)*/g),i=0;i<l.length;i++)if(l[i].length>0&&"+"!==l[i]&&"-"!==l[i]){var c=s.substr(0,s.indexOf(l[i])+l[i].length);s=s.replace(c,"");for(var u=0;u<o.length&&c.length>0;u++)$t(l[i])===$t(o[u])&&(Kt(l[i])===Kt(o[u])?n+=c.replace(l[i],"<g>"+l[i]+"</g>"):n+=c.replace(l[i],"<o>"+l[i]+"</o>"),c="",o.splice(u,1));n+=c}return n+=s,O("mathDiff")&&console.log("mathDiff(a,answer,vars)=",n,e,r,t,l,o),n}function $t(e){return e.length>0&&("+"===e[0]||"-"===e[0])?e.substr(1):e}function Kt(e){return e.length>0&&"-"===e[0]?"-":"+"}var Vt=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={start:0,keypad:!1},a.change=function(e,t){t=t||(a.calcInput?a.calcInput.selectionStart:0);var r=e.length,n=na(e,t+=e.length-r);n.text!==a.props.answer&&(a.props.change(n.text),a.setState({start:n.caret})),a.calcInput&&a.calcInput.focus()},a.keyboard=function(e){a.change(e.target.value)},a.keypress=function(e){var t=a.calcInput.selectionStart,r=a.calcInput.selectionEnd;a.change(a.props.answer.substring(0,t)+e+a.props.answer.substring(r),t+e.length)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return t.keypad!==this.state.keypad||e.answer!==this.props.answer||e.qid!==this.props.qid||e.vars!==this.props.vars}},{key:"componentDidUpdate",value:function(){this.calcInput&&(this.calcInput.setSelectionRange(this.state.start,this.state.start),this.calcInput.focus())}},{key:"render",value:function(){var e=this;return this.state.keypad?n.a.createElement(ta,{qid:this.props.qid,vars:this.props.vars,answer:this.props.answer,change:this.change,mark:this.props.mark,close:function(){return e.setState({keypad:!1,start:e.props.answer.length})}}):n.a.createElement(Y.a,{onSubmit:function(t){t.preventDefault(),e.props.mark()},inline:!0},n.a.createElement(Zt,{qid:this.props.qid,vars:this.props.vars}),n.a.createElement("input",{ref:function(t){e.calcInput=t},autoFocus:!0,className:"form-control",inputMode:"numeric",type:E.user.isios?"tel":"text",value:this.props.answer,onChange:this.keyboard}),n.a.createElement(ea,{qid:this.props.qid,vars:this.props.vars}),n.a.createElement(Yt,{show:function(){return e.setState({keypad:!0})}}),this.props.answer?n.a.createElement(ra,{mark:this.props.mark}):n.a.createElement(Xt,null),n.a.createElement("div",null,n.a.createElement(Gt,{qid:this.props.qid,vars:this.props.vars,onClick:this.keypress})))}}]),t}(r.Component),Gt=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).buttons=function(){var e=["-"],t=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=nt(Bt(e.split("\n")[0]),t);return r=a?[{chunk:e,type:"answer"},{chunk:JSON.stringify(t),type:"vars"},{chunk:Ot(r),type:"evaluated"},{chunk:Lt(e),type:"dpsf"}]:Pe(r),O("evaluateAnswer=")&&console.log("evaluateAnswer(answer,vars)=",e,t,r),r}(S(a.props.qid).answer,a.props.vars);return["+","/","(",")","^","\u221a",",","x","y","z","\u02fd","\xb1"].forEach(function(a){-1!==t.indexOf(a)&&e.push(a)}),O("buttons")&&console.log("buttons,answer,ret,qid,vars",t,e,a.props.qid,a.props.vars),e},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.qid!==this.props.qid||e.vars!==this.props.vars}},{key:"textClass",value:function(e){return-1!==["x","y","z"].indexOf(e)?"keyboard-algebra":"keyboard-text"}},{key:"render",value:function(){var e=this,t={"-":"\u2013"};return this.buttons().map(function(a){return n.a.createElement(d.a,{key:a,className:"keyboard-button",onClick:function(){return e.props.onClick(a)}},n.a.createElement("span",{className:e.textClass(a)},t[a]?t[a]:a))})}}]),t}(r.Component),Xt=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={help:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return this.state.help?n.a.createElement(ua,{topic:"keyboard",close:function(){return e.setState({help:!1})}}):n.a.createElement(W,{className:"btn btn-default green",onClick:function(){return e.setState({help:!0})},tooltip:"keyboard help"},"?")}}]),t}(r.Component),Yt=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return n.a.createElement(W,{className:"btn btn-default kbd",onClick:this.props.show,tooltip:"keyboard"},"\u200b")}}]),t}(r.Component),Zt=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e,t,a=E.data.tests.questions[this.props.qid];if(a.answer.startsWith("[")&&-1!==(e=a.answer.indexOf("]"))){var r=a.answer.substring(1,e);if((t=r.indexOf("{"))>-1&&(e=r.indexOf("}"))>-1&&e>t){var s=r.substring(t+1,e);r=r.substring(0,t)}return s?n.a.createElement(T,{tooltip:s},n.a.createElement(da,{vars:this.props.vars},r)):n.a.createElement(da,{vars:this.props.vars},r)}return n.a.createElement(da,null,"=")}}]),t}(r.Component),ea=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=E.data.tests.questions[this.props.qid];return Rt(e.answer)?n.a.createElement(da,{vars:this.props.vars},Rt(e.answer)):null}}]),t}(r.Component),ta=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).keypress=function(e){"{mark}"===e?a.props.mark():"{clear}"===e?a.props.change(""):"{bs}"===e?a.props.change(a.props.answer.substr(0,a.props.answer.length-1)):a.props.change(a.props.answer+e)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"keys",value:function(){var e=this,t={x:"x",y:"y",z:"z"},a=0;return[["x","y","z","\u02fd","{clear}"],[7,8,9,"+","-"],[4,5,6,"*","/"],[1,2,3,"^","\u221a"],[0,".","(",",",")"],["<",">","=","{bs}","{mark}"]].map(function(r){var s=r.map(function(a){var r=a,s="default",l=t[a]?"keyboard-algebra":"keyboard-text";switch(a){case"{bs}":r=n.a.createElement("img",{src:"/images/backspace.svg",alt:"backspace"});break;case"{mark}":s="success",r="\u2713";break;case"{clear}":r="C",l="keyboard-text red"}return n.a.createElement(aa,{key:"key_"+a,onClick:e.keypress,keyval:""+a,button:s,textClass:l},r)});return n.a.createElement("div",{key:a++},s)})}},{key:"componentDidMount",value:function(){this.scrollKB.scrollIntoView()}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{ref:function(t){e.scrollKB=t},className:"well keypad"},n.a.createElement("button",{className:"close",onClick:this.props.close},"\xd7"),n.a.createElement("input",{className:"form-control",readOnly:!0,value:this.props.answer,onClick:this.props.close}),this.keys())}}]),t}(r.Component),aa=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={style:a.props.button},a.hover=function(){E.user.isMobile||a.setState({style:"primary"})},a.unhover=function(){E.user.isMobile||a.setState({style:a.props.button})},a.click=function(e){a.props.onClick(a.props.keyval)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return n.a.createElement(d.a,{className:"keyboard-button",id:this.props.keyval,onClick:this.click,bsStyle:this.state.style,onMouseEnter:this.hover,onMouseLeave:this.unhover},n.a.createElement("span",{className:this.props.textClass},this.props.children))}}]),t}(r.Component),ra=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return n.a.createElement(W,{className:"btn btn-success",onClick:this.props.mark,tooltip:"mark"},"\u2713")}}]),t}(r.Component);function na(e,t){var a=e.length;if(-1===e.indexOf("begin")&&Object.keys(De).forEach(function(t){e=e.replace(De[t],t,e)}),e=(e=(e=e.replace("/dx","/(dx)",e)).replace("/du","/(du)",e)).replace("/\u0394x","/(\u0394x)",e),t)var r=t+e.length-a;else r=null;return{text:e,caret:r}}var sa=Vt,la=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={question:S(a.props.qid),vars:a.props.vars?a.props.vars:Tt(S(a.props.qid).variables),help:"",showHelp:!1},a.save=function(e){var t=a.state.question;e&&((t=Q(t)).previous_id=t.id,t.id=0),JSON.stringify(S(a.props.qid))!==JSON.stringify(t)?a.props.fm.saveQ(t):(console.log("Question save: no changes"),a.props.close())},a.updateQuestion=function(e,t){if(a.state.question[e]!==t){var r=JSON.parse(JSON.stringify(a.state.question));r[e]=t,a.setState({question:r})}},a.changeVariables=function(){a.setState({vars:Tt(a.state.question.variables)})},a.setQ=function(e){var t=a.props.questions[e.target.value-1];P(t.next)||(t.next=""),a.setState({vars:Tt(t.variables),question:t})},a.getQ=function(){var e=a.state.question;return e.topics||(e.topics=""),e},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.qid!==this.state.question.id&&this.setState({question:S(e.qid),vars:Tt(S(e.qid).variables),showHelp:!1})}},{key:"shouldComponentUpdate",value:function(e,t){return JSON.stringify(t.question)!==JSON.stringify(this.state.question)||t.vars!==this.state.vars||t.help!==this.state.help||t.showHelp!==this.state.showHelp}},{key:"render",value:function(){var e=this;return n.a.createElement(m.a,{show:!0,bsSize:"large",onHide:this.props.close},n.a.createElement(m.a.Header,{closeButton:!0},n.a.createElement(m.a.Title,null,n.a.createElement(oa,{q:this.state.question,qs:this.props.questions,setQ:this.setQ}))),n.a.createElement(m.a.Body,null,n.a.createElement(ia,{fields:this.getQ(),vars:this.state.vars,change:this.changeVariables,update:this.updateQuestion})),n.a.createElement(m.a.Footer,null,n.a.createElement(d.a,{onClick:function(){return e.save(!0)}},"Copy"),n.a.createElement(d.a,{onClick:function(){return e.save(!1)}},"Save")))}}]),t}(r.Component),oa=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return P(this.props.qs)?n.a.createElement("select",{value:this.props.q.id,onChange:this.props.setQ},this.props.qs.map(function(e){return n.a.createElement("option",{value:e.id,key:e.id},e.id,": ",e.topic)})):n.a.createElement("div",null,this.props.q.id,": ",n.a.createElement(da,null,this.props.q.topic))}}]),t}(r.Component),ia=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={fields:null},a.renderFields=function(e,t){var r={};Object.keys(e).forEach(function(s){"undefined"!==typeof t?r[s]=n.a.createElement(ca,{auto:a.props.auto,key:s,field:s,text:e[s],vars:t,update:a.props.update,change:a.props.change}):null===a.state.fields||a.props.fields[s]!==e[s]?r[s]=n.a.createElement(ca,{auto:a.props.auto,key:s,field:s,text:e[s],vars:a.props.vars,update:a.props.update,change:a.props.change}):r[s]=a.state.fields[s]}),a.setState({fields:r})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return t.fields!==this.state.fields}},{key:"componentWillReceiveProps",value:function(e){null!==this.state.fields&&(e.vars!==this.props.vars?this.renderFields(e.fields,e.vars):e.fields!==this.props.fields&&this.renderFields(e.fields))}},{key:"componentDidMount",value:function(){this.renderFields(this.props.fields,this.props.vars)}},{key:"render",value:function(){var e=this;if(null===this.state.fields)return null;var t=Object.keys(this.state.fields).map(function(t){return e.state.fields[t]});return n.a.createElement("div",null,t)}}]),t}(r.Component),ca=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={stats:{},text:a.props.text,caret:null},a.update=function(e){var t=a.text.selectionStart;if("json"!==a.props.field)var r=na(e.target.value,t);else r={text:e.target.value,caret:t};a.setState({text:r.text,caret:r.caret}),a.props.update(a.props.field,r.text)},a.setStats=function(){a.setState({stats:Tt(a.props.text,null,!0)})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(){null!==this.state.caret&&this.state.caret!==this.text.selectionStart&&this.text.setSelectionRange(this.state.caret,this.state.caret)}},{key:"componentWillReceiveProps",value:function(e){e.text!==this.state.text&&this.setState({stats:{},text:e.text})}},{key:"render",value:function(){var e=this;return"undefined"===typeof{json:1,working:1,variables:1,help:1,topic:1,answer:1,question:1,title:1,keywords:1,comment:1,topics:1,next:1}[this.props.field]?null:"variables"===this.props.field?n.a.createElement("div",{className:"EditVariables row"},n.a.createElement("div",{className:"col-sm-1",dangerouslySetInnerHTML:{__html:function(e){for(var t="",a=Object.keys(e),r=0;r<a.length;r++)t+=a[r]+"="+e[a[r]]+"<br />\n";return t}(this.props.vars)}}),n.a.createElement("div",{className:"col-sm-1"},n.a.createElement("i",{className:"btn btn-default btn-sm fa fa-btn fa-repeat",onClick:this.props.change})),n.a.createElement("div",{className:"col-sm-2"},"options: ",this.state.stats[!0],n.a.createElement("br",null),"failed: ",this.state.stats[!1]),n.a.createElement("div",{className:"col-sm-2"},n.a.createElement("i",{className:"btn btn-deafult btn-sm fa fa-btn fa-repeat",onClick:this.setStats})),n.a.createElement("div",{className:"col-sm-6"},n.a.createElement("textarea",{ref:function(t){e.text=t},style:{minWidth:"100%"},placeholder:this.props.field,value:this.state.text,rows:this.state.text.split("\n").length,onChange:this.update}))):"json"===this.props.field?this.state.text.length>0?n.a.createElement("div",{className:"EditField row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("textarea",{ref:function(t){e.text=t},style:{minWidth:"100%"},placeholder:this.props.field,value:this.state.text,rows:this.state.text.split("\n").length,onChange:this.update}))):null:n.a.createElement("div",{className:"EditField row"},n.a.createElement("div",{className:"col-sm-6"},n.a.createElement(da,{auto:this.props.auto,edit:!0,vars:this.props.vars},this.state.text)),n.a.createElement("div",{className:"col-sm-6"},n.a.createElement("textarea",{ref:function(t){e.text=t},style:{minWidth:"100%"},placeholder:this.props.field,value:this.state.text?this.state.text:"",rows:this.state.text?this.state.text.split("\n").length:1,onChange:this.update})))}}]),t}(r.Component),ua=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={edit:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){k("/react_ajax/help",null,{topic:this.props.topic})}},{key:"componentWillReceiveProps",value:function(e){k("/react_ajax/help",null,{topic:e.topic})}},{key:"render",value:function(){var e=this;if(null===this.props.topic)return null;var t=this.props.topic,a="not found",r=0;return E.data&&E.data.help[this.props.topic]?(r=E.data.help[this.props.topic].id,t=E.data.help[this.props.topic].title,a=E.data.help[this.props.topic].text):console.log("help",this.props.topic,E.data.help),this.state.edit?n.a.createElement(ha,{id:r,title:t,help:a,close:function(){return e.setState({edit:!1})}}):n.a.createElement(pa,{title:t.split("__")[0].replace(/_/g," "),help:a,edit:function(){console.log("click"),e.setState({edit:!0})},close:this.props.close})}}]),t}(r.Component),pa=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return n.a.createElement(m.a,{name:"help",show:!0,onHide:this.props.close},n.a.createElement(m.a.Header,{closeButton:!0},n.a.createElement(m.a.Title,null,n.a.createElement(da,null,this.props.title),this.props.edit&&E.user&&E.user.isAdmin?n.a.createElement("span",{className:"btn-link",onClick:this.props.edit}," ",n.a.createElement("i",{className:"fa fa-btn fa-edit"})):null)),n.a.createElement(m.a.Body,null,n.a.createElement(da,null,this.props.help)))}}]),t}(r.Component),ha=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={title:a.props.title,help:a.props.help,id:a.props.id,error:{}},a.save=function(){a.state.title===a.props.title&&a.state.help===a.props.help||k("/react_ajax/saveHelp",function(e){e.error?a.setState({error:e.data}):(E.data.help[a.props.title.toLowerCase().replace(/ /g,"_")]=e.data,a.props.close())},{title:a.state.title,text:a.state.help,id:a.state.id})},a.update=function(e,t){"title"===e?a.setState({title:t}):"help"===e&&a.setState({help:t})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return n.a.createElement(m.a,{show:!0,bsSize:"large",onHide:this.props.close},n.a.createElement(m.a.Header,{closeButton:!0},this.state.error.error?n.a.createElement("div",{className:"alert alert-danger"},n.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,n.a.createElement(m.a.Title,null,n.a.createElement(ia,{fields:{title:this.state.title},update:this.update}))),n.a.createElement(m.a.Body,null,n.a.createElement(ia,{fields:{help:this.state.help},update:this.update})),n.a.createElement(m.a.Footer,null,n.a.createElement(d.a,{onClick:this.save},"Save")))}}]),t}(r.Component),ma=a(185),da=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={help:""},a.close=function(){a.setState({help:""})},a.table=function(e,r){var s=0,l=0,o=e.split("\n").map(function(e){var r=e.split(",").map(function(e){return e.startsWith(" ")?n.a.createElement("th",{style:{textAlign:"center"},key:l++},n.a.createElement(t,{vars:a.props.vars},e.substring(1))):n.a.createElement("td",{style:{textAlign:"center"},key:l++},n.a.createElement(t,{vars:a.props.vars},e))});return n.a.createElement("tr",{key:s++},r)});return n.a.createElement("table",{className:"table table-condensed table-bordered table-striped",style:{width:"auto"},key:r},n.a.createElement("tbody",null,o))},a.help=function(e,t){a.setState({help:e}),t.currentTarget.blur()},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.children!==this.props.children||e.vars!==this.props.vars||t.help!==this.state.help}},{key:"render",value:function(){var e=this;if(!this.props.children)return null;var t=function(e,t,a){if(!e)return[];var r,n=[];O("maths")&&(r=Q(t)),t=t||{},a&&(t.auto=!0);for(var s,l={token:null,pos:0,vars:t,auto:a,text:e};null!==qt(l);)if(""!==l.token)if("object"===Object(ue.a)(l.token))n.push({chunk:l.token.text,error:l.token.error,type:"error"});else if(l.token.startsWith("\\("))Ct(n,l.token,"latex",l.vars);else if(l.token.startsWith("''")&&(s=Nt(l)))Ct(n,Ot(s),"maths");else if(l.token.startsWith("'"))Ct(n,At(l.token.substring(1)),"html");else if(l.token.startsWith("{xyz=")&&l.token.endsWith("}"))l.vars.xyz=l.token.substring(5,l.token.length-1);else if(l.token.endsWith(".png"))n.push({chunk:l.token,type:"png"});else if(l.token.startsWith("@")){var o=Mt(l.token.substring(1));Ct(n,o.name,"help"),""!==o.end&&Ct(n,o.end,"text")}else l.token.startsWith("[")&&l.token.endsWith("]")?Ct(n,l.token.substring(1,l.token.length-1),"table"):(s=Nt(l))?Ct(n,Ot(s),"maths"):Ct(n,At(l.token),"html");return O("maths")&&console.log("maths(text,vars,auto)=",Q(n),e,r,t,a),n}(this.props.children,this.props.vars,this.props.auto),a=0,r="",s=t.map(function(t){if("\n"===t.chunk)if(r.endsWith(">")||r.endsWith(" "))var s=null;else s=n.a.createElement("br",{key:a++});else s="latex"===t.type?n.a.createElement(fa,{key:a++},t.chunk):"error"===t.type?n.a.createElement("div",{key:a++},n.a.createElement("span",null,t.chunk),n.a.createElement("span",{className:"red"}," ",t.error)):"maths"===t.type?n.a.createElement(fa,{key:a++},t.chunk):"help"===t.type?n.a.createElement("span",{className:"btn-link",key:a++,onClick:function(a){return e.help(t.chunk,a)}},t.chunk.split("__")[0]):"table"===t.type?e.table(t.chunk,a++):"png"===t.type?n.a.createElement("img",{key:a++,alt:"figure",src:t.chunk,style:{maxWidth:"100%"}}):n.a.createElement("span",{key:a++,dangerouslySetInnerHTML:{__html:t.chunk}});return r="html"===t.type?t.chunk:"",s}),l=null;return""!==this.state.help&&(l=n.a.createElement(ua,{edit:this.props.edit,topic:this.state.help,close:this.close})),n.a.createElement("div",{style:{display:"inline"}},s,l)}}]),t}(r.Component),fa=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e;try{e=n.a.createElement("span",{className:"expression",dangerouslySetInnerHTML:{__html:ma.renderToString(this.props.children)}})}catch(t){e=n.a.createElement("div",null,n.a.createElement("span",null,this.props.children)),console.log("Latex",t.message)}return e}}]),t}(r.Component),va=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={message:a.props.text?a.props.text:"",name:"",email:"",maths:!1,error:{},to:"",from:"",sending:!1},a.error=function(e){return a.setState({error:e,sending:!1})},a.contact=function(e){var t=a.props.qkey?a.props.qkey:a.props.reply&&a.props.reply.qkey?a.props.reply.qkey:null,r=t?_(a.props.qkey,!0):null,n={email:a.state.email,name:a.state.name,maths:a.state.maths,message:a.state.message,from:a.state.from,to:a.state.to,qkey:t,question:r};a.setState({error:{},sending:!0}),E.contact(n,a.props.reply,a.props.close,a.error)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){if(this.props.reply)this.setState({message:this.props.reply.message,maths:this.props.reply.maths,to:this.props.reply.from,from:this.props.reply.to});else if(this.props.uid){var e=E.students[this.props.uid];e||console.error("Contact",this.props.uid,this.props.fm),this.setState({to:e||null})}}},{key:"render",value:function(){var e=this;return n.a.createElement(m.a,{name:"contact",bsSize:this.state.maths?"lg":null,show:!0,onHide:function(){return e.props.close()}},n.a.createElement(m.a.Header,{closeButton:!0},n.a.createElement(m.a.Title,null,this.props.reply?"Reply to ":"Contact ",this.state.to?this.state.to.name:"FreeMaths.uk")),n.a.createElement(m.a.Body,null,this.state.sending?n.a.createElement("div",{className:"alert alert-success"},n.a.createElement("strong",null,"Sending ...")):null,this.state.error.error?n.a.createElement("div",{className:"alert alert-danger"},n.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,n.a.createElement(Y.a,{onSubmit:this.contact,horizontal:!0},E.user||this.props.reply?null:n.a.createElement("div",null,n.a.createElement(Z.a,{controlId:"name",validationState:P(this.state.error.name)?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Name"),n.a.createElement(G.a,{sm:9},n.a.createElement(te.a,{type:"name",name:"name",value:this.state.name,placeholder:"First Last",onChange:function(t){return e.setState({name:t.target.value,error:{}})}})),P(this.state.error.name)?n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.name)):null),n.a.createElement(Z.a,{controlId:"email",validationState:P(this.state.error.email)?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Email"),n.a.createElement(G.a,{sm:9},n.a.createElement(te.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.setState({email:t.target.value,error:{}})}})),P(this.state.error.email)?n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.email)):null)),this.props.qkey?n.a.createElement(Z.a,null,n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Question"),n.a.createElement(G.a,{sm:9},_(this.props.qkey,!0))):null,this.state.maths?n.a.createElement(ga,{fm:this.props.fm,text:this.state.message,update:function(t){return e.setState({message:t})},close:function(){return e.setState({maths:!1})}}):n.a.createElement(Z.a,{controlId:"message",validationState:this.state.error.message?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:2},"Message"),n.a.createElement(G.a,{sm:9},n.a.createElement("textarea",{placeholder:"Your message",value:this.state.message,rows:8,style:{minWidth:"100%"},onChange:function(t){return e.setState({message:t.target.value,error:{}})}})),this.state.error.message?n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(ae.a,null,this.state.error.message)):null,n.a.createElement(G.a,{smOffset:2,sm:9},n.a.createElement(re.a,{checked:!1,onChange:function(t){return e.setState({maths:!0})}},"include maths?")))),n.a.createElement(m.a.Footer,null,n.a.createElement(d.a,{bsStyle:"primary",onClick:this.contact},n.a.createElement("i",{className:"fa fa-envelope-o"})," ",this.props.reply?"Reply":"Contact Us"))))}}]),t}(r.Component),ga=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={caret:null,text:a.props.text},a.update=function(e){var t=na(e.target.value,a.text.selectionStart);a.setState({text:t.text,caret:t.caret}),a.props.update(t.text)},a.key=function(e){e.preventDefault(),a.text.focus();var t=a.state.text,r=a.text.selectionStart,n=a.text.selectionEnd;r&&n||(r=n=0===r&&0===n?0:null!==a.state.caret?a.state.caret:t.length),t=t.substr(0,r)+e.target.value+t.substr(n,t.length-n),a.setState({text:t,caret:r+1}),a.props.update(t)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(){null!==this.state.caret&&this.text.setSelectionRange(this.state.caret,this.state.caret)}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("div",{className:"EditField row"},n.a.createElement("div",{className:"col-sm-6"},n.a.createElement(da,{auto:!0},this.state.text)),n.a.createElement("div",{className:"col-sm-6"},n.a.createElement("textarea",{ref:function(t){e.text=t},style:{minWidth:"100%"},placeholder:"Message",value:this.state.text,rows:8,onChange:this.update}))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-6"},n.a.createElement(re.a,{checked:!0,onChange:this.props.close}," maths? ",n.a.createElement("span",{className:"btn-link",onClick:function(t){t.preventDefault(),e.props.fm.setState({help:"typing_maths"})}},"(help)"))),n.a.createElement("div",{className:"col-sm-6"},Object.keys(De).map(function(t){return n.a.createElement(T,{key:t,tooltip:De[t]},n.a.createElement(d.a,{onClick:e.key,value:t,bsSize:"small"},t))}))))}}]),t}(r.Component),ba=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={message:null,error:{},reply:!1},a.message=function(e){return a.setState({message:e})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){E.mail(this.props.token,this.message,this.props.close)}},{key:"render",value:function(){var e=this;return null===this.state.message?null:this.state.reply?n.a.createElement(va,{fm:this.props.fm,reply:this.state.message,close:function(t){return e.props.close(t)}}):n.a.createElement(m.a,{show:!0,name:"mail",onHide:function(){return e.props.close()}},n.a.createElement(m.a.Header,{closeButton:!0},n.a.createElement(m.a.Title,null,"Message from ",this.state.message.from.name,this.state.message.qkey?n.a.createElement("div",null,"Question: "+_(this.state.message.qkey,!0)):null)),n.a.createElement(m.a.Body,null,this.state.error.error?n.a.createElement("div",{className:"alert alert-danger"},n.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,this.state.message.maths?n.a.createElement(da,{auto:!0},this.state.message.message):n.a.createElement("div",null,this.state.message.message)),n.a.createElement(m.a.Footer,null,n.a.createElement(d.a,{bsStyle:"primary",onClick:function(){return e.setState({reply:!0})}},n.a.createElement("i",{className:"fa fa-envelope-o"})," Reply")))}}]),t}(r.Component),ka=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={list:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"tests",value:function(e){var t=null;return e.tests&&(t=Object.keys(e.tests).map(function(t){return E.data.tests.tests[t].title+" Q"+e.tests[t]})),t}},{key:"render",value:function(){var e=this,t=E.data.tests;if(this.state.list){var a=Object.keys(this.props.tree.topics).map(function(a){return Object.keys(e.props.tree.topics[a]).map(function(r){return e.props.tree.topics[a][r].map(function(a){var r=t.questions[a];return n.a.createElement("div",{key:r.id},n.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setQ(r.id,!1)}},r.id)," ",n.a.createElement(da,null,r.topic)," ",n.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setQ(r.id,!0)}},"[",r.topics,"]")," ",e.tests(r))})})}),r=Object.keys(t.questions).map(function(a){var r=t.questions[a];return r.topics?null:n.a.createElement("div",{key:r.id},n.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setQ(r.id,!1)}},r.id)," ",n.a.createElement(da,null,r.topic)," ",n.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setQ(r.id,!0)}},"[",r.topics,"]")," ",e.tests(r))});return n.a.createElement("div",null,n.a.createElement(W,{className:"btn btn-primary",tooltip:"Hide Questions",onClick:function(){return e.setState({list:!1})}},"Hide"),a,r)}return n.a.createElement("button",{className:"btn btn-link",style:{float:"right"}},n.a.createElement("i",{className:"fa fa-btn fa-edit",onClick:function(){return e.setState({list:!0})}}))}}]),t}(r.Component);function Ea(e,t){return""===e&&""===t?"":(""===e?0:1*e)+(""===t?0:1*t)}function ya(e,t,a,r){P(e[r].c)||(e[r].c=[]),e[r].c.push.apply(e[r].c,t.c[a])}function Oa(e,t,a,r,n,s){if(P(e[a])||(e[a]={"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:0,effort:0,r:[]}),a===r)[":(",":|",":)","\u2717","?\u2713","\u2713"].forEach(function(s){P(t[s][n])&&t[s][n].forEach(function(l){return e[a][s].push({uid:n,key:r,ts:l.ts,a:l.a,v:l.v,l:s===t.l[n].m||s===t.l[n].f})})}),n===s?t.rs[n].forEach(function(s){return e[a].r.push({uid:n,key:r,mk:s.mk,mks:t.mks,ts:s.ts})}):e[a].r.push({uid:n,key:r,mk:t.l[n].mk,mks:t.mks,ts:t.l[n].ts});else{if(""!==t.l[n].m){var l=t[t.l[n].m][n][t[t.l[n].m][n].length-1];e[a][t.l[n].m].push({uid:n,key:r,ts:l.ts,a:l.a,v:l.v})}if(""!==t.l[n].f){var o=t[t.l[n].f][n][t[t.l[n].f][n].length-1];e[a][t.l[n].f].push({uid:n,key:r,ts:o.ts,a:o.a,v:o.v})}}""!==t.l[n].mk&&(e[a].mks+=t.mks),e[a].mk=Ea(e[a].mk,t.l[n].mk),e[a].qs++,t.l[n].ts>e[a].ts&&(e[a].ts=t.l[n].ts),e[a].uid=n}function ja(e,t,a,r){P(e.l[r])||(e.l[r]={"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:0,effort:0}),""!==t.l[r].m&&e.l[r][t.l[r].m].push({key:a,ts:t[t.l[r].m][r][t[t.l[r].m][r].length-1].ts}),""!==t.l[r].f&&e.l[r][t.l[r].f].push({key:a,ts:t[t.l[r].f][r][t[t.l[r].f][r].length-1].ts}),""!==t.l[r].mk&&(e.l[r].mks+=t.mks),e.l[r].mk=Ea(e.l[r].mk,t.l[r].mk),t.l[r].ts>e.l[r].ts&&(e.l[r].ts=t.l[r].ts),e.l[r].qs++}function wa(e,t,a){var r="0"===t.paper?{qs:[{id:t.q}]}:a.data.tests.tests[t.paper];0!==t.paper&&(P(e.ts[t.paper])||(e.ts[t.paper]={rs:{},qs:{},l:{},c:{}}),P(e.uids[t.user_id])?0===e.uids[t.user_id].p&&(e.uids[t.user_id].p=t.paper,e.uids[t.user_id].ts=e.uids[t.user_id].ts1=t.ts):e.uids[t.user_id]={p:t.paper,ts1:t.ts,ts:t.ts,l:{},c:{}});var n=e.uids[t.user_id];if(P(n)&&(t.ts-n.ts>36e5||t.paper!==n.p)){var s={"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:0,effort:0};Object.keys(r.qs).forEach(function(a){var r=n.p+":::"+a.id,l=e.ts[n.p].qs[r];P(l)&&P(l.xl[t.user_id])&&(0===s.ts&&(s.ts=l.xl[t.user_id].ts,s.effort=l.xl[t.user_id].ts-n.ts1),""!==l.xl[t.user_id].m&&s[l.xl[t.user_id].m].push({key:r,ts:l[l.xl[t.user_id].m].ts}),""!==l.xl[t.user_id].f&&s[l.xl[t.user_id].f].push({key:r,ts:l[l.xl[t.user_id].f].ts}),s.mks++,s.qs++,s.mk=Ea(s.mk,l.xl[t.user_id].mk),l.xl[t.user_id]=null)}),P(e.ts[n.p].rs[t.user_id])||(e.ts[n.p].rs[t.user_id]=[]),0!==n.p&&e.ts[n.p].rs[t.user_id].push(s),e.uids[t.user_id].p=t.paper,e.uids[t.user_id].ts=e.uids[t.user_id].ts1=t.ts}if(0!==t.paper&&("\u2713"===t.event||"\u2717"===t.event||"?\u2713"===t.event||":("===t.event||":|"===t.event||":)"===t.event)){var l=t.paper+":::"+t.q;P(e.ts[t.paper].qs[l])||(e.ts[t.paper].qs[l]={mks:1,l:{},xl:{},c:{},rs:{},"\u2717":{},":(":{},"?\u2713":{},":|":{},"\u2713":{},":)":{}});var o=e.ts[t.paper].qs[l];P(o.l[t.user_id])||(o.l[t.user_id]={m:"",f:"",ts:t.ts,mk:0},o.rs[t.user_id]=[]),P(o.xl[t.user_id])||(o.xl[t.user_id]={m:"",f:"",ts:t.ts,mk:0}),P(o[t.event][t.user_id])||(o[t.event][t.user_id]=[]),"\u2713"===t.event||"\u2717"===t.event||"?\u2713"===t.event?(o.l[t.user_id].m=o.xl[t.user_id].m=t.event,o[t.event][t.user_id].push({ts:t.ts,a:t.answer,v:t.variables}),"\u2713"===t.event?o.l[t.user_id].mk=o.xl[t.user_id].mk=1:o.l[t.user_id].mk=o.xl[t.user_id].mk=0,o.rs[t.user_id].push({ts:t.ts,mk:o.xl[t.user_id].mk})):":("!==t.event&&":|"!==t.event&&":)"!==t.event||(o.l[t.user_id].f=o.xl[t.user_id].f=t.event,o[t.event][t.user_id].push({ts:t.ts}),t.comment.length>0&&(P(o.c[t.user_id])||(o.c[t.user_id]=[]),o.c[t.user_id].push({key:l,uid:t.user_id,c:t.comment,f:t.event,ts:t.ts}))),o.l[t.user_id].ts=o.xl[t.user_id].ts=e.uids[t.user_id].ts=t.ts}}function xa(e,t){var a=t?E.log:E.user.log;if(!a)return null;if(e){if(0===a.length||e.last===a[a.length-1].id)return e}else e={users:{},log:a,uids:{},ts:{}};return t?Object.keys(E.students).forEach(function(t){e.users[t]||(e.users[t]={name:E.students[t].name,log:[]})}):e.users[E.user.id]||(e.users[E.user.id]={log:[]}),a.forEach(function(t){if(1*t.user_id!==0&&!(e.last&&t.id<=e.last&&e.users[t.user_id].log.length>0)){t.ts=new Date(t.created_at.replace(" ","T")).getTime();var a=t.paper?t.paper.split(":")[0]:"0";"0"===t.paper||E.data.tests.tests[a]?(t.q=t.question,wa(e,t,E)):"\u2713\u2717"===t.event&&function(e,t){P(e.ts[t.paper])||(e.ts[t.paper]={rs:{},qs:{},l:{},c:{}}),P(e.uids[t.user_id])||(e.uids[t.user_id]={p:0,l:{}});var a=JSON.parse(t.variables),r={"":[],"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:t.ts,effort:a.effort};a.marks.forEach(function(a){if(P(a)){var n=t.paper.indexOf(":")>0?t.paper+":"+a.q:t.paper+":::"+a.q;P(e.ts[t.paper].qs[n])||(e.ts[t.paper].qs[n]={mks:1*a.mks,l:{},xl:{},c:{},rs:{},"":{},"\u2717":{},":(":{},"?\u2713":{},":|":{},"\u2713":{},":)":{}});var s=e.ts[t.paper].qs[n];P(s.l[t.user_id])||(s.l[t.user_id]={m:"",f:"",ts:0,mk:0},s.rs[t.user_id]=[]),s.l[t.user_id].ts=t.ts,s.l[t.user_id].mk=a.mk,s.rs[t.user_id].push({ts:t.ts,mk:a.mk}),""!==a.mk&&(r.mks+=1*a.mks),r.mk=Ea(r.mk,a.mk),r.qs++,s.l[t.user_id].f=a.f,P(s[a.f][t.user_id])||(s[a.f][t.user_id]=[]),s[a.f][t.user_id].push({ts:t.ts}),r[a.f].push({key:n,ts:t.ts}),s.l[t.user_id].m=a.m,P(s[a.m][t.user_id])||(s[a.m][t.user_id]=[]),s[a.m][t.user_id].push({ts:t.ts,a:t.answer}),r[a.m].push({key:n,ts:t.ts}),P(a.c)&&a.c.length>0&&(P(s.c[t.user_id])||(s.c[t.user_id]=[]),s.c[t.user_id].push({key:n,uid:t.user_id,c:a.c,f:a.f,ts:t.ts}))}}),P(e.ts[t.paper].rs[t.user_id])||(e.ts[t.paper].rs[t.user_id]=[]),e.ts[t.paper].rs[t.user_id].push(r)}(e,t),e.users[t.user_id].log.unshift(t),e.last=t.id}}),Object.keys(e.uids).forEach(function(t){0!==e.uids[t].p&&wa(e,{user_id:t,event:"",paper:"0"},e.uids[t].ts)},E),function(e){Object.keys(e.uids).forEach(function(t){return e.uids[t].l={}}),Object.keys(e.ts).forEach(function(t){e.ts[t].l={},Object.keys(e.ts[t].qs).forEach(function(a){Object.keys(e.ts[t].qs[a].l).forEach(function(r){var n=e.ts[t].qs[a];ja(e.ts[t],n,a,r),ja(e.uids[r],n,a,r)})})})}(e),e}function qa(e,t,a){return a?t.ts-e.ts:t[":("].length-e[":("].length!==0?t[":("].length-e[":("].length:t[":|"].length-e[":|"].length!==0?t[":|"].length-e[":|"].length:t["\u2717"].length-e["\u2717"].length!==0?t["\u2717"].length-e["\u2717"].length:t["?\u2713"].length-e["?\u2713"].length!==0?t["?\u2713"].length-e["?\u2713"].length:t.mks-e.mks-(t.mk-e.mk)}function Sa(e){return 0===e.length||P(e[0].l)&&!e[0].l?0:e.length}var Ca=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return"book"===this.props.type?n.a.createElement(ur,{stats:this.props.stats,set:this.props.setTopic,pkey:this.props.pkey}):n.a.createElement("div",null,n.a.createElement("h3",{className:"inline"},"Subject: ")," ",n.a.createElement(Na,{type:this.props.type,topic:this.props.topic,setTopic:this.props.setTopic}),this.props.topic&&"0"!==this.props.topic?n.a.createElement(Ja,{type:this.props.type,topic:this.props.topic,stats:this.props.stats,update:this.props.update}):null)}}]),t}(r.Component),Na=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=[n.a.createElement("option",{key:0,value:"0"},"select")];return["GCSE(9-1)","IGCSE","P1","SM1","C1","C2","C3","C4","FP1","FP2","FP3","D1","D2","S1","S2","S3","S4","M1","M2","M3","M4","M5"].forEach(function(e){t.push(n.a.createElement("option",{key:e},e))}),n.a.createElement("form",{className:"form-horizontal inline"},n.a.createElement("select",{className:"form-control inline",style:{width:"auto"},value:this.props.topic,onChange:function(t){return e.props.setTopic(t.target.value)}},t))}}]),t}(r.Component),_a=Ca,Aa=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={uid:null,pkey:null,topic:"0",students:null,stats:null,test:null,edit:!1,s:null,q:null,cs:null,log:null,all:E.user.isAdmin},a.toggleAll=function(){a.props.fm.getStudents(!a.state.all),a.setState({all:!a.state.all})},a.setTest=function(e,t){a.setState({test:e.toString(),edit:t})},a.setPaper=function(e){var t=e.split(":"),r=Object(h.a)(t,4),n=r[0],s=r[1],l=r[2];P(r[3])&&(e=""!==l?n+":"+s+":"+l:n),P(N(n))&&e===a.state.pkey?a.props.students?a.setState({pkey:null,test:null}):a.setState({test:e}):a.setState({pkey:e,topic:"0"})},a.setQ=function(e){a.setState({test:e})},a.setS=function(e,t){t?a.setState({cs:e}):null!==a.state.s?a.setState({s:null}):z(e)||a.setState({s:e})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.students&&!E.students?E.getStudents(this.state.all):e.students?this.setState({students:xa(null,e.students)}):this.setState({stats:xa(null,e.students)}),e.type!==this.props.type&&this.setState({pkey:null,topic:"0"})}},{key:"componentWillMount",value:function(){this.props.students&&!E.students?E.getStudents(this.state.all):this.props.students?this.setState({students:xa(null,this.props.students)}):this.setState({stats:xa(null,this.props.students)})}},{key:"render",value:function(){var e=this,t=null,a=this.props.students?this.state.students:this.state.stats;if(!a)return n.a.createElement("div",{className:"blue"},"loading...");if(null!==this.state.test){var r=N(this.state.test);"past"===r.type||"book"===r.type?t=n.a.createElement(Ka,{user:this.props.user,stats:a,test:this.state.test,close:function(){return e.setState({pkey:null,test:null})}}):"vars"===r.type&&console.error("Students type vars")}return a=function(e,t,a,r,n){return e.t={qs:{},ts:{},uids:{},corrections:{}},Object.keys(e.ts).filter(function(e){return!P(r)||N(e).type===r}).forEach(function(r){(null===a||"0"===a||a===r.substr(0,a.length)||_(r).startsWith(a))&&(Object.keys(e.ts[r].qs).forEach(function(a){Object.keys(e.ts[r].qs[a].l).forEach(function(n){if(n===t||null===t){var s=e.ts[r].qs[a];Oa(e.t.qs,s,a,a,n,t),Oa(e.t.ts,s,r,a,n),Oa(e.t.uids,s,n,a,n),ya(e.t.uids,s,n,n),ya(e.t.ts,s,n,r),ya(e.t.qs,s,n,a)}})}),Object.keys(e.ts[r].l).forEach(function(a){if(a===t||null===t){var n=e.ts[r].l[a];P(e.t.uids[a].r)||(e.t.uids[a].r=[]),e.t.uids[a].r.push({uid:a,key:r,mk:n.mk,mks:n.mks,ts:n.ts}),P(e.t.ts[r].r)||(e.t.ts[r].r=[]),null===t?e.t.ts[r].r.push({uid:a,key:r,mk:n.mk,mks:n.mks,ts:n.ts}):e.ts[r].rs[t].forEach(function(t){t.ts>0&&e.t.ts[r].r.push({uid:a,key:r,mk:t.mk,mks:t.mks,ts:t.ts})})}}))}),e.uid=1===Object.keys(e.t.uids).length?Object.keys(e.t.uids)[0]:"0",Object.keys(e.t.uids).forEach(function(t){return["\u2717","?\u2713",":(",":|"].forEach(function(a){e.t.uids[t][a].forEach(function(t){P(e.t.corrections[t.key])||(e.t.corrections[t.key]=t)})})}),0===Object.keys(e.t.corrections).length&&(e.t.corrections=null),e}(a,this.props.students?this.state.uid:E.user.id.toString(),this.state.pkey,this.props.type),n.a.createElement("div",null,E.user.isAdmin&&this.props.students?n.a.createElement("button",{className:"btn btn-link",style:{float:"right"}},n.a.createElement("i",{className:"fa fa-btn fa-users",onClick:this.toggleAll})):null,a.t.corrections?n.a.createElement(W,{className:"btn btn-danger",tooltip:"Correct first",onClick:function(){return e.setS((t=a.t.corrections,Object.keys(t).map(function(e){return t[e]})));var t}},"Corrections"):null,this.props.students?null:n.a.createElement(_a,{type:this.props.type,topic:this.state.topic,pkey:this.state.pkey,setTest:this.setTest,setTopic:function(t){return e.setState({pkey:t,topic:t||"0"})},stats:a}),n.a.createElement(Ma,{fm:this.props.fm,students:this.props.students,stats:a,uid:this.state.uid,p:this.state.pkey,setUid:function(t){return e.setState({uid:t===e.state.uid?null:t})},setS:this.setS}),n.a.createElement(Ta,{type:this.props.type,students:this.props.students,stats:a,uid:this.state.uid,p:this.state.pkey,setPaper:this.setPaper,setS:this.setS}),n.a.createElement(Wa,{type:this.props.type,students:this.props.students,setQ:this.setQ,stats:a,uid:this.state.uid,p:this.state.pkey,setPaper:this.setPaper,setS:this.setS}),n.a.createElement(Dr,{s:this.state.s,stats:a,setS:this.setS}),n.a.createElement(Hr,{cs:this.state.cs,stats:a,setS:this.setS}),t)}}]),t}(r.Component),Ma=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={byDate:!0},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=[];return Object.keys(this.props.stats.t.uids).sort(function(t,a){return qa(e.props.stats.t.uids[t],e.props.stats.t.uids[a],e.state.byDate)}).forEach(function(a){var r=Sr(e.props.stats.t.uids[a],e.props.stats,!0,e.props.setS);e.props.students&&r.unshift(n.a.createElement("td",{key:"name"},n.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setUid(a)}},e.props.stats.users[a].name))),t.push(n.a.createElement("tr",{key:a},r))}),0===t.length&&(t=n.a.createElement("tr",null,n.a.createElement("td",{colSpan:this.props.students?9:8,className:"blue",style:{textAlign:"center"}},"No student activity to show yet."))),n.a.createElement("div",{name:"StudentSummary"},n.a.createElement("h3",null,"Summary"),this.props.students?n.a.createElement(_r,{setUid:this.props.setUid,uid:this.props.uid,stats:this.props.stats}):null,n.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},n.a.createElement("thead",null,n.a.createElement("tr",null,this.props.students?n.a.createElement("th",{style:{textAlign:"center"}},n.a.createElement(Pa,{fm:this.props.fm,uid:this.props.uid})):null,qr(),n.a.createElement("th",null,"marks"),n.a.createElement("th",{onClick:function(){return e.setState({byDate:!e.state.byDate})}},n.a.createElement("i",{className:"fa fa-file-o","aria-hidden":"true"})),n.a.createElement("th",null,n.a.createElement("i",{className:"fa fa-comments","aria-hidden":"true"})))),n.a.createElement("tbody",null,t)))}}]),t}(r.Component),Ta=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={byDate:!0},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=[];return Object.keys(this.props.stats.t.ts).sort(function(t,a){return qa(e.props.stats.t.ts[t],e.props.stats.t.ts[a],e.state.byDate)}).forEach(function(a){var r=N(a),s=Sr(e.props.stats.t.ts[a],e.props.stats,!e.props.students,e.props.setS);t.push(n.a.createElement("tr",{key:a},n.a.createElement("td",null,n.a.createElement("span",{className:"btn-link",onClick:e.props.setPaper.bind(e,a)},_(a,!1,!1,!0))," ",Ba(r)),s))}),n.a.createElement("div",null,n.a.createElement("h3",null,"past"===this.props.type?"Past Paper":"book"===this.props.type?"Exercise":"Test"," Analysis"),n.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,n.a.createElement(Qa,{type:this.props.type,p:this.props.p,stats:this.props.stats,setPaper:this.props.setPaper})),qr(),n.a.createElement("th",null,"marks"),"0"===this.props.stats.uid?n.a.createElement("th",null,n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({byDate:!e.state.byDate})}},n.a.createElement("i",{className:"fa fa-user","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"user"))):n.a.createElement("th",null,n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({byDate:!e.state.byDate})}},n.a.createElement("i",{className:"fa fa-calendar-o","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"date"))),n.a.createElement("th",null,n.a.createElement("i",{className:"fa fa-comments","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"comments")))),n.a.createElement("tbody",null,t)))}}]),t}(r.Component);var Wa=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={qSort:!1,detail:null},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"qn",value:function(e,t,a){var r=this;if("vars"===e.type){var s=n.a.createElement("span",{className:"btn-link",onClick:function(){return r.props.setQ(a)}},t?t.q:a);P(e.test)&&(s=n.a.createElement(T,{tooltip:n.a.createElement(da,null,t.topic.split(",")[0])},s))}else s=t?Ba(e,t,t.q):a;return s}},{key:"render",value:function(){var e=this,t=[];return Object.keys(this.props.stats.t.qs).sort(function(t,a){return function(e,t,a,r){if(r)return e.localeCompare(t,void 0,{numeric:!0});var n=a[t],s=a[e];return Sa(n[":("])-Sa(s[":("])!==0?Sa(n[":("])-Sa(s[":("]):Sa(n[":|"])-Sa(s[":|"])!==0?Sa(n[":|"])-Sa(s[":|"]):Sa(n["\u2717"])-Sa(s["\u2717"])!==0?Sa(n["\u2717"])-Sa(s["\u2717"]):Sa(n["?\u2713"])-Sa(s["?\u2713"])!==0?Sa(n["?\u2713"])-Sa(s["?\u2713"]):n.mks-s.mks-(n.mk-s.mk)}(t,a,e.props.stats.t.qs,e.state.qSort)}).splice(0,50).forEach(function(a){var r=a.split(":")[0],s=e.props.stats.t.qs[a],l=N(r),o=function(e,t){var a=e.split(":"),r=Object(h.a)(a,4),n=r[0],s=r[1],l=r[2],o=r[3];if("0"===n)return{q:o};var i=N(n),c={q:e};return l?c=i.qmap.qs&&i.qmap.qs[s]&&i.qmap.qs[s][l]&&i.qmap.q[s][l][o]?i.qmap.qs[s][l][i.qmap.q[s][l][o]]:{q:e}:i.qs[o]&&(c=i.qs[o]),c.q&&(c.q=o),c}(a,e.props.stats);t.push(n.a.createElement("tr",{key:a},n.a.createElement("td",null,n.a.createElement("span",{className:"btn-link",onClick:e.props.setPaper.bind(e,a)},_(a,!0))),n.a.createElement("td",null,e.qn(l,o,a)),Sr(s,e.props.stats,!e.props.students,e.props.setS)))}),n.a.createElement("div",null,n.a.createElement("h3",null,"Question Analysis"),n.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,n.a.createElement(Qa,{type:this.props.type,p:this.props.p,stats:this.props.stats,setPaper:this.props.setPaper})),n.a.createElement("th",null,n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({qSort:!e.state.qSort})}},"Q")),qr(),n.a.createElement("th",null,"marks"),"0"===this.props.stats.uid?n.a.createElement("th",null,n.a.createElement("i",{className:"fa fa-user","aria-hidden":"true"})):n.a.createElement("th",null,n.a.createElement("i",{className:"fa fa-calendar-o","aria-hidden":"true"})),n.a.createElement("th",null,n.a.createElement("i",{className:"fa fa-comments","aria-hidden":"true"})))),n.a.createElement("tbody",null,t)),this.state.detail)}}]),t}(r.Component),Qa=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(!P(this.props.stats))return null;var t={},a=Object.keys(this.props.stats.ts).filter(function(t){return!e.props.type||N(t).type===e.props.type}).map(function(e){return{id:e,title:_(e)}}).sort(function(e,t){return e.title.localeCompare(t.title)}),r=[n.a.createElement("option",{key:"sel",value:0},"select")];return a.forEach(function(e){var a=e.title.split(" ");a.length>1&&!P(t[a[0]])&&(t[a[0]]=a[0],r.push(n.a.createElement("option",{key:a[0],value:a[0]},a[0])))}),r=r.concat(a.map(function(e){return n.a.createElement("option",{key:e.id,value:e.id},_(e.title))})),n.a.createElement("select",{value:null===this.props.p?0:this.props.p,onChange:function(t){return e.props.setPaper(t.target.value)}},r)}}]),t}(r.Component),Pa=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return this.props.uid&&E.user.isAdmin&&E.students&&E.students[this.props.uid]?n.a.createElement("span",null,n.a.createElement("span",{className:"btn-link",onClick:function(){return E.setUser(e.props.uid)}},n.a.createElement("i",{className:"fa fa-group"}))," ",n.a.createElement(Pr,{uid:this.props.uid})):null}}]),t}(r.Component),za=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={paper:a.setPaper(a.props.test),type:null,error:{},q:null},a.update=function(e,t){var r=a.state.paper;r[e]=t,a.setState({paper:r})},a.update=function(e,t){var r=a.state.paper;r.questions[a.state.q][e]=t,a.setState({paper:r})},a.working=function(){var e=a.state.paper.questions[a.state.q],t={};return["topic","question","answer","help","working"].forEach(function(a){t[a]=e[a]?e[a]:""}),t},a.updateQ=function(e,t,r){if("ans"===a.state.type)console.log("updateQ",e),a.setState({q:e});else{var n=a.state.paper.questions;"undefined"===typeof n[e]&&(n[e]={q:"",marks:""}),n[e][t]=r;for(var s=0,l=0;l<e;l++)z(n[l][t])||(s=1*n[l][t]);if(l=e-1,1*r>=s)for(;l>=0&&z(n[l][t]);)n[l--][t]=r;var o=a.state.paper;o.questions=n,a.setState({paper:o})}},a.save=function(){k("/react_ajax/past",function(e){e.error?a.setState({error:e.data}):(a.state.paper.id=e.data.id,a.setState({paper:a.state.paper}),console.log("past",e.data.id))},{test:a.state.paper})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"setPaper",value:function(e){if(!e)return{id:"",name:"",board:"",month:"",year:"",title:"",QP:"",MS:"",ER:"",questions:[]};var t=e.test;return t.title=e.title,t.id=e.id,t.questions=e.test.questions,t}},{key:"render",value:function(){var e=this,t=[],a=0,r=0;for(r=0;r<this.state.paper.questions.length;r++){var s=this.state.paper.questions[r];"edit"===this.state.type?t.push(n.a.createElement(Da,{key:r,i:r,update:this.updateQ,q:s||{q:"",marks:""}})):t.push(n.a.createElement(Fa,{key:r,i:r,update:this.updateQ,type:this.state.type,q:s})),"undefined"!==typeof s&&(a+=1*s.marks)}return"edit"===this.state.type&&t.push(n.a.createElement(Da,{key:r,i:r,update:this.updateQ,q:{q:"",marks:""}})),n.a.createElement(m.a,{show:!0,onHide:this.props.close,bsSize:"ans"===this.state.type?"lg":null},n.a.createElement(m.a.Header,{closeButton:!0},n.a.createElement(m.a.Title,null,this.state.paper.title.replace(/_/g," "))),n.a.createElement(m.a.Body,null,this.state.error.error?n.a.createElement("div",{className:"alert alert-danger"},n.a.createElement("strong",null,"Error: ",this.state.error.error)):null,n.a.createElement("input",{type:"text",size:"10",placeholder:"Name",value:this.state.paper.name,onChange:function(t){return e.update("name",t.target.value)}}),n.a.createElement("input",{size:"5",type:"text",placeholder:"Board",value:this.state.paper.board,onChange:function(t){return e.update("board",t.target.value)}}),n.a.createElement("input",{size:"5",type:"text",placeholder:"Month",value:this.state.paper.month,onChange:function(t){return e.update("month",t.target.value)}}),n.a.createElement("input",{size:"5",type:"text",placeholder:"Year",value:this.state.paper.year,onChange:function(t){return e.update("year",t.target.value)}}),n.a.createElement("br",null),n.a.createElement("input",{style:{width:"90%"},type:"text",placeholder:"Paper",value:this.state.paper.QP,onChange:function(t){return e.update("QP",t.target.value)}}),n.a.createElement("br",null),n.a.createElement("input",{style:{width:"90%"},type:"text",placeholder:"Mark Scheme",value:this.state.paper.MS,onChange:function(t){return e.update("MS",t.target.value)}}),n.a.createElement("br",null),n.a.createElement("input",{style:{width:"90%"},placeholder:"Examiners Report",value:this.state.paper.ER,onChange:function(t){return e.update("ER",t.target.value)}}),n.a.createElement("br",null),n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({type:"edit"})}},"Questions & Marks"),n.a.createElement("br",null),n.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.setState({type:"qp"})},href:this.state.paper.QP},"question paper"),"\xa0",n.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.setState({type:"ms"})},href:this.state.paper.MS},"mark scheme"),"\xa0",n.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.setState({type:"er"})},href:this.state.paper.ER},"examiners report"),n.a.createElement("br",null),Ba(this.state.paper)," ",La(this.state.paper)," ",n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({type:"ans"})}},"working"),n.a.createElement("br",null),"qp"===this.state.type?n.a.createElement("input",{type:"text",placeholder:"Extra Pages",value:this.state.paper.qpx?this.state.paper.qpx:"",onChange:function(t){return e.update("qpx",t.target.value)}}):null,n.a.createElement(V.a,null,n.a.createElement(G.a,{sm:3},n.a.createElement("table",{className:"table table-bordered table-condensed table-striped",style:{width:"auto"}},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Q"),n.a.createElement("th",null,this.state.type))),n.a.createElement("tbody",null,t),n.a.createElement("tfoot",null,n.a.createElement("tr",null,n.a.createElement("th",null,"total"),n.a.createElement("th",null,a))))),"ans"===this.state.type?n.a.createElement(G.a,{sm:9},null!==this.state.q?n.a.createElement("div",null,n.a.createElement("h3",null,"Question ",this.state.paper.questions[this.state.q].q),n.a.createElement(ia,{auto:!0,fields:this.working(),update:this.update})):null):null)),n.a.createElement(m.a.Footer,null,n.a.createElement(d.a,{onClick:this.save},"Save")))}}]),t}(r.Component),Da=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("tr",null,n.a.createElement("td",null,n.a.createElement("input",{size:"4",type:"text",value:this.props.q.q,placeholder:"1a",onChange:function(t){return e.props.update(e.props.i,"q",t.target.value)}})),n.a.createElement("td",null,n.a.createElement("input",{style:{width:"3em"},type:"number",placeholder:"0",value:this.props.q.marks,onChange:function(t){return e.props.update(e.props.i,"marks",t.target.value)}})))}}]),t}(r.Component),Fa=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return this.props.type?n.a.createElement("tr",null,n.a.createElement("td",null,this.props.q.q),"ans"===this.props.type?n.a.createElement("td",null,n.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.update(e.props.i,e.props.type)}},"edit")):n.a.createElement("td",null,n.a.createElement("input",{style:{width:"3em"},type:"number",placeholder:"0",value:this.props.q[this.props.type]?this.props.q[this.props.type]:"",onChange:function(t){return e.props.update(e.props.i,e.props.type,t.target.value)}}))):null}}]),t}(r.Component),Ha=za;function Ba(e,t,a){if(P(t)&&z(t.qp))return a||"";P(e.test)&&(e=e.test);var r=P(t)&&!z(t.qp)?e.QP.split("#")[0]+"#page="+t.qp:e.QP;return P(e)&&!z(e.QP)?P(a)?n.a.createElement("a",{className:"btn-link",target:"_blank",rel:"noopener noreferrer",href:r+Ia(e)},n.a.createElement(T,{tooltip:"question paper"},a)):n.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:r+Ia(e)},n.a.createElement(T,{tooltip:"question paper"},n.a.createElement("i",{style:{fontSize:M()},className:"fa fa-question-circle"}))):""}function La(e,t,a){if(P(t)&&z(t.ms))return P(a)?a:"";P(e.test)&&(e=e.test);var r=P(t)&&!z(t.ms)?e.MS.split("#")[0]+"#page="+t.ms:e.MS;return P(e)&&!z(e.MS)?P(a)?n.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:r},n.a.createElement(T,{tooltip:"mark scheme"},a)):n.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:r},n.a.createElement(T,{tooltip:"mark scheme"},n.a.createElement("i",{style:{fontSize:M()},className:"fa fa-check-circle"}))):""}function Ra(e,t){if(P(t)&&z(t.er))return"";P(e.test)&&(e=e.test);var a=P(t)&&!z(t.er)?e.ER.split("#")[0]+"#page="+t.er:e.ER;return P(e)&&!z(e.ER)?n.a.createElement("a",{rel:"noopener noreferrer",target:"_blank",href:a},n.a.createElement(T,{tooltip:"examiners report"},n.a.createElement("i",{style:{fontSize:M()},className:"fa fa-info-circle"}))):""}function Ia(e){if(!P(e.qpx))return"";for(var t=e.questions.map(function(e){return e.qp}),a=e.qpx.split(","),r=0,n=0,s=0,l=[];r<t.length&&n<a.length;)1*t[r]>1*a[n]?1*a[n]>s?(s=1*a[n],l.push(a[n++])):n++:1*t[r]>s?(s=1*t[r],l.push(t[r++])):r++;for(;r<t.length;)1*t[r]>s?(s=1*t[r],l.push(t[r++])):r++;for(;n<a.length;)1*a[n]>s?(s=1*a[n],l.push(a[n++])):n++;return"#"+l.join(",")}function Ua(e,t){var a=t.t.ts[e];return P(a)&&P(a.r)&&a.r.length>0?n.a.createElement(T,{placement:"bottom",tooltip:wr(a.r,t,!0)},n.a.createElement("span",{className:yr(a.mk,a.mks)},_(e),"(",a.mk,"/",a.mks,")")):P(t.ts[e])&&P(t.ts[e].rs)&&P(t.ts[e].rs[E.user.id])&&P(t.ts[e].rs[E.user.id][0])?n.a.createElement(T,{placement:"bottom",tooltip:B(t.ts[e].rs[E.user.id][0].ts)},n.a.createElement("span",{className:"green"},_(e,t)," (0/0)")):_(e)}var Ja=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={test:null,mark:!1,bar:!1,edit:!1},a.links=function(e){var t=N(e);if(!t||"past"!==t.type)return null;var r=E.user.isAdmin?n.a.createElement(T,{tooltip:e},n.a.createElement("span",{className:"btn-link",onClick:function(){return a.setState({test:e,edit:!0})}},n.a.createElement("i",{className:t.test.questions.length&&t.test.questions[0].qp?"fa fa-edit green":"fa fa-edit red"}))):null;return n.a.createElement("span",null,"\xa0",Ba(t),"\xa0",La(t),"\xa0",Ra(t),"\xa0",r)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t="past"===this.props.type?E.data.past:E.data.books,a=null;if(O("Past")&&console.log("Past render",t,this.props,window.FreeMaths),this.props.test||(a=Object.keys(t).filter(function(a){return t[a].title.startsWith(e.props.topic)}).sort(function(e,a){return function(e,t){P(e.test)||(e.test=JSON.parse(e.json));P(t.test)||(t.test=JSON.parse(t.json));return e=e.test,t=t.test,0!==Ga(e.name,t.name)?Ga(e.name,t.name):e.board!==t.board?e.board>t.board?1:-1:e.year!==t.year?1*e.year-1*t.year:e.month!==t.month?e.month>t.month?1:-1:e.name.split("_").length>1?t.name.split("_").length>1?e.name.split("_")[1]>t.name.split("_")[1]?1:-1:1:t.name.split("_").length>1?-1:0}(t[e],t[a])}).map(function(t){return n.a.createElement("li",{key:t},n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({test:t})}},Ua(t,e.props.stats)),e.links(t))})),null!==this.state.test)if(this.state.edit)r=n.a.createElement(Ha,{test:t[this.state.test],close:function(){return e.setState({test:null,edit:!1})}});else var r=n.a.createElement(Ka,{stats:this.props.stats,test:this.state.test,update:this.update,close:function(){return e.setState({test:null})}});return n.a.createElement("div",null,"GCSE(9-1)"===this.props.topic||"P1"===this.props.topic||"SM1"===this.props.topic?n.a.createElement("p",null,n.a.createElement("span",{className:"red"},"Note:")," Several ",this.props.topic," sample papers are combined into a single PDF. The links below should jump to the correct page but be careful to set a page range if printing."):null,a?n.a.createElement("ul",null,a):n.a.createElement("span",null,B(this.props.ts)," ",n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({test:e.props.test})}},Ua(this.props.test,this.props.stats)),this.links(this.props.test)),r)}}]),t}(r.Component);function $a(e,t){var a={key:e},r=e.split(":"),n=Object(h.a)(r,3),s=n[0],l=n[1],o=n[2];return a.t=N(s),a.ts=t.ts[e],P(o)&&""!==o?(a.qs=P(a.t.qmap.qs)&&P(a.t.qmap.qs[l])&&P(a.t.qmap.qs[l][o])?a.t.qmap.qs[l][o]:null,a.ch=l,a.e=o):P(a.t.test)&&P(a.t.test.questions)&&(a.qs=a.t.test.questions),a}var Ka=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).setMarks=function(){var e=$a(a.props.test,a.props.stats);return e.qs.map(function(t){var a=e.key.indexOf(":")>0?e.key+":"+t.q:e.key+":::"+t.q,r=P(e.ts)&&P(e.ts.qs[a])?e.ts.qs[a].l[E.user.id]:null;return P(r)?{m:r.m,f:r.f,c:"",mk:r.mk,mks:t.marks,q:t.q}:{m:"",f:"",c:"",mk:"",mks:t.marks,q:t.q}})},a.state={marks:a.setMarks(),effort:0,show:!1},a.marking=function(e){var t=E.user;t.log.push(e),window.FreeMaths.setState({user:t,message:null}),a.props.close()},a.save=function(){var e={marks:a.state.marks.map(function(e){return e.show?(delete e.show,e):void 0}),effort:a.state.effort};k("/react_ajax/marking",function(e){e.error?a.setState({error:e.data.error}):a.marking(e.data.log)},{test_id:a.props.test,info:e})},a.setEffort=function(e){a.setState({effort:e})},a.mark=function(e,t,r){var n=a.state.marks,s=$a(a.props.test,a.props.stats).qs;n[e].show=!0,"f"===t?n[e].f=r:"mk"===t?(n[e].mk=r,n[e].mks=s[e].marks,""===r?n[e].f="":r===s[e].marks?(n[e].f=":)",n[e].m="\u2713"):"0"===r?(n[e].f=":)",n[e].m="\u2717"):(n[e].f=":)",n[e].m="?\u2713")):n[e].c=r,a.setState({marks:n})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"total",value:function(){var e={marks:0,total:0,f:{":)":0,":|":0,":(":0},m:{"\u2713":0,"?\u2713":0,"\u2717":0},qs:0,qc:0},t=this.state.marks,a=$a(this.props.test,this.props.stats).qs;e.qc=a.length;for(var r=0;r<a.length;r++)(this.state.show||t[r].show||1*a[r].marks!==1*t[r].mk||":)"!==t[r].f)&&(e.qs++,e.total+=1*a[r].marks,e.marks+=1*t[r].mk,t[r].f.startsWith(":")&&e.f[t[r].f]++,""!==t[r].m&&e.m[t[r].m]++);return e}},{key:"render",value:function(){var e=this;if(null===this.props.test)return null;var t=$a(this.props.test,this.props.stats),a=0,r=[],s=!1;t.qs.forEach(function(l){var o=t.key.indexOf(":")>0?t.key+":"+l.q:t.key+":::"+l.q;e.state.show?r.push(n.a.createElement(Xa,{key:a,qkey:o,i:a,test:t.t,update:e.updateQ,q:l,mark:e.mark,marks:!z(e.state.marks)&&P(e.state.marks[a])?e.state.marks[a]:{m:"",f:"",c:""}})):e.state.marks[a].show||1*l.marks!==1*e.state.marks[a].mk||":)"!==e.state.marks[a].f?r.push(n.a.createElement(Xa,{qkey:o,key:a,test:t.t,i:a,update:e.updateQ,q:l,mark:e.mark,marks:P(e.state.marks[a])?e.state.marks[a]:{m:"",f:"",c:"",mk:0}})):s=!0,a++});var l=this.total();if(l.marks===l.total)var o="green";else o=l.marks>.65*l.total?"amber":"red";return n.a.createElement(A,{save:{fn:this.save,text:"Save"},close:this.props.close,title:_(this.props.test)},s||this.state.show?n.a.createElement("button",{onClick:function(){return e.setState({show:!e.state.show})},className:"btn btn-default btn-sm"},this.state.show?"Hide":"Show"," ",n.a.createElement("span",{className:"green"},"\u2713",Er[":)"])):null,n.a.createElement("table",{className:"table table-bordered table-condensed table-striped",style:{width:"auto"}},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Q ",Ba(t.t)),n.a.createElement("th",null,"Marks ",La(t.t)),n.a.createElement("th",{style:{textAlign:"center"}},Er[":)"]),n.a.createElement("th",null,"Comment ",Ra(t.t)))),n.a.createElement("tbody",null,r),n.a.createElement("tfoot",null,n.a.createElement("tr",null,n.a.createElement("th",{style:{verticalAlign:"middle"}},"Total"),n.a.createElement("th",{style:{verticalAlign:"middle",textAlign:"center"}},n.a.createElement("span",{className:o},l.marks),"/",l.total),n.a.createElement("th",{style:{verticalAlign:"middle",textAlign:"center"}},n.a.createElement("span",{className:"green"},l.f[":)"])," ",n.a.createElement("span",{className:"amber"},l.f[":|"])," ",n.a.createElement("span",{className:"red"},l.f[":("])),n.a.createElement("th",null,n.a.createElement(Va,{total:l,effort:this.state.effort,setEffort:this.setEffort}))))),this.state.error?n.a.createElement("div",{className:"alert alert-danger"},n.a.createElement("strong",null,"Server Error: ",this.state.error)):null)}}]),t}(r.Component),Va=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).update=function(e){var t=e.target.value.split(":");if(3===t.length)var r=1e3*(60*(60*t[0]+t[1])+t[2]);else 2===t.length?r=60*(60*t[0]+t[1])*1e3:1===t.length&&(r=60*t[0]*1e3);a.props.setEffort(r)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=P(this.props.effort)&&this.props.effort>0?Math.round(this.props.effort/6e4):"";return n.a.createElement("span",null,"Effort: ",n.a.createElement("input",{onChange:this.update,size:"5",type:"text",value:e,placeholder:Math.round(this.props.total.total/75*90)}),"(mins)")}}]),t}(r.Component);function Ga(e,t){return(e=e.split("_")[0])===(t=t.split("_")[0])?0:"GCSE(9-1)"===e?-1:"GCSE(9-1)"===t?1:e>t?1:-1}var Xa=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(E.user.isMobile)var t=n.a.createElement("input",{style:{width:"6em"},type:"text",name:"comment",value:this.props.marks.c,onChange:function(t){return e.props.mark(e.props.i,"c",t.target.value)}});else t=n.a.createElement("input",{type:"text",name:"comment",value:this.props.marks.c,onChange:function(t){return e.props.mark(e.props.i,"c",t.target.value)}});return n.a.createElement("tr",null,n.a.createElement("td",null,Ba(this.props.test,this.props.q,this.props.q.q)),n.a.createElement("td",{style:{width:"6em"}},n.a.createElement(Ya,{test:this.props.test,q:this.props.q,mk:this.props.marks.mk,i:this.props.i,mark:this.props.mark})),n.a.createElement("td",null,n.a.createElement(Za,{f:this.props.marks.f,i:this.props.i,mark:this.props.mark})),n.a.createElement("td",null,Ra(this.props.test,this.props.q)," ",t," ",this.props.marks.c?n.a.createElement(Pr,{c:this.props.marks.c,qkey:this.props.qkey}):null))}}]),t}(r.Component),Ya=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){for(var e=this,t=[n.a.createElement("option",{key:"?",value:""},"?")],a=0;a<=this.props.q.marks;a++)t.push(n.a.createElement("option",{key:a},a));if(1*this.props.mk===1*this.props.q.marks)var r=n.a.createElement("span",{className:"green"},this.props.q.marks);else r=this.props.mk>0?n.a.createElement("span",{className:"amber"},this.props.q.marks):"0"===this.props.mk?n.a.createElement("span",{className:"red"},this.props.q.marks):n.a.createElement("span",null,this.props.q.marks);return n.a.createElement("span",null,n.a.createElement("select",{value:this.props.mk,className:"qmark btn btn-default btn-sm",onChange:function(t){return e.props.mark(e.props.i,"mk",t.target.value)}},t),"/",La(this.props.test,this.props.q,r))}}]),t}(r.Component),Za=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(":)"===this.props.f)var t="green ";else t=":|"===this.props.f?"amber ":":("===this.props.f?"red ":"";return n.a.createElement("select",{value:this.props.f,className:t+"feedback btn btn-default btn-sm",onChange:function(t){return e.props.mark(e.props.i,"f",t.target.value)}},n.a.createElement("option",{value:""},"?"),n.a.createElement("option",{className:"green"},":)"),n.a.createElement("option",{className:"amber"},":|"),n.a.createElement("option",{className:"red"},":("))}}]),t}(r.Component),er=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={book:{id:"",name:"",board:"",isbn:"",link:"",chapters:[]}},a.update=function(e,t){var r=a.state.book;r[e]=t,a.setState({book:r})},a.save=function(){k("/react_ajax/book",function(e){if(e.error)a.setState({error:e.data});else{var t=a.state.book;t.id=e.data.id,a.setState({book:t}),console.log("book",e.data.id)}},{book:a.state.book})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){P(this.props.id)&&this.setState({book:window.FreeMaths.state.data.books[this.props.id].book})}},{key:"render",value:function(){var e=this;return n.a.createElement(m.a,{show:!0,onHide:this.props.close,bsSize:"lg"},n.a.createElement(m.a.Header,{closeButton:!0},n.a.createElement(m.a.Title,null,this.state.book.name.replace(/_/g," "))),n.a.createElement(m.a.Body,null,n.a.createElement("div",{className:"panel panel-default"},n.a.createElement("input",{type:"text",size:"5",placeholder:"Name",value:this.state.book.name,onChange:function(t){return e.update("name",t.target.value)}}),n.a.createElement("input",{size:"5",type:"text",placeholder:"Board",value:this.state.book.board,onChange:function(t){return e.update("board",t.target.value)}}),n.a.createElement("input",{size:"15",type:"text",placeholder:"ISBN",value:this.state.book.isbn,onChange:function(t){return e.update("isbn",t.target.value)}}),n.a.createElement("br",null),n.a.createElement("input",{size:"100",type:"text",placeholder:"Link",value:this.state.book.link,onChange:function(t){return e.update("link",t.target.value)}}),n.a.createElement(tr,{cs:this.state.book.chapters,update:this.update}))),n.a.createElement(m.a.Footer,null,n.a.createElement(d.a,{onClick:this.save},"Save")))}}]),t}(r.Component),tr=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={c:0,e:0},a.update=function(e,t){var r=a.props.cs;""===e.chapter&&""===e.topic?r.splice(t,1):r[a.state.c]=e,a.setState({e:null}),a.props.update("chapters",r)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement(ar,{e:this.state.e,c:this.props.cs[this.state.c],i:this.state.c,update:this.update,add:function(){return e.setState({c:e.state.c+1,e:0})},back:function(){return e.setState({c:e.state.c>0?e.state.c-1:0,e:0})}})}}]),t}(r.Component),ar=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).update=function(e,t){if(P(a.props.c))var r=a.props.c;else r={chapter:"",topic:"",link:"",exercises:[]};r[e]=t,a.props.update(r,a.props.i)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(P(this.props.c))var t=this.props.c;else t={chapter:"",topic:"",link:"",exercises:[]};return n.a.createElement("div",null,"Chapter: ",n.a.createElement("input",{size:"2",type:"text",value:t.chapter,placeholder:"1",onChange:function(t){return e.update("chapter",t.target.value)}}),n.a.createElement("input",{size:"15",type:"topic",placeholder:"Topic",value:t.topic,onChange:function(t){return e.update("topic",t.target.value)}}),n.a.createElement("span",{className:"btn-link",onClick:this.props.add},"\xa0",n.a.createElement("i",{className:"fa fa-btn fa-plus-square-o"})),n.a.createElement("span",{className:"btn-link",onClick:this.props.back},"\xa0",n.a.createElement("i",{className:"fa fa-btn fa-minus-square-o"})),n.a.createElement("input",{size:"100",type:"text",placeholder:"Link",value:t.link,onChange:function(t){return e.update("link",t.target.value)}}),n.a.createElement(rr,{e:this.props.e,es:t.exercises,update:this.update}))}}]),t}(r.Component),rr=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={e:0},a.update=function(e,t){var r=a.props.es;""===e.exercise&&""===e.topic?r.splice(t,1):r[a.state.e]=e,a.props.update("exercises",r)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillReceiveProps",value:function(e){P(e.e)&&this.setState({e:e.e})}},{key:"render",value:function(){var e=this;return n.a.createElement(nr,{e:this.props.es[this.state.e],i:this.state.e,update:this.update,add:function(){return e.setState({e:e.state.e+1})},back:function(){return e.setState({e:e.state.e>0?e.state.e-1:0})}})}}]),t}(r.Component),nr=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).update=function(e,t){if(console.log("Exercise update",e,t),P(a.props.e))var r=a.props.e;else r={exercise:"",topic:"",page:"",qs:[]};r[e]=t,a.props.update(r,a.props.i)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(P(this.props.e))var t=this.props.e;else t={exercise:"",topic:"",page:"",qs:[]};return n.a.createElement("div",null,"Exercise: ",n.a.createElement("input",{size:"2",type:"text",value:t.exercise,placeholder:"1",onChange:function(t){return e.update("exercise",t.target.value)}}),n.a.createElement("input",{size:"15",type:"topic",placeholder:"Topic",value:t.topic,onChange:function(t){return e.update("topic",t.target.value)}}),n.a.createElement("input",{style:{width:"4em"},type:"number",placeholder:"pg",value:t.page,onChange:function(t){return e.update("page",t.target.value)}}),n.a.createElement("span",{className:"btn-link",onClick:this.props.add},"\xa0",n.a.createElement("i",{className:"fa fa-btn fa-plus-square-o"})),n.a.createElement("span",{className:"btn-link",onClick:this.props.back},"\xa0",n.a.createElement("i",{className:"fa fa-btn fa-minus-square-o"})),n.a.createElement(sr,{qs:t.qs,update:this.update}))}}]),t}(r.Component),sr=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).update=function(e,t){var r=a.props.qs;if(e.q.indexOf("-")>0){var n=e.q.split("-"),s=Object(h.a)(n,2),l=s[0],o=s[1],i=l.substring(0,l.length-1);if(l.endsWith("a")){if(1===o.length&&o.match(/[b-z]/)){r.splice(t,1);for(var c="a";c!==o;c=String.fromCharCode(c.charCodeAt(0)+1))r.splice(t++,0,{q:i+c,marks:e.marks});r.splice(t,0,{q:i+c,marks:e.marks})}}else if(l.endsWith("i")){var u=["i","ii","iii","iv","v","vi","vii","viii","ix","x"];if(u.includes(o)){for(r.splice(t,1),c=0;u[c]!==o;c++)r.splice(t++,0,{q:i+u[c],marks:e.marks});r.splice(t,0,{q:i+u[c],marks:e.marks})}}else if((o*=1)>(l*=1)&&o-l<99)for(r.splice(t,1),c=l;c<=o;c++)r.splice(t++,0,{q:c,marks:e.marks})}else""===e.q?r.splice(t,1):r[t]=e;a.props.update("qs",r)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=0,a=this.props.qs.map(function(a){return n.a.createElement(lr,{key:t,q:a,i:t++,update:e.update})});return n.a.createElement("div",null,a,n.a.createElement(lr,{key:t,q:void 0,i:t,update:this.update}))}}]),t}(r.Component),lr=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).update=function(e,t){if(P(a.props.q))var r=a.props.q;else r={q:"",marks:"2"};r[e]=t,a.props.update(r,a.props.i)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(P(this.props.q))var t=this.props.q;else t={q:"",marks:"2"};return n.a.createElement("div",null,n.a.createElement("input",{size:"4",type:"text",value:t.q,placeholder:"1a",onChange:function(t){return e.update("q",t.target.value)}}),n.a.createElement("input",{style:{width:"4em"},type:"number",placeholder:"0",value:t.marks,onChange:function(t){return e.update("marks",t.target.value)}}))}}]),t}(r.Component),or=er,ir=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={show:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props.pkey.split(":"),a=Object(h.a)(t,3),r=a[0],s=a[1],l=a[2],o=r+":"+s+":"+l,i=E.data.books[r].book;if(!i)return null;var c=i.chapters.find(function(e){return e.chapter===s});if(c.exercises){var u=c.exercises.find(function(e){return e.exercise=l});if(u)return this.state.show?n.a.createElement(Ka,{stats:this.props.stats,test:o,update:this.update,close:function(){return e.setState({show:!1})}}):n.a.createElement("span",null,n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({show:!0})}},u.exercise,"  ",n.a.createElement(da,null,u.topic)),n.a.createElement(dr,{stats:this.props.stats,ekey:o}),"\xa0",cr(c.link,u.page,u.exercise))}}}]),t}(r.Component);function cr(e,t,a){var r=e+"#page="+t;return e.indexOf("$pg")>0&&(r=t>1e4?e.replace(/r00\/.*\$pg/,"r00/r00"+Math.floor(t/1e4)+"/r00"+Math.floor(t/100)+"/r00"+t).replace("$ex",a):e.replace("$pg",t).replace("$ex",a)),n.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:r},n.a.createElement(T,{tooltip:"solution bank"},n.a.createElement("i",{style:{fontSize:M()},className:"fa fa-check-circle"})))}var ur=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=[237,238,240].map(function(t){var a=E.data.books[t],r=0;return a.book.chapters.forEach(function(e){e.n=r++;var t=0;e.exercises.forEach(function(e){return e.n=t++})}),n.a.createElement(pr,{key:a.id,bk:a,stats:e.props.stats,pkey:e.props.pkey,set:e.props.set})});return n.a.createElement("div",null,t)}}]),t}(r.Component),pr=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={show:!1,edit:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=1===E.user.id?n.a.createElement(T,{tooltip:this.props.bk.id},n.a.createElement("button",{className:"btn btn-link",onClick:function(){return e.setState({edit:!0})}},n.a.createElement("i",{className:"fa fa-edit green"}))):null;return this.state.edit?n.a.createElement(or,{close:function(){return e.setState({edit:!1})},id:this.props.bk.id}):n.a.createElement("div",null,n.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.set(e.props.pkey?null:e.props.bk.id+"")}},_(this.props.bk.title)),n.a.createElement(dr,{bk:this.props.bk,stats:this.props.stats})," ",t,this.props.pkey?n.a.createElement(hr,{pkey:this.props.pkey,set:this.props.set,bk:this.props.bk,stats:this.props.stats}):null)}}]),t}(r.Component),hr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props.pkey.split(":");if(0===t.length||1*t[0]!==1*this.props.bk.id)return null;var a=t[0],r=this.props.bk.book.chapters.map(function(t){var r=a+":"+t.chapter;return n.a.createElement("li",{key:t.chapter},n.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.set(e.props.pkey===r?a:r)}},t.chapter," ",n.a.createElement(da,null,t.topic)),n.a.createElement(dr,{bk:e.props.bk,stats:e.props.stats,ch:t.chapter}),n.a.createElement(mr,{stats:e.props.stats,set:e.props.set,bk:e.props.bk,chapter:t,pkey:e.props.pkey}))});return n.a.createElement("ul",null,r)}}]),t}(r.Component),mr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props.pkey.split(":");if(t.length<2||t[1]!==this.props.chapter.chapter)return null;var a=t[0]+":"+t[1],r=this.props.chapter.exercises.map(function(r){var s=a+":"+r.exercise;return n.a.createElement("li",{key:r.exercise},n.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.set(e.props.pkey===s?a:s)}},r.exercise,"  ",n.a.createElement(da,null,r.topic)),n.a.createElement(dr,{stats:e.props.stats,bk:e.props.bk,ch:t[1],e:r.exercise}),"\xa0",cr(e.props.chapter.link,r.page,r.exercise))}),s=3===t.length?n.a.createElement(Ka,{stats:this.props.stats,test:this.props.pkey,close:function(){return e.props.set(a)}}):null;return n.a.createElement("div",null,n.a.createElement("ul",null,r),s)}}]),t}(r.Component);var dr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e,t,a,r,s=function(e,t){var a={"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:0,effort:0,r:[]};return Object.keys(t.t.ts).filter(function(t){return t.startsWith(e)}).forEach(function(e){var r=t.t.ts[e];[":(",":|",":)","\u2717","?\u2713","\u2713"].forEach(function(e){return a[e].push.apply(a[e],r[e])}),a.r.push.apply(a.r,r.r),a.mks+=r.mks,a.mk=Ea(a.mk,r.mk),a.qs+=r.qs,r.ts>a.ts&&(a.ts=r.ts)}),a}(this.props.ekey?this.props.ekey:(e=this.props.bk.id,t=this.props.ch,a=this.props.e,r=e,P(t)&&(r+=":"+t,P(a)&&(r+=":"+a)),r),this.props.stats);return s&&0!==s.mks?n.a.createElement("span",{className:yr(s.mk,s.mks)}," (",s.mk,"/",s.mks,")"):null}}]),t}(r.Component),fr={":(":!0,":|":!0,":)":!0},vr={"\u2717":!0,"?\u2713":!0,"\u2713":!0},gr={"\u2717":"red","?\u2713":"amber","\u2713":"green",":)":"green",":|":"amber",":(":"red",Help:"blue"},br=[":(",":|","\u2717","?\u2713","\u2713"],kr=[":(",":|",":)","\u2717","?\u2713","\u2713"],Er={"\u2717":"\u2717","?\u2713":"\u2713","\u2713":"\u2713",Q:"?",":)":n.a.createElement("i",{name:"smile",className:"fa fa-smile-o green"}),":|":n.a.createElement("i",{name:"meh",className:"fa fa-meh-o amber"}),":(":n.a.createElement("i",{name:"frown",className:"fa fa-frown-o red"}),Show:n.a.createElement("i",{className:"fa fa-eye"}),Help:n.a.createElement("i",{className:"fa fa-book"}),"Re-try":n.a.createElement("i",{className:"fa fa-repeat"}),"\u2713\u2717":n.a.createElement("i",{className:"fa fa-check-square-o"})};function yr(e,t){return 1*e===t?"green":e>.65*t?"amber":"red"}function Or(e){var t=0,a=null;return e[":)"].forEach(function(e){e.ts>t&&(a=":)",t=e.ts)}),e[":|"].forEach(function(e){e.ts>t&&(a=":|",t=e.ts)}),e[":("].forEach(function(e){e.ts>t&&(a=":(",t=e.ts)}),a?Er[a]:null}function jr(e,t,a,r){return n.a.createElement("td",{key:"mks",onClick:r?function(){return r(e.r)}:null,style:{textAlign:"center"},className:yr(""===e.mk?0:e.mk,e.mks)},n.a.createElement(T,{placement:"bottom",tooltip:function(e,t,a){var r=0;return e.sort(function(e,t){return t.ts-e.ts}).map(function(s){var l=s.uid?s.uid:e.uid?e.uid:null;return n.a.createElement("div",{key:r++,style:{textAlign:"left"}},B(s.ts)," ",a?"":P(l)?t.users[l].name:""," ",s.key?_(s.key,!0):""," ",""!==s.mk?n.a.createElement("span",{className:yr(s.mk,s.mks)},s.mk,"/",s.mks):"?/?")})}(e.r,t,a)},""===e.mk?0:e.mk,"/",e.mks))}function wr(e,t,a){var r=0;return e.sort(function(e,t){return t.ts-e.ts}).map(function(s){var l=s.uid?s.uid:e.uid?e.uid:null;return n.a.createElement("div",{key:r++,style:{textAlign:"left"}},B(s.ts)," ",a?"":P(l)?t.users[l].name:""," ",s.key?_(s.key,!0):""," ",""!==s.mk?n.a.createElement("span",{className:yr(s.mk,s.mks)},s.mk,"/",s.mks):"")})}function xr(e,t,a,r,s){return 0===e[t].length?n.a.createElement("td",{key:t}):n.a.createElement("td",{key:t,onClick:s?function(){return s(e[t])}:null,className:P(e[t][0].l)&&!e[t][0].l?"grey":gr[t]},n.a.createElement(T,{placement:"bottom",tooltip:function(e,t,a,r,s){var l=0,o=e[t].sort(function(e,t){return t.ts-e.ts===0?e.key.localeCompare(t.key):t.ts-e.ts}).slice(0,20).map(function(t){var o=t.uid?t.uid:e.uid?e.uid:null;return n.a.createElement("div",{key:l++,style:{textAlign:"left"}},B(t.ts)," ",r?"":P(o)?a.users[o].name:""," ",t.key?n.a.createElement("span",{className:s},_(t.key,!0)):"")});e[t].length>20&&o.push(n.a.createElement("div",{key:"dots",style:{textAlign:"center"}},"\u2026"));return o}(e,t,a,r,gr[t])},e[t].length))}function qr(){return br.map(function(e){return n.a.createElement("th",{key:e,className:gr[e]},Er[e])})}function Sr(e,t,a,r){var s=br.map(function(n){return xr(e,n,t,a,r)});return s.push(jr(e,t,a,r)),s.push(function(e,t,a,r){return n.a.createElement("td",{key:"n",onClick:r?function(){return r(e.r)}:null},n.a.createElement(T,{placement:"bottom",tooltip:wr(e.r,t,a)},e.r.length))}(e,t,a,r)),s.push(function(e,t,a,r){var s=0;if(0===e.length)return n.a.createElement("td",{key:s++});var l=e.sort(function(e,t){return t.ts-e.ts}).map(function(e){return n.a.createElement("div",{key:s++,style:{textAlign:"left"}},B(e.ts)," ",a?"":t.users[e.uid].name," ",_(e.key,!0),a?" ":n.a.createElement("br",null),n.a.createElement("span",{style:{textAlign:"left"},className:gr[e.f]},n.a.createElement(da,null,e.c)))});return n.a.createElement("td",{key:"comments",onClick:r?function(){return r(e,!0)}:null,style:{textAlign:"center"}},n.a.createElement(T,{tooltip:l,placement:"bottom"},e.length))}(e.c,t,a,r)),s}function Cr(e,t){return kr.map(function(a){return function(e,t,a){return 0===Object.keys(e[t]).length?n.a.createElement("td",{key:t}):n.a.createElement("td",{key:t,onClick:a?function(){return a(e[t])}:null,className:gr[t]},n.a.createElement(T,{placement:"bottom",tooltip:function(e,t){var a=E.data.tests.questions;return Object.keys(e[t]).sort(function(a,r){return e[t][r].ts-e[t][a].ts}).map(function(r){return e[t][r].variables||console.log("tipT0",e[t][r],e,t,a,r),n.a.createElement("div",{key:r,style:{textAlign:"left"}},B(e[t][r].ts)," ",n.a.createElement("span",{className:gr},"Q",r," ",n.a.createElement(da,{vars:e[t][r].variables?JSON.parse(e[t][r].variables):null},a[r].topic)))})}(e,t)},Object.keys(e[t]).length))}(e,a,t)})}function Nr(e,t,a){var r=0,s="",l="",o="",i="",c="";return e.sort(function(e,t){return e.mks?t.ts-e.ts:e.key.localeCompare(t.key,void 0,{numeric:!0})}).map(function(e){var u=e.key.split(":"),p=Object(h.a)(u,4),m=p[0],d=p[1],f=p[2],v=p[3],g=P(e.mk)?e.mk:t.t.qs[e.key].mk,b=P(e.mks)?e.mks:t.t.qs[e.key].mks,k=N(m).type,E=n.a.createElement("div",{key:r++},f?m!==o||d!==s||f!==l?n.a.createElement("h5",null,B(e.ts)," ",_(m)," ",n.a.createElement(ir,{pkey:e.key,stats:t})):null:m!==o?n.a.createElement("h5",null,a?n.a.createElement("span",{className:"btn-link",onClick:a},B(e.ts)):B(e.ts)," ",_(m)," ",n.a.createElement("span",{className:yr(g,b)},"(",g,"/",b,")")):null,!v||"vars"===k||m===o&&d===s&&f===l&&v===i&&c===e.c?null:n.a.createElement("div",null,B(e.ts)," Q ",function(e,t){var a=e.split(":"),r=Object(h.a)(a,4),n=r[0],s=r[3],l=N(n);return l&&"past"===l.type?Ba(l,l.qs[s],s):s}(e.key)," ",n.a.createElement("span",{className:yr(g,b)},"(",g,"/",b,")")," ",function(e,t,a){var r=e.split(":"),s=Object(h.a)(r,4),l=s[0],o=s[3],i=N(l);if(!i||"past"!==i.type)return null;var c=i.qs[o];return n.a.createElement("span",null,La(i,c)," ",Ra(i,c))}(e.key)," ",Or(t.t.qs[e.key])," ",n.a.createElement(zr,{qkey:e.key,stats:t})," ",n.a.createElement(Pr,{qkey:e.key,stats:t})," ",e.c?e.c:null),v&&"vars"===k?n.a.createElement(Fr,{x:e,stats:t}):null);return o=m,s=d,l=f,i=v,c=e.c,E})}var _r=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={log:null},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(O("LogDetail")&&console.log("LogDetail",this.props.stats,this.props.stats.uid),!this.props.stats.log.length)return null;if(this.state.log)return n.a.createElement(Ar,{log:this.state.log,close:function(){return e.setState({log:null})}});var t={};return this.props.stats.log.filter(function(t){return!e.props.uid||t.user_id===e.props.uid}).sort(function(e,t){return e.id-t.id}).forEach(function(a){var r=e.props.uid?a.created_at.substr(0,10):a.user_id;t[r]&&a.created_at.substr(0,10)===t[r].date.substr(0,10)?("Start"===a.event?(t[r].msecs+=t[r].end?t[r].end-L(t[r].date):0,t[r].date=a.created_at,t[r].end=null):t[r].end=L(a.created_at),t[r].events.push(a)):t[r]={uid:a.user_id,date:a.created_at,events:[a],msecs:0}}),Object.keys(t).forEach(function(e){t[e].start=L(t[e].date),t[e].msecs+=t[e].end?t[e].end-t[e].start:0}),O("LogDetail")&&console.log("LogDetail",this.props.stats,t),n.a.createElement("div",{name:"LogDetail"},n.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Name"),n.a.createElement("th",null,"Events"),n.a.createElement("th",null,"Time"),n.a.createElement("th",null,"Date"))),n.a.createElement("tbody",null,Object.keys(t).sort(function(e,a){return t[a].start-t[e].start}).map(function(a){return n.a.createElement("tr",{key:a},n.a.createElement("td",null,n.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setUid(t[a].uid)}},e.props.stats.users[t[a].uid]?e.props.stats.users[t[a].uid].name:t[a].uid)),n.a.createElement("td",{align:"center"},n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({log:t[a].events})}},t[a].events.length)),n.a.createElement("td",{align:"right"},R(t[a].msecs)),n.a.createElement("td",{align:"right"},B(t[a].start,!0)))}))))}}]),t}(r.Component),Ar=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={log:null},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return O("Events")&&console.log("Events",this.props.log),this.state.log?n.a.createElement(Mr,{log:this.state.log,close:function(){return e.setState({log:null})}}):n.a.createElement(A,{name:"Events",close:this.props.close,title:"Activity Log"},n.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Test"),n.a.createElement("th",null,"Q"),n.a.createElement("th",null,"Event"),n.a.createElement("th",null,"Time"))),n.a.createElement("tbody",null,this.props.log.sort(function(e,t){return e.id-t.id}).map(function(t){return n.a.createElement("tr",{key:t.id},n.a.createElement("td",null,N(t.paper,t.question)?N(t.paper,t.question).title:""),n.a.createElement("td",null,n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({log:t})}},C(t.question,t.paper))),n.a.createElement("td",{className:gr[t.event],onClick:function(){return e.setState({log:t})}},t.event),n.a.createElement("td",null,function(e,t){if(!P(e)||0===e)return"";var a,r,n,s,l=new Date(1*e);return t?(r=(a=l).getHours(),(n=a.getMinutes())<10&&(n="0"+n),(s=a.getSeconds())<10&&(s="0"+s),r+":"+n+":"+s):H(l)}(L(t.created_at),!0)))}))))}}]),t}(r.Component),Mr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){O("Log")&&console.log("Log",this.props.log);var e=N(this.props.log.paper);return"vars"===e.type?n.a.createElement(Tr,{log:this.props.log,close:this.props.close}):"past"===e.type?n.a.createElement(Wr,{log:this.props.log,close:this.props.close}):"book"===e.type?n.a.createElement(Qr,{log:this.props.log,close:this.props.close}):(console.error("Log",e,this.props.log),"Log error")}}]),t}(r.Component),Tr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.log,t=N(e.paper),a=E.data.tests.questions[e.question],r=e.variables?JSON.parse(e.variables):null,s=e.answer?Ut(e.answer,a.answer,r):null;return n.a.createElement(A,{name:"Log",close:this.props.close,title:(t?t.title+" ":"")+"Q "+C(e.question,e.paper)},a?n.a.createElement(da,{vars:r},a.question):null,e.answer?n.a.createElement("div",null,"\u2713"===s.correct?n.a.createElement(da,{vars:r},e.answer):n.a.createElement(da,{auto:!1},s.diff),n.a.createElement(Jr,{mark:s})):null)}}]),t}(r.Component),Wr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return"Past"}}]),t}(r.Component),Qr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return"Book"}}]),t}(r.Component),Pr=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={contact:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(this.state.contact){var t="",a=this.props.uid?this.props.uid:null;return this.props.c&&(t=this.props.c+"\n"),this.props.stats&&(1*this.props.stats.uid!==1*E.user.id&&(a=this.props.stats.uid),this.props.qkey&&this.props.stats.t.qs[this.props.qkey].c.forEach(function(e){t+=e.c+"\n"})),n.a.createElement(va,{text:t,uid:a,fm:window.FreeMaths,qkey:this.props.qkey,close:function(){return e.setState({contact:!1})}})}return n.a.createElement(T,{tooltip:"Ask FreeMaths.uk",placement:"bottom"},n.a.createElement("i",{className:(this.props.btn?this.props.btn:"btn btn-default btn-sm")+" fa fa-envelope-o blue",onClick:function(){return e.setState({contact:!0})}}))}}]),t}(r.Component),zr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.stats.t.qs[this.props.qkey].c;if(0===e.length)return null;var t=0,a=e.sort(function(e,t){return t.ts-e.ts}).map(function(e){return n.a.createElement("div",{key:t++,style:{textAlign:"left"}},B(e.ts)," ",n.a.createElement("span",{style:{textAlign:"left"},className:gr[e.f]},n.a.createElement(da,null,e.c)))});return n.a.createElement(T,{tooltip:a,placement:"bottom"},n.a.createElement("i",{className:"fa fa-comments","aria-hidden":"true"}))}}]),t}(r.Component),Dr=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={ts:null},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"s",value:function(e){var t=this,a=[e];return Object.keys(this.props.stats.ts[e.key].qs).forEach(function(r){t.props.stats.ts[e.key].qs[r].rs[e.uid]&&t.props.stats.ts[e.key].qs[r].rs[e.uid].filter(function(t){return"vars"===N(e.key).type?e.ts-t.ts<3600:t.ts===e.ts}).forEach(function(e){a.push({ts:e.ts,mk:e.mk,key:r})})}),a}},{key:"render",value:function(){var e=this;if(!this.props.s)return null;var t=null;return t=-1===this.props.s[0].key.indexOf(":")?this.props.s.map(function(t){return t.ts&&t.ts===e.state.ts?Nr(e.s(t),e.props.stats,function(){return e.setState({ts:null})}):Nr([t],e.props.stats,function(){return e.setState({ts:t.ts})})}):Nr(this.props.s,this.props.stats),n.a.createElement(A,{close:function(){return e.props.setS(null)},title:"Corrections"},t)}}]),t}(r.Component),Fr=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={expand:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"topic",value:function(e){if(!e.topics)return null;var t=e.topics.split(",")[0];return D(t.substr(0,t.length-1))+" level "+t.substr(t.length-1,1)}},{key:"render",value:function(){var e=this;if(null===this.props.x)return null;var t=this.props.x,a=t.key.split(":"),r=Object(h.a)(a,4)[3],s=E.data.tests.questions[r];if(!s)return console.error("Adaptive",t,r),null;var l=t.v?JSON.parse(t.v):null,o=t.a?Ut(t.a,s.answer,l):null;return n.a.createElement("div",null,n.a.createElement("div",null,B(t.ts)," ",n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({expand:!e.state.expand})}},"Q ",r)," ",this.topic(s)," ",n.a.createElement(Jr,{mark:o})," ",Or(this.props.stats.t.qs[t.key])," ",n.a.createElement(zr,{qkey:t.key,stats:this.props.stats})," ",n.a.createElement(Pr,{qkey:t.key,stats:this.props.stats})," ",t.c?t.c:null),this.state.expand&&t.v?n.a.createElement("div",null,n.a.createElement(da,{vars:l},s.question)):null,this.state.expand&&t.a?n.a.createElement("div",null,n.a.createElement(Xr,{noBox:!0,answer:t.a,vars:l,mark:o,keyboard:!1})):null)}}]),t}(r.Component),Hr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return null===this.props.cs?null:n.a.createElement(A,{close:function(){return e.props.setS(null,!0)},title:"Comments"},Nr(this.props.cs,this.props.stats))}}]),t}(r.Component);function Br(e,t,a){if("undefined"===typeof e.e[t])return n.a.createElement("td",null);var r="m"===a?{"\u2713":"green","?\u2713":"amber","\u2717":"red"}:{":)":"green",":|":"amber",":(":"red"},s=e.e[t].length,l=!1,o=0;if(s>0)var i=e.e[t].map(function(e){return"undefined"!==typeof e.comment&&e.comment.length>0?(l=!0,n.a.createElement("div",{className:r[t],style:{textAlign:"left"},key:o++},e.comment)):null});return 0===s&&(s=""),l?("s"===a&&(s=n.a.createElement("u",null,s)),t===e[a]?n.a.createElement("td",null,n.a.createElement(T,{className:r[t],tooltip:i},s)):n.a.createElement("td",null,n.a.createElement(T,{tooltip:i},s))):t===e[a]?n.a.createElement("td",{className:r[t]},s):n.a.createElement("td",null,s)}r.Component;var Lr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=["negatives","fractions","algebra","powers","surds","quadratics"].map(function(t){var a=e.props.stats[t]?Cr(e.props.stats[t],e.props.setQs):[n.a.createElement("td",{key:"1"}),n.a.createElement("td",{key:"2"}),n.a.createElement("td",{key:"3"}),n.a.createElement("td",{key:"4"}),n.a.createElement("td",{key:"5"}),n.a.createElement("td",{key:"6"})];return n.a.createElement("tr",{key:t},n.a.createElement("td",null,n.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setTest(t)}},D(t))),n.a.createElement("td",{className:"tdcenter"},e.props.stats[t]?e.props.stats[t].level:""),a)});return n.a.createElement("div",{name:"topics"},n.a.createElement("h3",null,"Topic Summary"),n.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Topic"),n.a.createElement("th",null,"level"),kr.map(function(e){return n.a.createElement("th",{key:e,className:gr[e]},Er[e])}))),n.a.createElement("tbody",null,t)))}}]),t}(r.Component),Rr=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={correct:null,log:null,tid:null,qid:null,vars:null,tree:null,topic:null,last_log:null,edit:!1,qs:null,i:0},a.setQs=function(e){var t=Object.keys(e);O("setQs")&&console.log("setQs(s) qs",e,t),a.setState({qid:t[0],vars:JSON.parse(e[t[0]].variables),i:1,qs:Q(e)})},a.setTest=function(e){var t=E.data.tests.tests,r=null,n=null,s=null;Object.keys(t).forEach(function(a){t[a].title.endsWith(D(e))&&(r=a)}),r&&(s=Tt(S(n=t[r].qs[1].qid).variables,a.state.log[n])),a.setState({qid:n,vars:s,tid:r,topic:e,correct:null})},a.setTopic=function(e){var t=null;e=a.state.tree.topics[e]?e:null;var r=a.state.log.stats[e]?a.state.log.stats[e].level:null,n=Tt(S(t=e?a.chooseQ(a.topicOptions(e,r)):a.setQ()).variables,a.state.log[t]);a.setState({qid:t,vars:n,topic:e})},a.logEvent=function(e,t,r){a.state.correct||"\u2713"!==e&&"?\u2713"!==e?"\u2717"!==e&&"?\u2717"!==e&&"Show"!==e||a.setState({correct:!1}):(a.setState({correct:e}),"\u2713"===e&&setTimeout(function(){return a.nextQ(":)")},1e3)),e.startsWith(":")&&a.nextQ(e),E.updateLog({paper:a.state.tid?a.state.tid:0,question:a.state.qid,event:e,vars:a.state.vars,answer:t,comment:r})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){O("AutoTestMount")&&console.log("AutoTest componentDidMount(),props,state",this.props,this.state);var e=this.filterLog(E.user.log),t=this.buildTree(),a=this.props.qid&&!this.props.vars?Tt(S(this.props.qid).variables,e[this.props.qid]):this.props.vars;this.setState({tid:this.props.tid,qid:this.props.qid,vars:a,log:e,tree:t,last_log:E.user.log.length>0?E.user.log[E.user.log.length-1].id:0})}},{key:"shouldComponentUpdate",value:function(e,t){var a=E.data.savedQ||t.last_log!==this.state.last_log||t.retry!==this.state.retry||t.correct!==this.state.correct||t.qid!==this.state.qid||t.vars!==this.state.vars||t.edit!==this.state.edit;return O("AutoTestUpdate")&&console.log("AutoTest shouldComponentUpdate(p, s),props,state",e,t,this.props,this.state),a}},{key:"componentWillReceiveProps",value:function(e){if(O("AutoTestProps")&&console.log("AutoTest componentWillReceiveProps(p),props,state",e,this.props,this.state),this.state.log)E.user.log.length>0&&E.user.log[E.user.log.length-1].id!==this.state.last_log&&this.setState({log:this.updateLog(E.user.log),last_log:E.user.log[E.user.log.length-1].id});else{var t=this.filterLog(E.user.log),a=this.buildTree();this.setState({log:t,tree:a,last_log:E.user.log.length>0?E.user.log[E.user.log.length-1].id:0})}}},{key:"maxLevel",value:function(){var e=this,t=3;return this.state.log.stats&&Object.keys(this.state.log.stats).forEach(function(a){e.state.log.stats[a].level>t&&(t=e.state.log.stats[a].level)}),t}},{key:"buildTree",value:function(){var e=this,t={topics:{},levels:{}};return Object.keys(E.data.tests.questions).forEach(function(a){e.questionTopics(a).forEach(function(e){var r=e.topic,n=e.level;P(t.topics[r])||(t.topics[r]={}),P(t.levels[n])||(t.levels[n]={}),P(t.topics[r][n])?t.topics[r][n].push(a):t.topics[r][n]=[a],P(t.levels[n][r])?t.levels[n][r].push(a):t.levels[n][r]=[a]})}),t}},{key:"updateStats",value:function(e,t,a){var r=t;return this.questionTopics(e.question).forEach(function(t){P(r[t.topic])||(r[t.topic]={level:null,":(":{},":|":{},":)":{},"\u2717":{},"?\u2713":{},"\u2713":{},f:{},m:{}}),!fr[e.event]||r[t.topic].f[e.question]&&!a||(r[t.topic].f[e.question]&&r[t.topic][r[t.topic].f[e.question]][e.question]&&delete r[t.topic][r[t.topic].f[e.question]][e.question],r[t.topic][e.event][e.question]=e,r[t.topic].f[e.question]=e.event),!vr[e.event]||r[t.topic].m[e.question]&&!a||(r[t.topic].m[e.question]&&delete r[t.topic][r[t.topic].m[e.question]][e.question],r[t.topic][e.event][e.question]=e,r[t.topic].m[e.question]=e.event),"\u2713"===e.event&&(t.level>r[t.topic].level&&(r[t.topic].level=t.level),r[t.topic].f[e.question]&&r[t.topic][r[t.topic].f[e.question]][e.question]&&delete r[t.topic][r[t.topic].f[e.question]][e.question],r[t.topic].f[e.question]=":)")}),r}},{key:"corrections",value:function(e){var t={};return Object.keys(e).forEach(function(a){return["\u2717","?\u2713",":(",":|"].forEach(function(r){Object.keys(e[a][r]).forEach(function(n){t[n]||(t[n]=e[a][r][n])})})}),0===Object.keys(t).length&&(t=null),t}},{key:"updateLog",value:function(e){var t=this.state.log,a=e[e.length-1],r=new Date(a.created_at?a.created_at.replace(" ","T"):null).getTime();return t[a.question]?t[a.question].ts=r:t[a.question]={use:[],skip:[],ts:r},t[a.question].skip.includes(a.variables)||t[a.question].skip.push(a.variables),t[a.question].use.includes(a.variables)&&t[a.question].use.splice(t[a.question].use.indexOf(a.variables),1),t.stats=this.updateStats(a,t.stats,!0),t.corrections=this.corrections(t.stats),t}},{key:"filterLog",value:function(e){for(var t={session:[],stats:{},corrections:null},a=E.data.tests.questions,r=e.length-1;r>0;r--){var n=e[r];if(n.question&&n.variables&&P(a[n.question])&&P(a[n.question].topics)&&n.variables.length>0&&-1===n.variables.indexOf("$")){var s=new Date(n.created_at.replace(" ","T")).getTime(),l=Date.now()-s<864e5;t[n.question]||(t[n.question]={use:[],skip:[],ts:s}),t[n.question].skip.includes(n.variables)||t[n.question].use.includes(n.variables)||(l||"\u2713"===n.event?t[n.question].skip.push(n.variables):"\u2717"===n.event&&t[n.question].use.push(n.variables)),t.stats=this.updateStats(n,t.stats)}}return t.corrections=this.corrections(t.stats),t}},{key:"setQ",value:function(e,t){t=t||null;for(var a=E.data.tests.questions,r=Object.keys(this.state.log),n=0;null===t&&n<a.length;)P(this.state.log[r[n]].use)&&P(a[r[n]].topics)&&Wt(a[r[n]].variables,this.state.log[r[n]])?t=r[n]:n++;if(null===t&&(t=this.chooseQ(this.levelOptions(null,this.maxLevel()))),O("setQ")&&console.log("setQ(set,qid)",e,t),!e)return t;this.setState({qid:t,vars:Tt(S(t).variables,this.state.log[t]),correct:null})}},{key:"chooseQ",value:function(e){for(var t=null,a=0;null===t&&a<e.length;)P(this.state.log[e[a]])&&!z(this.state.log[e[a]].skip)?a++:t=e[a];return null===t&&e.length>0&&(t=e[0]),t}},{key:"topicOptions",value:function(e,t){var a=this,r=[];return this.state.tree.topics[e]&&(this.state.tree.topics[e][t]?this.state.tree.topics[e][t].forEach(function(e){r.includes(e)||r.push(e)}):Object.keys(this.state.tree.topics[e]).forEach(function(t){return a.state.tree.topics[e][t].forEach(function(e){r.includes(e)||r.push(e)})}),r.sort(function(e,t){return a.state.log[e]?a.state.log[t]?a.state.log[e].ts-a.state.log[t].ts:1:-1})),r}},{key:"levelOptions",value:function(e,t){var a=this,r=[];return P(this.state.tree.levels[t])&&Object.keys(this.state.tree.levels[t]).forEach(function(n){n!==e&&a.state.tree.levels[t][n].forEach(function(e){r.includes(e)||r.push(e)})}),r}},{key:"questionTopic",value:function(e){return this.questionTopics(e)[0]?this.questionTopics(e)[0].topic:null}},{key:"questionSelect",value:function(e){var t=this;if(null!==this.state.correct&&"\u2713"!==this.state.correct)return n.a.createElement(Gr,{logEvent:this.logEvent});if(this.state.tid)return n.a.createElement("span",null,n.a.createElement(Yr,{tid:this.state.tid,qid:this.state.qid,selectQ:function(e){return t.setQ(!0,e)}}),n.a.createElement("button",{className:"btn btn-link",onClick:function(){return t.setQ(!0,t.state.qid)}},n.a.createElement("i",{className:"fa fa-btn fa-random"})));var a=this.questionTopics(e)[0]?this.questionTopics(e)[0]:{topic:"",level:0};return n.a.createElement("span",null,n.a.createElement(Zr,{tree:this.state.tree,topic:a.topic,setTopic:this.setTopic}),this.level(a.level-1)?n.a.createElement("button",{className:"btn btn-link",onClick:function(){return t.nextQ("-")}},n.a.createElement("i",{className:"fa fa-btn fa-minus-circle"})):null,"level ",a.level,this.level(a.level+1)?n.a.createElement("button",{className:"btn btn-link",onClick:function(){return t.nextQ("+")}},n.a.createElement("i",{className:"fa fa-btn fa-plus-circle"})):null,n.a.createElement("button",{className:"btn btn-link",onClick:function(){return t.nextQ()}},n.a.createElement("i",{className:"fa fa-btn fa-random"})))}},{key:"questionTopics",value:function(e){var t=E.data.tests.questions;if((e=e||this.state.qid)&&!t[e])return console.error("questionTopics",e),[];if(null===e||!t[e].topics)return[];var a=t[e].topics.split(",")[0];return[{topic:a.substr(0,a.length-1),level:1*a.substr(a.length-1,1)}]}},{key:"level",value:function(e){return null===this.state.topic?P(this.state.tree.levels[e]):P(this.state.tree.topics[this.state.topic][e])}},{key:"questionOptions",value:function(e){var t=[],a=this.questionTopics()[0],r=a.topic,n=a.level;return":)"===e&&this.state.correct&&this.level(n+1)?n++:"+"===e&&this.level(n+1)?n++:":("!==e&&"-"!==e||!this.level(n-1)||n--,0===(t=this.state.correct&&null===this.state.topic?this.levelOptions(r,n):this.topicOptions(r,n)).length&&(t=this.levelOptions(null,n)),t}},{key:"setVars",value:function(e){return Tt(S(e=e||this.state.qid).variables,this.state.log[e])}},{key:"nextQ",value:function(e){var t=this;if(this.state.tid)if(this.state.correct&&":|"!==e&&":("!==e){var a=N(this.state.tid),r=a.qs.find(function(e){return e&&e.qid==t.state.qid}).qn,n=a.qs[r+1]?a.qs[r+1].qid:null;this.setState({qid:n,tid:n?this.state.tid:null,vars:n?this.setVars(n):null,correct:null})}else this.setState({vars:this.setVars(),correct:null});else if(this.state.correct||":|"!==e&&":)"!==e)if(this.state.i){var s=Object.keys(this.state.qs);this.state.i>=s.length?this.setState({qid:null,vars:null,qs:null,i:0,correct:null,retry:0}):this.setState({qid:s[this.state.i],vars:JSON.parse(this.state.qs[s[this.state.i]].variables),i:this.state.i+1,retry:0,correct:null})}else{var l=this.chooseQ(this.questionOptions(e));l!==this.state.qid?this.setState({qid:l,correct:null,vars:this.setVars(l)}):this.setState({correct:null,vars:this.setVars()})}else this.setState({vars:this.setVars(),correct:null})}},{key:"render",value:function(){var e=this;return this.state.tree?this.state.qid?!0===this.state.edit?n.a.createElement(la,{fm:this.props.fm,qid:this.state.qid,vars:this.state.vars,close:function(){return e.setState({edit:!1})}}):n.a.createElement(A,{name:"question",close:function(){return e.setState({tid:null,qid:null,vars:null,qs:{},topic:null,correct:null})},title:this.questionSelect(this.state.q)},n.a.createElement("div",null,"See ",n.a.createElement(da,null,"@"+this.questionTopic(this.state.qid)),n.a.createElement("br",null),n.a.createElement("span",{style:{float:"right"}}),E.user.isAdmin?n.a.createElement(T,{tooltip:this.state.qid},n.a.createElement("button",{className:"btn btn-link",style:{float:"right"}},n.a.createElement("i",{className:"fa fa-btn fa-edit",onClick:function(){return e.setState({edit:!0})}}))):null,n.a.createElement(Ir,{qid:this.state.qid,vars:this.state.vars,logEvent:this.logEvent}))):n.a.createElement("div",null,E.user.isAdmin?n.a.createElement(ka,{tree:this.state.tree,fm:this.props.fm,setQ:function(t,a){return e.setState({qid:t,edit:a})}}):null,this.state.log.corrections?n.a.createElement(W,{className:"btn btn-danger",tooltip:"Correct first",onClick:function(){return e.setQs(e.state.log.corrections)}},"Corrections"):null,n.a.createElement(W,{className:"btn btn-primary",tooltip:"Adaptive test and learn",onClick:function(){return e.setQ(!0)}},"Test"),"\xa0",n.a.createElement(da,null,"@instructions__home"),null===this.state.log?null:n.a.createElement(Lr,{setQs:this.setQs,setTest:this.setTest,stats:this.state.log.stats})):null}}]),t}(r.Component),Ir=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={help:!1,working:!1,correct:null},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.qid===this.props.qid&&e.vars===this.props.vars||(this.setState({help:!1,working:!1,correct:null}),e.qid&&e.logEvent("Q"))}},{key:"componentDidMount",value:function(){this.props.qid&&this.props.logEvent("Q")}},{key:"render",value:function(){var e=E.data.tests.questions[this.props.qid];return n.a.createElement("div",{id:"Question_"+this.props.qid},n.a.createElement("div",{className:"PQ"},n.a.createElement(da,{vars:this.props.vars},e.question)),n.a.createElement(Ur,{qid:this.props.qid,vars:this.props.vars,logEvent:this.props.logEvent}))}}]),t}(r.Component),Ur=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={answer:"",hint:!1,show:!1,mark:null},a.hintShow=function(e,t){t.currentTarget.blur(),"hint"===e?(a.props.logEvent("Hint"),a.setState({keyboard:!1,hint:!0})):"show"===e&&(a.props.logEvent("Show"),a.setState({keyboard:!1,hint:!0,show:!0}))},a.mark=function(){var e=E.data.tests.questions[a.props.qid].answer;if(a.state.answer.length>0){var t=Ut(a.state.answer,e,a.props.vars);a.props.logEvent(t.correct,a.state.answer),a.setState({mark:t})}else a.setState({mark:null})},a.logmark=function(e,t,r){a.props.log("M",r),a.setState({mark:{correct:"?\u2713",m:r}})},a.log=function(e,t,r,n){a.props.logEvent(e,r,n)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.qid===this.props.qid&&e.vars===this.props.vars||this.setState({answer:"",hint:!1,show:!1,mark:null})}},{key:"render",value:function(){var e=this,t=this.state.mark&&"\u2713"===this.state.mark.correct;return n.a.createElement("div",null,t?null:n.a.createElement(Kr,{hint:this.state.hint,show:this.state.show,hintShow:this.hintShow,mark:this.state.mark,change:this.props.change}),n.a.createElement(Xr,{answer:this.state.answer,mark:this.state.mark,vars:this.props.vars}),n.a.createElement(Pr,{btn:"btn btn-default",c:"",qkey:(this.props.tid?this.props.tid:0)+":::"+this.props.qid}),t?null:n.a.createElement("div",null,this.state.show?null:n.a.createElement(sa,{answer:this.state.answer,mark:this.mark,change:function(t){return e.setState({answer:t})},qid:this.props.qid,vars:this.props.vars}),n.a.createElement(Vr,{qid:this.props.qid,vars:this.props.vars,hint:this.state.hint,show:this.state.show})))}}]),t}(r.Component),Jr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return null===this.props.mark?null:"\u2713"===this.props.mark.correct?n.a.createElement("span",{className:"green"},"\u2713"):"?\u2713"===this.props.mark.correct?n.a.createElement("span",{className:"amber"},"\u2713"):"?\u2717"===this.props.mark.correct?n.a.createElement("span",{className:"amber"},"\u2717"):n.a.createElement("span",{className:"red"},"\u2717")}}]),t}(r.Component),$r=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={help:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(!this.props.mark)return null;var t="amber";if("\u2713"===this.props.mark.correct?t="green":"\u2717"===this.props.mark.correct&&(t="red"),this.state.help){var a="Freemaths does its best to check your answer (re-arranging as needed).\n<g>\u2713</g> means your answer matched.\n<o>\u2713</o> means your answer is numerically correct but not as expected, can you simplify?\n<r>\u2717</r> means our tests suggest your answer is wrong (but the tests aren't perfect).\n";return"\u2713"!==this.props.mark.correct?(a+="\nHave you have provided the answer in exactly the format requested?\n<g>Green</g> terms are in the expected answer. <o>Amber</o> terms have a sign error. Check other terms carefully for calculation errors.",a+="\n\nUse <r>Show</r> to see a model answer and working."):a+="\nUse <g>Show</g> to see a model answer and working.",n.a.createElement(pa,{title:"Marking Help",help:a,close:function(){return e.setState({help:!1})}})}return n.a.createElement(W,{className:"btn btn-default btn-sm "+t,onClick:function(){return e.setState({help:!0})},tooltip:"marking help"},"?")}}]),t}(r.Component),Kr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props.hint||null!==this.props.mark&&"\u2713"===this.props.mark.correct,a=null===this.props.mark?"red":"\u2713"===this.props.mark.correct?"green":"red";return n.a.createElement("span",null,t?null:n.a.createElement(W,{className:"btn btn-default amber",onClick:function(t){return e.props.hintShow("hint",t)},tooltip:"show hint"},"Hint"),this.props.show?null:n.a.createElement(W,{className:"btn btn-default "+a,onClick:function(t){return e.props.hintShow("show",t)},tooltip:"show answer"},"Show"))}}]),t}(r.Component),Vr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return n.a.createElement("div",null,this.props.show?n.a.createElement("div",{name:"show",className:"box"},n.a.createElement(da,{vars:this.props.vars},S(this.props.qid).working)):null,this.props.show&&this.props.hint?n.a.createElement("br",null):null,this.props.hint?n.a.createElement("div",{name:"hint",className:"box"},n.a.createElement(da,{vars:this.props.vars},S(this.props.qid).help)):null)}}]),t}(r.Component),Gr=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={help:!1},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=null;if(!this.state.help)return n.a.createElement("div",{name:"rate"},n.a.createElement(W,{id:"rate",tooltip:"rate to move on",onClick:function(){return e.setState({help:!0})}},"Rate:"),n.a.createElement(W,{id:"FG",value:":)",className:"btn btn-default green",tooltip:"understood",onClick:function(){return e.props.logEvent(":)")}},Er[":)"]),n.a.createElement(W,{id:"FA",value:":|",className:"btn btn-default amber",tooltip:"practice needed",onClick:function(){return e.props.logEvent(":)")}},Er[":|"]),n.a.createElement(W,{id:"FR",value:":(",className:"btn btn-default red",tooltip:"help needed",onClick:function(){return e.props.logEvent(":)")}},Er[":("]),n.a.createElement("div",null,t));t=n.a.createElement(ua,{topic:"rating",close:function(){return e.setState({help:!1})}})}}]),t}(r.Component),Xr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.answer.replace(/^(-?)(\d+)(\u02fd| )(\d+\/\d+)$/,"$1{$2\u02fd$4}").replace(/\s/g,"");if(!e||""===e)return null;var t=this.props.mark,a=this.props.vars,r=null,s=null;return t&&t.attempt==this.props.answer?(r=n.a.createElement(Jr,{mark:t}),s="\u2713"===t.correct?n.a.createElement(da,{vars:a},e):n.a.createElement(da,{auto:!1},t.diff)):s=n.a.createElement(da,{vars:a},e),r?n.a.createElement("div",{name:"answer",className:"inline"},n.a.createElement("div",{className:"maths border"},s,r),this.props.hide?null:n.a.createElement($r,{mark:t})):n.a.createElement("div",{className:"maths border inline"},s)}}]),t}(r.Component),Yr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.tid!==this.props.tid||e.qid!==this.props.qid}},{key:"render",value:function(){var e=this,t=E.data.tests.tests[this.props.tid],a=E.data.tests.questions[this.props.qid];if(!t||!a)return null;var r=t.qs.map(function(e){return e?n.a.createElement("option",{value:e.qid,key:e.qid},e.qn):null});return n.a.createElement("span",null,"Question ",n.a.createElement("select",{value:this.props.qid,className:"btn btn-default",onChange:function(t){return e.props.selectQ(t.target.value)}},r)," of ",t.qs.length-1)}}]),t}(r.Component),Zr=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=[n.a.createElement("option",{key:0,value:"0"},"select")];return Object.keys(this.props.tree.topics).sort(function(e,t){return e.localeCompare(t)}).forEach(function(e){t.push(n.a.createElement("option",{key:e},e))}),n.a.createElement("form",{className:"form-horizontal inline"},n.a.createElement("select",{className:"form-control inline",style:{width:"auto"},value:this.props.topic,onChange:function(t){return e.props.setTopic(t.target.value)}},t))}}]),t}(r.Component),en=Rr,tn=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={tutor:["","","",""],remove:[],error:{}},a.tutor=function(e){e.preventDefault(),k("/react_ajax/tutor",function(e){if(e.error)a.setState({error:e.data});else{var t=a.props.fm.state.user;t.tutors=e.data.tutors,a.setState({tutor:["","","",""],remove:[],error:{added:e.data.added,removed:e.data.removed}}),a.props.fm.setState({user:t})}},{tutor:a.state.tutor,remove:a.state.remove,token:a.props.fm.state.user.token})},a.add=function(e,t){var r=a.state.tutor;r[e]=t,a.setState({tutor:r,error:{}})},a.remove=function(e){var t=a.state.remove,r=t.indexOf(e);-1!==r?t.splice(r,1):t.push(e),a.setState({remove:t,error:{}})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"button",value:function(){var e={style:"primary",text:"Add"};return this.state.remove.length>0&&(e.style="danger",this.state.tutor.join("")?e.text="Add & Remove":e.text="Remove"),e}},{key:"render",value:function(){var e=this;return n.a.createElement(m.a,{show:!0,onHide:this.props.close},n.a.createElement(m.a.Header,{closeButton:!0},n.a.createElement(m.a.Title,null,"Parents, Teachers & Tutors")),n.a.createElement(m.a.Body,null,this.state.error.added?n.a.createElement("div",{className:"alert alert-success"},n.a.createElement("strong",null,this.state.error.added," tutors added")):null,this.state.error.removed?n.a.createElement("div",{className:"alert alert-success"},n.a.createElement("strong",null,this.state.error.removed," tutors removed")):null,this.state.error.error?n.a.createElement("div",{className:"alert alert-danger"},n.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,n.a.createElement(Y.a,{onSubmit:this.tutor,horizontal:!0},[1,2,3].map(function(t){return n.a.createElement(an,{key:t,i:t,email:e.state.tutor[t],error:e.state.error,add:e.add})}),n.a.createElement(Z.a,null,n.a.createElement(G.a,{smOffset:3,sm:4},n.a.createElement(d.a,{bsStyle:this.button().style,type:"submit"},n.a.createElement("i",{className:"fa fa-mortar-board"})," ",this.button().text))),this.props.fm.state.user.tutors?n.a.createElement("div",null,n.a.createElement(Z.a,null,this.props.fm.state.user.tutors.map(function(t){return n.a.createElement(G.a,{key:t.email,smOffset:3,sm:8},n.a.createElement(re.a,{value:!!e.state.remove[t.email]&&"checked",onChange:function(a){return e.remove(t.email)}},n.a.createElement("i",{className:"fa fa-trash"})," ",n.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.fm.setState({email:t.email,modal:"contact"})}},t.name?t.name:t.email)))}))):null)))}}]),t}(r.Component),an=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement(Z.a,{controlId:"tutor"+this.props.i,validationState:this.props.error["tutor."+this.props.i]?"error":null},n.a.createElement(G.a,{componentClass:ee.a,sm:3},"Tutor Email"),n.a.createElement(G.a,{sm:8},n.a.createElement(te.a,{type:"email",name:"email",value:this.props.email,placeholder:"Email",onChange:function(t){return e.props.add(e.props.i,t.target.value)}})),this.props.error["tutor."+this.props.i]?n.a.createElement(G.a,{smOffset:3,sm:8},n.a.createElement(ae.a,null,this.props.error["tutor."+this.props.i])):null)}}]),t}(r.Component),rn=tn,nn=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={users:null,data:null,tables:null,past:!1,book:!1,diffs:null,lz:null,debug:null},a.message=function(e){return a.setState({message:e})},a.check=function(e){console.log("updates",e),a.setState({message:{type:"danger",text:"Update - see console for details - dismiss message or click again to send"}})},a.send=function(){var e=a.check;a.state.message&&a.state.message.text.startsWith("Update")&&(e=!1),E.send(a.message,a.message,e)},a.compare=function(){var e={help:a.diff("help"),tests:a.diff("tests"),questions:a.diff("questions")};a.setState({diffs:e}),console.log("diffs",e)},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"diff",value:function(e){var t=this,a={};return Object.keys(this.state.data[e]).forEach(function(r){var n=E.data[e][r],s=t.state.data[e][r];n&&s&&n.updated_at===s.updated_at||(a[r]={live:n,comp:s})}),Object.keys(E.data[e]).forEach(function(r){var n=E.data[e][r],s=t.state.data[e][r];n&&s&&n.updated_at===s.updated_at||a[r]||(a[r]={live:n,comp:s})}),a}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,this.state.message?n.a.createElement("div",{className:"alert alert-dismissible alert-"+this.state.message.type},n.a.createElement("button",{type:"button",onClick:function(){return e.setState({message:null})},className:"close","data-dismiss":"alert"},"\xd7"),n.a.createElement("strong",null,this.state.message.text)):null,n.a.createElement("span",{className:"btn-link",onClick:this.send},"Send Data"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({debug:!e.state.debug})}},"Debug"),this.state.debug?n.a.createElement(sn,null):null,n.a.createElement("br",null),n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({users:!e.state.users})}},"Users"),this.state.users?n.a.createElement(ln,{fm:this.props.fm}):null,n.a.createElement("br",null),n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({past:!e.state.past})}},"Past Papers"),this.state.past?n.a.createElement(Ha,{close:function(){return e.setState({past:!1})},fm:this.props.fm}):null,n.a.createElement("br",null),n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({book:!e.state.book})}},"Books"),this.state.book?n.a.createElement(or,{close:function(){return e.setState({book:!1})},fm:this.props.fm}):null)}}]),t}(r.Component),sn=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={debugs:y},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"set_debug",value:function(e){j(e),this.setState({debugs:y})}},{key:"render",value:function(){var e=this;if(this.state.debugs)return n.a.createElement("div",null,n.a.createElement("div",null,E.user.token),Object.keys(this.state.debugs).map(function(t){return n.a.createElement("span",{key:t,className:"btn-link",onClick:function(){e.set_debug(t)}},y[t].show?n.a.createElement("span",{className:"green"},t,":",y[t].n," "):n.a.createElement("span",null,t,":",y[t].n," "))}))}}]),t}(r.Component),ln=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={users:null,sort:"visit",error:{}},a.sort=function(e,t){switch(e=a.state.users[e],t=a.state.users[t],a.state.sort){case"visit":return e.ts=new Date((e.visited_at?e.visited_at:e.updated_at).replace(" ","T")).getTime(),t.ts=new Date((t.visited_at?t.visited_at:t.updated_at).replace(" ","T")).getTime(),t.ts-e.ts;case"login":return e.ts=new Date(e.updated_at.replace(" ","T")).getTime(),t.ts=new Date(t.updated_at.replace(" ","T")).getTime(),t.ts-e.ts;case"register":return e.ts=new Date(e.created_at.replace(" ","T")).getTime(),t.ts=new Date(t.created_at.replace(" ","T")).getTime(),t.ts-e.ts;case"name":return e.name.localeCompare(t.name);case"email":return e.email.localeCompare(t.email);default:return t[a.state.sort]-e[a.state.sort]}},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){var e=this;k("react_ajax/users",function(t){if(t.error)e.props.fm.setState({message:{type:"danger",text:t.data.error}});else{var a={};q(t.data.users).forEach(function(e){a[e.id]=e}),q(t.data.log).forEach(function(e){e.user_id&&(a[e.user_id].visited_at=e.ts)}),e.setState({users:a})}})}},{key:"render",value:function(){var e=this;if(!this.state.users)return n.a.createElement("div",null,"loading...");var t=["name","email","visited_at","updated_at","created_at"],a=Object.keys(this.state.users).sort(this.sort).map(function(a){return a=e.state.users[a],n.a.createElement("tr",{key:a.id},n.a.createElement("td",null,a.id,n.a.createElement(Pr,{uid:a.id})),t.map(function(e){return n.a.createElement("td",{key:e},a[e])}))});return n.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},n.a.createElement("thead",null,n.a.createElement("tr",null,["id","name","email","visit","login","register"].map(function(t){return n.a.createElement("th",{key:t},n.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({sort:t})}},t))}))),n.a.createElement("tbody",null,a))}}]),t}(r.Component),on=nn,cn=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={page:"Home",modal:null,message:null,token:null,help:null},a.nav=function(e){a.setState({page:e,message:null})},a.modal=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;"about"===e?a.setState({help:"about",message:null}):a.setState({modal:e,email:t,message:null})},a.closeModal=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a.setState({modal:null,message:e})},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){if(E.loadData(this),E.loadUser(),window.location.search)if(window.location.search.startsWith("?reset="))this.setState({modal:"reset",token:window.location.search.substr(7)});else if(window.location.search.startsWith("?contact"))this.setState({modal:"contact"});else if(window.location.search.startsWith("?mail="))this.setState({modal:"mail",token:window.location.search.substr(6)});else if(window.location.search.startsWith("?Q")){var e=window.location.search.substr(2).split("&"),t=e[0],a=null;e.length>1&&(e.shift(),a={},e.forEach(function(e){e=decodeURIComponent(e).split("="),a[e[0]]=e[1]})),console.log("Q",t,a),this.setState({qid:t,vars:a})}window.history.pushState("object or string","Title","/")}},{key:"showPage",value:function(){if(!this.state.ready||this.state.password)return"Admin"===this.state.page?n.a.createElement(on,null):n.a.createElement(ne,{modal:this.modal,app:-1!==window.location.href.indexOf("://app.")});switch(this.state.page){case"Students":return n.a.createElement(Aa,{students:!0});case"Past":return n.a.createElement(Aa,{type:"past"});case"Books":return n.a.createElement(Aa,{type:"book"});case"Admin":return n.a.createElement(on,null);default:return n.a.createElement(en,{qid:this.state.qid,vars:this.state.vars})}}},{key:"showModal",value:function(){switch(this.state.modal){case"contact":return n.a.createElement(va,{close:this.closeModal});case"mail":return n.a.createElement(ba,{token:this.state.token,close:this.closeModal});case"register":return n.a.createElement(ce,{close:this.closeModal});case"update":return n.a.createElement(ie,{close:this.closeModal});case"tutor":return n.a.createElement(rn,{close:this.closeModal});case"forgot":return n.a.createElement(se,{email:this.state.email,close:this.closeModal});case"reset":return n.a.createElement(le,{close:this.closeModal,token:this.state.token});default:return null}}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement(un,{page:this.state.page,nav:this.nav,modal:this.modal}),n.a.createElement("div",{id:"modalRoot"}),n.a.createElement("div",{id:"page",className:"container"},this.state.message?n.a.createElement("div",{name:"alert",className:"alert alert-dismissible alert-"+this.state.message.type},n.a.createElement("button",{type:"button",className:"close",onClick:function(){return e.setState({message:null})},"data-dismiss":"alert"},"\xd7"),n.a.createElement("strong",null,this.state.message.text)):null,this.showPage(),this.showModal(),this.state.password&&"mail"!==this.state.modal?n.a.createElement(oe,{auth:function(){return e.setState({ready:E.ready(!0),password:null})},close:function(){return e.setState({ready:!1,password:null})}}):null,this.state.help?n.a.createElement(ua,{topic:this.state.help,close:function(){return e.setState({help:null})}}):null),this.state.token?n.a.createElement("span",{id:"debug",style:{display:"none"}},this.state.token):null)}}]),t}(r.Component),un=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e,t=this;return e=null!==E.user?n.a.createElement("div",null,n.a.createElement(I.a,{activeKey:this.props.page},n.a.createElement(U.a,{id:"tests",eventKey:"Home",onClick:function(){return t.props.nav("Home")}},"Tests"),n.a.createElement(U.a,{id:"books",eventKey:"Books",onClick:function(){return t.props.nav("Books")}},"Books"),n.a.createElement(U.a,{id:"past",eventKey:"Past",onClick:function(){return t.props.nav("Past")}},"Past Papers")),n.a.createElement(I.a,{pullRight:!0},n.a.createElement(J.a,{title:E.user.name,id:"user"},n.a.createElement($.a,{id:"logout",eventKey:"logout",onSelect:E.logout},n.a.createElement("i",{className:"fa fa-sign-out"})," Logout"),n.a.createElement($.a,{id:"contact",eventKey:"contact",onSelect:function(){return t.props.modal("contact")}},n.a.createElement("i",{className:"fa fa-envelope-o"})," Contact Us"),n.a.createElement($.a,{id:"tutor",eventKey:"Tutor",onSelect:function(){return t.props.modal("tutor")}},n.a.createElement("i",{className:"fa fa-mortar-board"})," Add Tutor"),n.a.createElement($.a,{id:"update",eventKey:"Update",onSelect:function(){return t.props.modal("update")}},n.a.createElement("i",{className:"fa fa-user"})," Update Details"),E.user.isTutor?n.a.createElement($.a,{id:"students",eventKey:"Students",onSelect:function(){return t.props.nav("Students")}},n.a.createElement("i",{className:"fa fa-group"})," Students"):null,E.user.isAdmin?n.a.createElement($.a,{id:"admin",eventKey:"Admin",onSelect:function(){return t.props.nav("Admin")}},n.a.createElement("i",{className:"fa fa-key"})," Admin"):null))):n.a.createElement("div",null,E.data.help?n.a.createElement(I.a,null,n.a.createElement(U.a,{id:"about",eventKey:"about",onClick:function(){return t.props.modal("about")}},"About")):null,n.a.createElement(I.a,{pullRight:!0},n.a.createElement(U.a,{id:"register",eventKey:"register",onClick:function(){return t.props.modal("register")}},"Register"),n.a.createElement(U.a,{id:"contact",eventKey:"contact",onSelect:function(){return t.props.modal("contact")}},"Contact Us"))),n.a.createElement("div",{id:"nav"},n.a.createElement(K.a,{collapseOnSelect:!0,fixedTop:!0},n.a.createElement(K.a.Header,null,n.a.createElement(K.a.Brand,null,n.a.createElement("a",{href:"http://ec2.freemaths.uk/"},"FreeMaths.uk")),n.a.createElement(K.a.Toggle,null)),n.a.createElement(K.a.Collapse,null,e)))}}]),t}(r.Component),pn=cn,hn=(a(201),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function mn(e,t){E.swState("registering"),navigator.serviceWorker.register(e).then(function(e){E.swState("registered"),e.onupdatefound=function(){E.swState("updatefound");var a=e.installing;a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available; please refresh."),E.swState("newcontent"),t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),E.swState("cached"),t.onSuccess&&t.onSuccess(e)))}}}).catch(function(e){E.swState("error"),console.error("Error during service worker registration:",e)})}l.a.render(n.a.createElement(pn,null),document.getElementById("root")),-1!==window.location.href.indexOf("://app.")?function(e){if(E.swState("register"),"serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return void E.swState("unregistered");window.addEventListener("load",function(){E.swState("load");var t="".concat("","/service-worker.js");hn?(E.swState("load_localhost"),function(e,t){fetch(e).then(function(a){404===a.status||-1===a.headers.get("content-type").indexOf("javascript")?(E.swState("noserviceworker"),navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})})):mn(e,t)}).catch(function(){E.swState("error_local"),console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){E.swState("loaded_local"),console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):(E.swState("load_production"),mn(t,e))})}}({onUpdate:E.onUpdate,onSuccess:E.onSuccess}):(E.swState("unregister"),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()}))}},[[110,2,1]]]);
//# sourceMappingURL=main.f4cc2fe5.chunk.js.map