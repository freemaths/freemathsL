{"version":3,"sources":["ajax.js","Utils.js","maths.js","Login.js","vars.js","EditQuestion.js","Help.js","ReactMaths.js","Contact.js","mark.js","Keyboard.js","EditQuestions.js","Stats.js","Tests.js","Students.js","EditPast.js","PastPaper.js","EditBook.js","Books.js","StatsUI.js","AutoTest.js","Tutor.js","Admin.js","FreeMaths.js","serviceWorker.js","index.js"],"names":["ajax","url","action","data","token","error","fetch","ret","headers","Accept","X-Requested-With","Content-Type","FM-Token","window","FreeMaths","state","user","credentials","method","cache","body","JSON","stringify","FM-Env","process","params","then","res","ok","statusText","endsWith","text","json","catch","e","console","message","unit_debug","debug","func","length","indexOf","store_user","cached","id","log","concat","localStorage","zip","LZUTF8","compress","outputEncoding","setItem","name","unzip","parse","decompress","inputEncoding","question","qid","tests","questions","test","p","split","books","past","type","title","stats","showQ","hideP","showId","_p$split","_p$split2","Object","slicedToArray","t","ch","q","replace","isset","isAdmin","react_default","a","createElement","Utils_TooltipHover","tooltip","ModalBox","this","props","save","footer","Modal","Footer","Button","className","onClick","fn","show","bsSize","onHide","close","Header","closeButton","Title","Body","children","Component","fontSize","isMobile","TooltipHover","OverlayTrigger","placement","overlay","Tooltip","TooltipButton","copy","x","v","empty","UC1","toUpperCase","substr","ddmm","date","day","getDate","month","getMonth","ts","Date","hms","milli","space","sec","Math","floor","min","hour","parseError","Login","email","password","remember","login","preventDefault","r","_this","setState","fm","_this2","Row","Col","smOffset","sm","Panel","Heading","componentClass","Form","onSubmit","horizontal","FormGroup","controlId","validationState","ControlLabel","FormControl","value","placeholder","onChange","target","HelpBlock","bsStyle","currentTarget","blur","modal","Checkbox","Forgot","_this3","sending","send","_this4","Reset","password_confirmation","reset","_this5","_this6","Password","auth","to","_this7","lastLogId","_this8","Details","_this10","Login_Register","Login_Password","Register","_this11","pw","register","_this12","update","maths_keys","±","–","˽","√","π","∫","≈","≠","≥","≤","÷","≡","…","⇒","⟺","→","∞","α","β","γ","δ","Δ","ϵ","μ","λ","σ","Σ","θ","Π","∩","∪","×","⋅","°","_greek","du","dy","dx","_eq","∝","_op","is_numeric","isNaN","is_string","is_tree","esm_typeof","op","normalise","lhs","left","rhs","right","is_negative","rhs2","change_sign","tree","multiply","is_fraction","is_frac","f","compare","b","dpsf","vars","_a","_b","parse_expression","comp","allowCommute","compare_dpsf","c","i","commute","toPrecision","toFixed","compare_eval","evaluate","Array","isArray","used","j","includes","push","compare_multi","inputTree","depth","d","node","precedence","pop","mj","maths","output_tree","side","rt","substring","brackets","startsWith","func_multiple","not_func","equalsCache","replace_symbols","outTree","prec","parent_op","pruneTree","replace01","trimTree","isMinus1","parent","tokens","pos","condition","expression","ops","len","is","longer","k","s","algebra","token_split","peek_next","next_token","parse_expression_1","parse_primary","peek_current","opX","precedenceX","min_precedence","lookahead","right_assoc","substitute","calc","result","PI","E","is_xyz","xyz","sub","undefined","negative","_ret$split","_ret$split2","n","checkFraction","round","simplify","abs","pow","hcf","exp","sin","cos","tan","asin","acos","atan","toString","func_eval","map","l","eval_multi","f2","mixed","f1","fraction","keyword","frac_add","frac_mult","m","frac_equiv","whole","fraction_op","h","_s$split","_s$split2","prev","parse_error","val","trig","base","numeric","op2","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","err","return","set","str","match","op1","right1","expected","text_pos","next_tok","charAt","start","end","ifTrue","ifFalse","eq","eq2","parse_conditional","table","multiLine","tmp","limits","lim","katex","vec","join","parse_table","replace_vars","content","chunk","add_chunk","chunks","detectMaths","forEach","parse_maths","commafull","mathsjax","integrals","int","_maths$split","_maths$split2","integral","split_parse","replace_tags","identifier","string","setVariables","def","count","setUse","_ret","keys","opts","defs","_loop","vdef","vs","trim","options","testing","random","temp","randomise","false","true","set_state","get_vars","next_option","count_opts","orig","setVals","varDef","testList","use","names","vals","range","frac_range","range1","lines","line","check_skip","skip","v2","EditQuestion","variables","help","showHelp","cpy","previous_id","saveQ","updateQuestion","field","updated","changeVariables","setQ","nextProps","nextState","EditQuestion_Qlist","qs","EditQuestion_EditFields","fields","change","Qlist","key","topic","ReactMaths_Maths","EditFields","renderFields","newQ","EditQuestion_EditField","auto","html","EditField","caret","selectionStart","mathsSymbols","setStats","setSelectionRange","working","answer","keywords","comment","topics","dangerouslySetInnerHTML","__html","outputVars","ref","style","minWidth","rows","edit","JsonHelp","Help_EditHelp","Help_Help","Help","EditHelp","toLowerCase","require","Maths","row","tds","td","textAlign","width","txt","link","y","z","u","w","testxyz","ReactMaths_Latex","alt","src","maxWidth","Help_JsonHelp","display","Latex","renderToString","Contact","from","contact","qkey","reply","uid","students","Contact_EditMaths","checked","EditMaths","focus","selectionEnd","Mail","Contact_Contact","ans","units","checkAnswer","entered","attempt","stripEq","val_match","answers","correct","diff","mathDiff","markup","remaining","tok_a","tok_b","mod","sign","splice","Keyboard","keypad","calcInput","keyboard","keypress","newProps","newState","Keyboard_KeyPad","mark","inline","Keyboard_Equals","autoFocus","inputMode","isios","Keyboard_Units","Keyboard_KeyboardButton","Keyboard_Mark","Keyboard_KeyboardHelp","Keyboard_Buttons","Buttons","buttons","evaluateAnswer","sym","-","textClass","KeyboardHelp","Utils_TooltipButton","KeyboardButton","Equals","hover","Units","KeyPad","rownum","keyval","button","Keyboard_Key","scrollKB","scrollIntoView","_this9","readOnly","Key","unhover","click","onMouseEnter","onMouseLeave","Mark","EditQuestions","list","qk","qs2","qn","float","sum","add_c","apply","update_t","✗",":(","?✓",":|","✓",":)","mk","mks","effort","rs","sf","update_l","var_event","paper","uids","user_id","ts1","_q","xl","event","calcStats","last","users","getTime","","marks","analyse_r","unshift","pkey","calc_latest","totalSort","byDate","Tests","Books_Books","setTopic","Tests_PaperSelect","PastPaper_Past","PaperSelect","Students","cs","all","toggleAll","getStudents","setTest","setPaper","_key$split","_key$split2","setS","marking","PastPaper_PastMark","corrections","filter","calc_totals","o","src_Tests","Students_StudentSummary","setUid","Students_TestAnalysis","Students_QuestionAnalysis","StatsUI_QuestionAttempts","StatsUI_Comments","StudentSummary","sort","TDs","colSpan","Students_StudentSelect","THs","aria-hidden","TestAnalysis","tid","bind","qp","Students_PaperSelect","QuestionAnalysis","qSort","detail","xk","yk","byQ","localeCompare","totalSortQ","_qkey$split","_qkey$split2","qmap","findQ","subjects","papers","subject","StudentSelect","setUser","logout","isTutor","page","StatsUI_AskTutor","EditPast","updateQ","max","board","year","QP","MS","ER","total","EditPast_Q","EditPast_QP","size","rel","href","ms","Q","pages","er","qpx","ps","px","tipN","totalColour","Past","bar","links","ed","past_book","book","paperSort","src_EditPast","tqs","_pkey$split","_pkey$split2","PastMark","setMarks","info","test_id","setEffort","qc","hidden","PastPaper_QF","color","Utils_ModalBox","verticalAlign","PastPaper_Effort","Effort","QF","PastPaper_Marks","PastPaper_Smiley","Marks","Smiley","EditBook","isbn","chapters","EditBook_Chapters","Chapters","chapter","EditBook_Chapter","add","back","Chapter","exercises","EditBook_Exercises","es","Exercises","exercise","EditBook_Exercise","Exercise","EditBook_Questions","Questions","_q$q$split","_q$q$split2","String","fromCharCode","charCodeAt","rn","EditBook_Q","_this13","_this14","_this$props$pkey$spli","_this$props$pkey$spli2","bk","ex","ekey","find","Books_Marks","Books","cn","en","Books_Book","Book","src_EditBook","Books_Chapters","bkey","ckey","Books_Exercises","pk","sum_ts","smiley","rag","xs","xs0","Show","Re-try","✓✗","rating","tipMtd","hideName","tipM","tipTtd","slice","tipT","tipNtd","setC","tip","tipC","TD0s","tipT0","tipTtd0","ch1","ex1","p1","qn1","_x$key$split","_x$key$split2","Books_Exercise","_k$split3","_k$split4","qQp","_k$split","_k$split2","qMsEr","StatsUI_Cs","StatsUI_Adaptive","AskTutor","Cs","QuestionAttempts","Adaptive","expand","_x$key$split3","AutoTest_Mark","AutoTest_Answer","noBox","Comments","tdRAG","stat","item","num","tt","LevelSummary","setQs","level","AutoTest","last_log","logEvent","chooseQ","topicOptions","setTimeout","nextQ","updateLog","filterLog","buildTree","savedQ","retry","reload","levels","questionTopics","tl","latest","created_at","updateStats","session","today","now","lq","levelOptions","maxLevel","tp","AutoTest_Rate","AutoTest_QuestionSelect","selectQ","qt","AutoTest_TopicSelect","setVars","questionOptions","EditQuestion_EditQuestion","questionSelect","questionTopic","AutoTest_Question","src_EditQuestions","AutoTest_LevelSummary","Question","AutoTest_AnswerBlock","AnswerBlock","hint","hintShow","logmark","hide","AutoTest_HintShowButtons","src_Keyboard","AutoTest_HintShow","MarkHelp","colour","HintShowButtons","_this15","HintShow","Rate","_this17","Answer","AutoTest_MarkHelp","QuestionSelect","_this19","TopicSelect","_this20","Tutor","tutor","remove","tutors","added","removed","Tutor_TutorEmail","TutorEmail","Admin","tables","diffs","lz","load","expand_book","expand_past","number","question_id","expand_data","live","updated_at","data-dismiss","Admin_Diffs","Admin_Users","Diffs","Users","removeItem","location","pathname","lastIndexOf","getItem","load_user","search","decodeURIComponent","history","pushState","Login_Login","Students_Students","src_Admin","src_AutoTest","Contact_Mail","Login_Details","src_Tutor","Login_Forgot","Login_Reset","FreeMaths_FreeMathsNav","showPage","showModal","FreeMathsNav","nav","Nav","activeKey","NavItem","eventKey","pullRight","NavDropdown","MenuItem","onSelect","Navbar","collapseOnSelect","fixedTop","Brand","Toggle","Collapse","isLocalhost","Boolean","hostname","registerValidSW","swUrl","config","navigator","serviceWorker","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","ReactDOM","render","src_FreeMaths_0","document","getElementById","URL","origin","addEventListener","response","status","get","ready","unregister","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.993ccc64.chunk.js","sourcesContent":["function ajax(url,action,data,token) // token used when state not yet set\r\n{\r\n  let error=false\r\n  /*\r\n  if (process.env.NODE_ENV === 'test') return ajaxMock(url,action,data)\r\n  if (isset(window.app))\r\n  {\r\n    window.app.makeToast(\"ajax: \"+url)\r\n  }\r\n  */\r\n  //console.log(\"fetch %s\",url)\r\n  fetch(url,params(data,token))\r\n  .then(res=>{\r\n    if (!res.ok) error=res.statusText\r\n    //console.log('ajax',url,res)\r\n    return url.endsWith('.lz')?res.text():res.json()\r\n  })\r\n  .then(json=>{\r\n    //error?console.log(url,error,json):console.log(url,json)\r\n    if (action) action({error:error,data:json})\r\n  })\r\n  .catch(e=>{\r\n    console.error(url,error,e)\r\n    if (action) action({error:e,data:{error:error?error:e.message}})\r\n  })\r\n}\r\n\r\nfunction params(data,token)\r\n{\r\n  var ret;\r\n  if (!data) ret = {\r\n    headers: {\r\n      'Accept': 'application/json',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n      'FM-Token':window.FreeMaths.state.user?window.FreeMaths.state.user.token:null,\r\n      'FM-Env':JSON.stringify(process.env)\r\n    },\r\n    credentials: 'include',\r\n    method: 'get',\r\n    cache: 'default'\r\n  }\r\n  else ret = {\r\n    headers: {\r\n      'Accept': 'application/json',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n      'Content-Type': 'application/json',\r\n      'FM-Token':token?token:window.FreeMaths.state.user?window.FreeMaths.state.user.token:null\r\n    },\r\n    credentials: 'include',\r\n    method: 'post',\r\n    cache: 'no-cache',\r\n    body: JSON.stringify(data)\r\n  }\r\n  return ret\r\n}\r\n\r\nexport {ajax,params}\r\n","import React, { Component } from 'react'\r\nimport {OverlayTrigger,Tooltip,Modal,Button} from 'react-bootstrap'\r\nimport LZUTF8 from 'lzutf8'\r\n\r\nvar unit_debug=false\r\nfunction debug(func) {\r\n  if (unit_debug) return true\r\n  else if (window.FreeMaths && window.FreeMaths.state && window.FreeMaths.state.user && window.FreeMaths.state.user.debug)\r\n  {\r\n    if (window.FreeMaths.state.user.debug.length)\r\n    {\r\n      return window.FreeMaths.state.user.debug.indexOf(func)!==-1\r\n    }\r\n    else return true\r\n  }\r\n}\r\nfunction set_debug(val) {\r\n  unit_debug=val?val:true\r\n}\r\n\r\nfunction store_user(user,cached) {\r\n  if (cached && cached.id===user.id) user.log=cached.log.concat(user.log)\r\n  if (window.localStorage) try {\r\n    let json=JSON.stringify(user)\r\n    let zip=LZUTF8.compress(json,{outputEncoding:'Base64'})\r\n    window.localStorage.setItem('FMuser',zip)\r\n    console.log('user stored',user,zip.length)\r\n  } catch (e) {\r\n    console.error('user not stored',e.name,user)\r\n  }\r\n  return user\r\n}\r\n\r\nfunction clear_user() {\r\n  if (window.localStorage) window.localStorage.removeItem('FMuser')\r\n}\r\n\r\nfunction unzip(data) {\r\n  return JSON.parse(LZUTF8.decompress(data,{inputEncoding:\"Base64\"}))\r\n}\r\n\r\nfunction load_user() {\r\n  let user=null\r\n  if (window.localStorage && window.localStorage['FMuser']) {\r\n    try {\r\n      user=unzip(window.localStorage.getItem('FMuser'))\r\n      console.log('user set from localStorage',user)\r\n    } catch(e) {\r\n      console.error('failed to unzip user from localStorage',e)\r\n      window.localStorage.removeItem('FMuser')\r\n      user=null\r\n    }\r\n  }\r\n  return user\r\n}\r\n\r\n\r\n\r\nfunction values(o)\r\n{\r\n  return Object.keys(o).map(k=>o[k])\r\n}\r\n\r\nfunction question(qid)\r\n{\r\n  return window.FreeMaths.state.data.tests.questions[qid]\r\n}\r\n\r\nfunction test(p) // p can be tid\r\n{\r\n  const data=window.FreeMaths.state.data\r\n  if (typeof p==='string' && p.indexOf(':')>0) p=p.split(':')[0]\r\n  let ret=data.tests.tests[p]?data.tests.tests[p]:data.books[p]?data.books[p]:data.past[p]?data.past[p]:null\r\n  if (p===0 || p==='0') ret={id:0,type:'var',title:'Adaptive'}\r\n  //if (!ret) console.log('test',p,data)\r\n  return ret\r\n}\r\n\r\nfunction title(p,stats,showQ,hideP,showId)\r\n{\r\n  //stats=stats?stats:window.FreeMaths.state.data\r\n  if (!p) return null\r\n  if (stats && typeof p === 'string' && p.indexOf(':')>0) {\r\n    var [t,ch,e,q] =p.split(':') // p:ch:e:q - q not needed\r\n    p=t\r\n  }\r\n  if (t==='0') return \"Q\"+q // for adaptive\r\n  let title=test(p)?test(p).title.replace(/Edexcel_/,'').replace(/_/g,' '):p\r\n  if (isset(e) && e!=='') title+=\" \"+e\r\n  else if (isset(ch) && ch!=='') title+=\" \"+ch\r\n  if (hideP) title=''\r\n  if (isset(q) && showQ) title+=\" Q\"+q\r\n  if (window.FreeMaths.state.user&&window.FreeMaths.state.user.isAdmin && showId) title=<TooltipHover tooltip={p}>{title}</TooltipHover>\r\n  return title\r\n}\r\n\r\nclass ModalBox extends Component {\r\n  // title= close=() save={fn:,text:}\r\n  render()\r\n  {\r\n    if (typeof this.props.save !== 'undefined') var footer = <Modal.Footer><Button className=\"btn btn-sm btn-primary\" onClick={this.props.save.fn}>{this.props.save.text}</Button></Modal.Footer>\r\n    else footer = null\r\n    return(\r\n    <Modal show={true} name={this.props.name} bsSize=\"large\" onHide={this.props.close}>\r\n    <Modal.Header closeButton><Modal.Title>{this.props.title}</Modal.Title></Modal.Header>\r\n    <Modal.Body>\r\n    {this.props.children}\r\n    </Modal.Body>\r\n    {footer}\r\n    </Modal>)\r\n  }\r\n}\r\n\r\nfunction fontSize()\r\n{\r\n  return window.FreeMaths.state.user&&window.FreeMaths.state.user.isMobile?'large':'medium'\r\n}\r\n\r\nclass TooltipHover extends Component {\r\n  render() {\r\n    if (window.FreeMaths.state.user && window.FreeMaths.state.user.isMobile) return <span className={this.props.className}>{this.props.children}</span>\r\n    else return <OverlayTrigger placement={this.props.placement?this.props.placement:\"top\"} overlay={<Tooltip id=\"tooltip\">{this.props.tooltip}</Tooltip>}><span className={this.props.className}>{this.props.children}</span></OverlayTrigger>\r\n  }\r\n}\r\n\r\nclass TooltipButton extends Component {\r\n  render() {\r\n    if (window.FreeMaths.state.user && window.FreeMaths.state.user.isMobile) return <span className={this.props.className?this.props.className:'btn-link'} onClick={this.props.onClick}>{this.props.children}</span>\r\n    else return <OverlayTrigger placement=\"top\" overlay={<Tooltip id=\"tooltip\">{this.props.tooltip}</Tooltip>}><span className={this.props.className?this.props.className:'btn-link'} onClick={this.props.onClick}>{this.props.children}</span></OverlayTrigger>\r\n  }\r\n}\r\n\r\nfunction copy(x)\r\n{\r\n  return JSON.parse(JSON.stringify(x))\r\n}\r\n\r\nfunction isset(v)\r\n{\r\n  return typeof v !== 'undefined' && v !== null\r\n}\r\n\r\nfunction istrue(v)\r\n{\r\n  return typeof v !== 'undefined' && v === true\r\n}\r\n\r\nfunction empty(v)\r\n{\r\n  return typeof v === 'undefined' || v === null || v.length === 0\r\n}\r\n\r\nfunction UC1(name)\r\n{\r\n  return name[0].toUpperCase()+name.substr(1,name.length-1)\r\n}\r\n\r\nfunction ddmmyy(date)\r\n{\r\n  var day = date.getDate()\r\n  if (day < 10) day='0'+day\r\n  var month = date.getMonth() + 1\r\n  if (month < 10) month='0'+month\r\n  var year= date.getFullYear()%100\r\n  if (year < 10) year='0'+year\r\n  return day+'/'+month+'/'+year\r\n}\r\n\r\nfunction ddmm(date)\r\n{\r\n  var day = date.getDate()\r\n  if (day < 10) day='0'+day\r\n  var month = date.getMonth() + 1\r\n  if (month < 10) month='0'+month\r\n  return day+'/'+month\r\n}\r\n\r\nfunction hhmm(date)\r\n{\r\n  var hour = date.getHours()\r\n  if (hour < 10) hour='0'+hour\r\n  var min = date.getMinutes()\r\n  if (min < 10) min='0'+min\r\n  return hour+':'+min\r\n}\r\n\r\nfunction date(ts)\r\n{\r\n  if (!isset(ts) || ts === 0) return \"\"\r\n  var dt = new Date(ts*1)\r\n  return ddmm(dt)\r\n}\r\n\r\nfunction dateTime(ts)\r\n{\r\n  var dt = new Date(ts*1)\r\n  return ddmm(dt)+' '+hhmm(dt)\r\n}\r\n\r\nfunction hms(milli,space)\r\n{\r\n  if (!isset(milli)) return ''\r\n  if (typeof space === 'undefined') space = ''\r\n  var sec = Math.floor(milli/1000)\r\n  if (sec === 0) return ''\r\n  var min = Math.floor(sec/60)\r\n  sec-=min*60\r\n  var hour = Math.floor(min/60)\r\n  min-=hour*60\r\n  if (sec < 10) sec = '0'+sec\r\n  if (hour > 0) {\r\n    if (min < 10) min = '0'+min\r\n    var ret= hour+':'+min+':'+sec\r\n  } else ret= min+':'+sec\r\n  //console.log(\"%s=%s\",milli,ret)\r\n  return space+ret\r\n}\r\n\r\n/*\r\nclass Time extends Component {\r\n  render() {\r\n    var hrs=[], mins=[]\r\n    for (var i=0; i<10; i++) hrs.push(<option key={i}>{i}</option>)\r\n    for (i=0; i<60; i++) mins.push(<option key={i}>{i<10?'0'+i:i}</option>)\r\n    return <span><select value={this.props.effort.hrs} className=\"btn btn-default btn-sm\" onChange={(e)=>this.props.setEffort('hrs',e.target.value)}>{hrs}</select>\r\n    :<select value={this.props.effort.mins} className=\"btn btn-default btn-sm\" onChange={(e)=>this.props.setEffort('mins',e.target.value)}>{mins}</select></span>\r\n  }\r\n}\r\n\r\nclass Dates extends Component {\r\n  render() {\r\n    var month = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\",\"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\r\n    var date = new Date()\r\n    if (this.props.date > 0)  date.setTime(this.props.date)\r\n    date.setHours(0,0,0,0)\r\n    //console.log(\"date=%s %s\",this.props.date,date.getTime())\r\n    var opts = [<option key={0} value=\"0\">Select</option>]\r\n    for (var i=1; i<14; i++) {opts.push(<option value={date.getTime()} key={i}>{date.getDate()} {month[date.getMonth()]} {date.getFullYear()}</option>); date.setDate(date.getDate()-1);}\r\n    return <select value={this.props.date} className=\"btn btn-default btn-sm\" onChange={(e)=>this.props.setDate(e.target.value)}>{opts}</select>\r\n  }\r\n}\r\n*/\r\n\r\nexport {ModalBox,TooltipHover,TooltipButton,fontSize,isset,istrue,empty,ddmmyy,hms,date,dateTime,title,copy,UC1,values,test,question,debug,set_debug,store_user,load_user,clear_user,unzip}\r\n","//TODO add support for factorial\r\nimport {debug} from './Utils'\r\nvar parseError // TODO get rid of this\r\n// should combine these lists\r\nconst maths_keys={'±':'+-','–':'\\\\-','˽':'\\\\ ','√':'\\\\2','π':'\\\\p','∫':'\\\\[','≈':'~=','≠':'/=','≥':'>=','≤':'<=','÷':'\\\\/','≡':'==','…':'...','⇒':'=>','⟺':'<>','→':'->','∞':'\\\\i','α':'\\\\a','β':'\\\\b','γ':'\\\\g','δ':'\\\\d','Δ':'\\\\D','ϵ':'\\\\e','μ':'\\\\m','λ':'\\\\l','σ':'\\\\s','Σ':'\\\\S','θ':'\\\\t','Π':'\\\\P','∩':'\\\\^','∪':'\\\\v','×':'\\\\*','⋅':'\\\\.','°':'\\\\o'}\r\n//const _greek={'α':'\\\\aplha','β':'\\\\beta','γ':'\\\\gamma','δ':'\\\\delta','ϵ':'\\\\epsilon','μ':'\\\\mu','π':'\\\\pi','σ':'\\\\sigma','θ':'\\\\theta','Σ':'\\\\Sigma','…':'...'}\r\nconst _greek={'du':'du','dy':'dy','dx':'dx','α':'α','β':'β','γ':'γ','δ':'δ','ϵ':'ϵ','μ':'μ','λ':'λ','π':'π','σ':'σ','θ':'θ','Σ':'Σ','…':'…','°':'^o','Δ':'Δ'}\r\n//const _eq={'≥':'\\\\ge','≤':'\\\\le','≠':'\\\\ne','≡':'\\\\equiv','≈':'\\\\approx','⇒':'\\\\Rightarrow','∝':'\\\\propto'}\r\nconst _eq={'≥':'≥','≤':'≤','≠':'≠','≡':'≡','≈':'≈','⇒':'⇒','∝':'∝','⟺':'⟺'}\r\n//const _op={'÷':'\\\\div','±':'\\\\pm','√':'\\\\sqrt','∩':'\\\\cap','∪':'\\\\cup','×':'\\\\times'}\r\nconst _op={'÷':'÷','±':'±','–':'-','√':'√','∩':'∩','∪':'∪','×':'×','⋅':'⋅','˽':'˽'}\r\n\r\nfunction is_numeric(a)\r\n{\r\n\treturn !isNaN(a)&&a!==''&&a!==false&&a!==true&&a!==null;\r\n}\r\n\r\nfunction is_string(a)\r\n{\r\n\treturn (typeof a === 'string' || is_numeric(a));\r\n}\r\n\r\nfunction is_tree(a)\r\n{\r\n\treturn (a&&typeof a==='object'&&a.op)\r\n}\r\n\r\nfunction normalise(t)\r\n{\r\n\tif (typeof t === 'undefined') console.error(\"normalise() called with null tree\");\r\n\t//else if (Array.isArray(t)) return t.map(v=>{return normalise(v)})\r\n\tvar ret = t\r\n\tif (ret && !is_string(ret))\r\n\t{\r\n\t\tvar lhs = normalise(ret.left);\r\n\t\tvar rhs = normalise(ret.right);\r\n\r\n\t\tif (ret.op === '^' && is_negative(rhs))\r\n\t\t{\r\n\t\t\t// should also split multiplicative terms (xy)^.5 = x^.5y^.5\r\n\t\t\tvar rhs2 = change_sign(rhs);\r\n\t\t\tif (rhs2*1 === 1) ret = tree('1','/',lhs);\r\n\t\t\telse ret = tree('1','/',tree(lhs,'^',rhs2));\r\n\t\t}\r\n\t\telse if (ret.op==='*' || ret.op===' ' || ret.op==='(')\r\n\t\t{\r\n\t\t\tret = multiply(lhs,rhs);\r\n\t\t}\r\n\t\telse if (ret.op === '√')\r\n\t\t{\r\n\t\t\tret = tree(rhs,'^',tree('1','/','2'));\r\n\t\t}\r\n\t\telse ret = tree(lhs,ret.op,rhs);\r\n\t}\r\n\t//if ($tree == $ret) Log::debug(\"normalise(\".$this->output_tree($tree).\") unchanged\");\r\n\t//else Log::debug(\"normalise(\".$this->output_tree($tree).\") => \".$this->output_tree($ret));\r\n\treturn ret\r\n}\r\n\r\nfunction is_fraction(tree)\r\n{\r\n\treturn (is_tree(tree) && tree.op === '/')\r\n}\r\n\r\nfunction is_frac(f)\r\n{\r\n // for evaluate - allow negative or mixed fractions\r\n let ret=false\r\n if (!is_tree(f)) ret=false\r\n else if (is_numeric(f.left) && f.op==='/' && is_numeric(f.right)) ret=true\r\n else if (is_numeric(f.left) && f.op==='˽' && is_fraction(f.right)) ret=is_frac(f.right) // mixed fraction\r\n else if (is_negative(f)) ret=is_frac(change_sign(f))\r\n //console.log(\"is_frac\",f,ret,f.op)\r\n return ret\r\n}\r\n\r\nfunction multiply(left,right)\r\n{\r\n\tvar ret;\r\n\tif (is_fraction(left) && is_fraction(right))\r\n\t{\r\n\t\tret = tree(multiply(left.left,right.left),'/',multiply(left.right,right.right));\r\n\t}\r\n\telse if (is_fraction(left))\r\n\t\tret = tree(multiply(left.left,right),'/',left.right);\r\n\telse if (is_fraction(right))\r\n\t\tret = tree(multiply(left,right.left),'/',right.right);\r\n\telse\r\n\t{\r\n\t\tif (left*1 === 1) ret = right;\r\n\t\telse if (right*1 === 1) ret = left;\r\n\t\telse ret = tree(left,'*',right);\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nfunction compare(a,b,dpsf,vars)\r\n{\r\n\tlet ret,_a,_b\r\n\tif (a===b) ret=true // save all the work\r\n\telse {\r\n\t\t_a=parse_expression(a,vars)\r\n\t\t_b=parse_expression(b,vars)\r\n\t\tret=a!==false&&b!==false&&comp(normalise(_a),normalise(_b),true,dpsf)\r\n\t}\r\n\t//console.log('compare',a,b,dpsf,vars,_a,_b,ret,parseError)\r\n\treturn ret\r\n}\r\n\r\nfunction compare_dpsf(a,b,dpsf)\r\n{\r\n\t//console.log(\"compare_dpsf(a,b,dpsf)\",a,b,dpsf)\r\n\tif (!is_numeric(a) || !is_numeric(b)) return a === b\r\n\ta=a*=1; b=b*=1 // make sure number not string type\r\n\tif (dpsf && dpsf !== '')\r\n\t{\r\n\t\tif (dpsf.endsWith('sf')) var ret=a.toPrecision(dpsf[0]) === b.toPrecision(dpsf[0])\r\n\t\telse if (dpsf.endsWith('dp')) ret=a.toFixed(dpsf[0]) === b.toFixed(dpsf[0])\r\n\t}\r\n\telse ret =  a.toPrecision(10) === b.toPrecision(10)\r\n\treturn ret\r\n}\r\n\r\nfunction compare_multi(a,b,dpsf)\r\n{\r\n\tif (!Array.isArray(a) || !Array.isArray(b) || a.length===0 || a.length !== b.length) return false\r\n\tvar ret=true,i=0,used=[]\r\n\twhile (ret && i<a.length) {\r\n\t\tif (dpsf && dpsf[0]===',') {\r\n\t\t\tlet r=false\r\n\t\t\tfor (var j=0; j<b.length&&!r; j++) {\r\n\t\t\t\tif (!used.includes(j)) r=compare_dpsf(a[i],b[j],dpsf.substr(1))\r\n\t\t\t}\r\n\t\t\tif (r) used.push(j-1) // j++ since match\r\n\t\t\tret = r\r\n\t\t}\r\n\t\telse ret = compare_dpsf(a[i],b[i],dpsf)\r\n\t\ti++\r\n\t}\r\n\t//console.log(\"compare_multi\",a,b,ret)\r\n\treturn ret\r\n}\r\n\r\nfunction compare_eval(a,b,dpsf,vars)\r\n{\r\n\t// beware global vars needs to be set by calling routine to replace variables\r\n\tvar _a,_b\r\n\t_a = parse_expression(a,vars)\r\n\tif (parseError !== '') return a===b\r\n\t_b = parse_expression(b,vars)\r\n\tif (parseError !== '') return a===b\r\n\t_a=evaluate(_a,vars)\r\n\t_b=evaluate(_b,vars)\r\n\t//console.log(\"compare_eval\",a,b,_a,_b,dpsf)\r\n\tif (Array.isArray(_a) || Array.isArray(_b)) return compare_multi(_a,_b,dpsf)\r\n\telse return compare_dpsf(_a,_b,dpsf)\r\n}\r\n\r\nfunction comp(a,b,allowCommute,dpsf)\r\n{\r\n\t\tif (typeof allowCommute === \"undefined\") allowCommute = true;\r\n\t\t//console.log(\"comp\",a,b,allowCommute,dpsf);\r\n\t\tvar ret = false;\r\n\t\tif (is_numeric(a) && is_numeric(b)) ret = compare_dpsf(a,b,dpsf) // could evaluate\r\n\t\t//else if (Array.isArray(a) || Array.isArray(b)) ret = compare_multi(a,b,dpsf)\r\n\t\t//else if (is_numeric(evaluate(a)) && is_numeric(evaluate(b))) ret=compare_dpsf(evaluate(a),evaluate(b),dpsf)\r\n\t\telse if (a===null || b===null) ret = a===b\r\n\t\telse if (is_string(a) && is_string(b)) ret = (a === b)\r\n\t\telse if (is_string(a) || is_string(b)) ret = false //frac_comp(a,b);\r\n\t\t//else if (typeof a !== 'object' || typeof b !== 'object') console.error(\"comp error\",a,b,allowCommute,dpsf)\r\n\t\telse if (comp(a.right,b.right,true,dpsf))\r\n\t\t{\r\n\t\t\tif (a.op===' ' || a.op==='(') a.op = '*';\r\n\t\t\tif (b.op===' ' || b.op==='(') b.op = '*';\r\n\t\t\tif (a.op === b.op) ret = comp(a.left,b.left,true,dpsf);\r\n\t\t\telse ret = false;\r\n\t\t}\r\n\t\telse if (is_negative(a) && comp(change_sign(a),change_sign(b),false,dpsf)) ret = true;\r\n\t\telse if (allowCommute)\r\n\t\t{\r\n\t\t\tvar i = 0;\r\n\t\t\tvar c;\r\n\t\t\t//eslint-disable-next-line\r\n\t\t\twhile (ret === false && (c = commute(b,i++))) ret = comp(a,c,false,dpsf);\r\n\t\t}\r\n\t\telse ret = false;\r\n\t\t//if (typeof a === 'object' && a.op === ',') console.log('comp',a,b,allowCommute,ret)\r\n\t\treturn ret;\r\n\t}\r\n\r\n/*\r\n\tfunction frac_comp(a,b)\r\n\t{\r\n\t\tvar ret = false;\r\n\t\tif (is_numeric(a))\r\n\t\t{\r\n\t\t\tif (is_string(b)) ret = (a*1 === b*1);\r\n\t\t\telse if (b.op === '/' && is_numeric(b.left) && is_numeric(b.right)) ret = (a*1 === b.left/b.right);\r\n\t\t}\r\n\t\telse if (is_numeric(b))\r\n\t\t{\r\n\t\t\tif (is_string(a)) ret = (a*1 === b*1); // need to check this in javascript\r\n\t\t\telse if (a.op === '/' && is_numeric(a.left) && is_numeric(a.right)) ret =  (b*1 === a.left / a.right);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}*/\r\n\r\n\r\n\tfunction commutative(op)\r\n\t{\r\n\t\treturn op === '*' || op === '+' || op === ' ' || op === '(' || op === ',' //  op === ',' || op === ','\r\n\t}\r\n\r\n\tfunction commute(inputTree,depth)\r\n\t{\r\n\t\tif (inputTree === null) console.error(\"commute() called with null inputTree\");\r\n\t\tvar t = inputTree;\r\n\t\tvar d = 0;\r\n\t\tvar node = [];\r\n\t\tif (!is_string(t))\r\n\t\t{\r\n\t\t\tvar p = precedence(t.op);\r\n\t\t\twhile (!is_string(t) && precedence(t.op) === p)\r\n\t\t\t{\r\n\t\t\t\tnode[d] = {right: t.right, op: t.op};\r\n\t\t\t\tt = t.left;\r\n\t\t\t\td++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (t === '' && node[d-1].op === '-')\r\n\t\t{\r\n\t\t\td--;\r\n\t\t\tt = node.pop(); // array_pop(node)\r\n\t\t\tt.left = '';\r\n\t\t\tif (d === depth+1) node[d] = t; // put it back!!\r\n\t\t}\r\n\t\telse if (d === depth+1)\r\n\t\t{\r\n\t\t\tnode[d] = {right: t, op: (p === precedence('+'))?'+':'*'};\r\n\t\t}\r\n\t\tif (d > depth)\r\n\t\t{\r\n\t\t\tdepth++; // avoid constantly using depth+1\r\n\t\t\tif (d === depth) {\r\n\t\t\t\tif (node[0].op === '-') t = change_sign(node[0].right);\r\n\t\t\t\telse if (commutative(node[0].op)) t = node[0].right;\r\n\t\t\t\telse t = false;\r\n\t\t\t}\r\n\t\t\tvar i;\r\n\t\t\tif (t !== false) for (i=d-1; i > 0; i--)\r\n\t\t\t{\r\n\t\t\t\tif (depth === i) t = tree(t,node[0].op,node[0].right);\r\n\t\t\t\telse t = tree(t,node[i].op,node[i].right);\r\n\t\t\t}\r\n\t\t\tif (t !== false)\r\n\t\t\t{\r\n\t\t\t\tif (is_negative(node[depth].right) && node[depth].op === '+') t = tree(t,'-',change_sign(node[depth].right))\r\n\t\t\t\telse t = tree(t,node[depth].op,node[depth].right);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse t = false;\r\n\t\t//console.log('commute(%s,%s)=%s',outTree(inputTree),depth,outTree(t))\r\n\t\treturn t;\r\n\t}\r\n\r\n\tfunction change_sign(t)\r\n\t{\r\n\t\tlet ret=t\r\n\t\tif (is_negative(t))\r\n\t\t{\r\n\t\t\tif (t.left === '') ret=t.right // TODO perhaps bug - need to change sign of all +- terms?\r\n\t\t\t//else if (t.op === '-') ret=tree(change_sign(t.left),'+',t.right) // negative mixed fraction\r\n\t\t\telse ret=tree(change_sign(t.left),t.op,t.right)\r\n\t\t}\r\n\t\telse if (!is_string(t) && (t.op === '*' || t.op === ' ' || t.op === '(')) ret=tree(change_sign(t.left),t.op,t.right)\r\n\t\telse ret=tree('','-',t)\r\n\t\t//console.log('change_sign',t,ret)\r\n\t\treturn ret\r\n\t}\r\n\r\n\tfunction is_negative(tree)\r\n\t{\r\n\t\t// TODO bug - need to check sign of all +- terms?\r\n\t\treturn (is_tree(tree) && ((tree.left === '' && tree.op === '-')\r\n\t\t\t\t|| ((tree.op === '*' || tree.op === ' ' || tree.op === '(' || tree.op === '/') && is_negative(tree.left))));\r\n\t}\r\n\r\nfunction mj(maths,vars) {\r\n\t  var ret = output_tree(parse_expression(maths,vars));\r\n\t  if (parseError !== '')\r\n\t  {\r\n\t\t  maths = maths.replace(/</g,'&lt;').replace(/>/g,'&gt;'); // HTML encoding\r\n\t\t  ret = \"<span class=\\\"red\\\">\"+((parseError!=='?')?'?':'')+ parseError + \"</span>\"+maths;\r\n\t  }\r\n\telse {\r\n\t\t\tret = ''+ret; // convert to string if number\r\n\t\t\tret = replace_symbols(ret)\r\n\t\t\tret = ret.replace(/S_([a-z][a-z])/g,'S_{$1}'); // S_xx,S_xy ...\r\n\t\t  // pattern for single mixed fraction A+b/c to make A b/c\r\n\t\t  //ret = ret.replace(/^([=]?)([\\d]+)\\+(\\\\)d(frac{[\\d]+}{[\\d]+})$/,'$1\\\\Large{$2$3$4}');\r\n\t\t  // pattern for single mixed fraction -A-b/c to make -A b/c\r\n\t\t  //ret = ret.replace(/^([=]?)(-[\\d]+)-(\\\\)d(frac{[\\d]+}{[\\d]+})$/,'$1\\\\Large{$2$3$4}');\r\n\t\t  //var ret1 = ret;\r\n\t\t  ret = \"\" + ret + \"\";\r\n\t  }\r\n\t  return ret;\r\n\t};\r\n\r\n\tfunction token_split(maths,vars) {\r\n\t  var ret = [];\r\n\t  var token = \"\";\r\n\t  var t = 0;\r\n\t  //const ops = '+-*/÷^√(),=<>≠≤≥{}[]|~≡⇒±'; // must also add to precedence\r\n\t\tconst ops = '+-*/^(),=<>{}[]|~±'; // must also add to precedence\r\n\r\n\t  for (var i = 0, len = maths.length; i < len; i++) {\r\n\t\t\tif (maths[i]==='{') condition=true // to recognise vars as algebraic terms\r\n\t\t\telse if (maths[i]==='}') condition=false\r\n\t    if (ops.indexOf(maths[i]) !== -1 || is('symbol',maths[i])) {\r\n\t      if (token.length > 0) ret[t++] = token;\r\n\t      token = \"\";\r\n\t\t\t\tif (maths[i] === '\\'') ret[t]+='\\''\r\n\t      else ret[t++] = maths[i];\r\n\t    }\r\n\t    else {\r\n\t    \tif (token.length > 0 && (isNaN(token) && token !== '.') !== (isNaN(maths[i]) && maths[i] !== '.'))\r\n\t    \t{\r\n\t    \t\tret[t++] = token;\r\n\t    \t\ttoken = \"\";\r\n\t    \t}\r\n\t    \ttoken += maths[i];\r\n\r\n\t\t\t\tvar longer = token\r\n\t\t\t\tvar k=-1\r\n\t\t\t\tfor (var s=t;s>=0;s--) // take longest e.g. cosec not cos e c\r\n\t\t\t\t{\r\n\t\t\t\t\tif (func(longer,vars) || algebra(longer,vars))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttoken = longer;\r\n\t\t\t\t\t\t\tk = s\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (s===0 || ops.indexOf(ret[s-1]) !== -1) break;\r\n\t\t\t\t\telse longer=ret[s-1]+longer\r\n\t\t\t\t\t//console.log(\"%s=%s\",s-1,longer)\r\n\t\t\t\t}\r\n\t\t\t\tif (k !== -1)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (k<t) ret.length=k // truncate array\r\n\t\t\t\t\tt=k\r\n\t\t\t\t\tret[t++] = token;\r\n\t\t\t\t\t//console.log(ret[t-1])\r\n\t\t\t\t\ttoken = ''\r\n\t\t\t\t}\r\n\t    }\r\n\t  }\r\n\t  if (token.length > 0) ret[t] = token;\r\n\t\t//console.log(\"token\",ret)\r\n\t\tcondition=false // incase { with no }\r\n\t  return ret;\r\n\t};\r\n\r\n\r\nfunction outTree(tree,prec,parent_op)\r\n{\r\n\tvar ret = tree\r\n\tif (typeof parent_op === \"undefined\") parent_op = '';\r\n\tif (typeof prec === \"undefined\") prec = 0;\r\n\tif (is_tree(tree)) {\r\n\t\t//var op = (ret.op === ' ')?'*':ret.op;\r\n\t\tvar p=precedence(tree.op);\r\n\t\tif (tree.op === '-' && tree.left === '') p = precedence('*') // negative\r\n\t\tret = outTree(tree.left,p)+(tree.op===' '?'':tree.op)+outTree(tree.right,p,tree.op);\r\n\t\tif (p < prec || (parent_op === '/' && p === precedence('*') && tree.op !== '/')) ret = \"(\"+ret+\")\";\r\n\t\t//console.log(\"outTree(%s%s%s,%s)=%s\",tree.left,tree.op,tree.right,prec,ret)\r\n\t}\r\n\tif (ret === false || ret === '') return ret // false for commute '' for functions or negatives avoid matching == 0\r\n\telse if (is_numeric(ret) && ret*1 === 0) return '0'\r\n\telse if (ret*1 === 1) return '1'\r\n\telse return ''+ret;\r\n}\r\n\r\nfunction pruneTree(tree)\r\n{\r\n\treturn tree?replace01(trimTree(tree)):tree\r\n}\r\n\r\nfunction replace01(t)\r\n{\r\n\tif (!is_tree(t))\r\n\t{\r\n\t\tif (t === '0.0') return 0\r\n\t\telse if (t === '1.0') return 1\r\n\t\telse return t;\r\n\t}\r\n\telse return tree(replace01(t.left),t.op,replace01(t.right))\r\n}\r\n\r\nfunction trimTree(t)\r\n{\r\n\tif (!is_tree(t)) return t\r\n\r\n\tvar op = (t.op===' '||t.op==='(')?'*':t.op;\r\n\tvar left = trimTree(t.left)\r\n\tvar right = trimTree(t.right)\r\n\tvar ret\r\n\tif (is_negative(right) && ((t.op === '+') || (t.op === '-')))\r\n\t{\r\n\t\tright = change_sign(right)\r\n\t\tif (t.op === '+') {\r\n\t\t\top='-'\r\n\t\t\tret=tree(left,'-',right)\r\n\t\t}\r\n\t\telse if (t.op === '-')\r\n\t\t{\r\n\t\t\top='+'\r\n\t\t\tret=tree(left,'+',right)\r\n\t\t}\r\n\t}\r\n\telse ret = tree(left,t.op,right) // default\r\n\tif (left === '0.0')\r\n\t{\r\n\t\tif (op === '*') ret = \"0.0\"\r\n\t\telse if (op === '+') ret = right\r\n\t\telse if (op === '-')\r\n\t\t{\r\n\t\t\tif (right === '0.0') ret = \"0.0\"\r\n\t\t\telse ret = tree('','-',right)\r\n\t\t}\r\n\t}\r\n\telse if (right === \"0.0\")\r\n\t{\r\n\t\tif (op === '*') ret = \"0.0\"\r\n\t\telse if (op === '+' || op === '-') ret = left\r\n\t\telse if (op === '^') ret = '1.0'\r\n\t}\r\n\telse if (left === '1.0')\r\n\t{\r\n\t\tif (op === '*') ret = right\r\n\t\telse if (op === '^') ret = '1.0'\r\n\t}\r\n\telse if (right === '1.0')\r\n\t{\r\n\t\tif (op === '*' || op === '^') ret = left\r\n\t}\r\n\telse if (op === '*')\r\n\t{\r\n\t\tif (isMinus1(left)) ret = tree('','-',right)\r\n\t\telse if (isMinus1(right)) ret = tree('','-',left)\r\n\t}\r\n\treturn ret\r\n}\r\n\r\nfunction isMinus1(tree)\r\n{\r\n\treturn (is_tree(tree) && tree.left === '' && tree.op === '-' && tree.right*1 === 1)\r\n\t//if (tree.right*1 === 1) console.log(\"isMinus1 %s=%s\",JSON.stringify(tree),ret)\r\n\t//return ret\r\n}\r\n\r\nfunction brackets(parent,side)\r\n{\r\n\tvar t;\r\n\tif (typeof side  === 'undefined')  t = parent;\r\n\telse if (side === 'left') t = parent.left;\r\n\telse if (side === 'right') t = parent.right;\r\n\tif (is_tree(t))\r\n\t{\r\n\t\tif (parent.op === '/' || (side === 'right' && (parent.op === '^' || parent.op === '√'))) return false\r\n\t\telse if (t.op === '^' && is_tree(t.left) && (t.left.op === '^' || t.left.op === '/')) return true\r\n\t\telse if (t.op === '-' && t.left === '' && parent.op !== '^') return false;\r\n\t\telse return precedence(parent.op) > precedence(t.op);\r\n\t}\r\n\telse\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nvar equalsCache='';\r\nfunction output_tree(tree, side, rt, f) {\r\n\tif (!tree) return \"\";\r\n\tvar ret = '';\r\n\t//console.log(\"output_tree\",tree,side,rt,f);\r\n\tvar t;\r\n\tif (side) f = f||tree.op==='/'||(tree.op==='^'&&side==='right');\r\n\tif (!side) t = tree\r\n\telse if (side === 'left')\r\n\t{\r\n\t\tt = tree.left;\r\n\t\trt = tree;\r\n\t}\r\n\telse if (side === 'right') t = tree.right;\r\n\r\n\tif (!is_tree(t))\r\n\t{\r\n\t\t if (t === 'g') ret = '\\\\text{g}' // force font for gravity\r\n\t\t else if (is_numeric(t) && t*1 === 0) ret = '0'\r\n\t\t else if (t*1 === 1) ret = '1'\r\n\t\t else ret = ''+t\r\n\t\t equalsCache=ret\r\n\t}\r\n  else {\r\n\t\tlet left = output_tree(t,'left',rt, false,f);\r\n    var right = output_tree(t,'right',rt,f);\r\n    var op = t.op;\r\n\r\n    if (op === '*' || op === '(' || op === ')' || op === ' ')\r\n\t\t{\r\n    \tif (right[0] === '-' || !isNaN(right[0]) || right.substring(0,6) === \"\\\\dfrac\") op=op==='('?'(':'×'\r\n    \telse op = ' ';\r\n\t\t}\r\n    if (op === '/')\r\n    {\r\n    \tif (f) ret = \"\\\\frac{\" + left + \"}{\" + right + \"}\";\r\n    \telse ret = \"\\\\dfrac{\" + left + \"}{\" + right + \"}\";\r\n    }\r\n\t\telse if (op==='˽')\r\n\t\t{\r\n\t\t\tret=\"{\\\\Large{\"+left+\"}}\"+right\r\n\t\t}\r\n    else if(op === '^') {\r\n\t\t\tif (brackets(tree,side))\r\n\t\t\t{\r\n\t\t\t\tif (left.indexOf('\\\\dfrac') !== -1) ret = \"\\\\Big(\" + left + \"\\\\Big)^{\" + right + \"}\";\r\n\t\t\t\telse ret = \"(\" + left + \")^{\" + right + \"}\";\r\n\t\t\t}\r\n\t\t\telse if (left.startsWith('(') && left.indexOf('\\\\dfrac') !== -1){\r\n\t\t\t\tret = \"\\\\Big\" + left.substring(0,left.length-1) + \"\\\\Big)^{\" + right + \"}\";\r\n\t\t\t}\r\n\t\t\telse ret = left + \"^{\" + right + \"}\";\r\n\t\t}\r\n\t\telse if(op === '|') ret = \"\\\\left|\" + right + \"\\\\right|\"; // hack for g regexp \\\\right breaks\r\n    else if(op === '√') ret = \"\\\\sqrt{\" + right + \"}\\\\,\";\r\n    else if (op === '(,)') ret = \"(\"+left+\",\"+right+\")\";\r\n\t\t// case for -(5+3) but not now --4\r\n\t\telse if (op === '-' && !is_string(t.right) /*&& t.right.left !== ''*/ && (t.right.op === '+' || t.right.op === '-'))\r\n    {\r\n    \t\tif ( t.right.left !== '') ret = left +op + '('+ right+ ')';\r\n\t\t\t\telse ret = left +op + '{'+ right+ '}';\r\n\t\t}\r\n    else if (func(op))\r\n    {\r\n\t\t\tif (func_multiple(t.right)) ret = \"\\\\\"+op+'(' + right + ')'; // avoid ambiguity\r\n    \telse if (brackets(t,'right')  && !(is_tree(t.right) && t.right.op === '^'))\r\n\t\t\t{\r\n\t\t\t\tif (op === 'f') ret = left+\" \"+op+ '{' + right + '}';\r\n\t\t\t\telse ret = left+\"\\\\\"+op+ '{' + right + '}'; // none needed - already there\r\n\t\t\t}\r\n\t\t\telse if (right.indexOf('\\\\times') !== -1 || right.indexOf('(') !== -1) ret = \"\\\\\"+op+ '(' + right + ')'; // needs refining\r\n    \telse if (side === 'left' && (tree.op===' ' || (tree.op==='*' && not_func(tree.right)) || tree.op === '^')) ret = \"\\\\\"+op+ '(' + right + ')';\r\n    \telse if (side === 'right' && is_tree(rt) && !brackets(rt,'left') && ((rt.op === '*' && not_func(rt.right)) || rt.op===' ')) ret = \"\\\\\"+op+ '(' + right + ')';\r\n\t\t\telse if (op === 'f') ret = op+'(' + right + ')';\r\n    \telse ret = \"\\\\\"+op+'{' + right + '}'; // none needed\r\n    }\r\n    else if (brackets(tree,side)) ret = \"(\" + left + op + right + \")\";\r\n\t\telse if (op==='(') ret=left+'('+right+')'\r\n    else ret =left + op + right;// + op==='('?')':'';\r\n\t\tif (op === '=') equalsCache=right; // extend to other operators (e.g. '<') - precedemce(op) === 1\r\n\t\telse equalsCache=ret;\r\n\t\t//console.log('equalsCache',equalsCache)\r\n  }\r\n  return ''+ret // make sure we return a sring (even if empty)\r\n};\r\n\r\nfunction not_func(tree)\r\n{\r\n\treturn !(is_tree(tree) && func(tree.op));\r\n}\r\n\r\nfunction func_multiple(tree)\r\n{\r\n\tif (is_string(tree)) return false;\r\n\telse if (func(tree.op)) return true;\r\n\telse if (tree.op === '*' || tree.op === '(' || tree.op === ')' || tree.op === ' ') return (func_multiple(tree.left) || func_multiple(tree.right));\r\n}\r\n/*\r\nadditive-expression ::= multiplicative-expression ( ( '+' | '-' ) multiplicative-expression ) *\r\nmultiplicative-expression ::= primary ( ( '*' | '/' ) primary ) *\r\nprimary ::= '(' expression ')' | NUMBER | VARIABLE | '-' primary\r\n\r\nparse_expression ()\r\n    return parse_expression_1 (parse_primary (), 0)\r\nparse_expression_1 (lhs, min_precedence)\r\n    lookahead := peek next token\r\n    while lookahead is a binary operator whose precedence is >= min_precedence\r\n        op := lookahead\r\n        advance to next token\r\n        rhs := parse_primary ()\r\n        lookahead := peek next token\r\n        while lookahead is a binary operator whose precedence is greater\r\n                 than op's, or a right-associative operator\r\n                 whose precedence is equal to op's\r\n            rhs := parse_expression_1 (rhs, lookahead's precedence)\r\n            lookahead := peek next token\r\n        lhs := the result of applying op with operands lhs and rhs\r\n    return lhs\r\n*/\r\n\r\nvar tokens,pos;\r\nvar condition=false;\r\nfunction parse_expression(expression,vars) {\r\n\tlet ret=''\r\n\tparseError = \"\";\r\n\ttokens=null\r\n\tpos=0\r\n\tcondition=false\r\n\tif (typeof expression === \"undefined\" || expression === null || expression === \"\") ret=null\r\n\telse {\r\n\t\ttokens = token_split(expression,vars)\r\n\t  if (peek_next()==='=' || is(_eq,peek_next()))\r\n\t  {\r\n\t\t  var eq=next_token();\r\n\t\t  ret = tree('',eq,parse_expression_1(parse_primary(vars), 0, vars)); // for working\r\n\t  }\r\n\t  else ret = parse_expression_1(parse_primary(vars), 0, vars);\r\n\t  if (pos !== tokens.length) parseError = 'E'+peek_current();\r\n\t\telse if (pos === tokens.length && (peek_current()==='=' || is(_eq,peek_current())))\r\n\t\t{\r\n\t\t\t//console.log(\"= error: %s %s\",expression,parseError);\r\n\t\t\tparseError = ''; // override ending in = for questions\r\n\t\t}\r\n\t\tret=parseError===''?pruneTree(ret):false\r\n\t}\r\n\tif (debug('parse_expression=')) console.log(\"parse_expression(expression,vars)=ret,tokens,parseError\",expression,vars,ret,tokens,pos,parseError)\r\n\treturn ret\r\n}\r\n\r\nfunction opX(token,vars)\r\n{\r\n  if (token === '(' || func(token,vars) || (token.length > 0 && precedence(token) === -1 && peek_current() === ')')) return '*';\r\n  else if (algebra(token,vars) || token === '√') return ' ';\r\n  else return token;\r\n}\r\n\r\nfunction precedenceX(token,vars)\r\n{\r\n  if (func(token,vars)) return precedence('+')+0.5; //break out of sinxsinx\r\n\telse return precedence(opX(token,vars));\r\n}\r\n\r\n\r\nfunction parse_expression_1(lhs, min_precedence,vars) {\r\n\tif (parseError !== '') return '';\r\n  var lookahead = peek_next();\r\n  var op = '';\r\n  while (parseError==='' && lookahead!==')' && lookahead!=='}' && lookahead!=='|' && lookahead!==']' && precedenceX(lookahead,vars) >= min_precedence) {\r\n\t\tif (opX(lookahead,vars) !== lookahead) op=lookahead==='('?'(':opX(lookahead,vars)\r\n    else op = next_token()\r\n    var rhs = parse_primary(vars)\r\n    lookahead = peek_next()\r\n    while (parseError==='' && lookahead!==')' && lookahead!=='}' && lookahead!=='|' && lookahead!==']' && (precedenceX(lookahead,vars) > precedence(op,vars) || (right_assoc(lookahead) && precedence(lookahead,vars) === precedence(op,vars)))) // should compare precedence for ^ - assuming highest\r\n    {\r\n      rhs = parse_expression_1(rhs, precedenceX(lookahead,vars),vars);\r\n      lookahead = peek_next();\r\n    }\r\n    // check if coordinates\r\n    if (op === ',' && lookahead === ')' && !condition) lhs = tree(lhs,'(,)',rhs)\r\n    else lhs = tree(lhs, op, rhs);\r\n  }\r\n  //echo output_tree($lhs,0).'<br />';\r\n  return lhs;\r\n}\r\n\r\nfunction right_assoc(op) {\r\n  if (op === '^') return true;\r\n  else return false;\r\n}\r\n\r\nfunction sub(s,vars) {\r\n\tconst x=1.1234567\r\n\treturn is_xyz(s,vars)?s:x+xyz(vars).indexOf(s)\r\n}\r\n\r\nfunction substitute(s,vars,calc)\r\n{\r\n\tlet result=s // default no change\r\n\tif (!calc) result = vars&&vars[s]!==undefined?checkFraction(vars[s]):s\r\n\telse if (result === 'π') result=Math.PI;\r\n\telse if (result === 'e') result=Math.E;\r\n\telse if (result === '°') result=Math.PI/180;\r\n\telse result=sub(s)\r\n\tif (debug(\"substitute\")) console.log(\"substitute(s,var,calc)=\",s,vars,calc,result)\r\n\treturn result\r\n}\r\n\r\nfunction checkFraction(f)\r\n{\r\n\tvar ret = ''+f // convert number to string\r\n\tif (ret.indexOf('/') !== -1)\r\n\t{\r\n\t\tvar negative = ret.startsWith('-')\r\n\t\tif (negative) ret=ret.substring(1)\r\n\t\tvar [n,d]=ret.split('/');\r\n\t\tret = tree(n,'/',d)\r\n\t\tif (negative) ret = tree('','-',ret)\r\n\t}\r\n\t//console.log(\"checkFraction\",f,ret)\r\n\treturn ret\r\n}\r\n\r\nfunction evaluate(t,vars)\r\n{\r\n\tvar result = 0;\r\n\tif (t==='') return ''\r\n\telse if (!t) {\r\n\t\tconsole.log(\"evaluate\",t,vars,null)\r\n\t\treturn t\r\n\t}\r\n\telse if (is_string(t))\r\n\t{\r\n\t\tresult = substitute(t,vars)\r\n\t}\r\n\telse {\r\n\t\tlet lhs = is_tree(t.left)?evaluate(t.left,vars):substitute(t.left,vars)\r\n\t\tlet rhs = is_tree(t.right)?evaluate(t.right,vars):substitute(t.right,vars)\r\n\t\tif ((lhs === '' || is_numeric(lhs)) && is_numeric(rhs))\r\n\t\tswitch (t.op)\r\n\t\t{\r\n\t\t\tcase '+':\r\n\t\t\tcase '˽': // mixed fractions - beware broken precedence\r\n\t\t\t\tresult = 1*lhs+1*rhs // force numeric addition\r\n\t\t\t\tbreak;\r\n\t\t\tcase '±':\r\n\t\t\t\tresult = [(1*lhs+1*rhs),(1*lhs-1*rhs)] // force numeric addition\r\n\t\t\t\tbreak;\r\n\t\t\tcase '-':\r\n\t\t\t\tresult = lhs-rhs;\r\n\t\t\t\tbreak;\r\n\t\t\tcase '*':\r\n\t\t\tcase ' ': // algebra\r\n\t\t\tcase '(':\r\n\t\t\tcase '×': // forced symbol\r\n\t\t\t\tresult = lhs*rhs;\r\n\t\t\t\tbreak;\r\n\t\t\tcase '÷':\r\n\t\t\tcase '/':\r\n\t\t\t\tif (1*rhs !== 0) {\r\n\t\t\t\t\tif (condition && Math.round(lhs)===1*lhs && Math.round(rhs)===1*rhs) {\r\n\t\t\t\t\t\tvar negative = ((lhs<0||rhs<0)&&!(lhs<0&&rhs<0))\r\n\t\t\t\t\t\tvar f=simplify({n:Math.abs(lhs),d:Math.abs(rhs)});\r\n\t\t\t\t\t\tif (f.d === 1) result = f.n\r\n\t\t\t\t\t\telse result=tree(f.n,'/',f.d)\r\n\t\t\t\t\t\tif (negative) result = tree('','-',result)\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse result = lhs/rhs;\r\n\t\t\t\t}\r\n\t\t\t\telse result = '@'+lhs+'/'+rhs+'divide by zero'; // for debugging\r\n\t\t\t\t//console.log(\"%s/%s=%s\",lhs,rhs,result);\r\n\t\t\t\t//else  $result = [$lhs,$rhs]; // for debugging\r\n\t\t\t\tbreak;\r\n\t\t\tcase '^':\r\n\t\t\t\tresult = Math.pow(lhs,rhs);\r\n\t\t\t\tbreak;\r\n\t\t\tcase '|':\r\n\t\t\t\tresult = Math.abs(rhs);\r\n\t\t\t\tbreak;\r\n\t\t\tcase '√':\r\n\t\t\t\tresult = Math.pow(rhs,0.5);\r\n\t\t\t\tbreak;\r\n\t\t\tcase '~':\r\n\t\t\t\tresult=hcf(1*lhs,1*rhs);\r\n\t\t\t\tbreak;\r\n\t\t\tcase '=':\r\n\t\t\t\tif (condition) result = (1*lhs===1*rhs)?1:0\r\n\t\t\t\telse result='@'+lhs+'='+rhs\r\n\t\t\t\tbreak\r\n\t\t\tcase '≠':\r\n\t\t\t\tif (condition) result = (1*lhs===1*rhs)?0:1\r\n\t\t\t\telse result='@'+lhs+'≠'+rhs;\r\n\t\t\t\tbreak\r\n\t\t\t\t// consider chaining of a>b>c and a<b<c\r\n\t\t\tcase '>':\r\n\t\t\t\tif (condition) result = (1*lhs>1*rhs)?1:0 // rhs=0 make close to zero\r\n\t\t\t\telse result='@'+lhs+'>'+rhs\r\n\t\t\t\tbreak\r\n\t\t\tcase '<':\r\n\t\t\t\tif (condition) result = (1*lhs<1*rhs)?1:0\r\n\t\t\t\telse result='@'+lhs+'<'+rhs\r\n\t\t\t\t//console.log(\"%s<%s=%s\",lhs,rhs,result)\r\n\t\t\t\tbreak\r\n\t\t\tcase '≥':\r\n\t\t\t\tif (condition) result = (1*lhs>=1*rhs)?1:0\r\n\t\t\t\telse result='@'+lhs+'≥'+rhs\r\n\t\t\t\tbreak\r\n\t\t\tcase '≤':\r\n\t\t\t\tif (condition) result = (1*lhs<=1*rhs)?1:0\r\n\t\t\t\telse result='@'+lhs+'≤'+rhs\r\n\t\t\t\tbreak\r\n\t\t\tcase ',':\r\n\t\t\t//console.log(',',lhs,rhs)\r\n\t\t\t\tresult=[lhs,rhs] // co-ordinates & multiple values\r\n\t\t\t\tbreak;\r\n\t\t\t/*\r\n\t\t\tcase func(op):\r\n\t\t\t\t$result = $this->func_eval($tree['op'],$rhs);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ',':\r\n\t\t\t\t$result = [$lhs,',',$rhs]; // don't evaluate - co-ordinates - + multi-value answers\r\n\t\t\t\tbreak;\r\n\t\t\t\t*/\r\n\t\t\tdefault:\r\n\t\t\t  if (func(t.op)) result = func_eval(t.op,rhs);\r\n\t\t\t\telse result='@@'+lhs+t.op+rhs // for debugging\r\n\t\t}\r\n\t\telse if (Array.isArray(lhs) || Array.isArray(rhs)) result=eval_multi(lhs,t.op,rhs)\r\n\t\t//eslint-disable-next-line\r\n\t\telse if ((result=fraction_op(tree(lhs,t.op,rhs))) === false) {\r\n\t\t\tif (t.op===',' && is_numeric(lhs) && (rhs.endsWith('dp') || (rhs.endsWith('sf')))) {\r\n\t\t\t\t//console.log(\",\",t,lhs,rhs)\r\n\t\t\t\tif (rhs.endsWith('dp')) result=(lhs*1).toFixed(rhs.substr(0,rhs.length-2))\r\n\t\t\t\telse result=(lhs*1).toPrecision(rhs.substr(0,rhs.length-2))\r\n\t\t\t}\r\n\t\t\telse result=''+lhs+t.op+rhs // e.g. {3x} in text\r\n\t\t}\r\n\t}\r\n\tif (debug('evaluate')) console.log('evaluate(t,vars)=',t,vars,result)\r\n\treturn result; // toString() removed to allow fractions\r\n}\r\n\r\nfunction eval_multi(lhs,op,rhs)\r\n{\r\n\tlet ret = []\r\n\tif (Array.isArray(lhs)) ret=lhs.map(l=>{return evaluate({left:l,op:op,right:rhs})})\r\n\telse if (Array.isArray(rhs)) ret=rhs.map(r=>{return evaluate({left:lhs,op:op,right:r})})\r\n\t//console.log(\"eval_multi\",lhs,op,rhs,ret)\r\n\treturn ret\r\n}\r\n\r\nfunction simplify(f)\r\n{\r\n\tvar h = hcf(f.n,f.d)\r\n\treturn {n:f.n/h,d:f.d/h};\r\n}\r\n\r\nfunction frac_add(f1,f2)\r\n{\r\n\treturn simplify({n:f1.n*f2.d+f2.n*f1.d,d:f1.d*f2.d});\r\n}\r\n\r\nfunction frac_mult(f1,f2)\r\n{\r\n\treturn simplify({n:f1.n*f2.n,d:f1.d*f2.d});\r\n}\r\n\r\nfunction frac_equiv(f1,f2)\r\n{\r\n\tvar f;\r\n\tif (f2 === 'numerator') f = f1.n\r\n\telse if (f2 === 'denominator') f = f1.d\r\n\telse if (f2 === 'whole') f = Math.floor(f1.n/f1.d) // whole part\r\n\telse if (f2 === 'fractional') f = {n:f1.n-Math.floor(f1.n/f1.d)*f1.d,d:f1.d} // fraction part\r\n\telse if (f2 === 'improper') f = f1.n>f1.d?1:0;\r\n\telse {\r\n\t\tvar m = lcm(f1.d,f2.d)/f1.d;\r\n\t\tf = {n:f1.n*m,d:f1.d*m}\r\n\t}\r\n\treturn f;\r\n}\r\n\r\nfunction fraction(s)\r\n{\r\n\tvar f = false;\r\n\tif (is_numeric(s)) f = {n:s*1,d:1}\r\n\telse if (is_fraction(s)) f = {n:s.left*1,d:s.right*1}\r\n\telse if (is_negative(s))\r\n\t{\r\n\t\tlet p=change_sign(s)\r\n\t\tif (is_numeric(p)) f={n:p*-1,d:1}\r\n\t\telse if (is_fraction(p)) f={n:p.left*-1,d:p.right*1}\r\n\t}\r\n\telse if (is_tree(s) && s.op==='˽') {\r\n\t\tf=fraction(s.right)\r\n\t\tf.n=f.n+s.left*f.d\r\n\t}\r\n\telse if (is_string(s) && s.indexOf('/') !== -1)\r\n\t{\r\n\t\tvar [n,d] = s.split('/');\r\n\t\tf = {n:n*1,d:d*1};\r\n\t}\r\n\tif (debug('fraction')) console.log('fraction(s)=',s,f)\r\n\treturn f\r\n}\r\n\r\nfunction fraction_op(t)\r\n{\r\n\tif (is_frac(t) || is_numeric(t)) return t\r\n\telse if (!is_tree(t)) return false\r\n\tlet f=false,mixed=false,f2\r\n\tlet f1=fraction(t.left)\r\n\tif (t.op ===',' && keyword(t.right)) f2=t.right\r\n\telse f2=fraction(t.right)\r\n\r\n\tif (f1!==false && f2!==false) {\r\n\t\tswitch (t.op)\r\n\t\t{\r\n\t\t\tcase '+':\r\n\t\t\t\tf = frac_add(f1,f2);\r\n\t\t\t\tbreak;\r\n\t\t\tcase '-':\r\n\t\t\t\tf = frac_add(f1,{n:-f2.n,d:f2.d});\r\n\t\t\t\tbreak;\r\n\t\t\tcase '*':\r\n\t\t\tcase '(':\r\n\t\t\tcase ' ': // algebra\r\n\t\t\tcase '×': // forced symbol\r\n\t\t\t\tf = frac_mult(f1,f2);\r\n\t\t\t\tbreak;\r\n\t\t\tcase '÷':\r\n\t\t\tcase '/':\r\n\t\t\t\tf = frac_mult(f1,{n:f2.d,d:f2.n});\r\n\t\t\t\tbreak;\r\n\t\t\tcase '^': // only support squared and -1 for now\r\n\t\t\t\tif (t.right*1 === 2) f=frac_mult(f1,f1);\r\n\t\t\t\telse if (t.right*1===-1) f={n:f1.d,d:f1.n}\r\n\t\t\t\telse f=false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase ',':\r\n\t\t\t\tif (f2 === 'mixed') {mixed=true; f=f1}\r\n\t\t\t\telse f = frac_equiv(f1,f2)\r\n\t\t\t\tbreak;\r\n\t\t\tcase '~': // cancel down\r\n\t\t\t\tf = {n:(f1.n/hcf(f1.n,f2.d)),d:(f1.d/hcf(f1.d,f2.n))}\r\n\t\t\t\tbreak;\r\n\t\t\tcase '=':\r\n\t\t\t\tf = (f1.n===f2.n && f1.d===f2.d)?1:0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase '≠':\r\n\t\t\t\tf = (f1.n===f2.n && f1.d===f2.d)?0:1;\r\n\t\t\t\tbreak;\r\n\t\t\tcase '>':\r\n\t\t\t\tf = (f1.n*f2.d>f2.n*f1.d)?1:0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase '<':\r\n\t\t\t\tf = (f1.n*f2.d<f2.n*f1.d)?1:0;\r\n\t\t\tbreak;\r\n\t\t\tcase '≥':\r\n\t\t\t\tf = (f1.n*f2.d>=f2.n*f1.d)?1:0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase '≤':\r\n\t\t\t\tf = (f1.n*f2.d<=f2.n*f1.d)?1:0;\r\n\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tf = false;\r\n\t\t}\r\n\t}\r\n\tif (f && f.d)\r\n\t{\r\n\t\tlet negative = f.n<0\r\n\t\tif (negative) f.n=-f.n\r\n\t\tlet whole=Math.floor(f.n/f.d)\r\n\t\tif (f.n===0) f=0\r\n\t\telse if (f.n/f.d === whole) f=negative?tree('','-',whole):whole\r\n\t\telse if (mixed && whole>0) {\r\n\t\t\tf.n-=f.d*whole\r\n\t\t\tif (negative) f=tree('','-',tree(whole,'˽',tree(f.n,'/',f.d)))\r\n\t\t\telse f=tree(whole,'˽',tree(f.n,'/',f.d))\r\n\t\t}\r\n\t\telse {\r\n\t\t\tf=tree(f.n,'/',f.d)\r\n\t\t\tif (negative) f=tree('','-',f)\r\n\t\t}\r\n\t}\r\n\telse if (f<0) f = tree('','-',-f)\r\n\tif (debug()) console.log('fraction_op(t)=',t,f)\r\n\treturn f\r\n}\r\n\r\nfunction func_eval(f,x)\r\n{\r\n\tvar result, pow = '';\r\n\tvar exp = f.indexOf('^');\r\n\tif (exp > 0)\r\n\t{\r\n\t\tpow = f.substring(exp+2,f.length-1); //sin^{-1} sin^{2}\r\n\t\tf=f.substring(0,exp);\r\n\t\tif (pow*1 === -1) f=\"a\"+f;\r\n\t}\r\n\t//console.log(\"func_eval(%s,%s,%s)\",f,pow,x);\r\n\tif (!is_numeric(x)) {\r\n\t\tresult = [f,x]; // for debugging\r\n\t}\r\n\telse switch (f)\r\n\t{\r\n\t\tcase 'sin':\r\n\t\t\tresult = Math.sin(x);\r\n\t\t\tbreak;\r\n\t\tcase 'cos':\r\n\t\t\tresult = Math.cos(x);\r\n\t\t\tbreak;\r\n\t\tcase 'tan':\r\n\t\t\tresult = Math.tan(x);\r\n\t\t\tbreak;\r\n\t\tcase 'cosec':\r\n\t\t\t\tresult = 1/Math.sin(x);\r\n\t\t\t\tbreak;\r\n\t\tcase 'sec':\r\n\t\t\t\tresult = 1/Math.cos(x);\r\n\t\t\t\tbreak;\r\n\t\tcase 'cot':\r\n\t\t\t\tresult = 1/Math.tan(x);\r\n\t\t\t\tbreak;\r\n\t\tcase 'asin':\r\n\t\t\tresult = Math.asin(x);\r\n\t\t\tbreak;\r\n\t\tcase 'acos':\r\n\t\t\tresult = Math.acos(x);\r\n\t\t\tbreak;\r\n\t\tcase 'atan':\r\n\t\t\tresult = Math.atan(x);\r\n\t\t\tbreak;\r\n\t\tcase 'acosec':\r\n\t\t\t\tresult = Math.asin(1/x);\r\n\t\t\t\tbreak;\r\n\t\tcase 'asec':\r\n\t\t\t\tresult = Math.acos(1/x);\r\n\t\t\t\tbreak;\r\n\t\tcase 'acot':\r\n\t\t\t\tresult = Math.atan(1/x);\r\n\t\t\t\tbreak;\r\n\t\tcase 'ln':\r\n\t\t\tresult = Math.log(x); // defaults to ln\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tconsole.error(\"evaluate(%s,%s) not yet supported\",f,x);\r\n\t\t\tresult = [f,x]; // for debugging\r\n\t}\r\n\tif (pow > 0) result = Math.pow(result,pow);\r\n\treturn result.toString();\r\n}\r\n\r\n function parse_primary(vars) {\r\n\t if (parseError !== '') return '';\r\n\tvar prev = peek_current();\r\n  var ret = next_token();\r\n  if (ret === '(') {\r\n    ret = parse_expression_1(parse_primary(vars),0,vars);\r\n    if (peek_next() !== ')') parse_error(')'); // error if not ')';\r\n    else\r\n    {\r\n    \tnext_token();\r\n    \t//if (peek_next() != '') ret = parse_expression_1(ret, 0);\r\n    }\r\n  }\r\n\telse if (ret === '|') {\r\n\t\tret = parse_expression_1(parse_primary(vars),0,vars);\r\n\t\tif (peek_next() !== '|') parse_error('|'); // error if not ')';\r\n\t\telse\r\n\t\t{\r\n\t\t\tnext_token();\r\n\t\t\tret = tree('','|',ret);\r\n\t\t\t//if (peek_next() != '') ret = parse_expression_1(ret, 0);\r\n\t\t}\r\n\t}\r\n\telse if (ret==='[') {\r\n\t\tret = parse_expression_1(parse_primary(vars),0,vars);\r\n\t\tif (peek_next() !== ']') parse_error(']'); // error if not ')';\r\n\t\telse\r\n\t\t{\r\n\t\t\tnext_token();\r\n\t\t\tret = tree('','[]',ret);\r\n\t\t\t//if (peek_next() != '') ret = parse_expression_1(ret, 0);\r\n\t\t}\r\n\t}\r\n  else if (ret === '{') {\r\n\t\t\tif (condition) parse_error('{'); // do not allow eval within evaluate\r\n\t\t\telse if (peek_next() === \"'\") next_token() // don't evaluate\r\n\t\t\telse condition = true; // flag to evaluate\r\n\t    ret = parse_expression_1(parse_primary(vars),0,vars);\r\n\t    if (peek_next() !== '}') parse_error('}'); // error if not ')';\r\n\t    else\r\n\t    {\r\n\t\t\t\tnext_token();\r\n\t\t\t\tif (condition)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet val = evaluate(ret,vars);\r\n\t\t\t\t\t//console.log('condition',ret,val)\r\n\t\t\t\t\tif (is_numeric(val)){\r\n\t\t\t\t\t\tif (val<0) ret=tree('','-',-val)\r\n\t\t\t\t\t\telse if (val*1 === 0) ret='0.0' // magic values for pruning\r\n\t\t\t\t\t\telse if (val*1 === 1) ret='1.0'\r\n\t\t\t\t\t\telse ret=val\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (is_negative(val) && is_numeric(change_sign(val))) ret=val\r\n\t\t\t\t\telse if (is_frac(val,true)) ret=val // fraction variables allow mixed\r\n\t\t\t\t\telse if (Array.isArray(val)) ret=tree(val[0],',',val[1]) // for plus minus double value\r\n\t\t\t\t\t// if (is_fraction(ret) || is_fraction(change_sign(ret))) ret=ret // fractions fine as tree version\r\n\t\t\t\t\tcondition=false; // reset\r\n\t\t\t\t}\r\n\t    }\r\n  }\r\n  else if (ret === '√' || func(ret,vars)) {\r\n\t\tvar prec =  precedence(ret);\r\n\t\tif (func(ret,vars) && peek_next() === '(') prec = precedence('^') +1;\r\n\t\tif (trig(ret) && peek_next() === '^')\r\n\t\t{\r\n\t\t\tnext_token();\r\n\t\t\tvar pow = next_token();\r\n\t\t\tif (pow === '-' && peek_next() === '1')\r\n\t\t\t{\r\n\t\t\t\tpow = next_token();\r\n\t\t\t\tret += '^{-1}';\r\n\t\t\t}\r\n\t\t\telse if (isNaN(pow)) parse_error(pow);\r\n\t\t\telse ret += '^{'+pow+'}';\r\n\t\t\tif (peek_next() === '(') prec = precedence('^') +1;\r\n\t\t\t//pow = tree (ret,'^',pow);\r\n\t\t}\r\n\t\telse if (ret==='log_' && peek_next() === '{') { // e.g. log_{10}\r\n\t\t\tnext_token()\r\n\t\t\tlet base=next_token()\r\n\t\t\tif (peek_next() !== '}') parse_error('}')\r\n\t\t\telse next_token()\r\n\t\t\tret+='{'+base+'}'\r\n\t\t}\r\n\t  ret = tree('',ret,parse_expression_1(parse_primary(vars), prec,vars));\r\n  } else if ((ret==='-' || ret==='±' || ret==='–') && (func(peek_next()) || algebra(peek_next(),vars) || numeric(peek_next()) || peek_next() === '{' || peek_next() === '(' || peek_next() === '√')) { // don't allow --\r\n    //ret = tree('','-',parse_primary());\r\n    ret = tree('',ret,parse_expression_1(parse_primary(vars),(prev==='^')?precedence('^')-1:precedence('*'),vars));\r\n\t\t//ret = tree('','-',parse_expression_1(parse_primary(),(prev=='^')?precedence('^')-1:precedence('-')));\r\n    //ret = tree('','-',parse_expression_1(parse_primary(), precedence('-')));\r\n  } //else if (ret.length == 0 || '+-*/^)'.indexOf(ret) != -1) parse_error(ret);\r\n\telse if (ret === '.') ret = '' // hack for now to allow blank items in expressions\r\n  else if (ret.length === 0 || !(algebra(ret,vars) || numeric(ret))) parse_error(ret);\r\n\r\n  return ret;\r\n};\r\n\r\nfunction func(op,vars)\r\n{\r\n\tif (trig(op) || op.startsWith('log') || op  === 'ln') return true /*|| (op==='f' && !is_xyz('f',vars)))*/\r\n}\r\n\r\nfunction trig(op2)\r\n{\r\n\tvar op = ''\r\n\tfor (let ch of op2) if (ch === '{' || ch === '^') break; else op+=ch;\r\n\tif (op === 'sin' || op === 'cos' || op === 'tan' || op === 'cosec' || op === 'sec' || op === 'cot') return true;\r\n\telse return false\r\n}\r\n\r\nfunction is(set,token)\r\n{\r\n\tif (set==='symbol') return _greek[token] || _eq[token] || _op[token]\r\n\telse return set[token]?true:false\r\n}\r\n\r\nfunction replace_symbols(str)\r\n{\r\n\tvar ret = ''\r\n\tfor (var i=0; i<str.length; i++) {\r\n\t\tif (typeof _greek[str[i]] !== 'undefined') ret+=(_greek[str[i]]+' ')\r\n\t\telse if (typeof _eq[str[i]] !== 'undefined') ret+=(_eq[str[i]]+' ')\r\n\t\telse if (typeof _op[str[i]] !== 'undefined') ret+=(_op[str[i]]+' ')\r\n\t\telse ret+=str[i]\r\n\t}\r\n\treturn ret\r\n}\r\n\r\nfunction xyz(vars)\r\n{\r\n\treturn (vars&&vars['xyz'])?vars['xyz'].replace(/,/g,' ').split(' '):['x','y','z']\r\n}\r\n\r\nfunction is_xyz(x,vars)\r\n{\r\n\treturn xyz(vars).indexOf(x)!==-1\r\n}\r\n\r\nfunction algebra(token,vars)\r\n{\r\n\tlet ret=false\r\n\tif (func(token,vars)) ret=false\r\n\telse if (is_xyz(token,vars) || token === 'e' || is(_greek,token)) ret=true\r\n\telse if (token.endsWith(\"'\") && is_xyz(token.substring(0,token.length-1),vars)) ret=true\r\n\telse if (condition) ret=vars&&vars[token]!==undefined?true:false || keyword(token) // beware {a:0}\r\n\telse ret=false\r\n\t//console.log('algebra',token,vars,ret)\r\n\treturn ret\r\n\t//if (!func(token) && (token == x || token == y || token == z || token == 'π') && token != '≤' && token != '≥') return true;\r\n}\r\n\r\nfunction keyword(token)\r\n{\r\n\tif (token === 'dp' || token === 'sf' || token === 'improper' || token === 'fractional' || token === 'whole' || token === 'mixed' || token === 'denominator' || token === 'numerator' || token === 'mixed') return true\r\n\telse return false\r\n}\r\n\r\nfunction numeric(token)\r\n{\r\n\treturn token.match(/^[0-9]*(\\.)?[0-9]+$/);\r\n}\r\n\r\n function tree(left, op1, right1) {\r\n  var op = typeof op1 !== 'undefined' ? op1 : '';\r\n  var right = typeof right1 !== 'undefined' ? right1 : '';\r\n  if (op !== '') {\r\n    var tree = {\r\n      left: left,\r\n      op: op,\r\n      right: right // ==''?'?':right //- check side-effect on calculator\r\n    }\r\n  } else tree = left;\r\n\r\n  return tree;\r\n};\r\n\r\nfunction peek_next() {\r\n\tvar ret;\r\n  if (pos < 0 || pos === tokens.length) ret = '';\r\n  else ret = tokens[pos];\r\n  //echo \"<br />peek_next()=$ret\";\r\n  return ret;\r\n};\r\n\r\nfunction peek_current() {\r\n\tvar ret;\r\n\t  if (pos < 1) ret = '';\r\n\t  else ret = tokens[pos-1];\r\n\t  //echo \"<br />peek_next()=$ret\";\r\n\t  return ret;\r\n\t};\r\n\r\nfunction next_token() {\r\n  var ret;\r\n  if (pos < 0 || pos === tokens.length) ret = '';\r\n  else {\r\n    pos++;\r\n    ret = tokens[pos - 1];\r\n\t\tif (ret==='+' && pos < tokens.length && tokens[pos]==='/') ret+=tokens[pos++] // mixed fractions\r\n  }\r\n  //echo \"<br />next_token()=$ret\";\r\n  return ret;\r\n};\r\n\r\nfunction precedence(op) {\r\n\tif (op===\"=\" || op === '<' || op === '>' || is(_eq,op)) return 1\r\n\telse if (op === \",\") {if (condition) return 1.5; else return 1;}\r\n\t//else if (op === \"Σ\") return 1.5\r\n\telse if (op === \"~\" && condition) return 1.5\r\n\telse if (op === \"+\" || op === '-' || op === '–' || op === '±') return 2\r\n\telse if (op === \"˽\") return 2.5 // mixed fractions\r\n\telse if (op === \"*\" || op === '×' || op==='(' || op==='⋅') return 4 // 3\r\n\telse if (op === \"/\" || op===\"÷\") return 4 //4;\r\n\telse if (func(op)) return 3 //5;\r\n\telse if (op === \" \") return 4 //6;\r\n\telse if (op === '√' || op === \"^\") return 7\r\n\telse return -1 // not operator or not supported!\r\n};\r\n\r\nfunction parse_error(expected) {\r\n  if (debug('parse_error')) console.error(\"parse_error(expected),tokens,pos\",expected,tokens,pos)\r\n  parseError = (expected === '')?'?':expected;\r\n  //if (pos > 0 && pos < tokens.length) parse_error += expected;\r\n  /*\r\n    alert(\"parse error at token \" + pos + \", expected:\" + expected + \"got: \" + tokens[pos]);\r\n  else alert(\"parse error expected: \" + expected + \" got end-of-string\");\r\n  */\r\n};\r\n\r\nvar text;\r\nvar text_pos = 0;\r\nfunction next_tok(vars)\r\n{\r\n\tconst tokens=\" \\r\\n[]\\\\?\";\r\n\tif (text_pos >= text.length) return -1;\r\n\tvar ret =  text.charAt(text_pos++);\r\n\tif (tokens.indexOf(ret) !== -1)\r\n\t{\r\n\t\tif (ret === '\\\\' && text.charAt(text_pos) === '(')\r\n\t\t{ // latex\r\n\t\t\tret += text.charAt(text_pos++);\r\n\t\t\twhile (text_pos < text.length-1 && !(text.charAt(text_pos) === '\\\\' && text.charAt(text_pos+1) === ')')) ret += text.charAt(text_pos++);\r\n\t\t\tif (text.charAt(text_pos) === '\\\\' && text.charAt(text_pos+1) === ')')\r\n\t\t\t{ // add in latex close\r\n\t\t\t\tret += text.charAt(text_pos++);\r\n\t\t\t\tret += text.charAt(text_pos++);\r\n\t\t\t\t//console.log(\"latex: \",ret);\r\n\t\t\t}\r\n\t\t\t//else console.error(\"unterminated latex \\\\( with no \\\\)\"); // could keep track of line and charpos\r\n\t\t}\r\n\t\telse if (ret === '?') ret = parse_conditional(vars)\r\n\t\telse if (ret === '[') ret = parse_table()\r\n\t\treturn ret;\r\n\t}\r\n\telse while (text_pos < text.length && tokens.indexOf(text.charAt(text_pos)) === -1) ret += text.charAt(text_pos++);\r\n\treturn ret;\r\n};\r\n\r\nfunction parse_table()\r\n{\r\n\tvar table='['\r\n\tvar multiLine=false\r\n\tvar tmp = text_pos\r\n\twhile (text_pos < text.length-1 && text.charAt(text_pos) !== ']')\r\n\t{\r\n\t\tif (text.charAt(text_pos)===\"\\n\") multiLine=true\r\n\t\ttable += text.charAt(text_pos++)\r\n\t}\r\n\tif (text.charAt(text_pos) === ']') {\r\n\t\ttext_pos++\r\n\t\tif (multiLine){\r\n\t\t\treturn table+']'\r\n\t\t}\r\n\t\telse if (text.charAt(text_pos) === '_') // integration limits\r\n\t\t{\r\n\t\t\tlet e=limits(text,text_pos)\r\n\t\t\tlet lim=text.substr(text_pos,e-text_pos)\r\n\t\t\ttext_pos=e\r\n\t\t\tparseError=''\r\n\t\t\tlet katex=mj(table.substr(1))\r\n\t\t\tconsole.log('[]_^',table,katex,lim,e)\r\n\t\t\tif (parseError==='') return '\\\\(\\\\Big['+katex+'\\\\Big]'+lim+'\\\\)'\r\n\t\t\telse return '\\\\(\\\\Big['+table.substr(1)+'\\\\Big]'+lim+'\\\\)'\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet vec=table.substr(1).split(',')\r\n\t\t\tif (vec.length===1) {\r\n\t\t\t\tif (vec[0].length===1) return  '\\\\(\\\\utilde{'+vec[0]+'}\\\\)'\r\n\t\t\t\telse if (vec[0].indexOf('|')===0 && vec[0].substr(1).indexOf('|')===vec[0].length-2) return  '\\\\(|\\\\overrightarrow{'+vec[0].substr(1,vec[0].length-2)+'}|\\\\)'\r\n\t\t\t\telse return  '\\\\(\\\\overrightarrow{'+vec[0]+'}\\\\)'\r\n\t\t\t}\r\n\t\t\telse return '\\\\(\\\\begin{pmatrix}'+table.substr(1).split(',').join('\\\\\\\\')+'\\\\end{pmatrix}\\\\)'\r\n\t\t}\r\n\r\n\t}\r\n\t// fell through\r\n\ttext_pos = tmp\r\n\treturn '['\r\n}\r\n\r\nfunction parse_conditional(vars)\r\n{\r\n\tvar ret = '?';\r\n\tif (text_pos < text.length && text.charAt(text_pos) === '{')\r\n\t{\r\n\t\tvar start=text_pos,end=text_pos++;\r\n\t\tconst tokens=\"\\n:;}\";\r\n\t\twhile (end < text.length && tokens.indexOf(text.charAt(end)) === -1) end++;\r\n\t\tif (text.charAt(end) === '}')\r\n\t\t{\r\n\t\t\tconst tokens=\"\\n:;\";\r\n\t\t\ttext_pos = ++end;\r\n\t\t\tvar condition = text.substring(start,end);\r\n\t\t\tstart = end;\r\n\t\t\twhile (end < text.length && tokens.indexOf(text.charAt(end)) === -1) end++;\r\n\t\t\tvar ifTrue = '',ifFalse='';\r\n\t\t\tif (end > start) ifTrue = text.substring(start,end)\r\n\t\t\tif (text.charAt(end) === ':')\r\n\t\t\t{\r\n\t\t\t\tstart=++end;\r\n\t\t\t\twhile (end < text.length && tokens.indexOf(text.charAt(end)) === -1) end++;\r\n\t\t\t\tif (end > start) ifFalse = text.substring(start,end);\r\n\t\t\t}\r\n\t\t\tif (end < text.length && text.charAt(end) !== '\\n') end++;\r\n\t\t\ttext_pos=end;\r\n\t\t\tvar test = evaluate(parse_expression(condition,vars));\r\n\t\t\t//console.log(\"conditional: %s=%s?%s:%s\",condition,test,ifTrue,ifFalse);\r\n\t\t\tif (test*1!==0) ret = ifTrue;\r\n\t\t\telse ret = ifFalse;\r\n\t\t}\r\n\t\telse ret = {text:'?{',error:\"?{ with no matching }\"};\r\n\t}\r\n\telse if (text_pos < text.length && text.charAt(text_pos) === '=')\r\n\t{\r\n\t\t//?= only display if different to last =\r\n\t\tstart=end=++text_pos;\r\n\t\tconst tokens=\"\\n;?=\";\r\n\t\twhile (end < text.length && tokens.indexOf(text.charAt(end)) === -1) end++;\r\n\t\tif (end > start) ret=text.substring(start,end);\r\n\t\tvar eq = equalsCache, eq2 = mj(ret,vars);\r\n\t\tif (parseError !== '') ret = {text:'?=',error:\"expression parse error\"};\r\n\t\telse {\r\n\t\t\t//console.log(\"?=\",eq,eq2,eq===eq2);\r\n\t\t\tif (eq===eq2) ret = ''\r\n\t\t\telse ret = '='+ret\r\n\t\t\tif (end < text.length && text.charAt(end) === ';') end++\r\n\t\t\ttext_pos=end\r\n\t\t}\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nfunction replace_vars(content,vars)\r\n{\r\n\t//console.log('replace_vars',content,vars)\r\n\tvar start,end\r\n\tvar ret = content\r\n\t// eslint-disable-next-line\r\n\twhile ((start=content.indexOf('{')) !== -1 && (end=content.indexOf('}')) !== -1)\r\n\t{\r\n\t\t//console.log(\"replace_vars\",start,end,ret,content)\r\n\t\tif (end<start) {\r\n\t\t\tcontent = content.substr(end+1)\r\n\t\t\tcontinue\r\n\t\t}\r\n\t\tvar chunk = content.substring(start+1,end)\r\n\t\t// eslint-disable-next-line\r\n\t\twhile ((start=chunk.indexOf('{')) !== -1)  chunk = chunk.substr(start+1)\r\n\t\tif (chunk[0]===\"'\") {\r\n\t\t\tlet katex=mj(chunk.substr(1))\r\n\t\t\tif (parseError==='') ret = ret.replace('{'+chunk+'}','{'+katex+'}')\r\n\t\t\telse ret = ret.replace('{'+chunk+'}','{'+chunk.substr(1)+'}')\r\n\t\t}\r\n\t\telse if (vars) {\r\n\t\t\tlet val=evaluate(parse_expression('{'+chunk+'}',vars))\r\n\t\t\t//console.log('replace_vars',content,vars,val,chunk,parseError)\r\n\t\t\tif (parseError==='') ret = ret.replace('{'+chunk+'}','{'+(val!==chunk?val:mj(chunk))+'}')\r\n\t\t}\r\n\t\tcontent = content.substr(end+1)\r\n\t}\r\n\t//ret = ret.replace(/×/g,'\\\\times '); // TODO - don;t think this is needed - check replace vars\r\n\treturn ret\r\n}\r\n\r\nfunction add_chunk(chunks,content,type,vars)\r\n{\r\n\t//console.log(\"add_chunk\",content,type,vars)\r\n\tif (content === '\\n') chunks.push({chunk: '\\n', type: 'newline'})\r\n\telse if (content.indexOf('\\\\(') === 0)\r\n\t{\r\n\t\tvar end=content.indexOf('\\\\)')\r\n\t\tif (end === content.length-2) {\r\n\t\t\tif (type==='integral' || content.indexOf('//Big]_')!==-1) add_chunk(chunks,replace_symbols(replace_vars(content.substring(2,end),vars)).replace(/\\\\'/g,'\\\\').replace(/\\\\dfrac/g,'\\\\frac'),'latex')\r\n\t\t\telse add_chunk(chunks,replace_symbols(replace_vars(content.substring(2,end),vars)).replace(/\\\\'/g,'\\\\'),'latex')\r\n\t\t}\r\n\t\telse chunks.push({chunk:content,error:'\\\\( with no matching \\\\)',type:'error'})\r\n\t\t//console.log(\"add_chunk:latex \",content.substring(2,end));\r\n\t}\r\n\telse if (chunks.length>0 && chunks[chunks.length-1].type === type) chunks[chunks.length-1].chunk += content\r\n\telse if (chunks.length>0 && ((chunks[chunks.length-1].type==='maths' && type==='latex') || (chunks[chunks.length-1].type==='latex' && type==='maths'))) {\r\n\t\tchunks[chunks.length-1].chunk +=content\r\n\t\tchunks[chunks.length-1].type=type\r\n\t}\r\n\telse chunks.push({chunk: content, type: type})\r\n}\r\n\r\nfunction detectMaths(maths,vars)\r\n{\r\n\tif  (maths.indexOf('\\\\(')!==-1 || maths.indexOf('</')!==-1 || maths.indexOf('class=')!==-1 || maths.indexOf('target=')!==-1 || maths.endsWith('^') || maths.endsWith('√')) return false // avoid double markup\r\n\tlet ret=false\r\n\t;['^','+','=','{','[','/'].forEach(s=>{if (maths.indexOf(s)!==-1) ret=true})\r\n\tif (/-?[0-9]*/.test(maths)) ret=true\r\n\tif (parse_expression(maths,vars)) ret=true\r\n\tfor (var i=0; !ret&&i<maths.length; i++) {\r\n\t\tif (maths_keys[maths.charAt(i)]) ret=true\r\n\t}\r\n\treturn ret\r\n}\r\n\r\nfunction maths(txt,vars,auto)\r\n{\r\n\tif (debug('maths')) console.log(\"maths(txt,vars,auto)\",txt,vars,auto)\r\n\tvar chunks = [];\r\n\ttext = txt;\r\n\tif (!text) return []; // safeguard\r\n\t//if (typeof vars[q] !== 'undefined') text = replace_vars(txt,vars[q]);\r\n\ttext_pos = 0;\r\n\tvar token;\r\n\t//eslint-disable-next-line\r\n\twhile ((token = next_tok(vars)) !== -1)\r\n\t{\r\n\t\t//console.log(\"maths\",token)\r\n\t\tif (token==='') continue // empty conditional\r\n\t\tif (typeof token === 'object') chunks.push({chunk:token.text,error:token.error,type:'error'})\r\n\t\telse if (token.startsWith('\\\\(')) add_chunk(chunks,token,'latex',vars)\r\n\t\telse if (token.startsWith(\"'\")) add_chunk(chunks,replace_tags(token.substring(1)),'html')\r\n\t\telse if (token.startsWith('{xyz=') && token.endsWith('}')) {\r\n\t\t\tvars=vars?vars:{}\r\n\t\t\tvars['xyz']=token.substring(5,token.length-1)\r\n\t\t}\r\n\t\telse if (token.endsWith('.png')) chunks.push({chunk:token,type:'png'})\r\n\t\telse if (token.startsWith(\"@\"))\r\n\t\t{\r\n\t\t\tlet link=identifier(token.substring(1)) //  drop @\r\n\t\t\tadd_chunk(chunks,link.name,'help')\r\n\t\t\tif (link.end !== '') add_chunk(chunks,link.end,'text')\r\n\t\t}\r\n\t\telse if (token.startsWith(\"[\") && token.endsWith(\"]\")) add_chunk(chunks,token.substring(1,token.length-1),'table')\r\n\t\telse if (auto && detectMaths(token,vars)) parse_maths(token,chunks,vars)\r\n\t\telse if (parse_expression(token,vars)) add_chunk(chunks,mj(token,vars),'maths')\r\n\t\telse add_chunk(chunks,replace_tags(token),'html');\r\n\t}\r\n\treturn chunks;\r\n}\r\n\r\nfunction parse_maths(maths,chunks,vars)\r\n{\r\n\tlet commafull=''\r\n\tif (maths.endsWith('.') || maths.endsWith(',')) {\r\n\t\tcommafull = maths.substring(maths.length-1,maths.length)\r\n\t\tmaths = maths.substring(0,maths.length-1)\r\n\t}\r\n\tlet mathsjax = mj(maths,vars);\r\n\tif (parseError === '')\r\n\t{\r\n\t\tadd_chunk(chunks,mathsjax,'maths');\r\n\t\t//console.log('parse_maths',maths,mathsjax,checkVar('a'),condition)\r\n\t}\r\n\telse split_parse(maths,chunks,vars)\r\n\tif (commafull !== '') add_chunk(chunks,commafull,'html');\r\n}\r\n\r\nfunction split_parse(maths,chunks,vars)\r\n{\r\n\t//console.log('split_parse',maths)\r\n\tif (maths.indexOf('∫')===-1) add_chunk(chunks,'\\\\('+maths+'\\\\)','latex')\r\n\telse {\r\n\t\tlet integrals=maths.split(/(?=∫)/g)\r\n\t\tintegrals.forEach(i=>{\r\n\t\t\tif (i[0] === '∫') integral(i,chunks,vars)\r\n\t\t\telse parse_maths(i,chunks,vars)\r\n\t\t})\r\n\t}\r\n}\r\n\r\nfunction limits(maths,c)\r\n{\r\n\tconsole.log('limits',maths.substr(c,5),c)\r\n\tif (!c) c=0\r\n\tif (maths.charAt(c)==='_') {\r\n\t\tc++\r\n\t\tif (maths.charAt(c)==='{' &&  maths.indexOf('}',c)>c) c=maths.indexOf('}',c)\r\n\t\tc++\r\n\t\tif (maths.charAt(c)==='^') {\r\n\t\t\tc++\r\n\t\t\tif (maths.charAt(c)==='{' &&  maths.indexOf('}',c)>c) c=maths.indexOf('}',c)\r\n\t\t\tc++\r\n\t\t}\r\n\t}\r\n\treturn c // can also return upper and lower if needed\r\n}\r\n\r\nfunction integral(maths,chunks,vars)\r\n{\r\n\tlet int=null,eq=null,f=null,dx=null\r\n\tif (maths.indexOf('=')>0) [maths,eq]=maths.split(/(?==)/)\r\n\tlet c=limits(maths,1)\r\n\tint=maths.substr(0,c)\r\n\tlet e=maths.length\r\n\tif (e>=2 && maths[e-2]==='d') {\r\n\t\tdx=maths.substr(e-2,2)\r\n\t\te=e-2\r\n\t}\r\n\tif (e>c) f=maths.substr(c,e-c)\r\n\t//console.log('integral',int,f,dx,eq)\r\n\tif (int.indexOf('_')>-1) add_chunk(chunks,'\\\\(\\\\displaystyle'+int+'\\\\)','integral')\r\n\telse add_chunk(chunks,'\\\\('+int+'\\\\)','latex')\r\n\tif (f) parse_maths(f,chunks,vars)\r\n\tif (dx) add_chunk(chunks,'\\\\(\\\\;'+dx+'\\\\)','latex')\r\n\tif (eq) parse_maths(eq,chunks,vars)\r\n}\r\n\r\nfunction replace_tags(str)\r\n{\r\n\tvar ret=''+str // could make an array and itterate but easier not to\r\n\tret = ret.replace(/<r>/g,'<span class=\"red\">')\r\n\tret = ret.replace(/<o>/g,'<span class=\"amber\">')\r\n\tret = ret.replace(/<g>/g,'<span class=\"green\">')\r\n\tret = ret.replace(/<h>/g,'<h5>')\r\n\tret = ret.replace(/<\\/r>/g,'</span>')\r\n\tret = ret.replace(/<\\/o>/g,'</span>')\r\n\tret = ret.replace(/<\\/g>/g,'</span>')\r\n\tret = ret.replace(/<\\/h>/g,'</h5>')\r\n\treturn ret\r\n}\r\n\r\nfunction identifier(string)\r\n{\r\n\tconst terminators=\" \\r\\n\\\\'[](){}.,@\"; // things not allowed in identifier\r\n\tvar i = 0;\r\n\twhile (i<string.length && terminators.indexOf(string[i]) === -1) i++;\r\n\treturn {name:string.substring(0,i),end:i===string.length?'':string.substring(i)};\r\n}\r\n\r\nfunction hcf(a,b)\r\n{\r\n\tlet ret=1 // safeguard\r\n\tif (is_numeric(a) && is_numeric(b))\r\n\t{\r\n\t\tif (b*1===0) ret=a*1\r\n\t\telse if (b*1===1) ret=a%b // will be 1 for integers < 1 for non-integer\r\n\t\telse ret=hcf(b,a%b)\r\n\t}\r\n\t//console.log(\"hcf\",a,b,ret)\r\n\treturn ret>0?ret:ret===0?1:-ret\r\n}\r\n\r\nfunction lcm(a,b)\r\n{\r\n\t//echo \"lcm($a,$b)<br/>\";\r\n\treturn a*b/hcf(a,b);\r\n}\r\n\r\nexport {evaluate,parse_expression,parseError,mj,maths,comp,compare,compare_eval,outTree,hcf,lcm,commute,normalise,is_numeric,is_fraction,maths_keys}\r\n","import React, { Component } from 'react'\r\nimport {Modal,Panel,Row,Col,Form,FormGroup,FormControl,HelpBlock,ControlLabel,Button,Checkbox} from 'react-bootstrap';\r\nimport {ajax} from './ajax'\r\nimport {isset,store_user} from './Utils'\r\n\r\nclass Login extends Component {\r\n  state={email:'',password:'', remember: false, error:{}}\r\n  login=(e)=>{\r\n    e.preventDefault()\r\n    ajax('/react_ajax/login',(r)=>{\r\n      if (r.error) this.setState({error:r.data})\r\n      else {\r\n        this.props.fm.setState({user:r.data})\r\n        store_user(r.data)\r\n      }\r\n    },this.state)\r\n  }\r\n  render() {\r\n    return (<Row><Col smOffset={2} sm={8}>\r\n      <Panel><Panel.Heading><Panel.Title componentClass=\"h3\">Login</Panel.Title></Panel.Heading>\r\n      <Panel.Body>\r\n      {this.state.error.error?<div className=\"alert alert-danger\"><strong>Server Error: {this.state.error.error}</strong></div>:null}\r\n      <Form onSubmit={this.login} horizontal>\r\n      <FormGroup controlId=\"formEmail\" validationState={this.state.error.email?\"error\":null}>\r\n        <Col componentClass={ControlLabel} sm={2}>Email</Col>\r\n        <Col sm={9}><FormControl type=\"email\" name=\"email\" value={this.state.email} placeholder=\"Email\" onChange={(e)=>this.setState({email:e.target.value,error:''})}/></Col>\r\n        {this.state.error.email?<Col smOffset={2} sm={9}><HelpBlock>{this.state.error.email}</HelpBlock></Col>:null}\r\n      </FormGroup>\r\n      <FormGroup controlId=\"formPassword\" validationState={this.state.error.password?\"error\":null}>\r\n        <Col componentClass={ControlLabel} sm={2}>Password</Col>\r\n        <Col sm={9}><FormControl type=\"password\" name=\"password\" value={this.state.password} placeholder=\"Password\" onChange={(e)=>this.setState({password:e.target.value,error:''})}/></Col>\r\n        {this.state.error.password?<Col smOffset={2} sm={9}><HelpBlock>{this.state.error.password}</HelpBlock></Col>:null}\r\n      </FormGroup>\r\n      <FormGroup>\r\n        <Col smOffset={2} sm={4}><Button name=\"login\" bsStyle=\"primary\" type=\"submit\"><i className=\"fa fa-btn fa-sign-in\"></i> Login</Button></Col>\r\n        <Col sm={4}><Button bsStyle=\"link\" onClick={(e)=>{e.currentTarget.blur();this.props.fm.setState({modal:'forgot',email:this.state.email})}}>Forgot your password?</Button></Col>\r\n      </FormGroup>\r\n      <FormGroup>\r\n        <Col smOffset={2} sm={4}><Checkbox value={this.state.remember?'checked':false} onChange={()=>this.setState({remember:!this.state.remember})}>remember me</Checkbox></Col>\r\n        <Col sm={4}><Button bsStyle=\"link\" onClick={(e)=>{e.currentTarget.blur();this.props.fm.setState({modal:'register'})}}><i className=\"fa fa-btn fa-user\"></i>Register</Button></Col>\r\n        </FormGroup>\r\n      </Form></Panel.Body>\r\n    </Panel></Col></Row>)\r\n  }\r\n}\r\n\r\nclass Forgot extends Component {\r\n  state={email: this.props.email?this.props.email:'', error:{}, sending:false}\r\n  send=(e)=>{\r\n    e.preventDefault()\r\n    this.setState({sending:true})\r\n    ajax('/react_ajax/forgot',(r)=>{\r\n      //console.log(\"forgot\",r)\r\n      if (r.error) this.setState({error:r.data,sending:false}) // report general error\r\n      else this.props.close({type:'success',text:'We have e-mailed your password reset link!'})\r\n    },{email:this.state.email})\r\n  }\r\n  render() {\r\n    return (<Modal show={true} onHide={this.props.close}>\r\n        <Modal.Header closeButton><Modal.Title>Reset Password</Modal.Title></Modal.Header>\r\n        <Modal.Body>\r\n        {this.state.sending?<div className=\"alert alert-success\"><strong>Sending...</strong></div>:null}\r\n      {this.state.error.error?<div className=\"alert alert-danger\"><strong>Error: {this.state.error.error}</strong></div>:null}\r\n      <Form onSubmit={this.send} horizontal>\r\n      <FormGroup controlId=\"formHorizontalEmail\" validationState={this.state.error.email?\"error\":null}>\r\n        <Col componentClass={ControlLabel} sm={2}>Email</Col>\r\n        <Col sm={9}><FormControl type=\"email\" name=\"email\" value={this.state.email} placeholder=\"Email\" onChange={(e)=>this.setState({email:e.target.value,error:{}})}/></Col>\r\n        {this.state.error.email===''?null:<Col smOffset={2} sm={9}><HelpBlock>{this.state.error.email}</HelpBlock></Col>}\r\n      </FormGroup>\r\n      <FormGroup>\r\n        <Col smOffset={2} sm={6}><Button bsStyle=\"primary\" type=\"submit\"><i className=\"fa fa-btn fa-envelope\"></i> Send Password Reset Link</Button></Col>\r\n      </FormGroup>\r\n      </Form>\r\n    </Modal.Body></Modal>)\r\n  }\r\n}\r\n\r\nclass Reset extends Component {\r\n  state={email:'', password:'', password_confirmation:'',error:{}}\r\n  reset=(e)=>{\r\n    e.preventDefault();\r\n    ajax('/react_ajax/reset',(r)=>{\r\n      //console.log(\"reset\",r)\r\n      if (r.error) this.setState({error:r.data})\r\n      else this.props.fm.setState({user:r.data,modal:null,message:{type:'success',text:'Your password has been reset.'}})\r\n    },{email:this.state.email,password:this.state.password,password_confirmation:this.state.password_confirmation,token:this.props.fm.state.token})\r\n  }\r\n  render() {\r\n    return (<Modal show={true} onHide={this.props.close}>\r\n      <Modal.Header closeButton><Modal.Title>Reset Password</Modal.Title></Modal.Header>\r\n      <Modal.Body>\r\n      {this.state.error.error?<div className=\"alert alert-danger\"><strong>Error: {this.state.error.error}</strong></div>:null}\r\n      {this.state.error.token?<div className=\"alert alert-danger\"><strong>Error: {this.state.error.token}</strong></div>:null}\r\n      <Form onSubmit={this.reset} horizontal>\r\n    <FormGroup controlId=\"email1\" validationState={this.state.error.email?\"error\":null}>\r\n      <Col componentClass={ControlLabel} sm={2}>Email</Col>\r\n      <Col sm={9}><FormControl type=\"email\" name=\"email\" value={this.state.email} placeholder=\"Email\" onChange={(e)=>this.setState({email:e.target.value,error:{}})}/></Col>\r\n      {this.state.error.email?<Col smOffset={2} sm={9}><HelpBlock>{this.state.error.email}</HelpBlock></Col>:null}\r\n    </FormGroup>\r\n    <FormGroup controlId=\"password1\" validationState={this.state.error.password?\"error\":null}>\r\n      <Col componentClass={ControlLabel} sm={2}>Password</Col>\r\n      <Col sm={9}><FormControl type=\"password\" name=\"password\" value={this.state.password} placeholder=\"Password\" onChange={(e)=>this.setState({password:e.target.value,error:{}})}/></Col>\r\n      {isset(this.state.error.password)?<Col smOffset={2} sm={9}><HelpBlock>{this.state.error.password}</HelpBlock></Col>:null}\r\n    </FormGroup>\r\n    <FormGroup controlId=\"confirm1\" validationState={this.state.error.password_confirmation?\"error\":null}>\r\n      <Col componentClass={ControlLabel} sm={2}>Confirm</Col>\r\n      <Col sm={9}><FormControl type=\"password\" name=\"password_confirmation\" value={this.state.password_confirmation} placeholder=\"Password\" onChange={(e)=>this.setState({password_confirmation:e.target.value,error:{}})}/></Col>\r\n      {this.state.error.password_confirmation?<Col smOffset={2} sm={9}><HelpBlock>{this.state.error.password_confirmation}</HelpBlock></Col>:null}\r\n    </FormGroup>\r\n    <FormGroup>\r\n      <Col smOffset={2} sm={4}><Button bsStyle=\"primary\" type=\"submit\"><i className=\"fa fa-btn fa-refresh\"></i> Reset Password</Button></Col>\r\n    </FormGroup>\r\n    </Form>\r\n    </Modal.Body></Modal>)\r\n  }\r\n}\r\n\r\nclass Password extends Component {\r\n  state={password:'', error:{}}\r\n  login=(e)=>{\r\n    e.preventDefault();\r\n    let auth=false,to=this.props.to?this.props.to:null,user=this.props.fm.state.user\r\n    if (this.props.auth && user && (!this.props.to || this.props.to.email===user.email)) {\r\n      auth=true; to=null;\r\n    }\r\n    ajax('/react_ajax/password',(r)=>{\r\n      //console.log(\"Password\",r)\r\n      if (r.error) this.setState({error:r.data})\r\n      else if (this.props.auth && user && (!this.props.to || this.props.to.email===user.email))\r\n        this.props.auth()\r\n      else this.props.fm.setState({user: store_user(r.data,user),password:false})\r\n    },{password:this.state.password,auth:auth,to:to,lastLogId:user&&user.log.length?user.log[user.log.length-1].id:0})\r\n  }\r\n  render() {\r\n    return (<Modal show={true} onHide={this.props.close}>\r\n      <Modal.Header closeButton><Modal.Title>Enter Password</Modal.Title></Modal.Header>\r\n      <Modal.Body>\r\n      {this.state.error.error?<div className=\"alert alert-danger\"><strong>Server Error: {this.state.error.error}</strong></div>:null}\r\n      <Form onSubmit={this.login} horizontal>\r\n      <FormGroup controlId=\"password\" validationState={this.state.error.password?\"error\":null}>\r\n        <Col componentClass={ControlLabel} sm={2}>Password</Col>\r\n        <Col sm={9}><FormControl type=\"password\" name=\"password\" value={this.state.password} placeholder=\"Password\" onChange={(e)=>this.setState({password:e.target.value,error:''})}/></Col>\r\n        {this.state.error.password?<Col smOffset={2} sm={9}><HelpBlock>{this.state.error.password}</HelpBlock></Col>:null}\r\n      </FormGroup>\r\n      <FormGroup>\r\n        <Col smOffset={2} sm={4}><Button bsStyle=\"primary\" type=\"submit\"><i className=\"fa fa-btn fa-sign-in\"></i> Confirm</Button></Col>\r\n        {this.props.fm.state.user?null:<Col sm={4}><Button bsStyle=\"link\" onClick={this.props.close}>Switch user?</Button></Col>}\r\n      </FormGroup>\r\n      </Form>\r\n      </Modal.Body>\r\n      </Modal>)\r\n  }\r\n}\r\n\r\nclass Details extends Component {\r\n  state={auth:false}\r\n  render() {\r\n    if (this.state.auth) return <Register fm={this.props.fm} close={this.props.close}/>\r\n    else return <Password fm={this.props.fm} close={this.props.close} auth={()=>this.setState({auth:true})}/>\r\n  }\r\n}\r\n\r\nclass Register extends Component {\r\n  state=this.props.fm.state.user?{name:this.props.fm.state.user.name,email:this.props.fm.state.user.email,password:'',password_confirmation:'',error:{},pw:false}\r\n  :{name:'',email:'',password:'',password_confirmation:'',error:{},pw:true}\r\n  register=(e)=>{\r\n    e.preventDefault()\r\n    ajax('/react_ajax/'+(this.props.fm.state.user?'update':'register'),(r)=>{\r\n      if (r.error) this.setState({error:r.data})\r\n      else if (this.props.fm.state.user) {\r\n        let user=this.props.fm.state.user\r\n        user.email=r.data.email\r\n        user.name=r.data.name\r\n        this.props.fm.setState({user:user,modal:null,message:{type:'success',text:'Details updated'}})\r\n      }\r\n      else this.props.fm.setState({user:r.data,modal:null,message:{type:'success',text:'Account registered. Use Test to check you knowledge.'}})\r\n    },this.state)\r\n  }\r\n  update(name,value){\r\n    let state=this.state\r\n    state[name]=value\r\n    if (isset(state.error[name])) delete state.error[name]\r\n    this.setState(state)\r\n  }\r\n  render() {\r\n    return (<Modal name='register' show={true} onHide={this.props.close}>\r\n      <Modal.Header closeButton><Modal.Title>{this.props.fm.state.user?'Update Details':'Register'}</Modal.Title></Modal.Header>\r\n      <Modal.Body>\r\n      {this.state.error.error?<div className=\"alert alert-danger\"><strong>Server Error: {this.state.error.error}</strong></div>:null}\r\n      <Form onSubmit={this.register} horizontal>\r\n      <FormGroup controlId=\"formName\" validationState={isset(this.state.error['name'])?\"error\":null}>\r\n        <Col componentClass={ControlLabel} sm={2}>Name</Col>\r\n        <Col sm={9}><FormControl type=\"name\" name=\"name\" value={this.state.name} placeholder=\"First Last\" onChange={(e)=>this.update('name',e.target.value)}/></Col>\r\n        {isset(this.state.error['name'])?<Col smOffset={2} sm={9}><HelpBlock>{this.state.error['name']}</HelpBlock></Col>:null}\r\n      </FormGroup>\r\n      <FormGroup controlId=\"formEmail\" validationState={isset(this.state.error['email'])?\"error\":null}>\r\n        <Col componentClass={ControlLabel} sm={2}>Email</Col>\r\n        <Col sm={9}><FormControl type=\"email\" name=\"email\" value={this.state.email} placeholder=\"Email\" onChange={(e)=>this.update('email',e.target.value)}/></Col>\r\n        {isset(this.state.error['email'])?<Col smOffset={2} sm={9}><HelpBlock>{this.state.error['email']}</HelpBlock></Col>:null}\r\n      </FormGroup>\r\n      {this.state.pw?<div>\r\n      <FormGroup controlId=\"formPassword\" validationState={isset(this.state.error['password'])?\"error\":null}>\r\n        <Col componentClass={ControlLabel} sm={2}>Password</Col>\r\n        <Col sm={9}><FormControl type=\"password\" name=\"password\" value={this.state.password} placeholder={this.props.fm.state.user?\"New Password\":\"Password\"} onChange={(e)=>this.update('password',e.target.value)}/></Col>\r\n        {isset(this.state.error['password'])?<Col smOffset={2} sm={9}><HelpBlock>{this.state.error['password']}</HelpBlock></Col>:null}\r\n      </FormGroup>\r\n      <FormGroup controlId=\"formConfirm\" validationState={isset(this.state.error['password_confirmation'])?\"error\":null}>\r\n        <Col componentClass={ControlLabel} sm={2}>Confirm</Col>\r\n        <Col sm={9}><FormControl type=\"password\" name=\"password_confirmation\" value={this.state.password_confirmation} placeholder={this.props.fm.state.user?\"New Password\":\"Password\"} onChange={(e)=>this.update('password_confirmation',e.target.value)}/></Col>\r\n        {isset(this.state.error['password_confirmation'])?<Col smOffset={2} sm={9}><HelpBlock>{this.state.error['password_confirmation']}</HelpBlock></Col>:null}\r\n      </FormGroup>\r\n      </div>:\r\n      <FormGroup>\r\n        <Col sm={4}><Button bsStyle=\"link\" onClick={(e)=>{this.setState({pw:true})}}>Change password?</Button></Col>\r\n      </FormGroup>}\r\n      <FormGroup>\r\n        <Col smOffset={2} sm={4}><Button bsStyle=\"primary\" type=\"submit\"><i className=\"fa fa-btn fa-user\"></i> {this.props.fm.state.user?'Update':'Register'}</Button></Col>\r\n      </FormGroup>\r\n      </Form>\r\n    </Modal.Body></Modal>)\r\n  }\r\n}\r\n\r\nexport {Login,Reset,Forgot,Password,Details,Register}\r\n","/* eslint-disable */ //TODO need to specifically eslint-disable-next-line or remove each error.\r\nimport {evaluate,parse_expression,parseError,set_keys,set_algebra_,hcf,lcm,is_numeric,is_fraction} from './maths'\r\nimport {copy,isset,debug} from './Utils'\r\n\r\nfunction outputVars(vars)\r\n{\r\n\tvar ret = '';\r\n\tvar keys = Object.keys(vars);\r\n\tfor (var i = 0; i < keys.length; i++)\r\n\t{\r\n\t\t//console.log(keys[i]+'='+vars[keys[i]]);\r\n\t\tret += (\"\"+keys[i]+\"=\"+vars[keys[i]]+\"<br />\\n\");\r\n\t}\r\n\treturn ret\r\n}\r\n\r\nfunction setVariables(def,log,count) {\r\n\tif (debug('setVariables')) console.log('setVariables',def,log,count)\r\n\tlet vars=setUse(def,log)\r\n\tif (!vars)\r\n\t{\r\n\t\tlet opts = {};\r\n\t\tlet defs = [];\r\n\t\tlet xyz,keys\r\n\t\t//var ret='';\r\n\t\tif (typeof def !== 'undefined' && def.length > 0) defs = def.split('\\n');\r\n\t\tfor (var i=0; i<defs.length; i++)\r\n\t\t{\r\n\t\t\tif (defs[i].indexOf('=') === -1 || (defs[i].indexOf('{') !== -1 && defs[i].indexOf('{')<defs[i].indexOf('='))) continue\r\n\t\t\tlet vdef = defs[i].substr(defs[i].indexOf('=')+1)\r\n\t\t\tlet vs = defs[i].substr(0,defs[i].indexOf('=')).split(',')\r\n\t\t\tif (vdef.length>0 && vs.length>0) vs.forEach(v=>{\r\n\t\t\t\tv=v.trim()\r\n\t\t\t\tif (v==='xyz') xyz=vdef\r\n\t\t\t\telse if (v==='keys') keys=vdef\r\n\t\t\t\telse if (v) opts[v]=count?options(vdef):randomise(options(vdef))\r\n\t\t\t})\r\n\t\t}\r\n\t\t//console.log(\"setVars=\",JSON.stringify(vars))\r\n\t\tif (count) return count_opts(opts,tests(def))\r\n\t\telse {\r\n\t\t\tvars=setVals(opts,tests(def),log)\r\n\t\t\tif (vars&&xyz) vars.xyz=xyz\r\n\t\t\tif (vars&&keys) vars.keys=keys\r\n\t\t}\r\n\t}\r\n\treturn vars\r\n}\r\n\r\nfunction randomise(opts)\r\n{\r\n\tif (typeof window.FreeMaths !== 'undefined' && typeof window.FreeMaths.testing !== 'undefined' && window.FreeMaths.testing) return opts\r\n\t//console.log(\"randomise\",opts)\r\n\tif (opts.length > 0)\r\n\tfor (var i=0; i<opts.length; i++)\r\n\t{\r\n\t\t\tvar j = Math.floor(i+ Math.random()*(opts.length-i));\r\n\t\t\tvar temp=opts[i]\r\n\t\t\topts[i]=opts[j]\r\n\t\t\topts[j]=temp\r\n\t}\r\n\t//console.log(\"randomise\",opts)\r\n\treturn opts\r\n}\r\n\r\nfunction setUse(varDef,log)\r\n{\r\n\t//console.log(\"setUse\",varDef,log)\r\n\tlet testList=tests(varDef)\r\n\tlet done=false,vars=null\r\n\tif (log && log.use.length > 0)\r\n\t{\r\n\t\tlet i=0\r\n\t\twhile (!done && i<log.use.length)\r\n\t\t{\r\n\t\t\tvars = JSON.parse(log.use[i++])\r\n\t\t\tdone = test(vars,testList,log)\r\n\t\t}\r\n\t}\r\n\treturn done?vars:false\r\n}\r\n\r\nfunction setVals(opts,tests,log)\r\n{\r\n\tlet state = set_state(opts,vars)\r\n\tlet orig=copy(state)\r\n\tlet vars=get_vars(opts,state)\r\n\t// should refactor to avoid duplication\r\n\twhile (state !== false && !test(vars,tests,log))\r\n\t{\r\n\t\tstate = next_option(opts,state)\r\n\t\tvars=get_vars(opts,state)\r\n\t}\r\n\tif (state === false) {\r\n\t\tconsole.log(\"setVals - retry\",state,orig,opts,tests,log)\r\n\t\t// re-try without avoiding \"log.skip\"\r\n\t\tstate=copy(orig)\r\n\t\tvars=get_vars(opts,state)\r\n\t\twhile (state !== false && !test(vars,tests,null))\r\n\t\t{\r\n\t\t\tstate=next_option(opts,state)\r\n\t\t\tvars=get_vars(opts,state)\r\n\t\t}\r\n\t\tif (state === false) console.error(\"setVals\",state,orig,opts,tests)\r\n\t}\r\n\treturn state?vars:null\r\n}\r\n\r\nfunction count_opts(opts,tests)\r\n{\r\n\tlet stats = {false:0,true:0,opts:[]}\r\n\tstats[false]=0\r\n\tstats[true]=0\r\n\tlet state = set_state(opts)\r\n\twhile (state !== false && stats[false] < 65000 && stats[true] < 65000)\r\n\t{\r\n\t\tlet vars=get_vars(opts,state)\r\n\t\tif (test(vars,tests)) {\r\n\t\t\tstats[true]++\r\n\t\t\tstats.opts.push(vars)\r\n\t\t}\r\n\t\telse stats[false]++\r\n\t\tstate = next_option(opts,state)\r\n\t}\r\n\treturn stats\r\n}\r\n\r\nfunction set_state(opts)\r\n{\r\n\tvar state = {}\r\n\tvar names = Object.keys(opts)\r\n\tfor (var i=0; i<names.length; i++)\r\n\t{\r\n\t\tstate[names[i]]=0\r\n\t}\r\n\treturn state\r\n}\r\n\r\nfunction get_vars(opts,state)\r\n{\r\n\tlet vars={}\r\n\tObject.keys(opts).forEach(x=>{vars[x]=opts[x][state[x]]})\r\n\treturn vars\r\n}\r\n\r\nfunction next_option(opts,state)\r\n{\r\n\tvar names = Object.keys(state)\r\n\tfor (var i=0; i<names.length; i++)\r\n\t{\r\n\t\tstate[names[i]]++\r\n\t\t//console.log(\"next_option\",i,state[names[i]])\r\n\t\tif (state[names[i]] < opts[names[i]].length) {\r\n\t\t\treturn state\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstate[names[i]]=0\r\n\t\t}\r\n\t}\r\n\treturn false\r\n}\r\n\r\nfunction options(def)\r\n{\r\n\tvar options = [];\r\n\tif (def.startsWith('[')) options = range1(def.substr(1,def.indexOf(']')-1))\r\n\telse if (is_numeric(def)) options[0]=def*1\r\n\telse if (is_fraction(parse_expression(def))) options[0]=def\r\n\telse  options[0] = evaluate(parse_expression(def))\r\n\treturn options\r\n}\r\n\r\nfunction tests(def)\r\n{\r\n\t\tvar lines = def.split(\"\\n\")\r\n\t\tvar tests=[]\r\n\t\tlines.forEach((line)=>{\r\n\t\t\tif (line.indexOf(']') !== -1) line = line.substring(line.indexOf(']')+1)\r\n\t\t\tif (line.indexOf(':') !== -1) line = line.substring(line.indexOf(']')+1)\r\n\t\t\tvar start,end\r\n\t\t\tif ((start=line.indexOf('{')) !== -1 && line.indexOf('{xyz=') === -1 && (end=line.indexOf('}')) !== -1 && end > start)\r\n\t\t\t{\r\n\t\t\t\ttests.push(line.substring(start,end+1))\r\n\t\t\t}\r\n\t\t})\r\n\t\t//console.log(\"tests\",tests,def)\r\n\t\treturn tests\r\n}\r\n\r\nfunction skip(tests,vars)\r\n{\r\n\t// needs re-writing - test whic variables need changing\r\n\tlet ret=0\r\n\tfor (var i=0; i<tests.length && ret===0; i++)\r\n\t{\r\n\t\t// should do all and then return lowest\r\n\t\tif (tests[i].startsWith('≠{'))\r\n\t\t{\r\n\t\t\t\tlet vs=tests[i].substring(2,tests[i].length-1).split(',')\r\n\t\t\t\tvar j=1;\r\n\t\t\t\twhile (ret === 0 && j<vs.length)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (var v=0; v<j && ret===0; v++)\r\n\t\t\t\t\t for (v2=v+1; v2<=j && ret===0; v2++)\r\n\t\t\t\t\t  if (vars[v]===vars[v2]) ret=v2\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//console.log(\"skip\",tests[i],ret)\r\n\treturn ret\r\n}\r\n\r\nfunction check_skip(vars,vals)\r\n{\r\n\tlet ret=false\r\n\tlet i=0\r\n\twhile (i<vals.length && !ret)\r\n\t{\r\n\t\tret=(vals[i]===JSON.stringify(vars))\r\n\t\ti++\r\n\t}\r\n\t//if (ret) console.log(\"check_skip\",ret,vals,vars)\r\n\treturn ret\r\n}\r\n\r\nfunction test(vars,testList,log)\r\n{\r\n\tlet ret = true\r\n\tif (log && check_skip(vars,log.skip)) ret=false\r\n\telse {\r\n\t\tfor (var i=0; i<testList.length; i++)\r\n\t\t{\r\n\t\t\tif (testList[i].startsWith('{≠'))\r\n\t\t\t{\r\n\t\t\t\tlet vs=testList[i].substring(2,testList[i].length-1).split(',')\r\n\t\t\t\tvs.forEach(v=>vs.forEach(v2=>{if (v!==v2 && vars[v]===vars[v2]) ret = false}))\r\n\t\t\t}\r\n\t\t\telse ret=ret&&parse_expression(testList[i],vars)?true:false\r\n\t\t}\r\n\t}\r\n\t//console.log('test',vars,testList,log,ret)\r\n\treturn ret\r\n}\r\n\r\nfunction range1(str)\r\n{\r\n\tvar vals = [];\r\n\tif (str.indexOf(',')>0)\r\n\t{\r\n\t\tvals = str.split(\",\");\r\n\t\tvals=vals.map(x=>{return is_numeric(x)?1*x:x})\r\n\t}\r\n\telse if (str.indexOf('..')>0)\r\n\t{\r\n\t\t// integer range - improve for fraction range\r\n\t\tvar val = 0;\r\n\t\tvar range = str.split(\"..\");\r\n\t\tif (range.length === 2)\r\n\t\t{\r\n\t\t\tif (range[0].indexOf('/')>0 && range[1].indexOf('/')>0) vals = frac_range(range[0],range[1]);\r\n\t\t\telse for (var i=range[0]*1; i<=range[1]; i++) vals[val++] = i;\r\n\t\t}\r\n\t}\r\n\treturn vals;\r\n}\r\n\r\nfunction frac_range(f1,f2)\r\n{\r\n\tvar ret = [];\r\n\tvar a = f1.split('/');\r\n\tvar b = f2.split('/');\r\n\tvar n,d;\r\n\tif (is_numeric(a[0]) && is_numeric(a[1]) && is_numeric(b[0]) && is_numeric(b[1]))\r\n\t\tfor (n = 1; n <= 9*b[0]/b[1]; n++)\r\n\t\t\tfor (d=2; d <= 9; d++)\r\n\t\t\t\tif (n/d >= a[0]/a[1] && n/d <= b[0]/b[1] && hcf(n,d) === 1) ret.push(n+'/'+d);\r\n\t\t\t\treturn ret;\r\n}\r\n\r\nexport {setVariables,outputVars,setUse}\r\n","import React, { Component } from 'react'\r\nimport {setVariables,outputVars} from './vars'\r\nimport {Modal,Button} from 'react-bootstrap'\r\nimport {Maths,mathsSymbols} from './ReactMaths'\r\nimport {copy,isset,question} from './Utils'\r\n\r\nclass EditQuestion extends Component {\r\n  state = {question: question(this.props.qid), vars: this.props.vars?this.props.vars:setVariables(question(this.props.qid).variables), help: '', showHelp:false}\r\n  save=(cpy)=>{\r\n    let q=this.state.question\r\n    if (cpy) {\r\n      q=copy(q)\r\n      q.previous_id=q.id\r\n      q.id=0\r\n    }\r\n    if (JSON.stringify(question(this.props.qid)) !== JSON.stringify(q)) this.props.fm.saveQ(q)\r\n    else\r\n    {\r\n      console.log(\"Question save: no changes\")\r\n      this.props.close()\r\n    }\r\n  }\r\n  componentWillReceiveProps(p) {\r\n    if (p.qid !== this.state.question.id)\r\n    {\r\n       this.setState({question: question(p.qid), vars: setVariables(question(p.qid).variables), showHelp:false});\r\n       //if (JSON.stringify(nextProps.question) !== JSON.stringify(this.state.question)) this.setState({vars: setVariables(nextProps.question['variables'])});\r\n     }\r\n  }\r\n  shouldComponentUpdate(nextProps, nextState)\r\n  {\r\n    return (\r\n      JSON.stringify(nextState.question) !== JSON.stringify(this.state.question) ||\r\n      nextState.vars !== this.state.vars ||\r\n      nextState.help !== this.state.help ||\r\n      nextState.showHelp !== this.state.showHelp)\r\n  }\r\n  updateQuestion=(field,value)=>\r\n  {\r\n    if (this.state.question[field] !== value)\r\n    {\r\n      var updated = JSON.parse(JSON.stringify(this.state.question));\r\n      updated[field] = value;\r\n      this.setState({question: updated});\r\n    }\r\n  }\r\n  changeVariables=()=>\r\n  {\r\n    this.setState({vars: setVariables(this.state.question['variables'])});\r\n  }\r\n  setQ=(e)=>{\r\n    let q=this.props.questions[e.target.value-1]\r\n    //console.log(\"EditQuestion setQ\",e.target.value,q)\r\n    if (!isset(q.next)) q.next=''\r\n    this.setState({vars: setVariables(q.variables), question: q})\r\n  }\r\n  render() {\r\n    //console.log(\"EditQuestion render\",this.state.question,this.state.vars)\r\n    return (\r\n      <Modal show={true} bsSize=\"large\" onHide={this.props.close}>\r\n      <Modal.Header closeButton><Modal.Title><Qlist q={this.state.question} qs={this.props.questions} setQ={this.setQ}/></Modal.Title></Modal.Header>\r\n      <Modal.Body><EditFields fields={this.state.question} vars={this.state.vars} change={this.changeVariables} update={this.updateQuestion}/></Modal.Body>\r\n      <Modal.Footer><Button onClick={()=>this.save(true)}>Copy</Button><Button onClick={()=>this.save(false)}>Save</Button></Modal.Footer>\r\n      </Modal>\r\n    )\r\n  }\r\n}\r\n\r\nclass Qlist extends Component {\r\n  render(){\r\n    if (!isset(this.props.qs)) return <div>{this.props.q.id}: <Maths>{this.props.q.topic}</Maths></div>\r\n    else return <select value={this.props.q.id} onChange={this.props.setQ}>{this.props.qs.map(q=>{return <option value={q.id} key={q.id}>{q.id}: {q.topic}</option>})}</select>\r\n  }\r\n}\r\n\r\nclass EditFields extends Component\r\n{\r\n  state={fields: null}\r\n  renderFields=(newQ,vars)=>\r\n  {\r\n    var fields = {}\r\n    //console.log(\"renderFields:\",newQ,this.props.fields,vars)\r\n    Object.keys(newQ).forEach((key)=>\r\n    {\r\n      if (typeof vars !== \"undefined\")\r\n        fields[key] = <EditField auto={this.props.auto} key={key} field={key} text={newQ[key]} vars={vars} update={this.props.update} change={this.props.change}/>\r\n      else if (this.state.fields === null || this.props.fields[key] !== newQ[key])\r\n        fields[key] =<EditField auto={this.props.auto} key={key} field={key} text={newQ[key]} vars={this.props.vars} update={this.props.update} change={this.props.change}/>\r\n      else  fields[key] = this.state.fields[key]\r\n    });\r\n    //console.log(\"renderFields %o %o %o\",newQ,vars,fields)\r\n    this.setState({fields: fields})\r\n  }\r\n  shouldComponentUpdate(nextProps, nextState)\r\n  {\r\n    return nextState.fields !== this.state.fields\r\n  }\r\n  componentWillReceiveProps(nextProps) {\r\n    if (this.state.fields !== null)\r\n    {\r\n      if (nextProps.vars !== this.props.vars) this.renderFields(nextProps.fields,nextProps.vars)\r\n      else if (nextProps.fields !== this.props.fields) this.renderFields(nextProps.fields)\r\n    }\r\n  }\r\n  componentDidMount() {this.renderFields(this.props.fields,this.props.vars)}\r\n  render()\r\n  {\r\n    if (this.state.fields === null) return null\r\n    var html = Object.keys(this.state.fields).map((key)=>{return this.state.fields[key]})\r\n    //console.log(\"Fields\",this.state.fields)\r\n    return <div>{html}</div>\r\n  }\r\n}\r\n\r\nclass EditField extends Component {\r\n  state={stats:{},text:this.props.text,caret:null}\r\n  update=(e)=>\r\n  {\r\n    let caret=this.text.selectionStart\r\n    if (this.props.field !== 'json') var m = mathsSymbols(e.target.value,caret)\r\n    else m = {text:e.target.value, caret:caret}\r\n    this.setState({text: m.text,caret:m.caret})\r\n    this.props.update(this.props.field, m.text)\r\n  }\r\n  componentDidUpdate()\r\n  {\r\n    if (this.state.caret!==null &&  this.state.caret!==this.text.selectionStart) this.text.setSelectionRange(this.state.caret,this.state.caret)\r\n  }\r\n  componentWillReceiveProps(nextProps) {\r\n    if (nextProps.text !== this.state.text) this.setState({stats:{},text:nextProps.text})\r\n  }\r\n  setStats=()=>{\r\n    this.setState({stats: setVariables(this.props.text,null,true)})\r\n  }\r\n  render() {\r\n    var editable={json:1,working:1,variables:1,help:1,topic:1,answer:1,question:1,title:1,keywords:1,comment:1,topics:1,next:1}\r\n    if (typeof editable[this.props.field] ==='undefined') return null // may leave mark\r\n    else if (this.props.field === 'variables') return (\r\n      <div className=\"EditVariables row\">\r\n      <div className=\"col-sm-1\" dangerouslySetInnerHTML={{__html: outputVars(this.props.vars)}}></div>\r\n      <div className=\"col-sm-1\"><i className=\"btn btn-default btn-sm fa fa-btn fa-repeat\" onClick={this.props.change}></i></div>\r\n      <div className=\"col-sm-2\">options: {this.state.stats[true]}<br />failed: {this.state.stats[false]}</div>\r\n      <div className=\"col-sm-2\"><i className=\"btn btn-deafult btn-sm fa fa-btn fa-repeat\" onClick={this.setStats}></i></div>\r\n      <div className=\"col-sm-6\"><textarea ref={(r)=>{this.text=r}} style={{minWidth: \"100%\"}}\r\n      placeholder={this.props.field}\r\n      value={this.state.text}\r\n      rows={this.state.text.split(\"\\n\").length}\r\n      onChange={this.update}\r\n      /></div>\r\n      </div>)\r\n    else if (this.props.field === 'json')\r\n    {\r\n      if (this.state.text.length > 0) return (\r\n        <div className=\"EditField row\">\r\n        <div className=\"col-sm-12\"><textarea ref={(r)=>{this.text=r}} style={{minWidth: \"100%\"}}\r\n        placeholder={this.props.field}\r\n        value={this.state.text}\r\n        rows={this.state.text.split(\"\\n\").length}\r\n        onChange={this.update}\r\n        /></div>\r\n        </div>)\r\n        else return null\r\n    }\r\n    else return (\r\n      <div className=\"EditField row\">\r\n      <div className=\"col-sm-6\"><Maths auto={this.props.auto} edit={true} vars={this.props.vars}>{this.state.text}</Maths></div>\r\n      <div className=\"col-sm-6\"><textarea ref={(r)=>{this.text=r}} style={{minWidth: \"100%\"}}\r\n      placeholder={this.props.field}\r\n      value={this.state.text?this.state.text:''}\r\n      rows={this.state.text?this.state.text.split(\"\\n\").length:1}\r\n      onChange={this.update}\r\n      /></div>\r\n      </div>)\r\n  }\r\n}\r\n\r\nexport {EditQuestion,EditFields,mathsSymbols}\r\n","import React, { Component } from 'react'\r\nimport {Modal,Button} from 'react-bootstrap';\r\nimport {Maths} from './ReactMaths';\r\nimport {ajax} from './ajax'\r\nimport {EditFields} from './EditQuestion'\r\n\r\nclass JsonHelp extends Component {\r\n  state={edit:false}\r\n  componentWillMount()\r\n  {\r\n    ajax('/react_ajax/help',null,{topic:this.props.topic})\r\n  }\r\n  componentWillReceiveProps(nextProps)\r\n  {\r\n    ajax('/react_ajax/help',null,{topic:nextProps.topic})\r\n  }\r\n  render()\r\n  {\r\n    if (this.props.topic === null) return null\r\n    let title=this.props.topic,text='not found',id=0\r\n    if (window.FreeMaths.state.data && window.FreeMaths.state.data.help[this.props.topic]) {\r\n      id=window.FreeMaths.state.data.help[this.props.topic].id\r\n      title=window.FreeMaths.state.data.help[this.props.topic].title\r\n      text=window.FreeMaths.state.data.help[this.props.topic].text\r\n    }\r\n    else {\r\n      //not found\r\n      console.log('help',this.props.topic,window.FreeMaths.state.data.help)\r\n    }\r\n    if (this.state.edit) return <EditHelp id={id} title={title} help={text} close={()=>this.setState({edit:false})}/>\r\n    else return <Help title={title.split(\"__\")[0].replace(/_/g,' ')} help={text} edit={()=>{console.log('click');this.setState({edit:true})}} close={this.props.close}/>\r\n  }\r\n}\r\n\r\n\r\nclass Help extends Component {\r\n  render()\r\n  {\r\n    return(\r\n      <Modal name=\"help\" show={true} onHide={this.props.close}>\r\n      <Modal.Header closeButton>\r\n      <Modal.Title><Maths>{this.props.title}</Maths>{this.props.edit&&window.FreeMaths.state.user&&window.FreeMaths.state.user.isAdmin?<span className='btn-link' onClick={this.props.edit}> <i className=\"fa fa-btn fa-edit\"></i></span>:null}</Modal.Title></Modal.Header>\r\n      <Modal.Body>\r\n      <Maths>{this.props.help}</Maths>\r\n      </Modal.Body>\r\n      </Modal>)\r\n  }\r\n}\r\n\r\nclass EditHelp extends Component {\r\n  state={title:this.props.title,help:this.props.help,id:this.props.id,error:{}}\r\n  save=()=>{\r\n    if (this.state.title!==this.props.title || this.state.help!==this.props.help)\r\n      ajax('/react_ajax/saveHelp',(r)=>{\r\n        if (r.error) this.setState({error:r.data})\r\n        else {\r\n          window.FreeMaths.state.data.help[this.props.title.toLowerCase().replace(/ /g,'_')]=r.data\r\n          this.props.close()\r\n        }\r\n      },{title:this.state.title,text:this.state.help,id:this.state.id})\r\n  }\r\n  update=(field,value)=>{\r\n    if (field==='title') this.setState({title:value})\r\n    else if (field==='help') this.setState({help:value})\r\n  }\r\n  render()\r\n  {\r\n    return(\r\n      <Modal show={true} bsSize=\"large\" onHide={this.props.close}>\r\n      <Modal.Header closeButton>\r\n      {this.state.error.error?<div className=\"alert alert-danger\"><strong>Server Error: {this.state.error.error}</strong></div>:null}\r\n      <Modal.Title><EditFields fields={{title:this.state.title}} update={this.update}/></Modal.Title></Modal.Header>\r\n      <Modal.Body>\r\n      <EditFields fields={{help:this.state.help}} update={this.update}/></Modal.Body>\r\n      <Modal.Footer><Button onClick={this.save}>Save</Button></Modal.Footer>\r\n      </Modal>)\r\n  }\r\n}\r\n\r\n\r\nexport {Help,JsonHelp}\r\n","import React, { Component } from 'react'\r\nimport {maths,parse_expression,maths_keys} from './maths'\r\nimport {JsonHelp} from './Help'\r\nimport {copy} from './Utils'\r\nvar katex = require('katex');\r\n\r\nclass Maths extends Component {\r\n  state={help:''}\r\n  close=()=>{this.setState({help: ''})}\r\n  table=(chunk,k)=>{\r\n    //console.log(\"table\",chunk)\r\n    var i=0,j=0\r\n    var table=chunk.split(\"\\n\").map((row)=>{\r\n      var tds=row.split(',').map((td)=>{\r\n        if (td.startsWith(' ')) return <th style={{textAlign: 'center'}} key={j++}><Maths vars={this.props.vars}>{td.substring(1)}</Maths></th>\r\n        else return <td style={{textAlign: 'center'}} key={j++}><Maths vars={this.props.vars}>{td}</Maths></td>\r\n      })\r\n      return <tr key={i++}>{tds}</tr>\r\n    })\r\n    return <table className=\"table table-condensed table-bordered table-striped\" style={{width: 'auto'}} key={k}><tbody>{table}</tbody></table>\r\n  }\r\n  help=(topic,e)=>{\r\n    //console.log(\"help: \",topic)\r\n    this.setState({help: topic})\r\n    e.currentTarget.blur()\r\n  }\r\n  shouldComponentUpdate(nextProps, nextState)\r\n  {\r\n    return (nextProps.children !== this.props.children || (nextProps.vars !== this.props.vars) || (nextState.help !== this.state.help))\r\n  }\r\n  render() {\r\n    //console.log(\"Maths %s\",this.props.children)\r\n    if (!this.props.children) return null;\r\n    var chunks = maths(this.props.children,this.props.auto?xyz(this.props.children):this.props.vars,this.props.auto);\r\n    //console.log(\"Maths chunks %s\",JSON.stringify(chunks))\r\n    var i=0,prev=''\r\n    var html=chunks.map((chunk)=>{\r\n      if (chunk.chunk === '\\n') {\r\n        if (prev.endsWith('>') || prev.endsWith(' ')) var ret=null\r\n        else ret = <br key={i++}/>\r\n      }\r\n      else if (chunk.type === 'latex') ret= <Latex key={i++}>{chunk.chunk}</Latex>\r\n      else if (chunk.type === 'error') ret= <div key={i++}><span>{chunk.chunk}</span><span className=\"red\"> {chunk.error}</span></div>\r\n      else if (chunk.type === 'maths') ret= <Latex key={i++}>{chunk.chunk}</Latex>\r\n      else if (chunk.type === 'help') ret= <span className=\"btn-link\" key={i++} onClick={(e)=>this.help(chunk.chunk,e)}>{chunk.chunk.split('__')[0]}</span>\r\n      else if (chunk.type === 'table') ret=this.table(chunk.chunk,i++)\r\n      else if (chunk.type === 'png') ret=<img key={i++} alt=\"figure\" src={chunk.chunk} style={{maxWidth:'100%'}}/>\r\n      else ret= <span key={i++}dangerouslySetInnerHTML={ {__html: chunk.chunk}} />\r\n      prev=(chunk.type==='html')?chunk.chunk:''\r\n      return ret\r\n    });\r\n    var help = null;\r\n    if (this.state.help!=='') help = <JsonHelp edit={this.props.edit} topic={this.state.help} close={this.close} />\r\n    return (<div style={{display:'inline'}}>{html}{help}</div>) // overflow: hidden forces mark to have height\r\n  }\r\n  //       {this.state.help!==''?<JsonHelp topic={this.state.help} close={this.close} />:null});\r\n}\r\n\r\nclass Latex extends Component {\r\n  render(){\r\n    //console.log(\"Latex\",this.props.children)\r\n    var html;\r\n    try {html=<span className=\"expression\" dangerouslySetInnerHTML={ {__html: katex.renderToString(this.props.children)} }/>}\r\n    catch (e) {\r\n      html=<div><span>{this.props.children}</span></div>\r\n      console.log(\"Latex\",e.message)\r\n    }\r\n    return html;\r\n  }\r\n}\r\n\r\nfunction xyz(text) {\r\n  const symbols=\"=^/+*-≠≥≤±÷√≡≈…⇒(){}\"\r\n  let xyz={x:'x',y:'y',z:'z',d:'d',u:'u'} // d allows dx dy dz\r\n  text.split(\"\\n\").forEach(l=>{\r\n    l.split(\" \").forEach(w=>{\r\n      // remove functions sin,cos,tan etc\r\n      let testxyz=copy(xyz)\r\n      let test=false\r\n      w.split('').forEach(ch=>\r\n      {\r\n        if (symbols.indexOf(ch) !== -1) test=true\r\n        else if (ch >= \"A\" && ch <= \"z\" && ch!=='f') testxyz[ch]=ch\r\n      })\r\n      if (w.indexOf('f(')===-1 && w.indexOf(\"f'(\")===-1 && w.indexOf('f')>-1) testxyz['f']='f'\r\n      if (test && parse_expression(w,testxyz)) xyz=testxyz\r\n    })\r\n  })\r\n  return {xyz:Object.keys(xyz).join(',')}\r\n}\r\n\r\nfunction mathsSymbols(value,selectionStart)\r\n{\r\n  var l=value.length\r\n  if (value.indexOf('begin')===-1) Object.keys(maths_keys).forEach(c=>{value=value.replace(maths_keys[c],c,value)})\r\n  //value = value.replace('!=','≠',value); now \\= to allow for factorial\r\n  //value = value.replace('=~','≈',value);\r\n  value = value.replace('/dx','/(dx)',value);\r\n  value = value.replace('/du','/(du)',value);\r\n  value = value.replace('/Δx','/(Δx)',value);\r\n  if (selectionStart) var caret = selectionStart+value.length-l\r\n  else caret = null\r\n  //console.log(\"mathsSymbols\",l,value.length,caret)\r\n  return {text:value,caret:caret}\r\n}\r\n\r\nexport {Maths,Latex,xyz,mathsSymbols};\r\n","import React, { Component } from 'react'\r\nimport {Col,Form,FormGroup,FormControl,HelpBlock,ControlLabel,Button,Modal,Checkbox} from 'react-bootstrap';\r\nimport {Maths} from './ReactMaths'\r\nimport {maths_keys} from './maths'\r\n//import {Password} from './Login'\r\nimport {mathsSymbols} from './EditQuestion'\r\nimport {ajax} from './ajax'\r\nimport {isset,TooltipHover,title} from './Utils'\r\n\r\nclass Contact extends Component {\r\n  state={message:this.props.text?this.props.text:'',name:'',email:'',maths:false,error:{},to:'',from:'',sending:false}\r\n  contact=(e)=>{\r\n    e.preventDefault()\r\n    let qkey=this.props.qkey?this.props.qkey:this.props.reply&&this.props.reply.qkey?this.props.reply.qkey:null\r\n    let question=qkey?title(this.props.qkey,window.FreeMaths.state.data,true):null\r\n    this.setState({error:{},sending:true})\r\n    ajax('/react_ajax/contact',(r)=>{\r\n      if (r.error) this.setState({error:r.data,sending:false})\r\n      else this.props.close({type:'success',text:this.props.reply?'Reply sent.':'Message sent. We aim to respond within 24 hours.'})\r\n    },{email:this.state.email,name:this.state.name,maths:this.state.maths,message:this.state.message,from:this.state.from,to:this.state.to,qkey:qkey,question:question})\r\n  }\r\n  componentWillMount()\r\n  {\r\n    if (this.props.reply) this.setState({message:this.props.reply.message,maths:this.props.reply.maths,to:this.props.reply.from,from:this.props.reply.to})\r\n    else if (this.props.uid) {\r\n      let to=this.props.fm.state.students[this.props.uid]\r\n      if (!to) console.error('Contact',this.props.uid,this.props.fm.state)\r\n      this.setState({to:to?to:null})\r\n    }\r\n  }\r\n  render() {\r\n    return (<Modal name='contact' bsSize={this.state.maths?\"lg\":null} show={true} onHide={()=>this.props.close()}>\r\n        <Modal.Header closeButton><Modal.Title>{this.props.reply?'Reply to ':'Contact '}{this.state.to?this.state.to.name:'FreeMaths.uk'}</Modal.Title></Modal.Header>\r\n        <Modal.Body>\r\n        {this.state.sending?<div className=\"alert alert-success\"><strong>Sending ...</strong></div>:null}\r\n        {this.state.error.error?<div className=\"alert alert-danger\"><strong>Server Error: {this.state.error.error}</strong></div>:null}\r\n\r\n        <Form onSubmit={this.contact} horizontal>\r\n        {this.props.fm.state.user||this.props.reply?null:<div>\r\n        <FormGroup controlId=\"name\" validationState={isset(this.state.error['name'])?\"error\":null}>\r\n          <Col componentClass={ControlLabel} sm={2}>Name</Col>\r\n          <Col sm={9}><FormControl type=\"name\" name=\"name\" value={this.state.name} placeholder=\"First Last\" onChange={(e)=>this.setState({name:e.target.value,error:{}})}/></Col>\r\n          {isset(this.state.error['name'])?<Col smOffset={2} sm={9}><HelpBlock>{this.state.error['name']}</HelpBlock></Col>:null}\r\n        </FormGroup>\r\n        <FormGroup controlId=\"email\" validationState={isset(this.state.error['email'])?\"error\":null}>\r\n          <Col componentClass={ControlLabel} sm={2}>Email</Col>\r\n          <Col sm={9}><FormControl type=\"email\" name=\"email\" value={this.state.email} placeholder=\"Email\" onChange={(e)=>this.setState({email:e.target.value,error:{}})}/></Col>\r\n          {isset(this.state.error['email'])?<Col smOffset={2} sm={9}><HelpBlock>{this.state.error['email']}</HelpBlock></Col>:null}\r\n        </FormGroup>\r\n        </div>}\r\n        {this.props.qkey?<FormGroup>\r\n          <Col componentClass={ControlLabel} sm={2}>Question</Col>\r\n          <Col sm={9}>{title(this.props.qkey,this.props.fm.state.data,true)}</Col>\r\n        </FormGroup>:null}\r\n        {this.state.maths?<EditMaths fm={this.props.fm} text={this.state.message} update={(m)=>this.setState({message:m})} close={()=>this.setState({maths:false})}/>:\r\n          <FormGroup controlId=\"message\" validationState={this.state.error.message?\"error\":null}>\r\n          <Col componentClass={ControlLabel} sm={2}>Message</Col>\r\n          <Col sm={9}><textarea placeholder=\"Your message\" value={this.state.message} rows={8} style={{minWidth: \"100%\"}} onChange={(e)=>this.setState({message:e.target.value,error:{}})}/></Col>\r\n          {this.state.error.message?<Col smOffset={2} sm={9}><HelpBlock>{this.state.error.message}</HelpBlock></Col>:null}\r\n          <Col smOffset={2} sm={9}><Checkbox checked={false} onChange={(e)=>this.setState({maths:true})}>include maths?</Checkbox></Col>\r\n          </FormGroup>\r\n        }\r\n        </Form>\r\n        <Modal.Footer>\r\n        <Button bsStyle=\"primary\" onClick={this.contact}><i className=\"fa fa-envelope-o\"></i> {this.props.reply?'Reply':'Contact Us'}</Button>\r\n        </Modal.Footer>\r\n        </Modal.Body></Modal>)\r\n  }\r\n}\r\n\r\nclass EditMaths extends Component {\r\n  state={caret:null,text:this.props.text}\r\n  update=(e)=>\r\n  {\r\n    var m = mathsSymbols(e.target.value,this.text.selectionStart)\r\n    this.setState({text:m.text, caret:m.caret})\r\n    this.props.update(m.text)\r\n  }\r\n  key=(e)=>{\r\n    e.preventDefault()\r\n    this.text.focus()\r\n    let text=this.state.text\r\n    let start=this.text.selectionStart\r\n    let end=this.text.selectionEnd\r\n    if (!start || !end) {\r\n      if (start===0 && end===0) start=end=0\r\n      else if (this.state.caret!==null) start=end=this.state.caret\r\n      else start=end=text.length\r\n    }\r\n    text=text.substr(0,start)+e.target.value+text.substr(end,text.length-end)\r\n    this.setState({text:text, caret:start+1})\r\n    this.props.update(text)\r\n  }\r\n  componentDidUpdate()\r\n  {\r\n    if (this.state.caret !== null) {\r\n      this.text.setSelectionRange(this.state.caret,this.state.caret)\r\n    }\r\n  }\r\n  render() {\r\n    return (<div>\r\n      <div className=\"EditField row\">\r\n      <div className=\"col-sm-6\"><Maths auto={true}>{this.state.text}</Maths>\r\n      </div>\r\n      <div className=\"col-sm-6\"><textarea ref={(r)=>{this.text=r}} style={{minWidth: \"100%\"}}\r\n      placeholder=\"Message\"\r\n      value={this.state.text}\r\n      rows={8}\r\n      onChange={this.update}\r\n      /></div></div>\r\n      <div className=\"row\">\r\n      <div className=\"col-sm-6\"><Checkbox checked={true} onChange={this.props.close}> maths? <span className=\"btn-link\" onClick={(e)=>{e.preventDefault();this.props.fm.setState({help:'typing_maths'})}}>(help)</span></Checkbox></div>\r\n      <div className=\"col-sm-6\">{Object.keys(maths_keys).map(c=>{return <TooltipHover  key={c} tooltip={maths_keys[c]}><Button onClick={this.key} value={c} bsSize=\"small\">{c}</Button></TooltipHover>})}</div>\r\n      </div>\r\n      </div>)\r\n  }\r\n}\r\n\r\nclass Mail extends Component {\r\n  state={message:null,error:{},reply:false}\r\n  componentWillMount()\r\n  {\r\n    ajax('/react_ajax/mail',(r)=>{\r\n      if (r.error) this.fm.setState({message:{type:'danger',text:r.data},modal:null,token:null})\r\n      else {\r\n        console.log('Mail',r.data,r.data.maths===false)\r\n        //r.data.maths=((!r.data.maths||r.data.maths==='false')?false:true) // annoying json string values\r\n        this.setState({message:r.data})\r\n      }\r\n    },{token:this.props.fm.state.token})\r\n  }\r\n  render() {\r\n    if (this.state.message===null) return null\r\n    //console.log(\"Mail\",this.state.message)\r\n    if (this.state.reply) {\r\n      //if (this.props.fm.state.user && this.props.fm.state.user.email===this.state.message.to.email)\r\n        return <Contact fm={this.props.fm} reply={this.state.message} close={(m)=>this.props.close(m)}/>\r\n      //else return <Password to={this.state.message.to} fm={this.props.fm} close={(m)=>this.props.close(m)}/>\r\n    }\r\n    else return (<Modal show={true} onHide={()=>this.props.close()}>\r\n        <Modal.Header closeButton><Modal.Title>Message from {this.state.message.from.name}\r\n        {this.state.message.qkey?<div>{'Question: '+title(this.state.message.qkey,this.props.fm.state.data,true)}</div>:null}\r\n        </Modal.Title></Modal.Header>\r\n        <Modal.Body>\r\n        {this.state.error.error?<div className=\"alert alert-danger\"><strong>Server Error: {this.state.error.error}</strong></div>:null}\r\n        {this.state.message.maths?<Maths auto={true}>{this.state.message.message}</Maths>:<div>{this.state.message.message}</div>}\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n        <Button bsStyle=\"primary\" onClick={()=>this.setState({reply:true})}><i className=\"fa fa-envelope-o\"></i> Reply</Button>\r\n        </Modal.Footer>\r\n        </Modal>)\r\n  }\r\n}\r\n//TODO <EditField field=\"comment\" text={this.state.message} update={(f,value)=>this.setState({message:value})}/>\r\nexport {Contact,Mail,EditMaths}\r\n","import {compare,compare_eval,outTree,parse_expression,parseError} from \"./maths\"\r\nimport {debug} from \"./Utils\"\r\n\r\nfunction evaluateAnswer(answer,vars)\r\n{\r\n  let ret = outTree(parse_expression(ans(answer),vars)) // may need flag to evaluate too\r\n  if (debug('evaluateAnswer=')) console.log(\"evaluateAnswer(answer,vars)=\",answer,vars,ret)\r\n  return ''+ret // convert to string if number\r\n}\r\n\r\nfunction ans(a)\r\n{\r\n  var ret=a\r\n  if (ret.indexOf('[')===0) ret=ret.substring(ret.indexOf(']')+1) // x=\r\n  if (ret.indexOf('#')!==-1) ret=ret.substring(0,ret.indexOf('#')) // d.p. s.f.\r\n  if (ret.indexOf('[')>0) ret=ret.substring(0,ret.indexOf('[')) // units\r\n  return ret\r\n}\r\n\r\nfunction stripEq(a,attempt)\r\n{\r\n  // may be best just to strip anything up to =\r\n  let ret=attempt\r\n  let end=a.indexOf(']')-1\r\n  if (a.indexOf('[')===0 && end>1)\r\n  {\r\n    let eq=a.substring(1,end)\r\n    if (attempt.startsWith(eq)) ret = attempt.substr(end)\r\n    else if (a.indexOf('?') <= end)\r\n    {\r\n      end = a.indexOf('?')-1\r\n      eq=a.substring(1,end)\r\n      if (attempt.startsWith(eq)) ret = attempt.substr(end)\r\n    }\r\n  }\r\n  else if (attempt.startsWith('=') && attempt.length>1) ret = attempt.substr(1)\r\n  if (ret.startsWith('(') && ret.endsWith(')') && ret.substr(1).indexOf('(') === -1) ret = ret.substr(1,attempt.length-2) // coordinates or redundant brackets\r\n  return ret\r\n}\r\n\r\nfunction dpsf(a)\r\n{\r\n  var ret=undefined\r\n  if (a.indexOf('#')!==-1) {\r\n    ret=a.substring(a.indexOf('#')+1)\r\n    if (ret.indexOf('[')!==-1) ret=ret.substring(0,a.indexOf('['))\r\n  }\r\n  return ret\r\n}\r\n\r\nfunction units(a)\r\n{\r\n  var ret=undefined\r\n  if (a.indexOf('[')===0) a=a.substring(a.indexOf(']'))\r\n  if (a.indexOf('[')>0 && a.endsWith(']')) ret=a.substring(a.indexOf('[')+1,a.length-1)\r\n  return ret\r\n}\r\n\r\nfunction checkAnswer(entered,answer,vars)\r\n{\r\n  //TODO - entities need more thought\r\n  let attempt=stripEq(answer,entered) //.replace(/\\s/g,'')) // strip any x= or whitespace from keyboard input\r\n  attempt=attempt.replace(/^(-?)(\\d+)(˽| )(\\d+\\/\\d+)$/,\"$1{$2˽$4}\").replace(/\\s/g,'') // mixed fractions and then remove remaining whitespace\r\n  var ret=false, val_match=false\r\n  var answers = answer.split(\"\\n\")\r\n  var i;\r\n  for (i=0; i<answers.length; i++)\r\n  {\r\n    //TODO $val = html_entity_decode(trim(str_replace(' ','',$this->vars->replace($option))));\r\n    var a=ans(answers[i])\r\n    // eslint-disable-next-line\r\n    if (ret = compare(attempt,a,dpsf(answers[i]),vars)) break\r\n    if (!val_match) val_match=compare_eval(attempt,a,dpsf(answers[i]),vars)\r\n  }\r\n  //console.log(\"checkAnswer\",entered,answer,vars,attempt,ret,val_match)\r\n  if (!ret && val_match)\r\n  {\r\n    if (answers[0].indexOf('#') > 0) return ({attempt:entered, correct: '✓',diff: null})\r\n    else return ({attempt:entered, correct: '?✓',diff: ret?null:mathDiff(attempt,answer,vars)})\r\n  }\r\n  else return ({attempt:entered, correct: ret?'✓':'✗',diff: ret?null:mathDiff(attempt,answer,vars)});\r\n}\r\n\r\nfunction mathDiff(a,answer,vars) // $wrong = 'red'?\r\n{\r\n  // rely on vars already set by mark\r\n  let expected = outTree(parse_expression(ans(answer.split(\"\\n\")[0]),vars))\r\n  if (parseError !== '') expected = ans(answer.split(\"\\n\")[0])\r\n  let markup=''\r\n  let remaining=a\r\n  let tok_a = a.match(/[+-]?[\\d]*([a-z]*(\\^[\\d])?)*/g) // add \".\" to spot decimal errors\r\n  var tok_b = expected.match(/[+-]?[\\d]*([a-z]*(\\^[\\d])?)*/g)\r\n  //echo 'comp_mark('.$a.','.$b.','.print_r($tok_a,true).','.print_r($tok_b,true).')<br />';\r\n  for (var j=0; j<tok_a.length; j++)\r\n  {\r\n    if (tok_a[j].length > 0 && tok_a[j]!=='+' && tok_a[j]!=='-') {\r\n      let chunk = remaining.substr(0,remaining.indexOf(tok_a[j])+tok_a[j].length)\r\n      remaining=remaining.replace(chunk,'')\r\n      for (var k=0; k<tok_b.length && chunk.length > 0; k++)\r\n      {\r\n        if (mod(tok_a[j]) === mod(tok_b[k])) {\r\n          if (sign(tok_a[j]) === sign(tok_b[k])) markup+=chunk.replace(tok_a[j],'<g>'+tok_a[j]+'</g>')\r\n          else markup+=chunk.replace(tok_a[j],'<o>'+tok_a[j]+'</o>')\r\n          chunk=''\r\n          tok_b.splice(k,1)\r\n        }\r\n      }\r\n      markup+=chunk\r\n    }\r\n  }\r\n  markup+=remaining\r\n  //console.log(\"mathDiff\",a,expected,markup)\r\n  return markup\r\n}\r\n\r\nfunction mod(a)\r\n{\r\n  if (a.length > 0 && (a[0]==='+' || a[0]==='-')) return a.substr(1)\r\n  else return a\r\n}\r\n\r\nfunction sign(a)\r\n{\r\n  if (a.length > 0 && a[0]==='-') return '-'\r\n  else return '+'\r\n}\r\n\r\nexport {checkAnswer,evaluateAnswer,units,mathDiff}\r\n","//import ReactDOM from 'react-dom'\r\nimport React, { Component } from 'react'\r\nimport {Button,Form} from 'react-bootstrap'\r\nimport {mathsSymbols} from './ReactMaths'\r\nimport {JsonHelp} from './Help'\r\nimport {TooltipButton,TooltipHover,question} from './Utils'\r\nimport {evaluateAnswer,units} from './mark'\r\nimport {Maths} from './ReactMaths'\r\n\r\nclass Keyboard extends Component {\r\n  state={start:0, keypad:false}\r\n  shouldComponentUpdate(newProps,newState) {\r\n    return newState.keypad!==this.state.keypad || newProps.answer!==this.props.answer || newProps.qid!==this.props.qid || newProps.vars!==this.props.vars\r\n  }\r\n  componentDidUpdate() {\r\n    if (this.calcInput) {\r\n      this.calcInput.setSelectionRange(this.state.start,this.state.start)\r\n      this.calcInput.focus()\r\n    }\r\n  }\r\n  change=(ans,start)=>\r\n  {\r\n    start=start?start:this.calcInput?this.calcInput.selectionStart:0\r\n    let l=ans.length\r\n    //var val = ans.replace(/^(\\d+) (\\d+\\/\\d+)$/,\"$1+/$2\") // mixed fractions via keyboard\r\n    //val = val.replace(/^(-\\d+) (\\d+\\/\\d+)$/,\"$1-$2\")\r\n    start += ans.length-l\r\n    let ret=mathsSymbols(ans,start)\r\n    if (ret.text!==this.props.answer)\r\n    {\r\n      this.props.change(ret.text)\r\n      this.setState({start:ret.caret})\r\n    }\r\n    if (this.calcInput) this.calcInput.focus()\r\n  }\r\n  keyboard=(e)=>\r\n  {\r\n    this.change(e.target.value)\r\n  }\r\n  keypress=(e)=>{\r\n    let start=this.calcInput.selectionStart\r\n    let end=this.calcInput.selectionEnd\r\n    this.change(this.props.answer.substring(0,start)+e+this.props.answer.substring(end),start+e.length)\r\n  }\r\n  render() {\r\n    return this.state.keypad?<KeyPad qid={this.props.qid} vars={this.props.vars} answer={this.props.answer} change={this.change} mark={this.props.mark} close={()=>this.setState({keypad:false,start:this.props.answer.length})} />\r\n    :<Form onSubmit={(e)=>{e.preventDefault();this.props.mark()}} inline>\r\n    <Equals qid={this.props.qid} vars={this.props.vars}/>\r\n    <input ref={(r)=>{this.calcInput=r}} autoFocus className=\"form-control\" inputMode=\"numeric\" type={window.FreeMaths.state.user.isios?'tel':'text'} value={this.props.answer} onChange={this.keyboard}/>\r\n    <Units qid={this.props.qid} vars={this.props.vars}/>\r\n    <KeyboardButton show={()=>this.setState({keypad:true})}/>\r\n    {this.props.answer?<Mark mark={this.props.mark}/>:<KeyboardHelp />}\r\n    <div><Buttons qid={this.props.qid} vars={this.props.vars} onClick={this.keypress}/></div>\r\n    </Form>\r\n  }\r\n}\r\n\r\nclass Buttons extends Component {\r\n  shouldComponentUpdate(newProps) {\r\n    return newProps.qid!==this.props.qid || newProps.vars!==this.props.vars\r\n  }\r\n  buttons=()=>\r\n  {\r\n    let ret=['-'];\r\n    let answer=(evaluateAnswer(question(this.props.qid).answer,this.props.vars));\r\n    ['+','/','(',')','^','√',',','x','y','z','˽'].forEach(c=>{if (answer.indexOf(c)!==-1) ret.push(c)})\r\n    //console.log('buttons',answer,ret,this.props.qid,this.props.vars)\r\n    return ret\r\n  }\r\n  textClass(b) {\r\n    if (['x','y','z'].indexOf(b)!==-1) return 'keyboard-algebra'\r\n    else return 'keyboard-text'\r\n  }\r\n  render() {\r\n    const sym={'-':'–'}\r\n    return this.buttons().map(b=>{return <Button key={b} className=\"keyboard-button\" onClick={()=>this.props.onClick(b)}>\r\n    <span className={this.textClass(b)}>{sym[b]?sym[b]:b}</span>\r\n    </Button>})\r\n  }\r\n}\r\n\r\nclass KeyboardHelp extends Component {\r\n  state={help:false}\r\n  render() {\r\n    if (this.state.help) return <JsonHelp topic=\"keyboard\" close={()=>this.setState({help:false})}/>\r\n    else return <TooltipButton className=\"btn btn-default green\" onClick={()=>this.setState({help:true})} tooltip=\"keyboard help\">?</TooltipButton>\r\n  }\r\n}\r\n\r\nclass KeyboardButton extends Component {\r\n  render() {\r\n    return <TooltipButton className=\"btn btn-default kbd\" onClick={this.props.show} tooltip=\"keyboard\">{\"\\u200B\"}</TooltipButton>\r\n  }\r\n}\r\n\r\nclass Equals extends Component {\r\n  render() {\r\n    const q=window.FreeMaths.state.data.tests.questions[this.props.qid]\r\n    var end,start\r\n    if (q.answer.startsWith('[') && (end=q.answer.indexOf(']'))!==-1)\r\n    {\r\n      var text=q.answer.substring(1,end)\r\n      //eslint-disable-next-line\r\n      if ((start=text.indexOf('{')) > -1 && (end=text.indexOf('}')) > -1 && end>start)\r\n      {\r\n        var hover = text.substring(start+1,end)\r\n        text=text.substring(0,start)\r\n      }\r\n      if (hover) return <TooltipHover tooltip={hover}><Maths vars={this.props.vars}>{text}</Maths></TooltipHover>\r\n      else return <Maths vars={this.props.vars}>{text}</Maths>\r\n    }\r\n    else return <Maths>=</Maths>\r\n  }\r\n}\r\n\r\nclass Units extends Component {\r\n  render() {\r\n    const q=window.FreeMaths.state.data.tests.questions[this.props.qid]\r\n    return units(q.answer)?<Maths vars={this.props.vars}>{units(q.answer)}</Maths>:null\r\n  }\r\n}\r\n\r\nclass KeyPad extends Component {\r\n  keypress=(key)=>{\r\n    //console.log('keypress',key)\r\n    if (key==='{mark}') this.props.mark()\r\n    else if (key==='{clear}') this.props.change('')\r\n    else if (key==='{bs}') this.props.change(this.props.answer.substr(0,this.props.answer.length-1))\r\n    else this.props.change(this.props.answer+key)\r\n  }\r\n  keys() {\r\n    const algebra={x:'x',y:'y',z:'z'}\r\n    let rownum=0\r\n    return [['x','y','z','˽','{clear}'],\r\n    [7,8,9,'+','-'],\r\n    [4,5,6,'*','/'],\r\n    [1,2,3,'^','√'],\r\n    [0,'.','(',',',')'],\r\n    ['<','>','=','{bs}','{mark}']].map(row=>{\r\n      let keys = row.map(keyval=>{\r\n        let display=keyval, button='default'\r\n        let textClass=algebra[keyval]?\"keyboard-algebra\":\"keyboard-text\";\r\n        switch (keyval) {\r\n          case '{bs}': display=<img src=\"/images/backspace.svg\" alt=\"backspace\"/>; break;\r\n          case '{mark}': button=\"success\"; display='✓'; break;\r\n          case '{clear}': display='C'; textClass=\"keyboard-text red\"; break;\r\n          default:\r\n            // already done\r\n        }\r\n        return <Key key={\"key_\"+keyval} onClick={this.keypress} keyval={''+keyval} button={button} textClass={textClass}>{display}</Key>\r\n      })\r\n      return <div key={rownum++}>{keys}</div>\r\n    })\r\n  }\r\n  componentDidMount()\r\n  {\r\n    this.scrollKB.scrollIntoView();\r\n  }\r\n  render() {\r\n    return (<div ref={(r)=>{this.scrollKB=r}} className=\"well keypad\"><button className=\"close\" onClick={this.props.close}>&times;</button>\r\n    <input className=\"form-control\" readOnly value={this.props.answer} onClick={this.props.close}/>\r\n    {this.keys()}\r\n    </div>)\r\n  }\r\n}\r\n\r\nclass Key extends Component {\r\n  state={style:this.props.button}\r\n  hover=()=> {\r\n    if (!window.FreeMaths.state.user.isMobile) this.setState({style:'primary'});\r\n  }\r\n  unhover=()=> {\r\n    if (!window.FreeMaths.state.user.isMobile) this.setState({style:this.props.button});\r\n  }\r\n  click=(e)=>{\r\n    this.props.onClick(this.props.keyval);\r\n  }\r\n  render() {\r\n    return (<Button className=\"keyboard-button\" id={this.props.keyval} onClick={this.click} bsStyle={this.state.style} onMouseEnter={this.hover} onMouseLeave={this.unhover}>\r\n    <span className={this.props.textClass}>{this.props.children}</span></Button>);\r\n    }\r\n}\r\n\r\nclass Mark extends Component {\r\n  render() {\r\n    return <TooltipButton className=\"btn btn-success\" onClick={this.props.mark} tooltip=\"mark\">✓</TooltipButton>\r\n  }\r\n}\r\n\r\n\r\nexport default Keyboard;\r\n","/**\r\n* This file provided by FreeMaths is for non-commercial testing and evaluation\r\n* purposes only. FreeMaths reserves all rights not expressly granted.\r\n*\r\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\r\n* FreeMaths BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN\r\n* ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\r\n* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n*/\r\nimport React, { Component } from 'react'\r\nimport {TooltipButton} from './Utils'\r\nimport {Maths} from './ReactMaths'\r\n\r\nclass EditQuestions extends Component {\r\n  state = {list:false}\r\n  tests(q){\r\n    let ret=null\r\n    if (q.tests) ret=Object.keys(q.tests).map(t=>{return this.props.fm.state.data.tests.tests[t].title+\" Q\"+q.tests[t]})\r\n    return ret\r\n  }\r\n  render() {\r\n    //console.log(\"EditQuestions\",this.props.fm)\r\n    const tests=this.props.fm.state.data.tests\r\n    if (this.state.list) {\r\n      let qs=Object.keys(this.props.tree.topics).map(t=>Object.keys(this.props.tree.topics[t]).map(l=>this.props.tree.topics[t][l].map(qk=>{\r\n        let q=tests.questions[qk]\r\n        return <div key={q.id}><span className='btn-link' onClick={()=>this.props.setQ(q.id,false)}>{q.id}</span> <Maths>{q.topic}</Maths> <span className='btn-link' onClick={()=>this.props.setQ(q.id,true)}>[{q.topics}]</span> {this.tests(q)}</div>\r\n      })))\r\n      let qs2=Object.keys(tests.questions).map(qn=>{\r\n        let q=tests.questions[qn]\r\n        if (!q.topics) return <div key={q.id}><span className='btn-link' onClick={()=>this.props.setQ(q.id,false)}>{q.id}</span> <Maths>{q.topic}</Maths> <span className='btn-link' onClick={()=>this.props.setQ(q.id,true)}>[{q.topics}]</span> {this.tests(q)}</div>\r\n        else return null\r\n      })\r\n      /*let qs=Object.keys(tests.questions).map(qk=>{\r\n        let q=tests.questions[qk]\r\n        return <div key={q.id}><a onClick={()=>this.props.setQ(q.id,false)}>{q.id}</a> <Maths>{q.topic}</Maths> <a onClick={()=>this.props.setQ(q.id,true)}>[{q.topics}]</a> {this.tests(q)}</div>\r\n      })*/\r\n      return (<div>\r\n      <TooltipButton className=\"btn btn-primary\" tooltip=\"Hide Questions\" onClick={()=>this.setState({list:false})}>Hide</TooltipButton>\r\n      {qs}{qs2}</div>)\r\n    }\r\n    else return <button className=\"btn btn-link\" style={{float: 'right'}}><i className=\"fa fa-btn fa-edit\" onClick={()=>this.setState({list:true})}></i></button>\r\n  }\r\n}\r\nexport default EditQuestions;\r\n","import {isset,title,test} from './Utils'\r\n\r\nfunction sum(a,b)\r\n{\r\n  if (a==='' && b==='') return ''\r\n  else return (a===''?0:a*1)+(b===''?0:b*1)\r\n}\r\n\r\nfunction sum_ts(key,stats)\r\n{\r\n  let ret={'✗':[],':(':[],'?✓':[],':|':[],'✓':[],':)':[],mk:'',mks:0,qs:0,ts:0,effort:0,r:[]}\r\n  Object.keys(stats.t.ts).filter(k=>{return k.startsWith(key)}).forEach(pk=>{\r\n    let s=stats.t.ts[pk];\r\n    [':(',':|',':)','✗','?✓','✓'].forEach(x=>ret[x].push.apply(ret[x],s[x]))\r\n    ret.r.push.apply(ret.r,s.r)\r\n    ret.mks+=s.mks\r\n    ret.mk=sum(ret.mk,s.mk)\r\n    ret.qs+=s.qs\r\n    if (s.ts>ret.ts) ret.ts=s.ts\r\n  })\r\n  return ret\r\n}\r\n\r\nfunction p(pkey)\r\n{\r\n  return pkey.split(':')[0]\r\n}\r\n\r\nfunction calc_totals(stats,uid,key,type,fm)\r\n{\r\n  // need to update for books\r\n  stats.t={qs:{},ts:{},uids:{},corrections:{}} // reset\r\n  Object.keys(stats.ts).filter(pkey=>{return !isset(type) || test(pkey).type===type}).forEach(pkey=>{\r\n    if (key === null || key==='0' || key===pkey.substr(0,key.length) || title(pkey,stats).startsWith(key))\r\n    {\r\n      Object.keys(stats.ts[pkey].qs).forEach((qkey)=>{\r\n        Object.keys(stats.ts[pkey].qs[qkey].l).forEach((u)=>{\r\n          if (u===uid || uid===null) {\r\n            let q=stats.ts[pkey].qs[qkey]\r\n            update_t(stats.t.qs,q,qkey,qkey,u,uid)\r\n            update_t(stats.t.ts,q,pkey,qkey,u)\r\n            update_t(stats.t.uids,q,u,qkey,u)\r\n            add_c(stats.t.uids,q,u,u)\r\n            add_c(stats.t.ts,q,u,pkey)\r\n            add_c(stats.t.qs,q,u,qkey)\r\n          }\r\n        })\r\n      })\r\n      Object.keys(stats.ts[pkey].l).forEach((u)=>{\r\n        if (u===uid || uid===null) {\r\n          //console.log(\"calc_totals\",paper,pkey,p,u)\r\n          let l=stats.ts[pkey].l[u]\r\n          if (!isset(stats.t.uids[u].r)) stats.t.uids[u].r=[]\r\n          stats.t.uids[u].r.push({uid:u,key:pkey,mk:l.mk,mks:l.mks,ts:l.ts})\r\n          if (!isset(stats.t.ts[pkey].r)) stats.t.ts[pkey].r=[]\r\n          if (uid===null) stats.t.ts[pkey].r.push({uid:u,key:pkey,mk:l.mk,mks:l.mks,ts:l.ts})\r\n          else stats.ts[pkey].rs[uid].forEach((r)=>{if (r.ts>0) stats.t.ts[pkey].r.push({uid:u,key:pkey,mk:r.mk,mks:r.mks,ts:r.ts})})\r\n        }\r\n      })\r\n    }\r\n  })\r\n  stats.uid=(Object.keys(stats.t.uids).length===1)?Object.keys(stats.t.uids)[0]:'0'\r\n  Object.keys(stats.t.uids).forEach(u=>['✗','?✓',':(',':|'].forEach(e=>{\r\n    stats.t.uids[u][e].forEach(s=>{\r\n      if (!isset(stats.t.corrections[s.key])) stats.t.corrections[s.key]=s\r\n    })\r\n  }))\r\n  if (Object.keys(stats.t.corrections).length===0) stats.t.corrections=null\r\n  //console.log(\"calc_totals\",stats,uid,key,type)\r\n  return stats\r\n}\r\n\r\nfunction add_c(s,q,u,key)\r\n{\r\n  if (!isset(s[key].c)) s[key].c=[]\r\n  s[key].c.push.apply(s[key].c,q.c[u])\r\n}\r\n\r\nfunction update_t(s,q,key,qkey,u,uid)\r\n{\r\n  if (!isset(s[key])) s[key]={'✗':[],':(':[],'?✓':[],':|':[],'✓':[],':)':[],mk:'',mks:0,qs:0,ts:0,effort:0,r:[]}\r\n  if (key===qkey) { // uid test alone is enough but for clarity\r\n    [':(',':|',':)','✗','?✓','✓'].forEach(x=>{if (isset(q[x][u])) q[x][u].forEach(r=>s[key][x].push({uid:u,key:qkey,ts:r.ts,a:r.a,v:r.v,l:x===q.l[u].m||x===q.l[u].f}))})\r\n    if (u===uid) {\r\n      q.rs[u].forEach(r=>s[key].r.push({uid:u,key:qkey,mk:r.mk,mks:q.mks,ts:r.ts}))\r\n    }\r\n    else s[key].r.push({uid:u,key:qkey,mk:q.l[u].mk,mks:q.mks,ts:q.l[u].ts})\r\n  }\r\n  else {\r\n    if (q.l[u].m !== '') {\r\n      let sm=q[q.l[u].m][u][q[q.l[u].m][u].length-1]\r\n      s[key][q.l[u].m].push({uid:u,key:qkey,ts:sm.ts,a:sm.a,v:sm.v})\r\n    }\r\n    if (q.l[u].f !== '') {\r\n      let sf=q[q.l[u].f][u][q[q.l[u].f][u].length-1]\r\n      s[key][q.l[u].f].push({uid:u,key:qkey,ts:sf.ts,a:sf.a,v:sf.v})\r\n    }\r\n  }\r\n  if (q.l[u].mk !== '') s[key].mks+=q.mks\r\n  s[key].mk=sum(s[key].mk,q.l[u].mk)\r\n  s[key].qs++\r\n  if (q.l[u].ts>s[key].ts) s[key].ts=q.l[u].ts\r\n  s[key].uid=u\r\n}\r\n\r\nfunction update_l(s,q,qkey,u)\r\n{\r\n  if (!isset(s.l[u])) s.l[u]={'✗':[],':(':[],'?✓':[],':|':[],'✓':[],':)':[],mk:'',mks:0,qs:0,ts:0,effort:0}\r\n  if (q.l[u].m !== '') s.l[u][q.l[u].m].push({key:qkey,ts:q[q.l[u].m][u][q[q.l[u].m][u].length-1].ts})\r\n  if (q.l[u].f !== '') s.l[u][q.l[u].f].push({key:qkey,ts:q[q.l[u].f][u][q[q.l[u].f][u].length-1].ts})\r\n  if (q.l[u].mk !== '') s.l[u].mks+=q.mks\r\n  s.l[u].mk=sum(s.l[u].mk,q.l[u].mk)\r\n  if (q.l[u].ts>s.l[u].ts) s.l[u].ts=q.l[u].ts\r\n  s.l[u].qs++\r\n}\r\n\r\nfunction calc_latest(stats)\r\n{\r\n  Object.keys(stats.uids).forEach(u=>stats.uids[u].l={})\r\n  Object.keys(stats.ts).forEach((pkey)=>{\r\n    stats.ts[pkey].l={}\r\n    Object.keys(stats.ts[pkey].qs).forEach((qkey)=>{\r\n      Object.keys(stats.ts[pkey].qs[qkey].l).forEach((uid)=>{\r\n        let q=stats.ts[pkey].qs[qkey]\r\n        update_l(stats.ts[pkey],q,qkey,uid)\r\n        update_l(stats.uids[uid],q,qkey,uid)\r\n      })\r\n    })\r\n  })\r\n  //console.log(\"calc_latest\",stats)\r\n}\r\n\r\nfunction analyse_r(stats,s)\r\n{\r\n  if (!isset(stats.ts[s.paper])) stats.ts[s.paper]={rs:{},qs:{},l:{},c:{}}\r\n  if (!isset(stats.uids[s.user_id])) stats.uids[s.user_id]={p:0,l:{}}\r\n  let v=JSON.parse(s.variables)\r\n  let r={'':[],'✗':[],':(':[],'?✓':[],':|':[],'✓':[],':)':[],mk:'',mks:0,qs:0,ts:s.ts,effort:v.effort}\r\n  v.marks.forEach((m)=>{\r\n    if (isset(m))\r\n    {\r\n      let qkey=s.paper.indexOf(':')>0?s.paper+\":\"+m.q:s.paper+\":::\"+m.q\r\n      if (!isset(stats.ts[s.paper].qs[qkey])) stats.ts[s.paper].qs[qkey]={mks:m.mks*1,l:{},xl:{},c:{},rs:{},'':{},'✗':{},':(':{},'?✓':{},':|':{},'✓':{},':)':{}}\r\n      let q=stats.ts[s.paper].qs[qkey]\r\n      if (!isset(q.l[s.user_id])) {q.l[s.user_id]={m:'',f:'',ts:0,mk:0}; q.rs[s.user_id]=[];}\r\n      q.l[s.user_id].ts=s.ts\r\n      q.l[s.user_id].mk=m.mk\r\n      q.rs[s.user_id].push({ts:s.ts,mk:m.mk})\r\n      if (m.mk !== '') r.mks+=m.mks*1 // strictly could be done just once\r\n      r.mk=sum(r.mk,m.mk) // strictly could be done just once\r\n      r.qs++\r\n      q.l[s.user_id].f=m.f\r\n      if (!isset(q[m.f][s.user_id])) q[m.f][s.user_id]=[]\r\n      q[m.f][s.user_id].push({ts:s.ts})\r\n      r[m.f].push({key:qkey,ts:s.ts})\r\n      q.l[s.user_id].m=m.m\r\n      if (!isset(q[m.m][s.user_id])) q[m.m][s.user_id]=[]\r\n      q[m.m][s.user_id].push({ts:s.ts,a:s.answer})\r\n      r[m.m].push({key:qkey,ts:s.ts})\r\n      if (isset(m.c) && m.c.length > 0) {\r\n        if (!isset(q.c[s.user_id])) q.c[s.user_id]=[]\r\n        q.c[s.user_id].push({key:qkey,uid:s.user_id,c:m.c,f:m.f,ts:s.ts})\r\n        //console.log(\"analyse_r\",qkey,m.c)\r\n      }\r\n    }\r\n  })\r\n  if (!isset(stats.ts[s.paper].rs[s.user_id])) stats.ts[s.paper].rs[s.user_id]=[]\r\n  stats.ts[s.paper].rs[s.user_id].push(r)\r\n}\r\n\r\nfunction var_event(stats,s,fm)\r\n{\r\n  const test=s.paper==='0'?{qs:[{id:s.q}]}:fm.state.data.tests.tests[s.paper]\r\n  if (s.paper !== 0) { // not for dummy event\r\n    if (!isset(stats.ts[s.paper])) stats.ts[s.paper]={rs:{},qs:{},l:{},c:{}}\r\n    if (!isset(stats.uids[s.user_id])) stats.uids[s.user_id]={p:s.paper,ts1:s.ts,ts:s.ts,l:{},c:{}}\r\n    else if (stats.uids[s.user_id].p === 0) {stats.uids[s.user_id].p=s.paper; stats.uids[s.user_id].ts=stats.uids[s.user_id].ts1=s.ts}\r\n  }\r\n  let u=stats.uids[s.user_id]\r\n  if (isset(u) && (s.ts-u.ts > 60*60*1000 || s.paper !== u.p))\r\n  {\r\n    let r={'✗':[],':(':[],'?✓':[],':|':[],'✓':[],':)':[],mk:'',mks:0,qs:0,ts:0,effort:0}\r\n    Object.keys(test.qs).forEach((_q)=>{\r\n      //console.log('var_event',s,test)\r\n      let qkey=u.p+':::'+_q.id\r\n      let q=stats.ts[u.p].qs[qkey]\r\n      if (isset(q) && isset(q.xl[s.user_id])) {\r\n        if (r.ts===0) {r.ts=q.xl[s.user_id].ts; r.effort=q.xl[s.user_id].ts-u.ts1}\r\n        if (q.xl[s.user_id].m !== '') r[q.xl[s.user_id].m].push({key:qkey,ts:q[q.xl[s.user_id].m].ts})\r\n        if (q.xl[s.user_id].f !== '') r[q.xl[s.user_id].f].push({key:qkey,ts:q[q.xl[s.user_id].f].ts})\r\n        r.mks++;\r\n        r.qs++;\r\n        r.mk=sum(r.mk,q.xl[s.user_id].mk)\r\n        q.xl[s.user_id]=null\r\n      }\r\n     })\r\n     if (!isset(stats.ts[u.p].rs[s.user_id])) stats.ts[u.p].rs[s.user_id]=[]\r\n     if (u.p !== 0) stats.ts[u.p].rs[s.user_id].push(r)\r\n     stats.uids[s.user_id].p=s.paper\r\n     stats.uids[s.user_id].ts=stats.uids[s.user_id].ts1=s.ts\r\n   }\r\n   if (s.paper !== 0 && (s.event === \"✓\" || s.event === \"✗\" || s.event === \"?✓\" || s.event === \":(\" || s.event === \":|\" || s.event === \":)\")) // console.log(\"correct\",s)\r\n   {\r\n     let qkey=s.paper+':::'+s.q\r\n     if (!isset(stats.ts[s.paper].qs[qkey])) stats.ts[s.paper].qs[qkey]={mks:1,l:{},xl:{},c:{},rs:{},'✗':{},':(':{},'?✓':{},':|':{},'✓':{},':)':{}}\r\n     let q=stats.ts[s.paper].qs[qkey]\r\n     if (!isset(q.l[s.user_id])) {q.l[s.user_id]={m:'',f:'',ts:s.ts,mk:0}; q.rs[s.user_id]=[]}\r\n     if (!isset(q.xl[s.user_id])) q.xl[s.user_id]={m:'',f:'',ts:s.ts,mk:0}\r\n     if (!isset(q[s.event][s.user_id])) q[s.event][s.user_id]=[]\r\n     if (s.event === \"✓\" || s.event === \"✗\" || s.event === \"?✓\") {\r\n       q.l[s.user_id].m=q.xl[s.user_id].m=s.event\r\n       q[s.event][s.user_id].push({ts:s.ts,a:s.answer,v:s.variables})\r\n       if (s.event === \"✓\") q.l[s.user_id].mk=q.xl[s.user_id].mk=1\r\n       else q.l[s.user_id].mk=q.xl[s.user_id].mk=0\r\n       q.rs[s.user_id].push({ts:s.ts,mk:q.xl[s.user_id].mk})\r\n     }\r\n     else if (s.event === \":(\" || s.event === \":|\" || s.event === \":)\") {\r\n       q.l[s.user_id].f=q.xl[s.user_id].f=s.event\r\n       q[s.event][s.user_id].push({ts:s.ts})\r\n       if (s.comment.length > 0) {\r\n         if (!isset(q.c[s.user_id])) q.c[s.user_id]=[]\r\n         q.c[s.user_id].push({key:qkey,uid:s.user_id,c:s.comment,f:s.event,ts:s.ts})\r\n       }\r\n     }\r\n     q.l[s.user_id].ts=q.xl[s.user_id].ts=stats.uids[s.user_id].ts=s.ts\r\n   }\r\n}\r\n\r\nfunction calcStats(fm,stats,students)\r\n{\r\n   // user may be students\r\n   let log=students?fm.state.log:fm.state.user.log\r\n   if (!log) return null // guard for faulty server\r\n   if (!stats)\r\n   {\r\n     stats={users:{},log:log,uids:{},ts:{}}\r\n   }\r\n   else if (log.length === 0 || stats.last === log[log.length-1].id) {\r\n     //console.log(\"calcStats\",stats.last)\r\n     return stats;\r\n   }\r\n   if (students) Object.keys(fm.state.students).forEach(id=>{if (!stats.users[id]) stats.users[id]={name:fm.state.students[id].name,log:[]}})\r\n   else if (!stats.users[fm.state.user.id]) stats.users[fm.state.user.id]={log:[]}\r\n   log.forEach(s=>\r\n   {\r\n     if (s.user_id*1===0) return // logging of anon\r\n     if (stats.last && s.id <= stats.last && stats.users[s.user_id].log.length > 0) return // skip unless new\r\n     s.ts = new Date(s['created_at'].replace(' ', 'T')).getTime()\r\n     let p=s.paper?s.paper.split(':')[0]:'0' // hack for now\r\n     if (s.paper==='0'||fm.state.data.tests.tests[p])\r\n     {\r\n       s.q=s.question\r\n       var_event(stats,s,fm)\r\n     }\r\n     else if (s.event === '✓✗') analyse_r(stats,s,fm)\r\n     // else need to handle s.paper === '0'\r\n     stats.users[s.user_id].log.unshift(s)\r\n     stats.last=s.id\r\n   })\r\n   Object.keys(stats.uids).forEach((uid)=>{if (stats.uids[uid].p !== 0) var_event(stats,{user_id:uid,event:\"\",paper:'0'},stats.uids[uid].ts)},fm) // dummy final event\r\n   calc_latest(stats)\r\n   //console.log(\"calcStats\",stats)\r\n   // if (!isset(stats.log)) stats.log=user.log\r\n   //else stats.log.push.apply(stats.log,log) - no longer needed?\r\n   return stats\r\n}\r\n\r\nfunction totalSort(y,x,byDate){ // switched x,y to reverse sort\r\n  if (byDate) return x.ts-y.ts\r\n  else if (x[':('].length-y[':('].length !== 0) return x[':('].length-y[':('].length\r\n  else if (x[':|'].length-y[':|'].length !== 0) return x[':|'].length-y[':|'].length\r\n  else if (x['✗'].length-y['✗'].length !== 0) return x['✗'].length-y['✗'].length\r\n  else if (x['?✓'].length-y['?✓'].length !== 0) return x['?✓'].length-y['?✓'].length\r\n  else return x.mks-y.mks-(x.mk-y.mk) //x.r.length\r\n}\r\n\r\nfunction val(x)\r\n{\r\n  return (x.length !== 0 && (!isset(x[0].l)||x[0].l))?x.length:0\r\n}\r\n\r\nfunction totalSortQ(xk,yk,s,byQ) {\r\n  if (byQ) return xk.localeCompare(yk, undefined, {numeric: true})\r\n  // else switched x,y to reverse sort\r\n  let x=s[yk]\r\n  let y=s[xk]\r\n  if (val(x[':('])-val(y[':(']) !== 0) return val(x[':('])-val(y[':('])\r\n  else if (val(x[':|'])-val(y[':|']) !== 0) return val(x[':|'])-val(y[':|'])\r\n  else if (val(x['✗'])-val(y['✗']) !== 0) return val(x['✗'])-val(y['✗'])\r\n  else if (val(x['?✓'])-val(y['?✓']) !== 0) return val(x['?✓'])-val(y['?✓'])\r\n  else return x.mks-y.mks-(x.mk-y.mk) //x.r.length\r\n}\r\n\r\n//TODO refactor the code below and move to ReactTest\r\n\r\nfunction paper_stats(s)\r\n{\r\n  var qs=[],stat\r\n  var t =0, ts = 0, q=-1\r\n  if (typeof s !== 'undefined') s.forEach((el)=>{\r\n    if (el.q === q) t+=el.ts-ts\r\n    else t=0\r\n    q=el.q\r\n    ts=el.ts\r\n    if (typeof qs[el.q] !== 'undefined') stat = qs[el.q];\r\n    else stat = {f:'',m:'',':)':[],':|':[],':(':[],'✓':[],'?✓':[],'✗':[],Hint:'',Show:''}\r\n    if (el.event === ':)' || el.event === ':|' || el.event === ':(') {\r\n      stat.f = el.event\r\n      stat[el.event].push({id:0,comment:el.comment})\r\n    }\r\n    else if (el.event === '✓' || el.event === '?✓' || el.event === '✗')\r\n    {\r\n      if (typeof el.vars !== 'undefined') stat.vars = JSON.parse(JSON.stringify(el.vars)) // q match latest answer\r\n      stat.m = el.event\r\n      stat[el.event].push(el.answer)\r\n    }\r\n    else if (el.event === 'Hint' || el.event === 'Show')\r\n    {\r\n      stat[el.event]++\r\n    }\r\n    if (typeof el.vars !== 'undefined' && typeof stat.vars === 'undefined') stat.vars = JSON.parse(JSON.stringify(el.vars))\r\n    stat.t=t\r\n    qs[el.q]=stat\r\n  })\r\n  return qs\r\n}\r\n\r\nexport {paper_stats,calcStats,calc_totals,totalSort,totalSortQ,sum_ts,p}\r\n","import React,{Component} from 'react';\r\nimport {Past} from './PastPaper'\r\nimport {Books} from './Books'\r\n\r\nclass Tests extends Component {\r\n  render() {\r\n    //console.log('Tests',this.props.type,this.props.topic,this.props.stats,this.props.update)\r\n    if (this.props.type==='book') return <Books stats={this.props.stats} set={this.props.setTopic} pkey={this.props.pkey}/>\r\n    else return (\r\n      <div><h3 className=\"inline\">Subject: </h3> <PaperSelect type={this.props.type} topic={this.props.topic} setTopic={this.props.setTopic}/>\r\n      {!this.props.topic||this.props.topic==='0'?null:<Past type={this.props.type} topic={this.props.topic} stats={this.props.stats} update={this.props.update}/>}</div>\r\n    )\r\n  }\r\n}\r\n\r\nclass PaperSelect extends Component {\r\n  render() {\r\n      let options=[<option key={0} value=\"0\">select</option>]\r\n      let subjects=['GCSE(9-1)','IGCSE','P1','SM1','C1','C2','C3','C4','FP1','FP2','FP3','D1','D2','S1','S2','S3','S4','M1','M2','M3','M4','M5',]\r\n      subjects.forEach((s)=>{options.push(<option key={s}>{s}</option>)})\r\n      return(<form className=\"form-horizontal inline\"><select className=\"form-control inline\" style={{width: \"auto\"}} value={this.props.topic} onChange={(e)=>this.props.setTopic(e.target.value)}>{options}</select></form>)\r\n  }\r\n}\r\n\r\nexport default Tests\r\n","import React, { Component } from 'react'\r\n//import {ajax} from './ajax'\r\nimport {isset,empty,TooltipHover,TooltipButton,title,values,test} from './Utils'\r\nimport {PastMark,qp} from './PastPaper'\r\nimport Tests from './Tests'\r\nimport {Maths} from './ReactMaths'\r\nimport {AskTutor} from './StatsUI'\r\nimport {calcStats,calc_totals,totalSort,totalSortQ} from './Stats'\r\nimport {QuestionAttempts,THs,TDs,tipN,Comments} from './StatsUI'\r\n\r\nclass Students extends Component\r\n{\r\n  state={uid:null, pkey:null, topic:\"0\", students:null, stats: null, test: null, edit:false, s:null, q:null, cs:null, log:null, all:false}\r\n  componentWillReceiveProps(p)\r\n  {\r\n    //console.log(\"componentWillReceiveProps\",p)\r\n    if (p.students && !p.fm.state.students) p.fm.getStudents(false)\r\n    else if (p.students) this.setState({students:calcStats(p.fm,null,p.students)}) // need to make incremental\r\n    else this.setState({stats:calcStats(p.fm,null,p.students)}) // need to make incremental\r\n    if (p.type!==this.props.type) this.setState({pkey:null,topic:'0'})\r\n  }\r\n  toggleAll=()=>{\r\n    this.props.fm.getStudents(!this.state.all)\r\n    this.setState({all:!this.state.all})\r\n  }\r\n  setTest=(t,edit)=>{\r\n    this.setState({test:t.toString(),edit:edit})\r\n  }\r\n  setPaper=(key)=>\r\n  {\r\n    let [p,ch,e,q]=key.split(\":\")\r\n    if (isset(q)) key=e!==''?(p+':'+ch+':'+e):p\r\n    let t=test(p)\r\n    if (isset(t) && key === this.state.pkey)\r\n    {\r\n        if (this.props.students) this.setState({pkey:null,test:null}) // reset to all\r\n        else this.setState({test:key})\r\n    }\r\n    else {\r\n      this.setState({pkey:key,topic:\"0\"})\r\n    }\r\n  }\r\n  setQ=(qkey)=>\r\n  {\r\n    this.setState({test:qkey})\r\n  }\r\n  setS=(s,comment)=>\r\n  {\r\n    if (comment) this.setState({cs:s})\r\n    else if (this.state.s !== null) this.setState({s:null}) // toggle\r\n    else if (!empty(s)) this.setState({s:s})\r\n  }\r\n  componentWillMount() {\r\n    //console.log(\"componentWillMount\",this.props)\r\n    if (this.props.students && !this.props.fm.state.students) this.props.fm.getStudents(false)\r\n    else if (this.props.students) this.setState({students:calcStats(this.props.fm,null,this.props.students)})\r\n    else this.setState({stats:calcStats(this.props.fm,null,this.props.students)})\r\n  }\r\n  render() {\r\n    let marking = null\r\n    //console.log(\"Students\",this.props)\r\n    let stats=this.props.students?this.state.students:this.state.stats\r\n    if (!stats) return <div className=\"blue\">loading...</div>\r\n    if (this.state.test!==null)\r\n    {\r\n      let t=test(this.state.test)\r\n      if (t.type==='past' || t.type==='book') marking=<PastMark user={this.props.user} stats={stats} test={this.state.test} close={()=>this.setState({pkey:null,test: null})}/>\r\n      else if (t.type==='vars') console.error(\"Students type vars\")\r\n    }\r\n    stats=calc_totals(stats,this.props.students?this.state.uid:this.props.fm.state.user.id.toString(),this.state.pkey,this.props.type)\r\n    return (<div>{this.props.fm.state.user.isAdmin&&this.props.students?<button className='btn btn-link' style={{float: 'right'}}><i className=\"fa fa-btn fa-users\" onClick={this.toggleAll}></i></button>:null}\r\n    {stats.t.corrections?<TooltipButton className=\"btn btn-danger\" tooltip=\"Correct first\" onClick={()=>this.setS(values(stats.t.corrections))}>Corrections</TooltipButton>:null}\r\n    {stats.students?null:<Tests type={this.props.type} topic={this.state.topic} pkey={this.state.pkey} setTest={this.setTest} setTopic={(t)=>this.setState({pkey:t,topic:t?t:\"0\"})} stats={stats}/>}\r\n      <StudentSummary fm={this.props.fm} students={this.props.students} stats={stats} uid={this.state.uid} p={this.state.pkey} setUid={(uid)=>this.setState({uid:uid===this.state.uid?null:uid})} setS={this.setS}/>\r\n      <TestAnalysis type={this.props.type} students={this.props.students} stats={stats} uid={this.state.uid} p={this.state.pkey} setPaper={this.setPaper} setS={this.setS}/>\r\n      <QuestionAnalysis type={this.props.type} students={this.props.students} setQ={this.setQ} stats={stats} uid={this.state.uid} p={this.state.pkey} setPaper={this.setPaper} setS={this.setS}/>\r\n      <QuestionAttempts s={this.state.s} stats={stats} setS={this.setS}/>\r\n      <Comments cs={this.state.cs} stats={stats} setS={this.setS}/>\r\n    {marking}\r\n      </div>)\r\n  }\r\n}\r\n\r\nclass StudentSummary extends Component {\r\n  state={byDate:true}\r\n  render()\r\n  {\r\n    var rows=[]\r\n    Object.keys(this.props.stats.t.uids).sort((x,y)=>{return totalSort(this.props.stats.t.uids[x],this.props.stats.t.uids[y],this.state.byDate)}).forEach((uid)=>{\r\n      let tds=TDs(this.props.stats.t.uids[uid],this.props.stats,true,this.props.setS)\r\n      if (this.props.students) tds.unshift(<td key=\"name\"><span className=\"btn-link\" onClick={()=>this.props.setUid(uid)}>{this.props.stats.users[uid].name}</span></td>) // only summary\r\n      rows.push(<tr key={uid}>{tds}</tr>)\r\n    })\r\n    if (rows.length === 0) rows=<tr><td colSpan={this.props.students?9:8} className='blue' style={{textAlign: 'center'}}>No student activity to show yet.</td></tr>\r\n\r\n    return (<div><h3>Summary</h3>\r\n    <table className=\"table table-bordered table-condensed table-striped width-auto\">\r\n    <thead><tr>\r\n    {this.props.students?<th style={{textAlign:'center'}}><StudentSelect fm={this.props.fm} uid={this.props.uid}/></th>:null}\r\n    {THs()}<th>marks</th><th  onClick={()=>this.setState({byDate:!this.state.byDate})}><i className=\"fa fa-file-o\" aria-hidden=\"true\"></i></th>\r\n    <th><i className=\"fa fa-comments\" aria-hidden=\"true\"></i></th>\r\n    </tr></thead><tbody>{rows}</tbody>\r\n    </table></div>)\r\n  }\r\n}\r\n\r\nclass TestAnalysis extends Component {\r\n  state={byDate:true}\r\n  render() {\r\n    let rows=[]\r\n    let ts=Object.keys(this.props.stats.t.ts).sort((x,y)=>{return totalSort(this.props.stats.t.ts[x],this.props.stats.t.ts[y],this.state.byDate)})\r\n    //console.log(\"TestAnalysis\",ts,this.props.stats)\r\n    ts.forEach((tid)=>\r\n    {\r\n      let t=test(tid)\r\n      let tds=TDs(this.props.stats.t.ts[tid],this.props.stats,!this.props.students,this.props.setS)\r\n      rows.push(<tr key={tid}><td><span className=\"btn-link\" onClick={this.props.setPaper.bind(this,tid)}>{title(tid,this.props.stats,false,false,true)}</span> {qp(t)}</td>{tds}</tr>)\r\n    })\r\n    return (<div><h3>{this.props.type === \"past\"?\"Past Paper\":this.props.type === \"book\"?\"Exercise\":\"Test\"} Analysis</h3>\r\n    <table className=\"table table-bordered table-condensed table-striped width-auto\">\r\n    <thead><tr><th><PaperSelect type={this.props.type} p={this.props.p} stats={this.props.stats} setPaper={this.props.setPaper}/></th>\r\n    {THs()}<th>marks</th>\r\n  {this.props.stats.uid===\"0\"?<th><span className=\"btn-link\" onClick={()=>this.setState({byDate:!this.state.byDate})}><i className=\"fa fa-user\" aria-hidden=\"true\"></i><span className=\"sr-only\">user</span></span></th>:<th><span className=\"btn-link\" onClick={()=>this.setState({byDate:!this.state.byDate})}><i className=\"fa fa-calendar-o\" aria-hidden=\"true\"></i><span className=\"sr-only\">date</span></span></th>}\r\n    <th><i className=\"fa fa-comments\" aria-hidden=\"true\"></i><span className=\"sr-only\">comments</span></th>\r\n    </tr></thead>\r\n    <tbody>{rows}</tbody>\r\n    </table></div>)\r\n  }\r\n}\r\n\r\nfunction findQ(qkey,stats)\r\n{\r\n  //console.log('findQ',qkey,stats)\r\n  let [p,ch,e,q]=qkey.split(':')\r\n  if (p==='0') return {q:q}\r\n  let t=test(p)\r\n  let ret={q:qkey}\r\n  if (e) ret=(t.qmap.qs && t.qmap.qs[ch] && t.qmap.qs[ch][e] && t.qmap.q[ch][e][q])?t.qmap.qs[ch][e][t.qmap.q[ch][e][q]]:{q:qkey}\r\n  else if (t.qs[q]) ret=t.qs[q]\r\n  if (ret.q) ret.q=q\r\n  return ret\r\n}\r\n\r\nclass QuestionAnalysis extends Component {\r\n  state={qSort:false,detail:null}\r\n  qn(t,q,qkey){\r\n    if (t.type==='vars') {\r\n      var n=<span className=\"btn-link\" onClick={()=>this.props.setQ(qkey)}>{q?q.q:qkey}</span>\r\n      if (isset(t.test)) n=<TooltipHover tooltip={<Maths>{q.topic.split(\",\")[0]}</Maths>}>{n}</TooltipHover>\r\n    }\r\n    else n=q?qp(t,q,q.q):qkey\r\n    return n\r\n  }\r\n  render() {\r\n    var i=0,rows=[];\r\n    //console.log(\"QuestionAnalysis\",this.props.stats)\r\n    Object.keys(this.props.stats.t.qs).sort((x,y)=>{return totalSortQ(x,y,this.props.stats.t.qs,this.state.qSort)}).splice(0,50).forEach((qkey)=>{\r\n      var p=qkey.split(':')[0]\r\n      let s=this.props.stats.t.qs[qkey]\r\n      let t=test(p)\r\n      let q=findQ(qkey,this.props.stats)\r\n      rows.push(<tr key={qkey}>\r\n        <td><span className=\"btn-link\" onClick={this.props.setPaper.bind(this,qkey)}>{title(qkey,this.props.stats,false,false,true)}</span></td>\r\n          <td>{this.qn(t,q,qkey)}</td>\r\n          {TDs(s,this.props.stats,!this.props.students,this.props.setS)}\r\n          </tr>)\r\n    })\r\n    return (<div><h3>Question Analysis</h3>\r\n          <table className=\"table table-bordered table-condensed table-striped width-auto\">\r\n          <thead><tr><th><PaperSelect type={this.props.type} p={this.props.p} stats={this.props.stats} setPaper={this.props.setPaper}/></th><th><span className=\"btn-link\" onClick={()=>this.setState({qSort:!this.state.qSort})}>Q</span></th>\r\n          {THs()}<th>marks</th>\r\n          {this.props.stats.uid===\"0\"?<th><i className=\"fa fa-user\" aria-hidden=\"true\"></i></th>:<th><i className=\"fa fa-calendar-o\" aria-hidden=\"true\"></i></th>}\r\n          <th><i className=\"fa fa-comments\" aria-hidden=\"true\"></i></th></tr></thead>\r\n          <tbody>{rows}</tbody>\r\n          </table>{this.state.detail}</div>)\r\n  }\r\n}\r\n\r\nclass PaperSelect extends Component {\r\n  render() {\r\n    if (!isset(this.props.stats)) return null\r\n    //console.log(\"PaperSelect\",this.props.tests[this.props.p])\r\n    var subjects = {}\r\n    var papers=Object.keys(this.props.stats.ts).filter(pkey=>{return !this.props.type || test(pkey).type===this.props.type}).map((tid)=>{return {id:tid,title:title(tid,this.props.stats)}}).sort((x,y)=>x.title.localeCompare(y.title))\r\n    var options = [<option key='sel' value={0}>select</option>]\r\n    papers.forEach((p)=>{\r\n      var subject = p.title.split(' ')\r\n      if (subject.length > 1 && !isset(subjects[subject[0]])) {\r\n        subjects[subject[0]]=subject[0]\r\n        options.push(<option key={subject[0]} value={subject[0]}>{subject[0]}</option>)\r\n      }\r\n    })\r\n    options = options.concat(papers.map((p)=>{return <option key={p.id} value={p.id}>{title(p.title)}</option>}))\r\n\r\n    return(<select value={this.props.p===null?0:this.props.p} onChange={(e)=>this.props.setPaper(e.target.value)}>{options}</select>)\r\n  }\r\n}\r\n\r\nclass StudentSelect extends Component {\r\n  setUser=()=>{\r\n    let user=this.props.fm.state.user\r\n    if (!user.logout) user.logout={name:user.name,id:user.id,log:user.log,token:user.token}\r\n    let log=this.props.fm.state.log.filter(x=>{return x.user_id===this.props.uid*1})\r\n    //console.log(\"setUser\",u,this.props.uid,user)\r\n    user.name=this.props.fm.state.students[this.props.uid].name\r\n    user.id=this.props.uid*1\r\n    user.log=log\r\n    user.token=null\r\n    user.isAdmin=user.isTutor=false\r\n    this.props.fm.setState({user:user,page:null,message:{type:'success',text:'Switched user to: '+user.name}})\r\n  }\r\n  render() {\r\n    if (this.props.uid && this.props.fm.state.user.isAdmin && this.props.fm.state.students && this.props.fm.state.students[this.props.uid])\r\n      return <span><span className=\"btn-link\" onClick={this.setUser}><i className=\"fa fa-group\"></i></span> <AskTutor uid={this.props.uid}/></span>\r\n    else return null\r\n  }\r\n}\r\n\r\nexport {Students,tipN,StudentSelect}\r\n","/**\r\n* This file provided by FreeMaths is for non-commercial testing and evaluation\r\n* purposes only. FreeMaths reserves all rights not expressly granted.\r\n*\r\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\r\n* FreeMaths BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN\r\n* ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\r\n* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n*/\r\nimport {ajax} from './ajax'\r\nimport React, { Component } from 'react'\r\nimport {Modal,Button,Col,Row} from 'react-bootstrap';\r\nimport {empty} from './Utils'\r\nimport {EditFields} from './EditQuestion'\r\nimport {qp,ms} from './PastPaper'\r\n\r\nclass EditPast extends Component {\r\n  setPaper(t) {\r\n    if (!t) return {id:'',name:'',board:'',month:'',year:'',title:'',QP:'',MS:'',ER:'',questions:[]}\r\n    let p=t.test\r\n    p.title=t.title\r\n    p.id=t.id\r\n    p.questions=t.test.questions\r\n    return p\r\n  }\r\n  state={paper: this.setPaper(this.props.test), type: null, error:{}, q:null}\r\n  update=(field,value)=>{\r\n    var updated = this.state.paper\r\n    updated[field]=value\r\n    this.setState({paper: updated})\r\n  }\r\n  update=(field,value)=>\r\n  {\r\n    let p=this.state.paper\r\n    p.questions[this.state.q][field]=value\r\n    this.setState({paper:p})\r\n  }\r\n  working=()=>{\r\n    const keys=['topic','question','answer','help','working']\r\n    let q=this.state.paper.questions[this.state.q],ret={}\r\n    keys.forEach(k=>{ret[k]=q[k]?q[k]:''})\r\n    return ret\r\n  }\r\n  updateQ=(q,field,value)=>\r\n  {\r\n    if (this.state.type==='ans') {\r\n      console.log(\"updateQ\",q)\r\n      this.setState({q:q})\r\n    }\r\n    else {\r\n      var qs = this.state.paper.questions\r\n      if (typeof qs[q] === 'undefined') qs[q]={q:'',marks:''}\r\n      qs[q][field]=value\r\n      var max=0\r\n      for (var i=0; i<q; i++) if (!empty(qs[i][field])) max=qs[i][field]*1\r\n      i=q-1;\r\n      if (value*1 >= max) while (i>=0 && empty(qs[i][field])) qs[i--][field]=value\r\n      var p=this.state.paper\r\n      p.questions = qs\r\n      this.setState({paper: p})\r\n    }\r\n  }\r\n  // duplicated code\r\n  save=()=>\r\n  {\r\n    ajax(\"/react_ajax/past\",(r)=>{\r\n      if (r.error) this.setState({error:r.data})\r\n      else {\r\n        let p=this.state.paper;\r\n        p.id=r.data.id;\r\n        this.setState({paper: this.state.paper});\r\n        console.log(\"past\",r.data.id)\r\n      }\r\n    },{test: this.state.paper}) //var obj = this; map tests\r\n  }\r\n  render() {\r\n    //console.log(\"EditPastPages\",this.props.test)\r\n      let qs=[]\r\n      let total=0\r\n      let i=0\r\n      for (i=0; i<this.state.paper.questions.length; i++)\r\n      {\r\n        var q=this.state.paper.questions[i]\r\n        if (this.state.type==='edit') qs.push(<Q key={i} i={i} update={this.updateQ} q={q?q:{q:'',marks:''}}/>)\r\n        else qs.push(<QP key={i} i={i} update={this.updateQ} type={this.state.type} q={q}/>)\r\n        if (typeof q !== 'undefined') total+=1*q.marks\r\n      }\r\n      if (this.state.type==='edit') qs.push(<Q key={i} i={i} update={this.updateQ} q={{q:'',marks:''}}/>) // one extra question\r\n\r\n      return (<Modal show={true} onHide={this.props.close} bsSize={this.state.type==='ans'?\"lg\":null}>\r\n        <Modal.Header closeButton><Modal.Title>{this.state.paper.title.replace(/_/g,' ')}</Modal.Title></Modal.Header>\r\n        <Modal.Body>\r\n        {this.state.error.error?<div className=\"alert alert-danger\"><strong>Error: {this.state.error.error}</strong></div>:null}\r\n        <input type=\"text\" size=\"10\" placeholder=\"Name\" value={this.state.paper['name']} onChange={(e)=>this.update(\"name\",e.target.value)}/>\r\n        <input size=\"5\" type=\"text\" placeholder=\"Board\" value={this.state.paper['board']} onChange={(e)=>this.update(\"board\",e.target.value)}/>\r\n        <input size=\"5\" type=\"text\" placeholder=\"Month\" value={this.state.paper['month']} onChange={(e)=>this.update(\"month\",e.target.value)}/>\r\n        <input size=\"5\" type=\"text\" placeholder=\"Year\" value={this.state.paper['year']} onChange={(e)=>this.update(\"year\",e.target.value)}/>\r\n        <br/><input style={{width: \"90%\"}} type=\"text\" placeholder=\"Paper\" value={this.state.paper['QP']} onChange={(e)=>this.update(\"QP\",e.target.value)}/>\r\n        <br/><input style={{width: \"90%\"}} type=\"text\" placeholder=\"Mark Scheme\"  value={this.state.paper['MS']} onChange={(e)=>this.update(\"MS\",e.target.value)}/>\r\n        <br/><input style={{width: \"90%\"}} placeholder=\"Examiners Report\"  value={this.state.paper['ER']} onChange={(e)=>this.update(\"ER\",e.target.value)}/>\r\n        <br/><span className=\"btn-link\" onClick={()=>this.setState({type:'edit'})}>Questions & Marks</span><br />\r\n        <a target=\"_blank\" rel=\"noopener noreferrer\" onClick={()=>this.setState({type: 'qp'})} href={this.state.paper['QP']}>question paper</a>&nbsp;\r\n        <a target=\"_blank\" rel=\"noopener noreferrer\" onClick={()=>this.setState({type: 'ms'})} href={this.state.paper['MS']}>mark scheme</a>&nbsp;\r\n        <a target=\"_blank\" rel=\"noopener noreferrer\" onClick={()=>this.setState({type: 'er'})} href={this.state.paper['ER']}>examiners report</a><br />\r\n        {qp(this.state.paper)} {ms(this.state.paper)} <span className=\"btn-link\" onClick={()=>this.setState({type: 'ans'})}>working</span><br />\r\n        {this.state.type === 'qp'?<input type=\"text\" placeholder=\"Extra Pages\" value={this.state.paper['qpx']?this.state.paper['qpx']:''} onChange={(e)=>this.update(\"qpx\",e.target.value)}/>:null}\r\n        <Row><Col sm={3}>\r\n        <table className=\"table table-bordered table-condensed table-striped\" style={{width: 'auto'}}>\r\n        <thead><tr><th>Q</th><th>{this.state.type}</th></tr></thead>\r\n        <tbody>{qs}</tbody>\r\n        <tfoot><tr><th>total</th><th>{total}</th></tr></tfoot>\r\n        </table>\r\n        </Col>\r\n        {this.state.type==='ans'?<Col sm={9}>{this.state.q!==null?<div><h3>Question {this.state.paper.questions[this.state.q]['q']}</h3><EditFields auto={true} fields={this.working()} update={this.update}/></div>:null}</Col>:null}\r\n        </Row>\r\n        </Modal.Body><Modal.Footer><Button onClick={this.save}>Save</Button></Modal.Footer>\r\n        </Modal>)\r\n      }\r\n}\r\n\r\nclass Q extends Component {\r\n  render() {\r\n  return (<tr>\r\n        <td><input size=\"4\" type=\"text\" value={this.props.q['q']} placeholder=\"1a\" onChange={(e)=>this.props.update(this.props.i,\"q\",e.target.value)}/></td>\r\n        <td><input style={{width: \"3em\"}}  type=\"number\" placeholder=\"0\" value={this.props.q['marks']} onChange={(e)=>this.props.update(this.props.i,\"marks\",e.target.value)}/></td>\r\n        </tr>)\r\n        // <td><input size=\"20\" type=\"text\" placeholder=\"hover text\" value={this.props.q['hover']} onChange={(e)=>this.props.update(this.props.i,\"hover\",e.target.value)}/></td>\r\n  }\r\n}\r\n\r\nclass QP extends Component {\r\n  render() {\r\n    if (!this.props.type) return null\r\n    else return (<tr>\r\n        <td>{this.props.q['q']}</td>\r\n        {this.props.type==='ans'?<td><span className=\"btn-link\" onClick={()=>this.props.update(this.props.i,this.props.type)}>edit</span></td>:\r\n        <td><input style={{width: \"3em\"}}  type=\"number\" placeholder=\"0\" value={this.props.q[this.props.type]?this.props.q[this.props.type]:''} onChange={(e)=>this.props.update(this.props.i,this.props.type,e.target.value)}/></td>\r\n        }</tr>)\r\n        // <td><input size=\"20\" type=\"text\" placeholder=\"hover text\" value={this.props.q['hover']} onChange={(e)=>this.props.update(this.props.i,\"hover\",e.target.value)}/></td>\r\n  }\r\n}\r\n\r\nexport default EditPast\r\n","/**\r\n* This file provided by FreeMaths is for non-commercial testing and evaluation\r\n* purposes only. FreeMaths reserves all rights not expressly granted.\r\n*\r\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\r\n* FreeMaths BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN\r\n* ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\r\n* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n*/\r\nimport {ajax} from './ajax'\r\nimport React, { Component } from 'react'\r\nimport {tipN} from './Students'\r\nimport {totalColour,sym,AskTutor} from './StatsUI'\r\nimport {TooltipHover,ModalBox,isset,empty,title,date,fontSize,test} from './Utils'\r\nimport EditPast from './EditPast'\r\n//import {Comment} from './Comment'\r\n\r\nfunction qMsEr(k,stats,n)\r\n{\r\n    let [p,,,qn]=k.split(':')\r\n    let t=test(p)\r\n    if (!t || t.type!=='past') return null\r\n    let q=t.qs[qn]\r\n    return <span>{ms(t,q)} {er(t,q)}</span>\r\n}\r\n\r\nfunction qQp(k,stats)\r\n{\r\n    let [p,,,qn]=k.split(':')\r\n    let t=test(p)\r\n    if (!t || t.type!=='past') return qn\r\n    let q=t.qs[qn]\r\n    return qp(t,q,qn)\r\n}\r\n\r\n\r\nfunction qp(t,q,qn)\r\n{\r\n  if (isset(q)&&empty(q.qp)) return qn?qn:''\r\n  if (isset(t.test)) t=t.test\r\n  let l=isset(q)&&!empty(q.qp)?t.QP.split('#')[0]+\"#page=\"+q.qp:t.QP\r\n  if (isset(t) && !empty(t.QP)) {\r\n    if(isset(qn)) return <a className=\"btn-link\" target=\"_blank\" rel=\"noopener noreferrer\" href={l+pages(t)}><TooltipHover tooltip=\"question paper\">{qn}</TooltipHover></a>\r\n    else return <a target=\"_blank\" rel=\"noopener noreferrer\" href={l+pages(t)}><TooltipHover tooltip=\"question paper\"><i style={{fontSize: fontSize()}} className=\"fa fa-question-circle\"></i></TooltipHover></a>\r\n  }\r\n  else return ''\r\n}\r\nfunction ms(t,q,mk)\r\n{\r\n  if (isset(q)&&empty(q.ms)) return isset(mk)?mk:''\r\n  if (isset(t.test)) t=t.test\r\n  let l=isset(q)&&!empty(q.ms)?t.MS.split('#')[0]+\"#page=\"+q.ms:t.MS\r\n  if (isset(t) && !empty(t.MS)) {\r\n    if (isset(mk)) return <a target=\"_blank\" rel=\"noopener noreferrer\" href={l}><TooltipHover tooltip=\"mark scheme\">{mk}</TooltipHover></a>\r\n    else return <a target=\"_blank\" rel=\"noopener noreferrer\" href={l}><TooltipHover tooltip=\"mark scheme\"><i style={{fontSize: fontSize()}} className=\"fa fa-check-circle\"></i></TooltipHover></a>\r\n  }\r\n  else return ''\r\n}\r\nfunction er(t,q)\r\n{\r\n  if (isset(q)&&empty(q.er)) return ''\r\n  if (isset(t.test)) t=t.test\r\n  let l=isset(q)&&!empty(q.er)?t.ER.split('#')[0]+\"#page=\"+q.er:t.ER\r\n  if (isset(t) && !empty(t.ER)) return <a rel=\"noopener noreferrer\" target=\"_blank\" href={l}><TooltipHover tooltip=\"examiners report\"><i style={{fontSize: fontSize()}} className=\"fa fa-info-circle\"></i></TooltipHover></a>\r\n  else return ''\r\n}\r\n\r\nfunction pages(t)\r\n{\r\n  if (!isset(t.qpx)) return ''\r\n  let ps=t.questions.map((q)=>{return q.qp})\r\n  let px=t.qpx.split(',')\r\n  var i=0,j=0,last=0,m=[]\r\n  while (i<ps.length && j<px.length)\r\n  {\r\n    if (ps[i]*1 > px[j]*1) {if (px[j]*1>last) {last=px[j]*1; m.push(px[j++]);} else j++;}\r\n    else {if (ps[i]*1>last) {last=ps[i]*1; m.push(ps[i++]);} else i++;}\r\n  }\r\n  while (i<ps.length) {if (ps[i]*1>last) {last=ps[i]*1; m.push(ps[i++]);} else i++;}\r\n  while (j<px.length) {if (px[j]*1>last) {last=px[j]*1; m.push(px[j++]);} else j++;}\r\n  return \"#\"+m.join(\",\")\r\n}\r\n\r\nfunction mark(test,stats)\r\n{\r\n  let ts=stats.t.ts[test]\r\n  if (isset(ts) && isset(ts.r) && ts.r.length > 0) return <TooltipHover placement=\"bottom\" tooltip={tipN(ts.r,stats,true)}><span className={totalColour(ts.mk,ts.mks)}>{title(test,stats)}({ts.mk}/{ts.mks})</span></TooltipHover>\r\n  else if(isset(stats.ts[test]) && isset(stats.ts[test].rs) && isset(stats.ts[test].rs[window.FreeMaths.state.user.id]) && isset(stats.ts[test].rs[window.FreeMaths.state.user.id][0])) return <TooltipHover placement=\"bottom\" tooltip={date(stats.ts[test].rs[window.FreeMaths.state.user.id][0].ts)}><span className=\"green\">{title(test,stats)} (0/0)</span></TooltipHover>\r\n  else return title(test,stats)\r\n}\r\n\r\nclass Past extends Component {\r\n  state={test: null, mark:false, bar:false, edit: false}\r\n  links=(tid)=>{\r\n    let t=test(tid)\r\n    if (!t || t.type !== 'past') return null\r\n    let ed=window.FreeMaths.state.user.isAdmin?<TooltipHover tooltip={tid}><span className='btn-link' onClick={()=>this.setState({test:tid, edit:true})}><i className={t.test.questions.length&&t.test.questions[0].qp?\"fa fa-edit green\":\"fa fa-edit red\"}></i></span></TooltipHover>:null\r\n    return <span>&nbsp;{qp(t)}&nbsp;{ms(t)}&nbsp;{er(t)}&nbsp;{ed}</span>\r\n  }\r\n  render() {\r\n    const past_book=this.props.type==='past'?window.FreeMaths.state.data.past:window.FreeMaths.state.data.book\r\n    let tests=null\r\n    if (!this.props.test) tests=Object.keys(past_book).filter((t)=>past_book[t].title.startsWith(this.props.topic)).sort((x,y)=>paperSort(past_book[x],past_book[y])).map((test)=>{\r\n      return <li key={test}><span className=\"btn-link\" onClick={()=>this.setState({test:test})}>{mark(test,this.props.stats)}</span>{this.links(test)}</li>\r\n    })\r\n    if (this.state.test !== null) {\r\n      if(!this.state.edit) var paper = <PastMark stats={this.props.stats} test={this.state.test} update={this.update} close={()=>this.setState({test: null})}/>\r\n      else paper = <EditPast test={past_book[this.state.test]} close={()=>this.setState({test: null, edit:false})}/> // usually null\r\n    }\r\n    return (<div>\r\n      {(this.props.topic===\"GCSE(9-1)\"||this.props.topic===\"P1\"||this.props.topic===\"SM1\")?<p><span className=\"red\">Note:</span> Several {this.props.topic} sample papers are combined into a single PDF. The links below should jump to the correct page but be careful to set a page range if printing.</p>:null}\r\n      {tests?<ul>{tests}</ul>:<span>{date(this.props.ts)} <span className=\"btn-link\" onClick={()=>this.setState({test:this.props.test})}>{mark(this.props.test,this.props.stats)}</span>{this.links(this.props.test)}</span>}\r\n      {paper}\r\n      </div>)\r\n    }\r\n        //<p>To add more past papers visit <Link to={'/pastpaper'}>pastpaper</Link></p>\r\n}\r\n\r\nfunction tqs(pkey,stats)\r\n{\r\n  //console.log('findQ',qkey,stats)\r\n  let ret={key:pkey}\r\n  let [p,ch,e]=pkey.split(':')\r\n  ret.t=test(p)\r\n  ret.ts=stats.ts[pkey]\r\n  if (isset(e) && e!== '') {\r\n    ret.qs=(isset(ret.t.qmap.qs) && isset(ret.t.qmap.qs[ch]) && isset(ret.t.qmap.qs[ch][e]))?ret.t.qmap.qs[ch][e]:null\r\n    ret.ch=ch\r\n    ret.e=e\r\n  }\r\n  else if (isset(ret.t.test) && isset(ret.t.test.questions)) ret.qs=ret.t.test.questions\r\n  return ret\r\n}\r\n\r\nclass PastMark extends Component {\r\n  setMarks=()=>\r\n  {\r\n    let t=tqs(this.props.test,this.props.stats)\r\n    let ret=t.qs.map((q)=>{\r\n      let qkey=t.key.indexOf(':')>0?t.key+':'+q.q:t.key+':::'+q.q\r\n      let l=isset(t.ts)&&isset(t.ts.qs[qkey])?t.ts.qs[qkey].l[window.FreeMaths.state.user.id]:null\r\n      if (isset(l))return {m:l.m,f:l.f,c:'',mk:l.mk,mks:q.marks,q:q.q}\r\n      else return {m:'',f:'',c:'',mk:'',mks:q.marks,q:q.q}\r\n    })\r\n    //console.log(\"PastMark\",this.props,t,ret)\r\n    return ret\r\n  }\r\n  state={marks:this.setMarks(), effort: 0, show: false}\r\n  total(){\r\n    let t={marks:0,total:0,f:{':)':0,':|':0,':(':0},m:{'✓':0,'?✓':0,'✗':0},qs:0,qc:0}\r\n    let marks = this.state.marks\r\n    let qs = tqs(this.props.test,this.props.stats).qs\r\n    t.qc = qs.length\r\n    for (var j=0; j<qs.length; j++)\r\n    if (this.state.show || marks[j].show || 1*qs[j].marks !== 1*marks[j].mk || marks[j].f !== ':)')\r\n    {\r\n      t.qs++;\r\n      t.total+=1*qs[j].marks\r\n      t.marks+=1*marks[j].mk\r\n      if (marks[j].f.startsWith(':')) t.f[marks[j].f]++\r\n      if (marks[j].m !== '') t.m[marks[j].m]++\r\n    }\r\n    return t\r\n  }\r\n  marking=(log)=>{\r\n    let user=window.FreeMaths.state.user\r\n    user.log.push(log)\r\n    window.FreeMaths.setState({user:user,message:null})\r\n    this.props.close()\r\n  }\r\n  save=()=>\r\n  {\r\n    let marks=this.state.marks.map((m)=>{if (m.show) {delete m.show; return m;} else return undefined;})\r\n    var info = {marks:marks,effort:this.state.effort}\r\n    ajax(\"/react_ajax/marking\",(r)=>{\r\n      if (r.error) this.setState({error:r.data.error})\r\n      else this.marking(r.data.log)\r\n    },{test_id: this.props.test, info: info}); //var obj = this; map tests\r\n  }\r\n  setEffort=(t)=>{\r\n    this.setState({effort:t})\r\n  }\r\n  mark=(i,t,m)=>{\r\n    var marks = this.state.marks\r\n    var qs = tqs(this.props.test,this.props.stats).qs\r\n    marks[i].show=true\r\n\r\n    if (t==='f') marks[i].f = m\r\n    else if (t==='mk'){\r\n      marks[i].mk=m\r\n      marks[i].mks=qs[i].marks\r\n      if (m==='') marks[i].f = ''\r\n      else if (m===qs[i].marks) {marks[i].f = ':)'; marks[i].m = '✓'}\r\n      else if (m==='0') {marks[i].f = ':)'; marks[i].m = '✗'}\r\n      else {marks[i].f = ':)'; marks[i].m = '?✓'}\r\n    }\r\n    else marks[i].c = m\r\n    this.setState({marks: marks})\r\n  }\r\n  render() {\r\n    if (this.props.test === null) return null\r\n    let t=tqs(this.props.test,this.props.stats),i=0,questions=[],hidden=false\r\n    t.qs.forEach(q=>{\r\n      let qkey=t.key.indexOf(':')>0?t.key+':'+q.q:t.key+':::'+q.q // for comments\r\n      if (this.state.show) questions.push(<QF key={i} qkey={qkey} i={i} test={t.t} update={this.updateQ} q={q} mark={this.mark} marks={!empty(this.state.marks)&&isset(this.state.marks[i])?this.state.marks[i]:{m:'',f:'',c:''}}/>)\r\n      else if (this.state.marks[i].show || 1*q.marks !== 1*this.state.marks[i].mk || this.state.marks[i].f !== ':)')\r\n        questions.push(<QF qkey={qkey} key={i} test={t.t} i={i} update={this.updateQ} q={q} mark={this.mark} marks={isset(this.state.marks[i])?this.state.marks[i]:{m:'',f:'',c:'',mk:0}}/>)\r\n      else hidden=true\r\n      i++;\r\n    })\r\n    var total = this.total()\r\n    if (total.marks === total.total) var color=\"green\"\r\n    else if (total.marks > total.total*.65) color = \"amber\"\r\n    else color=\"red\"\r\n    return (<ModalBox save={{fn:this.save,text:'Save'}} close={this.props.close} title={title(this.props.test,this.props.stats)}>\r\n      {hidden||this.state.show?<button onClick={()=>this.setState({show:!this.state.show})} className=\"btn btn-default btn-sm\">{this.state.show?\"Hide\":\"Show\"} <span className=\"green\">✓{sym[':)']}</span></button>:null}\r\n      <table className=\"table table-bordered table-condensed table-striped\" style={{width: 'auto'}}>\r\n      <thead><tr><th>Q {qp(t.t)}</th><th>Marks {ms(t.t)}</th><th style={{textAlign:'center'}}>{sym[':)']}</th><th>Comment {er(t.t)}</th></tr></thead>\r\n      <tbody>{questions}</tbody>\r\n      <tfoot><tr><th style={{verticalAlign: 'middle'}}>Total</th>\r\n      <th style={{verticalAlign: 'middle',textAlign:'center'}}><span className={color}>{total.marks}</span>/{total.total}</th>\r\n      <th style={{verticalAlign: 'middle',textAlign:'center'}}><span className=\"green\">{total.f[':)']}</span> <span className=\"amber\">{total.f[':|']}</span> <span className=\"red\">{total.f[':(']}</span></th>\r\n      <th><Effort total={total} effort={this.state.effort} setEffort={this.setEffort}/></th></tr></tfoot>\r\n      </table>\r\n      {this.state.error?<div className=\"alert alert-danger\"><strong>Server Error: {this.state.error}</strong></div>:null}\r\n    </ModalBox>)\r\n  }\r\n}\r\n\r\nclass Effort extends Component {\r\n  update=(e)=>\r\n  {\r\n      var hms=e.target.value.split(':')\r\n      if (hms.length === 3) var t = ((hms[0]*60+hms[1])*60+hms[2])*1000\r\n      else if (hms.length === 2) t = (hms[0]*60+hms[1])*60*1000\r\n      else if (hms.length === 1) t=hms[0]*60*1000\r\n      this.props.setEffort(t)\r\n  }\r\n  render() {\r\n    var t = (isset(this.props.effort) && this.props.effort > 0)?Math.round(this.props.effort/60000):''\r\n    //console.log(\"Effort\",this.props.effort)\r\n    return <span>Effort: <input onChange={this.update} size=\"5\" type=\"text\" value={t} placeholder={Math.round(this.props.total.total/75*90)}/>(mins)</span>\r\n  }\r\n}\r\n\r\nfunction comp(x,y)\r\n{\r\n  x=x.split('_')[0]\r\n  y=y.split('_')[0]\r\n  if (x===y) return 0\r\n  else if (x === 'GCSE(9-1)') return -1\r\n  else if (y === 'GCSE(9-1)') return 1\r\n  else return x>y?1:-1\r\n}\r\n\r\nfunction paperSort(x,y)\r\n{\r\n  //console.log(\"comp\",x.name,y.name)\r\n  if (!isset(x.test)) x.test=JSON.parse(x.json)\r\n  if (!isset(y.test)) y.test=JSON.parse(y.json)\r\n  x=x.test\r\n  y=y.test\r\n  if (comp(x.name,y.name) !== 0) return comp(x.name,y.name)\r\n  else if (x.board !== y.board) return x.board>y.board?1:-1\r\n  else if (x.year !== y.year) return (x.year*1)-(y.year*1)\r\n  else if (x.month !== y.month) return x.month>y.month?1:-1\r\n  else if (x.name.split('_').length>1) {\r\n    if (y.name.split('_').length>1) return x.name.split('_')[1]>y.name.split('_')[1]?1:-1\r\n    else return 1\r\n  }\r\n  else if (y.name.split('_').length>1) return -1\r\n  else return 0\r\n}\r\n\r\nclass QF extends Component {\r\n  render() {\r\n  //console.log(\"QF\",this.props)\r\n  if (window.FreeMaths.state.user.isMobile) var comment = <input style={{width: \"6em\"}} type=\"text\" name=\"comment\" value={this.props.marks.c} onChange={(e)=>this.props.mark(this.props.i,'c',e.target.value)}/>\r\n  else comment = <input type=\"text\" name=\"comment\" value={this.props.marks.c} onChange={(e)=>this.props.mark(this.props.i,'c',e.target.value)}/>\r\n  // let comment=<Comment save={(c)=>this.props.mark(this.props.i,'c',c)} comment={this.props.marks.c}/>\r\n  return (<tr>\r\n        <td>{qp(this.props.test,this.props.q,this.props.q.q)}</td>\r\n        <td style={{width: \"6em\"}}><Marks test={this.props.test} q={this.props.q} mk={this.props.marks.mk} i={this.props.i} mark={this.props.mark}/></td>\r\n        <td><Smiley f={this.props.marks.f} i={this.props.i} mark={this.props.mark}/></td>\r\n        <td>{er(this.props.test,this.props.q)} {comment} {this.props.marks.c?<AskTutor c={this.props.marks.c} qkey={this.props.qkey}/>:null}</td>\r\n        </tr>)\r\n  }\r\n}\r\n\r\nclass Marks extends Component {\r\n  render() {\r\n    //console.log(\"Marks\",this.props.m)\r\n    var opts = [<option key=\"?\" value=''>?</option>]\r\n    for (var i=0; i<=this.props.q.marks; i++) opts.push(<option key={i}>{i}</option>)\r\n    if (this.props.mk*1===this.props.q.marks*1) var marks = <span className=\"green\">{this.props.q.marks}</span>\r\n    else if (this.props.mk > 0) marks = <span className=\"amber\">{this.props.q.marks}</span>\r\n    else if (this.props.mk === '0') marks = <span className=\"red\">{this.props.q.marks}</span>\r\n    else marks = <span>{this.props.q.marks}</span>\r\n    return <span><select value={this.props.mk} className=\"qmark btn btn-default btn-sm\" onChange={(e)=>this.props.mark(this.props.i,'mk',e.target.value)}>{opts}</select>/{ms(this.props.test,this.props.q,marks)}</span>\r\n  }\r\n}\r\n\r\nclass Smiley extends Component {\r\n  render() {\r\n    if (this.props.f === ':)') var color = 'green '\r\n    else if (this.props.f === ':|') color = 'amber '\r\n    else if (this.props.f === ':(') color = 'red '\r\n    else color = ''\r\n    return (<select value={this.props.f} className={color+\"feedback btn btn-default btn-sm\"} onChange={(e)=>this.props.mark(this.props.i,'f',e.target.value)}>\r\n    <option value=''>?</option>\r\n    <option className=\"green\">:)</option>\r\n    <option className=\"amber\">:|</option>\r\n    <option className=\"red\">:(</option>\r\n      </select>)\r\n  }\r\n}\r\nexport {Past,Marks,PastMark,paperSort,pages,fontSize,qp,ms,er,mark,qMsEr,qQp}\r\n","/**\r\n* This file provided by FreeMaths is for non-commercial testing and evaluation\r\n* purposes only. FreeMaths reserves all rights not expressly granted.\r\n*\r\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\r\n* FreeMaths BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN\r\n* ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\r\n* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n*/\r\nimport {ajax} from './ajax'\r\nimport React, { Component } from 'react'\r\nimport {isset} from './Utils'\r\nimport {Modal,Button} from 'react-bootstrap';\r\n\r\nclass EditBook extends Component {\r\n  state={book: {id:'',name:'',board:'',isbn:'',link:'',chapters:[]}}\r\n  update=(field,value)=>{\r\n    var updated = this.state.book\r\n    updated[field]=value\r\n    this.setState({book: updated})\r\n  }\r\n  save=()=>\r\n  {\r\n    ajax(\"/react_ajax/book\",(r)=>{\r\n      if (r.error) this.setState({error:r.data})\r\n      else {\r\n        var p=this.state.book\r\n        p.id=r.data.id\r\n        this.setState({book: p})\r\n        console.log(\"book\",r.data.id)\r\n      }\r\n    },{book: this.state.book}) //var obj = this; map tests\r\n  }\r\n  componentDidMount() {\r\n    //console.log('EditBook',this.props,window.FreeMaths)\r\n    if (isset(this.props.id)) this.setState({book: window.FreeMaths.state.data.books[this.props.id].book})\r\n  }\r\n  render() {\r\n      return (\r\n        <Modal show={true} onHide={this.props.close} bsSize=\"lg\">\r\n        <Modal.Header closeButton><Modal.Title>{this.state.book.name.replace(/_/g,' ')}</Modal.Title></Modal.Header>\r\n        <Modal.Body>\r\n        <div className=\"panel panel-default\">\r\n        <input type=\"text\" size=\"5\" placeholder=\"Name\" value={this.state.book['name']} onChange={(e)=>this.update(\"name\",e.target.value)}/>\r\n        <input size=\"5\" type=\"text\" placeholder=\"Board\" value={this.state.book['board']} onChange={(e)=>this.update(\"board\",e.target.value)}/>\r\n        <input size=\"15\" type=\"text\" placeholder=\"ISBN\" value={this.state.book['isbn']} onChange={(e)=>this.update(\"isbn\",e.target.value)}/>\r\n        <br/><input size=\"100\" type=\"text\" placeholder=\"Link\" value={this.state.book['link']} onChange={(e)=>this.update(\"link\",e.target.value)}/>\r\n        <Chapters cs={this.state.book.chapters} update={this.update}/>\r\n        </div>\r\n        </Modal.Body><Modal.Footer><Button onClick={this.save}>Save</Button></Modal.Footer>\r\n        </Modal>)\r\n        /*<Exercise />\r\n        <table className=\"table table-bordered table-condensed table-striped\" style={{width: 'auto'}}>\r\n        <thead><tr><th>Q</th><th>Marks</th></tr></thead>\r\n        <tbody>{qs}</tbody>\r\n        <tfoot><tr><th>total</th><th>{total}</th></tr></tfoot>\r\n        </table></div>)*/\r\n      }\r\n}\r\n\r\nclass Chapters extends Component {\r\n  state={c:0,e:0}\r\n  update=(c,i)=>{\r\n    var cs = this.props.cs\r\n    if (c.chapter === '' && c.topic==='') cs.splice(i,1)\r\n    else cs[this.state.c]=c\r\n    this.setState({e:null})\r\n    this.props.update('chapters',cs)\r\n  }\r\n  render()\r\n  {\r\n    return <Chapter e={this.state.e} c={this.props.cs[this.state.c]} i={this.state.c} update={this.update} add={()=>this.setState({c:this.state.c+1,e:0})} back={()=>this.setState({c:this.state.c>0?this.state.c-1:0,e:0})}/>\r\n  }\r\n}\r\n\r\nclass Chapter extends Component {\r\n  update=(field,value)=>{\r\n    if (isset(this.props.c)) var c = this.props.c\r\n    else c={chapter:'',topic:'',link:'',exercises: []}\r\n    c[field]=value\r\n    this.props.update(c,this.props.i)\r\n  }\r\n  render() {\r\n  if (isset(this.props.c)) var c = this.props.c\r\n  else c={chapter:'',topic:'',link:'',exercises: []}\r\n  return (<div>Chapter: <input size=\"2\" type=\"text\" value={c.chapter} placeholder=\"1\" onChange={(e)=>this.update(\"chapter\",e.target.value)}/>\r\n          <input size=\"15\" type=\"topic\" placeholder=\"Topic\" value={c.topic} onChange={(e)=>this.update(\"topic\",e.target.value)}/>\r\n          <span className=\"btn-link\" onClick={this.props.add}>&nbsp;<i className=\"fa fa-btn fa-plus-square-o\"></i></span>\r\n          <span className=\"btn-link\" onClick={this.props.back}>&nbsp;<i className=\"fa fa-btn fa-minus-square-o\"></i></span>\r\n          <input size=\"100\" type=\"text\" placeholder=\"Link\" value={c.link} onChange={(e)=>this.update(\"link\",e.target.value)}/>\r\n          <Exercises e={this.props.e} es={c.exercises} update={this.update}/></div>)\r\n  }\r\n}\r\n\r\nclass Exercises extends Component {\r\n  state={e:0}\r\n  componentWillReceiveProps(nextProps)\r\n  {\r\n    if (isset(nextProps.e)) this.setState({e:nextProps.e})\r\n  }\r\n  update=(e,i)=>{\r\n    var es = this.props.es\r\n    if (e.exercise === '' && e.topic==='') es.splice(i,1)\r\n    else es[this.state.e]=e\r\n    this.props.update('exercises',es)\r\n  }\r\n  render()\r\n  {\r\n    return <Exercise e={this.props.es[this.state.e]} i={this.state.e} update={this.update} add={()=>this.setState({e:this.state.e+1})} back={()=>this.setState({e:this.state.e>0?this.state.e-1:0})}/>\r\n  }\r\n}\r\n\r\nclass Exercise extends Component {\r\n  update=(field,value)=>{\r\n    console.log(\"Exercise update\",field,value)\r\n    if (isset(this.props.e)) var e = this.props.e\r\n    else e={exercise:'',topic:'',page:'',qs: []}\r\n    e[field]=value\r\n    this.props.update(e,this.props.i)\r\n  }\r\n  render() {\r\n    if (isset(this.props.e)) var e = this.props.e\r\n    else e={exercise:'',topic:'',page:'',qs: []}\r\n    return (<div>Exercise: <input size=\"2\" type=\"text\" value={e.exercise} placeholder=\"1\" onChange={(e)=>this.update(\"exercise\",e.target.value)}/>\r\n          <input size=\"15\" type=\"topic\" placeholder=\"Topic\" value={e.topic} onChange={(e)=>this.update(\"topic\",e.target.value)}/>\r\n          <input style={{width: \"4em\"}}  type=\"number\" placeholder=\"pg\" value={e.page} onChange={(e)=>this.update(\"page\",e.target.value)}/>\r\n          <span className=\"btn-link\" onClick={this.props.add}>&nbsp;<i className=\"fa fa-btn fa-plus-square-o\"></i></span>\r\n          <span className=\"btn-link\" onClick={this.props.back}>&nbsp;<i className=\"fa fa-btn fa-minus-square-o\"></i></span>\r\n          <Questions qs={e.qs} update={this.update}/>\r\n          </div>)\r\n  }\r\n}\r\n\r\nclass Questions extends Component {\r\n  update=(q,i)=>{\r\n    var qs = this.props.qs\r\n    if (q.q.indexOf('-') > 0)\r\n    {\r\n      var [from,to]=q.q.split('-')\r\n      var n = from.substring(0,from.length-1)\r\n      if (from.endsWith('a')) {\r\n        if (to.length === 1 && to.match(/[b-z]/))\r\n        {\r\n          qs.splice(i,1)\r\n          for (var j='a'; j!==to; j=String.fromCharCode(j.charCodeAt(0) + 1))\r\n          {\r\n            qs.splice(i++,0,{q:n+j,marks:q.marks})\r\n          }\r\n          qs.splice(i,0,{q:n+j,marks:q.marks})\r\n        }\r\n      }\r\n      else if (from.endsWith('i')) {\r\n        var rn=['i','ii','iii','iv','v','vi','vii','viii','ix','x']\r\n        if (rn.includes(to))\r\n        {\r\n          qs.splice(i,1)\r\n          for (j=0; rn[j]!==to; j++)\r\n          {\r\n            qs.splice(i++,0,{q:n+rn[j],marks:q.marks})\r\n          }\r\n          qs.splice(i,0,{q:n+rn[j],marks:q.marks})\r\n        }\r\n      }\r\n      else {\r\n        to*=1;from*=1\r\n        if (to>from && to-from<99)\r\n        {\r\n          qs.splice(i,1)\r\n          for (j=from; j<=to; j++)\r\n          {\r\n            qs.splice(i++,0,{q:j,marks:q.marks})\r\n          }\r\n        }\r\n      }\r\n    }\r\n    else if (q.q === '') qs.splice(i,1)\r\n    else qs[i]=q\r\n    this.props.update('qs',qs)\r\n  }\r\n  render()\r\n  {\r\n    var i=0\r\n    var qs = this.props.qs.map((q)=>{return <Q key={i} q={q} i={i++} update={this.update}/>})\r\n    return <div>{qs}<Q key={i} q={undefined} i={i} update={this.update}/></div>\r\n  }\r\n}\r\n\r\nclass Q extends Component {\r\n  update=(field,value)=>{\r\n    if (isset(this.props.q)) var q = this.props.q\r\n    else q={q:'',marks:'2'}\r\n    q[field]=value\r\n    this.props.update(q,this.props.i)\r\n  }\r\n  render() {\r\n    //console.log(\"Q\",this.props.q)\r\n    if (isset(this.props.q)) var q = this.props.q\r\n    else q={q:'',marks:'2'}\r\n    return (<div><input size=\"4\" type=\"text\" value={q.q} placeholder=\"1a\" onChange={(e)=>this.update(\"q\",e.target.value)}/>\r\n        <input style={{width: \"4em\"}}  type=\"number\" placeholder=\"0\" value={q.marks} onChange={(e)=>this.update(\"marks\",e.target.value)}/>\r\n        </div>)\r\n  }\r\n}\r\n\r\nexport default EditBook\r\n","import React,{Component} from 'react';\r\nimport {sum_ts} from './Stats'\r\nimport {totalColour} from './StatsUI'\r\nimport {PastMark,fontSize} from './PastPaper'\r\nimport {Maths} from './ReactMaths'\r\nimport {isset,TooltipHover,title} from './Utils'\r\nimport EditBook from './EditBook'\r\n\r\nclass Exercise extends Component {\r\n  state={show:false}\r\n  render() {\r\n    let [bk,ch,ex,]=this.props.pkey.split(':')\r\n    let ekey=bk+':'+ch+':'+ex\r\n    let book=window.FreeMaths.state.data.books[bk].book\r\n    if (book) {\r\n      let chapter=book.chapters.find(c=>{return c.chapter===ch})\r\n      if (chapter.exercises) {\r\n        let exercise=chapter.exercises.find(e=>{return e.exercise=ex})\r\n        if (exercise) {\r\n          if (this.state.show) return <PastMark stats={this.props.stats} test={ekey} update={this.update} close={()=>this.setState({show: false})}/>\r\n          else return (<span><span className='btn-link' onClick={()=>this.setState({show:true})}>{exercise.exercise}  <Maths>{exercise.topic}</Maths></span>\r\n          <Marks stats={this.props.stats} ekey={ekey}/>\r\n          &nbsp;{link(chapter.link,exercise.page,exercise.exercise)}</span>)\r\n        }\r\n      }\r\n    }\r\n    else return null\r\n  }\r\n}\r\n\r\nfunction link(url,page,exercise) {\r\n  let href=url+\"#page=\"+page\r\n  if (url.indexOf('$pg')>0) {\r\n    if (page > 10000) href=url.replace(/r00\\/.*\\$pg/,'r00/r00'+Math.floor(page/10000)+'/r00'+Math.floor(page/100)+'/r00'+page).replace('$ex',exercise)\r\n    else href=url.replace('$pg',page).replace('$ex',exercise)\r\n  }\r\n  return <a target=\"_blank\" rel=\"noopener noreferrer\" href={href}><TooltipHover tooltip=\"solution bank\"><i style={{fontSize: fontSize()}} className=\"fa fa-check-circle\"></i></TooltipHover></a>\r\n}\r\n\r\nclass Books extends Component {\r\n  render() {\r\n    let books=[237,238,240].map(b=>{ // 237:'GCSE(9-1)',238:'P1',240:'SM1',236:'C3',157:'C4',239:'M1',258:'P2'\r\n      var bk=window.FreeMaths.state.data.books[b]\r\n      let cn=0\r\n      bk.book.chapters.forEach((c)=>{c.n=cn++; let en=0; c.exercises.forEach((e)=>e.n=en++)})\r\n      return <Book key={bk.id} bk={bk} stats={this.props.stats} pkey={this.props.pkey} set={this.props.set}/>\r\n    })\r\n    return(<div>{books}</div>)\r\n  }\r\n}\r\n\r\nclass Book extends Component {\r\n  state={show: false, edit: false}\r\n  render()\r\n  {\r\n    //console.log(\"Book\",this.props.bk,window.FreeMaths)\r\n    let ed=(window.FreeMaths.state.user.id===1?<TooltipHover tooltip={this.props.bk.id}><button className='btn btn-link' onClick={()=>this.setState({edit:true})}><i className={\"fa fa-edit green\"}></i></button></TooltipHover>:null)\r\n    if (this.state.edit) return <EditBook close={()=>this.setState({edit:false})} id={this.props.bk.id}/>\r\n    else return (<div>\r\n      <span className='btn-link' onClick={()=>this.props.set(this.props.pkey?null:this.props.bk.id+'')}>{title(this.props.bk.title)}</span>\r\n      <Marks bk={this.props.bk} stats={this.props.stats}/> {ed}\r\n      {this.props.pkey?<Chapters pkey={this.props.pkey} set={this.props.set} bk={this.props.bk} stats={this.props.stats}/>:null}\r\n      </div>)\r\n  }\r\n}\r\n\r\nclass Chapters extends Component {\r\n  render()\r\n  {\r\n    let keys=this.props.pkey.split(':')\r\n    if (keys.length===0 || keys[0]*1!==this.props.bk.id*1) return null\r\n    let bkey=keys[0]\r\n    let chapters=this.props.bk.book.chapters.map((c)=>{\r\n      let ckey=bkey+':'+c.chapter\r\n      return <li key={c.chapter}><span className='btn-link' onClick={()=>this.props.set(this.props.pkey===ckey?bkey:ckey)}>{c.chapter} <Maths>{c.topic}</Maths></span>\r\n      <Marks bk={this.props.bk} stats={this.props.stats} ch={c.chapter}/>\r\n      <Exercises stats={this.props.stats} set={this.props.set} bk={this.props.bk} chapter={c} pkey={this.props.pkey}/></li>})\r\n    return (<ul>{chapters}</ul>)\r\n  }\r\n}\r\n\r\nclass Exercises extends Component {\r\n  render()\r\n  {\r\n    let keys=this.props.pkey.split(':')\r\n    if (keys.length<2 || keys[1] !== this.props.chapter.chapter) return null\r\n    let ckey=keys[0]+':'+keys[1]\r\n    let exercises=this.props.chapter.exercises.map((e)=>{\r\n      let ekey=ckey+':'+e.exercise\r\n      return (<li key={e.exercise}><span className='btn-link' onClick={()=>this.props.set(this.props.pkey===ekey?ckey:ekey)}>{e.exercise}  <Maths>{e.topic}</Maths></span>\r\n      <Marks stats={this.props.stats} bk={this.props.bk} ch={keys[1]} e={e.exercise} />&nbsp;{link(this.props.chapter.link,e.page,e.exercise)}\r\n      </li>)})\r\n    let exercise=keys.length===3?<PastMark stats={this.props.stats} test={this.props.pkey} close={()=>this.props.set(ckey)}/>:null\r\n    return (<div><ul>{exercises}</ul>{exercise}</div>)\r\n  }\r\n}\r\n\r\nfunction pkey(p,ch,e)\r\n{\r\n  let key=p\r\n  if (isset(ch)) {\r\n    key+=':'+ch\r\n    if (isset(e)) key+=':'+e\r\n  }\r\n  return key\r\n}\r\n\r\nclass Marks extends Component {\r\n  render() {\r\n    let t=sum_ts(this.props.ekey?this.props.ekey:pkey(this.props.bk.id,this.props.ch,this.props.e),this.props.stats)\r\n    if (!t || t.mks===0) return null\r\n    return <span className={totalColour(t.mk,t.mks)}> ({t.mk}/{t.mks})</span>\r\n  }\r\n}\r\n\r\nexport {Books,Exercise}\r\n","import React, { Component } from 'react'\r\nimport {Maths} from './ReactMaths'\r\nimport {isset,TooltipHover,date,title,ModalBox,hms,UC1,test} from './Utils'\r\nimport {paper_stats} from './Stats'\r\nimport {Exercise} from './Books'\r\nimport {qQp,qMsEr} from './PastPaper'\r\nimport {Contact} from './Contact'\r\nimport {Answer,Mark} from './AutoTest'\r\nimport {checkAnswer} from './mark'\r\n\r\n\r\nconst smiley={':(':true,':|':true,':)':true}\r\nconst mark={'✗':true,'?✓':true,'✓':true}\r\nconst rag={'✗':'red','?✓':'amber','✓':'green',':)':'green',':|':'amber',':(':'red','Help':'blue'}\r\nconst xs=[':(',':|','✗','?✓','✓']\r\nconst xs0=[':(',':|',':)','✗','?✓','✓']\r\nconst sym={'✗':'✗','?✓':'✓','✓':'✓',\r\n  'Q':'?',\r\n  ':)':<i name='smile' className=\"fa fa-smile-o green\"></i>,\r\n  ':|':<i name='meh' className=\"fa fa-meh-o amber\"></i>,\r\n  ':(':<i name='frown' className=\"fa fa-frown-o red\"></i>,\r\n  'Show':<i className=\"fa fa-eye\"></i>,\r\n  'Help':<i className=\"fa fa-book\"></i>,\r\n  'Re-try':<i className=\"fa fa-repeat\"></i>,\r\n  '✓✗':<i className=\"fa fa-check-square-o\"></i>}\r\n\r\nfunction totalColour(m,t)\r\n{\r\n  if (m*1 === t) return \"green\"\r\n  else if (m > t*0.65) return \"amber\"\r\n  else return \"red\"\r\n}\r\n\r\nfunction rating(s)\r\n{\r\n  let ts=0,r=null\r\n  s[':)'].forEach(v=>{if (v.ts>ts) {r=':)';ts=v.ts}})\r\n  s[':|'].forEach(v=>{if (v.ts>ts) {r=':|';ts=v.ts}})\r\n  s[':('].forEach(v=>{if (v.ts>ts) {r=':(';ts=v.ts}})\r\n  if (r) return sym[r]\r\n  else return null\r\n}\r\n\r\nfunction tipC(cs,stats,hideName,setC) {\r\n  let i=0\r\n  if (cs.length === 0) return <td key={i++}></td>\r\n  let tip=cs.sort((x,y)=>{return y.ts-x.ts}).map((c)=>{return <div key={i++} style={{textAlign:'left'}}>{date(c.ts)} {hideName?'':stats.users[c.uid].name} {title(c.key,stats,true)}{!hideName?<br />:' '}<span style={{textAlign:'left'}} className={rag[c.f]}><Maths>{c.c}</Maths></span></div>})\r\n  return <td key=\"comments\" onClick={setC?()=>setC(cs,true):null} style={{textAlign:'center'}}><TooltipHover tooltip={tip} placement=\"bottom\">{cs.length}</TooltipHover></td>\r\n}\r\n\r\nfunction tipMtd(s,stats,hideName,setS) {\r\n  return <td key=\"mks\" onClick={setS?()=>setS(s.r):null} style={{textAlign:'center'}} className={totalColour(s.mk===''?0:s.mk,s.mks)}><TooltipHover placement=\"bottom\" tooltip={tipM(s.r,stats,hideName)}>{s.mk===''?0:s.mk}/{s.mks}</TooltipHover></td>\r\n}\r\n\r\nfunction tipNtd(s,stats,hideName,setS) {\r\n  return <td key=\"n\" onClick={setS?()=>setS(s.r):null}><TooltipHover placement=\"bottom\" tooltip={tipN(s.r,stats,hideName)}>{s.r.length}</TooltipHover></td>\r\n}\r\n\r\nfunction tipN(s,stats,hideName)\r\n{\r\n  let i=0;\r\n  return s.sort((x,y)=>{return y.ts-x.ts}).map((r)=>{let u=r.uid?r.uid:s.uid?s.uid:null; return <div key={i++} style={{textAlign:'left'}}>{date(r.ts)} {hideName?'':isset(u)?stats.users[u].name:''} {r.key?title(r.key,stats,true):''} {r.mk!==''?<span className={totalColour(r.mk,r.mks)}>{r.mk}/{r.mks}</span>:''}</div>})\r\n}\r\n\r\nfunction tipM(s,stats,hideName)\r\n{\r\n  let i=0;\r\n  return s.sort((x,y)=>{return y.ts-x.ts}).map((r)=>{let u=r.uid?r.uid:s.uid?s.uid:null; return <div key={i++} style={{textAlign:'left'}}>{date(r.ts)} {hideName?'':isset(u)?stats.users[u].name:''} {r.key?title(r.key,stats,true):''} {r.mk!==''?<span className={totalColour(r.mk,r.mks)}>{r.mk}/{r.mks}</span>:'?/?'}</div>})\r\n//  return s.sort((x,y)=>{return (y.mks-y.mk)-(x.mks-x.mk)}).map((r)=>{let u=r.uid?r.uid:s.uid?s.uid:null; return <div key={i++} style={{textAlign:'left'}}>{date(r.ts)} {hideName?'':isset(u)?stats.users[u].name:''} {r.key?title(r.key,stats,true,hideP):''} {r.mk!==''?<span className={totalColour(r.mk,r.mks)}>{r.mk}/{r.mks}</span>:''}</div>})\r\n}\r\n\r\nfunction tipTtd(s,x,stats,hideName,setS) {\r\n  return s[x].length===0?<td key={x}></td>:<td key={x} onClick={setS?()=>setS(s[x]):null} className={isset(s[x][0].l)&&!s[x][0].l?'grey':rag[x]}><TooltipHover placement=\"bottom\" tooltip={tipT(s,x,stats,hideName,rag[x])}>{s[x].length}</TooltipHover></td>\r\n}\r\n\r\nfunction tipT(s,k,stats,hideName,rag)\r\n{\r\n  let i=0;\r\n  let ret=s[k].sort((x,y)=>{return y.ts-x.ts===0?x.key.localeCompare(y.key):y.ts-x.ts}).slice(0,20).map((r)=>{\r\n    let u=r.uid?r.uid:s.uid?s.uid:null;\r\n    return <div key={i++} style={{textAlign:'left'}}>{date(r.ts)} {hideName?'':isset(u)?stats.users[u].name:''} {r.key?<span className={rag}>{title(r.key,stats,true)}</span>:''}</div>\r\n  })\r\n  if (s[k].length>20) ret.push(<div key=\"dots\" style={{textAlign: \"center\"}}>&hellip;</div>)\r\n  return ret\r\n}\r\n\r\nfunction THs() {\r\n  return xs.map((x)=>{return <th key={x} className={rag[x]}>{sym[x]}</th>})\r\n}\r\nfunction TH0s() {\r\n  return xs0.map((x)=>{return <th key={x} className={rag[x]}>{sym[x]}</th>})\r\n}\r\n\r\nfunction TDs(s,stats,hideName,setS) {\r\n  var tds=xs.map((x)=>{return tipTtd(s,x,stats,hideName,setS)})\r\n  tds.push(tipMtd(s,stats,hideName,setS))\r\n  tds.push(tipNtd(s,stats,hideName,setS))\r\n  tds.push(tipC(s.c,stats,hideName,setS))\r\n  return tds\r\n}\r\n\r\nfunction TD0s(s,setS) {\r\n  var tds=xs0.map(x=>{return tipTtd0(s,x,setS)})\r\n  //tds.push(tipMtd(s,stats,hideName,ms))\r\n  //tds.push(tipNtd(s,stats,hideName,isset(ms),setS))\r\n  //tds.push(tipC(er,s.c,stats,hideName,isset(ms),setS))\r\n  return tds\r\n}\r\n\r\nfunction tipTtd0(s,x,setS) {\r\n  return Object.keys(s[x]).length===0?<td key={x}></td>:<td key={x} onClick={setS?()=>setS(s[x]):null} className={rag[x]}><TooltipHover placement=\"bottom\" tooltip={tipT0(s,x)}>{Object.keys(s[x]).length}</TooltipHover></td>\r\n}\r\n\r\nfunction tipT0(s,k)\r\n{\r\n  const qs=window.FreeMaths.state.data.tests.questions\r\n  let ret=Object.keys(s[k]).sort((x,y)=>{return s[k][y].ts-s[k][x].ts}).map(qid=>{\r\n    if (!s[k][qid].variables) console.log(\"tipT0\",s[k][qid],s,k,qs,qid)\r\n    return <div key={qid} style={{textAlign:'left'}}>{date(s[k][qid].ts)} <span className={rag}>Q{qid} <Maths vars={s[k][qid].variables?JSON.parse(s[k][qid].variables):null}>{qs[qid].topic}</Maths></span></div>\r\n    //return <div key={q} style={{textAlign:'left'}}>{date(s[k][q].ts)} <span className={rag}>Q{q} <Maths vars={JSON.parse(s[k][q].variables)}>{qs[q].topic}</Maths></span></div>\r\n  })\r\n  return ret\r\n}\r\n\r\nfunction log(s,stats,f)\r\n{\r\n  //console.log('log',s,stats)\r\n  let i=0,ch1='',ex1='',p1='',qn1='',c=''\r\n  let detail=s.sort((x,y)=>{return x.mks?y.ts-x.ts:x.key.localeCompare(y.key,undefined,{numeric: true})}).map(x=>{\r\n    let [p,ch,ex,qn]=x.key.split(':')\r\n    let mk=isset(x.mk)?x.mk:stats.t.qs[x.key].mk,mks=isset(x.mks)?x.mks:stats.t.qs[x.key].mks\r\n    let type=test(p).type\r\n    let ret=(<div key={i++}>\r\n      {!ex?p!==p1?<h5>{f?<span className=\"btn-link\" onClick={f}>{date(x.ts)}</span>:date(x.ts)} {title(p,stats)} <span className={totalColour(mk,mks)}>({mk}/{mks})</span></h5>:null\r\n      :(p!==p1||ch!==ch1||ex!==ex1)?<h5>{date(x.ts)} {title(p,stats)} <Exercise pkey={x.key} stats={stats}/></h5>:null}\r\n      {qn&&type!=='vars'&&(p!==p1||ch!==ch1||ex!==ex1||qn!==qn1||c!==x.c)?<div>{date(x.ts)} Q {qQp(x.key,stats)} <span className={totalColour(mk,mks)}>({mk}/{mks})</span> {qMsEr(x.key,stats)} {rating(stats.t.qs[x.key])} <Cs qkey={x.key} stats={stats}/> <AskTutor qkey={x.key} stats={stats}/> {x.c?x.c:null}</div>:null}\r\n      {qn&&type==='vars'?<Adaptive x={x} stats={stats}/>:null}\r\n      </div>)\r\n    p1=p;ch1=ch;ex1=ex;qn1=qn;c=x.c\r\n    return ret\r\n  })\r\n  return detail\r\n}\r\n\r\nclass AskTutor extends Component {\r\n  state={contact:false}\r\n  render() {\r\n    //console.log('AskTutor',this.props.stats)\r\n    if (this.state.contact) {\r\n      //console.log('AskTutor',this.props.stats,window.FreeMaths.state)\r\n      let text=''\r\n      let uid=this.props.uid?this.props.uid:null\r\n      if (this.props.c) text=this.props.c+'\\n'\r\n      if (this.props.stats) {\r\n        if (this.props.stats.uid*1!==window.FreeMaths.state.user.id*1) uid=this.props.stats.uid\r\n        if (this.props.qkey) this.props.stats.t.qs[this.props.qkey].c.forEach(s=>{text+=s.c+'\\n'})\r\n      }\r\n      return <Contact text={text} uid={uid} fm={window.FreeMaths} qkey={this.props.qkey} close={()=>this.setState({contact:false})}/>\r\n    }\r\n    else return <TooltipHover tooltip=\"Ask FreeMaths.uk\" placement=\"bottom\"><i className=\"btn btn-default btn-sm fa fa-envelope-o blue\" onClick={()=>this.setState({contact:true})}></i></TooltipHover>\r\n  }\r\n}\r\n\r\nclass Cs extends Component {\r\n  render() {\r\n    let cs=this.props.stats.t.qs[this.props.qkey].c\r\n    if (cs.length === 0) return null\r\n    let i=0;\r\n    let tip=cs.sort((x,y)=>{return y.ts-x.ts}).map((c)=>{return <div key={i++} style={{textAlign:'left'}}>{date(c.ts)} <span style={{textAlign:'left'}} className={rag[c.f]}><Maths>{c.c}</Maths></span></div>})\r\n    return <TooltipHover tooltip={tip} placement=\"bottom\"><i className=\"fa fa-comments\" aria-hidden=\"true\"></i></TooltipHover>\r\n  }\r\n}\r\n\r\nclass QuestionAttempts extends Component {\r\n  state={ts:null}\r\n  s(s) {\r\n    let ret=[s]\r\n    Object.keys(this.props.stats.ts[s.key].qs).forEach(k=>{\r\n      if (this.props.stats.ts[s.key].qs[k].rs[s.uid]) this.props.stats.ts[s.key].qs[k].rs[s.uid].filter(r=>{return test(s.key).type==='vars'?s.ts-r.ts<3600:r.ts===s.ts}).forEach(r=>{ret.push({ts:r.ts,mk:r.mk,key:k})})\r\n    })\r\n    //console.log(\"s\",s,ret)\r\n    return ret\r\n  }\r\n  render() {\r\n    if (!this.props.s) return null\r\n    //console.log(\"QuestionAttempts\",this.props.s,this.props.stats)\r\n    let corrections=null\r\n    if (this.props.s[0].key.indexOf(':')===-1) corrections=this.props.s.map(x=>{return x.ts&&x.ts===this.state.ts?log(this.s(x),this.props.stats,()=>this.setState({ts:null})):log([x],this.props.stats,()=>this.setState({ts:x.ts}))})\r\n    else corrections=log(this.props.s,this.props.stats)\r\n    return <ModalBox close={()=>this.props.setS(null)} title=\"Corrections\">{corrections}</ModalBox>\r\n  }\r\n}\r\n\r\nclass Adaptive extends Component {\r\n  state={expand:false}\r\n  topic(q) {\r\n    if (!q.topics) return null\r\n    let t = q.topics.split(',')[0]\r\n    return UC1(t.substr(0,t.length-1))+' level '+t.substr(t.length-1,1)\r\n  }\r\n  render() {\r\n    if (this.props.x===null) return null\r\n    //console.log(this.props.s,this.props.stats)\r\n    let x=this.props.x\r\n    let [,,,qn]=x.key.split(':')\r\n      //TODO repair old tests - used to be test.qs[qn-1]\r\n    let q=window.FreeMaths.state.data.tests.questions[qn]\r\n    if (!q) {\r\n      console.error('Adaptive',x,qn)\r\n      return null\r\n    }\r\n    let vars=x.v?JSON.parse(x.v):null\r\n    let mark=x.a?checkAnswer(x.a,q.answer,vars):null;\r\n    return <div>\r\n      <div>{date(x.ts)} <span className=\"btn-link\" onClick={()=>this.setState({expand:!this.state.expand})}>Q {qn}</span> {this.topic(q)} <Mark  mark={mark}/> {rating(this.props.stats.t.qs[x.key])} <Cs qkey={x.key} stats={this.props.stats}/> <AskTutor qkey={x.key} stats={this.props.stats}/> {x.c?x.c:null}</div>\r\n      {this.state.expand&&x.v?<div><Maths vars={vars}>{q.question}</Maths></div>:null}\r\n      {this.state.expand&&x.a?<div><Answer noBox={true} answer={x.a} vars={vars} mark={mark} keyboard={false}/></div>:null}\r\n    </div>\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\nclass Comments extends Component {\r\n  render() {\r\n    if (this.props.cs===null) return null\r\n    /*console.log('Contact',this.props.s,this.props.stats)\r\n    let i=0\r\n    let tip=this.props.cs.sort((x,y)=>{return y.ts-x.ts}).map((c)=>{return <div key={i++} style={{textAlign:'left'}}>{date(c.ts)} {title(c.qkey,this.props.stats,true)}<br/><span style={{textAlign:'left'}} className={rag[c.f]}><Maths>{c.c}</Maths></span></div>})\r\n    */\r\n    return <ModalBox close={()=>this.props.setS(null,true)} title={\"Comments\"}>{log(this.props.cs,this.props.stats)}</ModalBox>\r\n  }\r\n}\r\n\r\nfunction tdRAG(stat,item,type)\r\n{\r\n  //console.log(\"tdRAG stat[e][%s]=%s\",item,JSON.stringify(stat['e'][item]))\r\n  if (typeof stat['e'][item] === 'undefined') return <td></td>\r\n  var color = type === 'm'?{'✓':'green','?✓':'amber','✗':'red'}:{':)':'green',':|':'amber',':(':'red'}\r\n  var num = stat['e'][item].length\r\n  var tt=false,i=0\r\n  if (num > 0) var tooltip=stat['e'][item].map((e)=>{if (typeof e.comment !== 'undefined' && e.comment.length>0) {tt=true;return <div className={color[item]} style={{textAlign:'left'}} key={i++}>{e.comment}</div>} else return null});\r\n  if (num === 0) num = ''\r\n  if (tt)\r\n  {\r\n    if (type === 's') num=<u>{num}</u> // flag that has comment\r\n    if (item === stat[type]) return <td><TooltipHover className={color[item]} tooltip={tooltip}>{num}</TooltipHover></td>\r\n    else return <td><TooltipHover tooltip={tooltip}>{num}</TooltipHover></td>\r\n  }\r\n  else {\r\n    if (item === stat[type]) return <td className={color[item]}>{num}</td>\r\n    else return <td>{num}</td>\r\n  }\r\n}\r\n\r\nclass Stats extends Component {\r\n  render() {\r\n    var s = paper_stats(this.props.stats)\r\n    var rows = []\r\n    for (var q=0; q<s.length; q++)\r\n    {\r\n      var c = 'amber';\r\n      if (typeof s[q] !== 'undefined')\r\n      {\r\n        s[q]['e']=s[q] // compatibility\r\n        if (s[q]['m'] === '✗' || s[q]['s'] === ':(') c = 'red'\r\n        else if (s[q]['m'] === '✓' && s[q]['s'] === ':)') c = 'green'\r\n        rows.push(<tr key={q}>\r\n          <td><TooltipHover tooltip={<Maths vars={s[q]['vars']}>{this.props.questions[q]['question']}</Maths>}>{q+1}</TooltipHover></td>\r\n          <td className={c}><Maths>{this.props.questions[q]['topic'].split(',')[0]}</Maths></td><td>{hms(s[q]['t'])}</td>\r\n          {tdRAG(s[q],'✓','m')}\r\n          {tdRAG(s[q],'?✓','m')}\r\n          {tdRAG(s[q],'✗','m')}\r\n          {tdRAG(s[q],':)','s')}\r\n          {tdRAG(s[q],':|','s')}\r\n          {tdRAG(s[q],':(','s')}\r\n          <td><TooltipHover tooltip={<Maths vars={s[q]['vars']}>{this.props.questions[q]['help']}</Maths>}> {s[q]['Hint']}</TooltipHover></td>\r\n          <td><TooltipHover tooltip={<Maths vars={s[q]['vars']}>{this.props.questions[q]['working']}</Maths>}> {s[q]['Show']}</TooltipHover></td></tr>\r\n        )\r\n      }\r\n    }\r\n    return(<table className=\"table table-bordered table-condensed table-striped\" style={{width: 'auto'}}>\r\n    <thead><tr><th>Q</th><th>Topic</th><th>Effort</th><th className=\"green\">✓</th><th className=\"amber\">✓</th><th className=\"red\">✗</th>\r\n    <th className=\"green\">:)</th><th className=\"amber\">:|</th><th className=\"red\"><nobr>:(</nobr></th>\r\n    <th>Hint</th><th>Show</th></tr></thead>\r\n    <tbody>{rows}</tbody>\r\n    </table>)\r\n  }\r\n}\r\n\r\nexport {Stats,QuestionAttempts,THs,TH0s,TDs,TD0s,tipN,Comments,totalColour,sym,smiley,mark,AskTutor}\r\n","/**\r\n* This file provided by FreeMaths is for non-commercial testing and evaluation\r\n* purposes only. FreeMaths reserves all rights not expressly granted.\r\n*\r\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\r\n* FreeMaths BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN\r\n* ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\r\n* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n*/\r\nimport React, { Component } from 'react'\r\nimport {setVariables,setUse} from './vars'\r\nimport {Help,JsonHelp} from './Help'\r\nimport Keyboard from './Keyboard'\r\nimport {checkAnswer} from './mark'\r\nimport {Maths} from './ReactMaths'\r\nimport {EditQuestion} from './EditQuestion'\r\nimport EditQuestions from './EditQuestions'\r\nimport {sym,TH0s,TD0s,smiley,mark,AskTutor} from './StatsUI'\r\n// import {Marks} from './PastPaper' - was used for self marking\r\nimport {TooltipHover,TooltipButton,ModalBox,isset,empty,UC1,copy,test,question,debug} from './Utils'\r\nimport {Form} from 'react-bootstrap';\r\n\r\nclass LevelSummary extends Component {\r\n  render()\r\n  {\r\n    //console.log(\"LevelSummary\",this.props.stats)\r\n    //var rows=Object.keys(this.props.stats).map(topic=>{\r\n      //if (this.props.stats[topic].level === null) return null\r\n    var rows=['negatives','fractions','algebra','powers','surds','quadratics'].map(topic=>{\r\n      let tds=this.props.stats[topic]?TD0s(this.props.stats[topic],this.props.setQs):[<td key='1'></td>,<td key='2'></td>,<td key='3'></td>,<td key='4'></td>,<td key='5'></td>,<td key='6'></td>]\r\n      return (<tr key={topic}><td><span className=\"btn-link\" onClick={()=>this.props.setTest(topic)}>{UC1(topic)}</span></td><td className='tdcenter'>{this.props.stats[topic]?this.props.stats[topic].level:''}</td>{tds}</tr>) // only summary\r\n    })\r\n    return (<div name=\"topics\"><h3>Topic Summary</h3>\r\n    <table className=\"table table-bordered table-condensed table-striped width-auto\">\r\n    <thead><tr><th>Topic</th><th>level</th>{TH0s()}</tr></thead>\r\n    <tbody>{rows}</tbody>\r\n    </table></div>)\r\n  }\r\n}\r\n\r\nclass AutoTest extends Component {\r\n  state = {correct:null, log:null, tid:null, qid:null, vars:null, tree:null, topic:null, last_log:null, edit:false, qs:null, i:0}\r\n  componentDidMount() {\r\n    let log=this.filterLog(this.props.fm.state.user.log)\r\n    let tree=this.buildTree()\r\n    this.setState({tid:this.props.tid,qid:this.props.qid,vars:this.props.vars,log:log,tree:tree,last_log:this.props.fm.state.user.log.length>0?this.props.fm.state.user.log[this.props.fm.state.user.log.length-1].id:0})\r\n  }\r\n  shouldComponentUpdate(p, s) {\r\n    let ret= p.fm.state.data.savedQ || s.last_log!==this.state.last_log || s.retry!==this.state.retry || s.correct!==this.state.correct || s.qid!==this.state.qid || s.vars !== this.state.vars || s.edit!==this.state.edit\r\n    //console.log(\"AutoTest shouldComponentUpdate\",ret,s,this.state)\r\n    return ret\r\n  }\r\n  componentWillReceiveProps(p)\r\n  {\r\n    //console.log('componentWillReceiveProps',p,this.state)\r\n    if (p.reset) this.setState({log:null})\r\n    else if (!this.state.log) {\r\n      let log=this.filterLog(p.fm.state.user.log)\r\n      let tree=this.buildTree()\r\n      this.setState({log:log,tree:tree,last_log:this.props.fm.state.user.log.length>0?this.props.fm.state.user.log[this.props.fm.state.user.log.length-1].id:0})\r\n    }\r\n    else if (p.fm.state.reload) {\r\n      let log=this.filterLog(p.fm.state.user.log)\r\n      let tree=this.buildTree()\r\n      this.setState({log:log,tree:tree}) //,edit:p.fm.state.data.savedQid===this.state.qid})\r\n      p.fm.setState({reload:false})\r\n    }\r\n    else if (p.fm.state.user.log.length>0 && p.fm.state.user.log[p.fm.state.user.log.length-1].id !== this.state.last_log) this.setState({log:this.updateLog(p.fm.state.user.log), last_log: p.fm.state.user.log[p.fm.state.user.log.length-1].id})\r\n  }\r\n  setQs=(s)=>{\r\n    let qs=Object.keys(s)\r\n    if (debug('setQs')) console.log(\"setQs(s) qs\",s,qs)\r\n    this.setState({qid:qs[0],vars:JSON.parse(s[qs[0]].variables),i:1,qs:copy(s)})\r\n    this.logEvent('Q')\r\n    //console.log(\"setQs\",s,qs,qs[0],JSON.parse(s[qs[0]].variables))\r\n  }\r\n  setTest=(topic)=>{\r\n    const ts=this.props.fm.state.data.tests.tests\r\n    let tid=null,qid=null,vars=null\r\n    Object.keys(ts).forEach(k=>{if (ts[k].title.endsWith(UC1(topic))) tid=k})\r\n    if (tid) {\r\n      qid=ts[tid].qs[1].qid\r\n      vars=setVariables(question(qid).variables,this.state.log[qid])\r\n    }\r\n    this.setState({qid:qid,vars:vars,tid:tid,topic:topic,correct:null})\r\n    //console.log(\"setTest\",topic,ts,t,q)\r\n  }\r\n  setTopic=(topic)=>{\r\n    let qid=null\r\n    topic=this.state.tree.topics[topic]?topic:null\r\n    let level=this.state.log.stats[topic]?this.state.log.stats[topic].level:null\r\n    if (topic) qid=this.chooseQ(this.topicOptions(topic,level))\r\n    else qid=this.setQ()\r\n    let vars=setVariables(question(qid).variables,this.state.log[qid])\r\n    this.setState({qid:qid,vars:vars,topic:topic})\r\n    //console.log(\"setTopic\",topic,this.state.log.stats[topic].level,q)\r\n  }\r\n  maxLevel() {\r\n    let level=3\r\n    if (this.state.log.stats) Object.keys(this.state.log.stats).forEach(topic=>{\r\n      if (this.state.log.stats[topic].level>level) level=this.state.log.stats[topic].level\r\n    })\r\n    return level\r\n  }\r\n  buildTree()\r\n  {\r\n    let tree={topics:{},levels:{}}\r\n    Object.keys(this.props.fm.state.data.tests.questions).forEach(qid=>{\r\n        this.questionTopics(qid).forEach(tl=>{\r\n          // will cope with 0-9 can move into A-Z or test pervious digit to make split more sophiticated\r\n          let topic=tl.topic\r\n          let level=tl.level\r\n          if (!isset(tree.topics[topic])) tree.topics[topic]={}\r\n          if (!isset(tree.levels[level])) tree.levels[level]={}\r\n          if (!isset(tree.topics[topic][level])) tree.topics[topic][level]=[qid]\r\n          else tree.topics[topic][level].push(qid)\r\n          if (!isset(tree.levels[level][topic])) tree.levels[level][topic]=[qid]\r\n          else tree.levels[level][topic].push(qid)\r\n        })\r\n    })\r\n    //console.log(\"AutoTest buildTree\",tree)\r\n    return tree\r\n  }\r\n  updateStats(l,s,latest)\r\n  {\r\n    //if (latest) console.log('updateStats',l,s)\r\n    let stats=s\r\n    this.questionTopics(l.question).forEach(tl=>{\r\n      if (!isset(stats[tl.topic])) stats[tl.topic]={level:null,':(':{},':|':{},':)':{},'✗':{},'?✓':{},'✓':{},f:{},m:{}}\r\n      if (smiley[l.event] && (!stats[tl.topic].f[l.question] || latest)){\r\n        if (stats[tl.topic].f[l.question] && stats[tl.topic][stats[tl.topic].f[l.question]][l.question]) delete stats[tl.topic][stats[tl.topic].f[l.question]][l.question]\r\n        stats[tl.topic][l.event][l.question]=l\r\n        stats[tl.topic].f[l.question]=l.event\r\n      }\r\n      if (mark[l.event] && (!stats[tl.topic].m[l.question] || latest)){\r\n        if (stats[tl.topic].m[l.question]) delete stats[tl.topic][stats[tl.topic].m[l.question]][l.question]\r\n        stats[tl.topic][l.event][l.question]=l\r\n        stats[tl.topic].m[l.question]=l.event\r\n      }\r\n      if (l.event === '✓') {\r\n        if (tl.level>stats[tl.topic].level) stats[tl.topic].level=tl.level\r\n        if (stats[tl.topic].f[l.question] && stats[tl.topic][stats[tl.topic].f[l.question]][l.question]) delete stats[tl.topic][stats[tl.topic].f[l.question]][l.question]\r\n        stats[tl.topic].f[l.question]=':)'\r\n      }\r\n    })\r\n    return stats\r\n  }\r\n  corrections(stats)\r\n  {\r\n    let corrections={}\r\n    Object.keys(stats).forEach(tid=>['✗','?✓',':(',':|'].forEach(e=>{\r\n      Object.keys(stats[tid][e]).forEach(qid=>{if (!corrections[qid]) corrections[qid]=stats[tid][e][qid]})\r\n    }))\r\n    if (Object.keys(corrections).length===0) corrections=null\r\n    return corrections\r\n  }\r\n  updateLog(log) {\r\n    //TODO - refactor - is this now needed?\r\n    //console.log('updateLog',log,this.state.log)\r\n    let ret=this.state.log\r\n    let l=log[log.length-1]\r\n    let ts=new Date(l.created_at?l.created_at.replace(' ', 'T'):null).getTime()\r\n    if (!ret[l.question]) ret[l.question]={use:[],skip:[],ts:ts}\r\n    else ret[l.question].ts=ts\r\n    if (!ret[l.question].skip.includes(l.variables)) ret[l.question].skip.push(l.variables)\r\n    if (ret[l.question].use.includes(l.variables)) ret[l.question].use.splice(ret[l.question].use.indexOf(l.variables),1)\r\n    ret.stats=this.updateStats(l,ret.stats,true)\r\n    ret.corrections=this.corrections(ret.stats)\r\n    return ret\r\n  }\r\n  filterLog(log)\r\n  {\r\n    //TODO remove session\r\n    let ret={session:[],stats:{},corrections:null}\r\n    let qs=this.props.fm.state.data.tests.questions\r\n    for (var i=log.length-1;i>0;i--)\r\n    {\r\n      let l=log[i]\r\n      if (isset(qs[l.question]) && isset(qs[l.question].topics) && l.variables.length>0 && l.variables.indexOf('$') === -1) // data cleanse\r\n      {\r\n        let ts=new Date(l.created_at.replace(' ', 'T')).getTime()\r\n        let today=(Date.now()-ts<1000*60*60*24)\r\n        if (!ret[l.question]) ret[l.question]={use:[],skip:[],ts:ts}\r\n        if (!ret[l.question].skip.includes(l.variables) && !ret[l.question].use.includes(l.variables))\r\n        {\r\n          if (today || l.event === '✓') ret[l.question].skip.push(l.variables)\r\n          else if (l.event === '✗') ret[l.question].use.push(l.variables)\r\n        }\r\n        ret.stats=this.updateStats(l,ret.stats)\r\n      }\r\n    }\r\n    ret.corrections=this.corrections(ret.stats)\r\n    //console.log(\"AutoTest filterLog\",ret,log)\r\n    return ret\r\n  }\r\n  setQ(set,qid) {\r\n    qid=qid?qid:null\r\n    let qs=this.props.fm.state.data.tests.questions\r\n    let lq=Object.keys(this.state.log)\r\n    let i=0\r\n    while (qid===null && i<qs.length){\r\n      if (isset(this.state.log[lq[i]].use) && isset(qs[lq[i]].topics) && setUse(qs[lq[i]].variables,this.state.log[lq[i]])) qid=lq[i]\r\n      else i++\r\n    }\r\n    if (qid===null) qid=this.chooseQ(this.levelOptions(null,this.maxLevel()))\r\n    if (debug('setQ')) console.log(\"setQ(set,qid)\",set,qid)\r\n    if (set) this.setState({qid:qid,vars:setVariables(question(qid).variables,this.state.log[qid]),correct:null})\r\n    else return qid\r\n  }\r\n  logEvent=(event,answer,comment)=> {\r\n    //console.log(\"Test logEvent\",event,vars,answer,comment,this.state.correct);\r\n    if (!this.state.correct && (event==='✓' || event==='?✓')) {\r\n      this.setState({correct:event})\r\n      if (event==='✓') setTimeout(()=>this.nextQ(':)'),1000)\r\n    }\r\n    else if (event==='✗' || event==='?✗' || event===\"Show\") this.setState({correct:false})\r\n    this.props.fm.updateLog({paper: this.state.tid?this.state.tid:0, question:this.state.qid, event:event, vars:this.state.vars, answer:answer, comment:comment},()=>{if (event.startsWith(\":\")) this.nextQ(event)})\r\n  }\r\n  chooseQ(options) {\r\n    // gradually make more sophisticated\r\n    let qid=null,i=0\r\n    while (qid===null && i<options.length)\r\n    {\r\n      if (isset(this.state.log[options[i]]) && !empty(this.state.log[options[i]].skip)) i++\r\n      else qid=options[i]\r\n    }\r\n    if (qid===null && options.length>0) qid=options[0] // all skip so take oldest\r\n    //console.log(\"AutoTest chooseQ\",q,options,options.map(q=>{return this.state.log[q]?this.state.log[q].ts:0}))\r\n    return qid\r\n  }\r\n  topicOptions(topic,level)\r\n  {\r\n    let options=[]\r\n    if (this.state.tree.topics[topic]) {\r\n      if (this.state.tree.topics[topic][level]) this.state.tree.topics[topic][level].forEach(qid=>{if (!options.includes(qid)) options.push(qid)})\r\n      else Object.keys(this.state.tree.topics[topic]).forEach(l=>this.state.tree.topics[topic][l].forEach(qid=>{if (!options.includes(qid)) options.push(qid)}))\r\n      options.sort((a,b)=>{return this.state.log[a]?this.state.log[b]?this.state.log[a].ts-this.state.log[b].ts:1:-1})\r\n    }\r\n    //console.log(\"topicOptions\",options)\r\n    return options\r\n  }\r\n  levelOptions(topic,level)\r\n  {\r\n    let options = []\r\n    if (isset(this.state.tree.levels[level])) Object.keys(this.state.tree.levels[level]).forEach(tp=>{if (tp!==topic) this.state.tree.levels[level][tp].forEach(qid=>{if (!options.includes(qid)) options.push(qid)})})\r\n    //console.log(\"levelOptions\",options,this.state)\r\n    return options\r\n  }\r\n  questionTopic(qid)\r\n  {\r\n    let topic=this.questionTopics(qid)[0]?this.questionTopics(qid)[0].topic:null\r\n    // console.log(\"questionTopic\",q,topic)\r\n    return topic\r\n  }\r\n  questionSelect(qid)\r\n  {\r\n    if (this.state.correct!==null && this.state.correct!=='✓') return <Rate logEvent={this.logEvent}/>\r\n    else if (this.state.tid) return (<span>\r\n      <QuestionSelect tid={this.state.tid} qid={this.state.qid} selectQ={(qid)=>this.setQ(true,qid)}/>\r\n      <button className='btn btn-link' onClick={()=>this.setQ(true,this.state.qid)}><i className=\"fa fa-btn fa-random\"></i></button>\r\n      </span>)\r\n    let qt=this.questionTopics(qid)[0]?this.questionTopics(qid)[0]:{topic:'',level:0}\r\n    return (<span>\r\n    <TopicSelect tree={this.state.tree} topic={qt.topic} setTopic={this.setTopic}/>\r\n    {this.level(qt.level-1)?<button className=\"btn btn-link\" onClick={()=>this.nextQ('-')}><i className=\"fa fa-btn fa-minus-circle\"></i></button>:null}\r\n    level {qt.level}\r\n    {this.level(qt.level+1)?<button className=\"btn btn-link\" onClick={()=>this.nextQ('+')}><i className=\"fa fa-btn fa-plus-circle\"></i></button>:null}\r\n    <button className='btn btn-link' onClick={()=>this.nextQ()}><i className=\"fa fa-btn fa-random\"></i></button>\r\n    </span>)\r\n  }\r\n  questionTopics(qid)\r\n  {\r\n    const qs=this.props.fm.state.data.tests.questions\r\n    qid=qid?qid:this.state.qid\r\n    if (qid && !qs[qid]) {console.error('questionTopics',qid);return []}\r\n    if (qid===null || !qs[qid].topics) return []\r\n    let topic = qs[qid].topics.split(',')[0]\r\n    return [{topic:topic.substr(0,topic.length-1),level:topic.substr(topic.length-1,1)*1}] // only first for now\r\n    /*\r\n    let topics = this.state.qs[q].topics.split(',')\r\n    return topics.map(t=>{\r\n      return {topic:t.substr(0,t.length-1),level:t.substr(t.length-1,1)*1}\r\n    })*/\r\n  }\r\n  level(level)\r\n  {\r\n    if (this.state.topic===null) return isset(this.state.tree.levels[level])\r\n    else return isset(this.state.tree.topics[this.state.topic][level])\r\n  }\r\n  questionOptions(smiley) {\r\n    let options=[]\r\n      let tl=this.questionTopics()[0]\r\n      let topic=tl.topic\r\n      let level=tl.level\r\n      if (smiley===':)' && this.state.correct && this.level(level+1)) level++;\r\n      else if (smiley==='+' && this.level(level+1))  level++;\r\n      else if ((smiley===':(' || smiley==='-')  && this.level(level-1)) level--;\r\n      if (this.state.correct && this.state.topic===null) options= this.levelOptions(topic,level)\r\n      else options = this.topicOptions(topic,level)\r\n      if (options.length === 0) options=this.levelOptions(null,level) // when +- level for test\r\n    return options\r\n  }\r\n  setVars(qid) {\r\n    qid=qid?qid:this.state.qid\r\n    return setVariables(question(qid).variables,this.state.log[qid])\r\n  }\r\n  nextQ(smiley){\r\n    if (this.state.tid) {\r\n      if (!this.state.correct || (smiley === ':|' || smiley === ':(')) this.setState({vars:this.setVars(), correct:null})\r\n      else {\r\n        const t=test(this.state.tid)\r\n        // eslint-disable-next-line\r\n        let qn=t.qs.find(v=>{return v&&v.qid==this.state.qid}).qn\r\n        let qid=t.qs[qn+1]?t.qs[qn+1].qid:null\r\n        this.setState({qid:qid,tid:qid?this.state.tid:null,vars:qid?this.setVars(qid):null,correct:null})\r\n      }\r\n    }\r\n    else if (!this.state.correct && (smiley === ':|' || smiley === ':)')) this.setState({vars:this.setVars(),correct:null})\r\n    else if (this.state.i) {\r\n      //console.log(\"nextQ\",this.state.qs,this.state.i)\r\n      let qs=Object.keys(this.state.qs)\r\n      if (this.state.i >= qs.length) this.setState({qid:null,vars:null,qs:null,i:0,correct:null,retry:0})\r\n      else this.setState({qid:qs[this.state.i],vars:JSON.parse(this.state.qs[qs[this.state.i]].variables),i:this.state.i+1,retry:0,correct:null})\r\n    }\r\n    else\r\n    {\r\n      let qid=this.chooseQ(this.questionOptions(smiley))\r\n      if (qid!==this.state.qid) this.setState({qid:qid, correct:null, vars:this.setVars(qid)})\r\n      else this.setState({correct:null, vars:this.setVars()})\r\n    }\r\n  }\r\n  render() {\r\n    //console.log(\"AutoTest render\",this.state.t,this.state.q,this.state.qs)\r\n    if (!this.state.tree) return null\r\n    if (!this.state.qid) // && this.state.q >= this.state.t.test.qs.length)\r\n    {\r\n      return (<div>\r\n        {this.props.fm.state.user.isAdmin?<EditQuestions tree={this.state.tree} fm={this.props.fm} setQ={(qid,e)=>this.setState({qid:qid,edit:e})}/>:null}\r\n        {this.state.log.corrections?<TooltipButton className=\"btn btn-danger\" tooltip=\"Correct first\" onClick={()=>this.setQs(this.state.log.corrections)}>Corrections</TooltipButton>:null}\r\n        <TooltipButton className=\"btn btn-primary\" tooltip=\"Adaptive test and learn\" onClick={()=>this.setQ(true)}>Test</TooltipButton>\r\n        &nbsp;<Maths>@instructions__home</Maths>\r\n      {this.state.log===null?null:<LevelSummary setQs={this.setQs} setTest={this.setTest} stats={this.state.log.stats}/>}\r\n        </div>)\r\n    }\r\n    else {\r\n      if (this.state.edit===true) return <EditQuestion fm={this.props.fm} qid={this.state.qid} vars={this.state.vars} close={()=>this.setState({edit:false})}/>\r\n      else return (<ModalBox name=\"question\" close={()=>this.setState({tid:null,qid:null,vars:null,qs:{},topic:null,correct:null})} title={<span>{this.questionSelect(this.state.q)}<span style={{float:'right'}}><AskTutor c='' qkey={(this.state.tid?this.state.tid:0)+':::'+this.state.qid}/>&nbsp;&nbsp;</span></span>}>\r\n        <div>See <Maths>{'@'+this.questionTopic(this.state.qid)}</Maths><br/>\r\n        {this.props.fm.state.user.isAdmin?<TooltipHover tooltip={this.state.qid}><button className='btn btn-link' style={{float: 'right'}}><i className=\"fa fa-btn fa-edit\" onClick={()=>this.setState({edit: true})}></i></button></TooltipHover>:null}\r\n        <Question qid={this.state.qid} vars={this.state.vars} logEvent={this.logEvent}/>\r\n        </div></ModalBox>)\r\n    }\r\n  }\r\n}\r\n\r\nclass Question extends Component {\r\n  state={help: false, working: false, correct:null}\r\n  componentWillReceiveProps(p) {\r\n    if (p.qid!==this.props.qid || p.vars!==this.props.vars) {\r\n      this.setState({help: false, working: false, correct:null})\r\n      if (p.qid) p.logEvent('Q')\r\n    }\r\n  }\r\n  componentDidMount() {\r\n    if (this.props.qid) this.props.logEvent('Q')\r\n  }\r\n  render() {\r\n    let q=window.FreeMaths.state.data.tests.questions[this.props.qid]\r\n    return (<div id={\"Question_\"+this.props.qid}>\r\n    <div className=\"PQ\"><Maths vars={this.props.vars}>{q.question}</Maths></div>\r\n    <AnswerBlock qid={this.props.qid} vars={this.props.vars} logEvent={this.props.logEvent}/>\r\n    </div>)\r\n  }\r\n}\r\n\r\nclass AnswerBlock extends Component {\r\n  state={answer:'', hint:false, show:false, mark:null}\r\n  componentWillReceiveProps(p)\r\n  {\r\n    if (p.qid!==this.props.qid || p.vars!==this.props.vars) this.setState({answer:'', hint:false, show:false, mark:null}); // revised question\r\n  }\r\n  hintShow=(type,e)=> {\r\n    e.currentTarget.blur()\r\n    if (type === 'hint')\r\n    {\r\n      this.props.logEvent(\"Hint\");\r\n      this.setState({keyboard: false, hint: true});\r\n    }\r\n    else if (type === 'show')\r\n    {\r\n      this.props.logEvent(\"Show\");\r\n      this.setState({keyboard: false, hint: true, show: true});\r\n    }\r\n  }\r\n  mark=()=> {\r\n    let answer=window.FreeMaths.state.data.tests.questions[this.props.qid].answer\r\n    if (this.state.answer.length > 0)\r\n    {\r\n      var mark = checkAnswer(this.state.answer,answer,this.props.vars);\r\n      this.props.logEvent(mark.correct,this.state.answer);\r\n      this.setState({mark: mark});\r\n    }\r\n    else this.setState({mark: null});\r\n  }\r\n  logmark=(i,t,m)=>{\r\n    this.props.log('M',m)\r\n    this.setState({mark:{correct:'?✓',m:m}})\r\n  }\r\n  log=(event,vars,answer,comment)=>{\r\n    this.props.logEvent(event,answer,comment)\r\n  }\r\n  render() {\r\n    let hide=this.state.mark&&this.state.mark.correct==='✓'\r\n    return (\r\n    <div>\r\n    {hide?null:<HintShowButtons hint={this.state.hint} show={this.state.show} hintShow={this.hintShow} mark={this.state.mark} change={this.props.change}/>}\r\n    <Answer answer={this.state.answer} mark={this.state.mark} vars={this.props.vars}/>\r\n    {hide?null:<div>\r\n      {this.state.show?null:<Keyboard answer={this.state.answer} mark={this.mark} change={(a)=>this.setState({answer:a})} qid={this.props.qid} vars={this.props.vars}/>}\r\n      <HintShow qid={this.props.qid} vars={this.props.vars} hint={this.state.hint} show={this.state.show}/>\r\n    </div>}\r\n    </div>\r\n    )\r\n  }\r\n}\r\n\r\nclass Mark extends Component {\r\n  render() {\r\n    if (this.props.mark === null) return null;\r\n    else if (this.props.mark.correct === '✓') return <span className=\"green\">✓</span>;\r\n    else if (this.props.mark.correct === '?✓') return <span className=\"amber\">✓</span>;\r\n    else if (this.props.mark.correct === '?✗') return <span className=\"amber\">✗</span>;\r\n    else  return <span className=\"red\">✗</span>;\r\n  }\r\n}\r\n\r\nclass MarkHelp extends Component {\r\n  state={help:false}\r\n  render() {\r\n    if (!this.props.mark) return null // should never be the case\r\n    let colour=\"amber\"\r\n    if (this.props.mark.correct === '✓') colour = \"green\"\r\n    else if (this.props.mark.correct === '✗') colour = \"red\"\r\n\r\n    if (!this.state.help) return <TooltipButton className={\"btn btn-default btn-sm \"+colour} onClick={()=>this.setState({help:true})} tooltip=\"marking help\">?</TooltipButton>\r\n    else {\r\n      let help=\"Freemaths does its best to check your answer (re-arranging as needed).\\n\"\r\n        +\"<g>✓</g> means your answer matched.\\n\"\r\n        //+\"<o>✓</o> means your answer is probably correct but was not exactly as expected.\\n\"\r\n        +\"<o>✓</o> means your answer is numerically correct but not as expected, can you simplify?\\n\"\r\n        +\"<r>✗</r> means our tests suggest your answer is wrong (but the tests aren't perfect).\\n\"\r\n      if (this.props.mark.correct !== '✓')\r\n      {\r\n        help+= \"\\nHave you have provided the answer in exactly the format requested?\\n\"\r\n          +\"<g>Green</g> terms are in the expected answer. <o>Amber</o> terms have a sign error. Check other terms carefully for calculation errors.\"\r\n        help+=\"\\n\\nUse <r>Show</r> to see a model answer and working.\"\r\n      }\r\n      else help+=\"\\nUse <g>Show</g> to see a model answer and working.\"\r\n      return <Help title=\"Marking Help\" help={help} close={()=>this.setState({help:false})}/>\r\n    }\r\n  }\r\n}\r\n\r\nclass HintShowButtons extends Component {\r\n  render() {\r\n    var hint = this.props.hint || (this.props.mark !== null && this.props.mark.correct === '✓');\r\n    var colour = (this.props.mark === null)?'red':((this.props.mark.correct === '✓')?'green':'red');\r\n    return (<span>\r\n      {hint?null:<TooltipButton className=\"btn btn-default amber\" onClick={(e)=>this.props.hintShow(\"hint\",e)} tooltip=\"show hint\">Hint</TooltipButton>}\r\n      {this.props.show?null:<TooltipButton className={\"btn btn-default \"+colour} onClick={(e)=>this.props.hintShow(\"show\",e)}  tooltip=\"show answer\">Show</TooltipButton>}\r\n      </span>);\r\n  }\r\n}\r\n\r\nclass HintShow extends Component {\r\n  render() {\r\n    return (<div>\r\n      {this.props.show?<div name=\"show\" className=\"box\"><Maths vars={this.props.vars}>{question(this.props.qid).working}</Maths></div>:null}\r\n      {this.props.show&&this.props.hint?<br />:null}\r\n      {this.props.hint?<div name=\"hint\" className=\"box\"><Maths vars={this.props.vars}>{question(this.props.qid).help}</Maths></div>:null}\r\n      </div>)\r\n  }\r\n}\r\n\r\nclass Rate extends Component {\r\n  state = {help: false}\r\n  render() {\r\n    var help = null\r\n    if (this.state.help) help = <JsonHelp topic=\"rating\" close={()=>this.setState({help:false})}/>\r\n    else return (\r\n      <div name='rate'><TooltipButton id=\"rate\" tooltip=\"rate to move on\" onClick={()=>this.setState({help:true})}>Rate:</TooltipButton>\r\n      <TooltipButton id=\"FG\" value=\":)\" className=\"btn btn-default green\" tooltip=\"understood\" onClick={()=>this.props.logEvent(':)')}>{sym[':)']}</TooltipButton>\r\n      <TooltipButton id=\"FA\" value=\":|\" className=\"btn btn-default amber\" tooltip=\"practice needed\" onClick={()=>this.props.logEvent(':)')}>{sym[':|']}</TooltipButton>\r\n      <TooltipButton id=\"FR\" value=\":(\" className=\"btn btn-default red\" tooltip=\"help needed\" onClick={()=>this.props.logEvent(':)')}>{sym[':(']}</TooltipButton>\r\n      <div>{help}</div>\r\n      </div>)\r\n  }\r\n}\r\n\r\nclass Comment extends Component {\r\n  state = {comment: ''}\r\n  comment=(e)=>{\r\n    this.setState({comment: e.target.value});\r\n  }\r\n  render() {\r\n    return <Form onSubmit={e=>e.preventDefault()} inline><label htmlFor=\"comment\">Comment:&nbsp;</label><input type=\"text\" className=\"form-control\" name=\"comment\" value={this.state.comment} onChange={this.comment}/> {this.state.comment?<AskTutor c={this.state.comment} qkey={0+':::'+this.props.qid}/>:null}</Form>\r\n  }\r\n}\r\n\r\nclass Answer extends Component {\r\n  //<MarkHelp self={this.state.self} mark={this.state.mark}/>\r\n  render() {\r\n    const answer=this.props.answer.replace(/^(-?)(\\d+)(˽| )(\\d+\\/\\d+)$/,\"$1{$2˽$4}\").replace(/\\s/g,'') // mixed fractions and remove any other spaces\r\n    if (!answer || answer==='') return null\r\n    const mark=this.props.mark\r\n    const vars=this.props.vars\r\n    let mk=null,maths=null\r\n    // eslint-disable-next-line\r\n    if (mark && mark.attempt == this.props.answer)\r\n    {\r\n      mk=<Mark mark={mark}/>\r\n      if (mark.correct === '✓') maths=<Maths vars={vars}>{answer}</Maths>\r\n      else maths=<Maths auto={false}>{mark.diff}</Maths>\r\n    }\r\n    else maths=<Maths vars={vars}>{answer}</Maths>\r\n    //console.log(\"Answer\",answer,html)\r\n    return mk?<div name='answer' className=\"inline\"><div className=\"maths border\">{maths}{mk}</div>{this.props.hide?null:<MarkHelp mark={mark}/>}</div>\r\n    :<div className=\"maths border inline\">{maths}</div>\r\n  }\r\n}\r\n\r\nclass QuestionSelect extends Component {\r\n  shouldComponentUpdate(newProps) {return newProps.tid!==this.props.tid || newProps.qid!==this.props.qid}\r\n  render() {\r\n    const t=window.FreeMaths.state.data.tests.tests[this.props.tid]\r\n    const q=window.FreeMaths.state.data.tests.questions[this.props.qid]\r\n    //console.log('QuestionSelect',this.props.tid,this.props.qid,t,q)\r\n    if (!t || !q) return null // for adaptive\r\n    let questionOptions = t.qs.map((question)=>{return question?<option value={question.qid} key={question.qid}>{question.qn}</option>:null})\r\n    return <span>Question <select value={this.props.qid} className=\"btn btn-default\" onChange={(e)=>this.props.selectQ(e.target.value)}>{questionOptions}</select> of {t.qs.length-1}</span>\r\n  }\r\n}\r\n\r\nclass TopicSelect extends Component {\r\n  render() {\r\n      let options=[<option key={0} value=\"0\">select</option>]\r\n      let topics=Object.keys(this.props.tree.topics).sort((x,y)=>x.localeCompare(y))\r\n      topics.forEach((s)=>{options.push(<option key={s}>{s}</option>)})\r\n      return(<form className=\"form-horizontal inline\"><select className=\"form-control inline\" style={{width: \"auto\"}} value={this.props.topic} onChange={(e)=>this.props.setTopic(e.target.value)}>{options}</select></form>)\r\n  }\r\n}\r\n\r\nexport default AutoTest;\r\nexport {Mark,Answer,Question} // used in testing\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\r\n","import React, { Component } from 'react'\r\nimport {Modal,Col,Form,FormGroup,FormControl,HelpBlock,ControlLabel,Button,Checkbox} from 'react-bootstrap';\r\nimport {ajax} from './ajax'\r\n\r\nclass Tutor extends Component {\r\n  state={tutor:['','','',''],remove:[],error:{}} // tutor[0] not used\r\n  tutor=(e)=>{\r\n    e.preventDefault();\r\n    ajax('/react_ajax/tutor',(r)=>{\r\n      if (r.error) this.setState({error:r.data})\r\n      else {\r\n        let user=this.props.fm.state.user\r\n        user.tutors=r.data.tutors\r\n        this.setState({tutor:['','','',''],remove:[],error:{added:r.data.added,removed:r.data.removed}})\r\n        this.props.fm.setState({user:user})\r\n      }\r\n    },{tutor:this.state.tutor,remove:this.state.remove,token:this.props.fm.state.user.token})\r\n  }\r\n  add=(i,value)=>{\r\n    let tutor=this.state.tutor\r\n    tutor[i]=value\r\n    this.setState({tutor:tutor,error:{}})\r\n  }\r\n  remove=(email)=>{\r\n    let remove=this.state.remove\r\n    let i=remove.indexOf(email)\r\n    if (i !== -1) remove.splice(i, 1)\r\n    else remove.push(email)\r\n    this.setState({remove:remove,error:{}})\r\n  }\r\n  button() {\r\n    let button={style:'primary',text:'Add'}\r\n    if (this.state.remove.length>0) {\r\n      button.style='danger'\r\n      if (this.state.tutor.join('')) button.text='Add & Remove'\r\n      else button.text='Remove'\r\n    }\r\n    return button\r\n  }\r\n  render() {\r\n    return (<Modal show={true} onHide={this.props.close}>\r\n      <Modal.Header closeButton><Modal.Title>Parents, Teachers &amp; Tutors</Modal.Title></Modal.Header>\r\n      <Modal.Body>\r\n      {this.state.error.added?<div className=\"alert alert-success\"><strong>{this.state.error.added} tutors added</strong></div>:null}\r\n      {this.state.error.removed?<div className=\"alert alert-success\"><strong>{this.state.error.removed} tutors removed</strong></div>:null}\r\n      {this.state.error.error?<div className=\"alert alert-danger\"><strong>Server Error: {this.state.error.error}</strong></div>:null}\r\n      <Form onSubmit={this.tutor} horizontal>\r\n      {[1,2,3].map(i=>{return <TutorEmail key={i} i={i} email={this.state.tutor[i]} error={this.state.error} add={this.add}/>})}\r\n      <FormGroup>\r\n        <Col smOffset={3} sm={4}><Button bsStyle={this.button().style} type=\"submit\"><i className=\"fa fa-mortar-board\"></i> {this.button().text}</Button></Col>\r\n      </FormGroup>\r\n      {this.props.fm.state.user.tutors?<div>\r\n      <FormGroup>\r\n        {this.props.fm.state.user.tutors.map(t=>{\r\n          return <Col key={t.email} smOffset={3} sm={8}><Checkbox value={this.state.remove[t.email]?'checked':false} onChange={(e)=>this.remove(t.email)}><i className=\"fa fa-trash\"></i> <span className=\"btn-link\" onClick={()=>this.props.fm.setState({email:t.email,modal:'contact'})}>{t.name?t.name:t.email}</span></Checkbox></Col>\r\n        })}\r\n      </FormGroup>\r\n      </div>:null}\r\n      </Form>\r\n      </Modal.Body></Modal>)\r\n  }\r\n}\r\n\r\nclass TutorEmail extends Component {\r\n  //state={email: this.props.email}\r\n  render() {\r\n    return(<FormGroup controlId={\"tutor\"+this.props.i} validationState={this.props.error['tutor.'+this.props.i]?\"error\":null}>\r\n          <Col componentClass={ControlLabel} sm={3}>Tutor Email</Col>\r\n          <Col sm={8}><FormControl type='email' name='email' value={this.props.email} placeholder=\"Email\" onChange={(e)=>this.props.add(this.props.i,e.target.value)}/></Col>\r\n          {this.props.error['tutor.'+this.props.i]?<Col smOffset={3} sm={8}><HelpBlock>{this.props.error['tutor.'+this.props.i]}</HelpBlock></Col>:null}\r\n        </FormGroup>)\r\n  }\r\n}\r\n\r\n\r\nexport default Tutor\r\n","import React, { Component } from 'react'\r\nimport {ajax} from './ajax'\r\n//import {expand_data} from './Stats'\r\nimport EditPast from './EditPast'\r\nimport EditBook from './EditBook'\r\n//import EditQuestions from './EditQuestions'\r\nimport {StudentSelect} from './Students'\r\n//import EditQuestions from './EditQuestions'\r\nimport LZUTF8 from 'lzutf8'\r\n\r\nclass Admin extends Component {\r\n  state={users:null, data:null, tables:null, past:false, book:false, diffs:null, lz:null}\r\n  send=()=>{\r\n    ajax('/react_ajax/update_data',(r)=>{\r\n      if (r.error) this.props.fm.setState({message:{type:'danger',text:'Server Error: '+r.data.error}})\r\n      else this.props.fm.setState({message:{type:'success',text:'Data updated'}})\r\n    },{data:this.props.fm.state.data,lz:this.state.lz})\r\n  }\r\n  load=()=>{\r\n    ajax('/react_ajax/data',(r)=>{\r\n      if (r.error) this.setState({message:{type:'danger',text:'Error: '+r.data.error}})\r\n      else {\r\n        let data=expand_data(r.data)\r\n        let lz={}; // warns if no semi as }[ ambiguous\r\n        ['tests','books','past','help'].forEach(t=>{\r\n          let json=JSON.stringify(data[t])\r\n          let zip=LZUTF8.compress(json,{outputEncoding:'Base64'})\r\n          console.log(t,json.length,zip.length)\r\n          lz[t]=zip\r\n        })\r\n        this.props.fm.setState({data:data,message:{type:'success',text:'Data loaded from DB'}})\r\n        this.setState({lz:lz})\r\n        console.log(\"data loaded from DB\")\r\n      }\r\n    })\r\n  }\r\n  diff(type){\r\n    let diffs={}\r\n    Object.keys(this.state.data[type]).forEach(k=>{\r\n      let live=this.props.fm.state.data[type][k]\r\n      let comp=this.state.data[type][k]\r\n      if (!live || !comp || live.updated_at !== comp.updated_at) diffs[k]={live:live,comp:comp}\r\n    })\r\n    Object.keys(this.props.fm.state.data[type]).forEach(k=>{\r\n      let live=this.props.fm.state.data[type][k]\r\n      let comp=this.state.data[type][k]\r\n      if ((!live || !comp || live.updated_at !== comp.updated_at) && !diffs[k]) diffs[k]={live:live,comp:comp}\r\n    })\r\n    return diffs\r\n  }\r\n  compare=()=>{\r\n    let diffs={help:this.diff('help'),tests:this.diff('tests'),questions:this.diff('questions')}\r\n    this.setState({diffs:diffs})\r\n    console.log(\"diffs\",diffs)\r\n  }\r\n  render() {\r\n    return (<div>\r\n      {this.state.message?<div className={\"alert alert-dismissible alert-\"+this.state.message.type}><button type=\"button\" onClick={()=>this.setState({message:null})} className=\"close\" data-dismiss=\"alert\">&times;</button><strong>{this.state.message.text}</strong></div>:null}\r\n      <span className=\"btn-link\" onClick={this.load}>Load Data</span><br/>\r\n      {this.state.lz?<div><span className=\"btn-link\" onClick={this.compare}>Compare Data</span><br/>\r\n      <Diffs diffs={this.state.diffs} update={this.compare}/>\r\n      <span className=\"btn-link\" onClick={this.send}>Send Data</span><br/>\r\n      </div>:null}\r\n      <br/><span className=\"btn-link\" onClick={()=>this.setState({users:!this.state.users})}>Users</span>\r\n      {this.state.users?<Users fm={this.props.fm}/>:null}\r\n      <br/><span className=\"btn-link\" onClick={()=>this.setState({past:!this.state.past})}>Past Papers</span>\r\n      {this.state.past?<EditPast close={()=>this.setState({past:false})} fm={this.props.fm}/>:null}\r\n      <br/><span className=\"btn-link\" onClick={()=>this.setState({book:!this.state.book})}>Books</span>\r\n      {this.state.book?<EditBook close={()=>this.setState({book:false})} fm={this.props.fm}/>:null}\r\n      </div>)\r\n          //  <EditQuestions fm={this.props.fm} setQ={(q,e)=>this.setState({q:q,edit:e})}/>\r\n  }\r\n}\r\n\r\nfunction expand_past(t)\r\n{\r\n  t.test=JSON.parse(t.json)\r\n  delete t.json\r\n  t.qs={}\r\n  //let i=0\r\n  t.test.questions.forEach(q=>t.qs[q.q]=q)\r\n}\r\n\r\nfunction expand_data(data)\r\n{\r\n  let tests={},questions={},help={},books={},past={}\r\n  data.tests.forEach(t=>{\r\n    if (t.type === 'book') {\r\n      expand_book(t)\r\n      books[t.id]=t\r\n    }\r\n    else if (t.type === 'past') {\r\n      expand_past(t)\r\n      past[t.id]=t\r\n    }\r\n    else if (t.type ==='vars') {\r\n      t.qs=[]\r\n      tests[t.id]=t\r\n    }\r\n  })\r\n  data.questions.forEach(q=>{\r\n    questions[q.id]=JSON.parse(q.json)\r\n    questions[q.id].id=q.id\r\n  })\r\n  data.qmap.forEach((q)=>{\r\n    tests[q.test_id].qs[q.number]={tid:q.test_id, qn:q.number, qid:q.question_id}\r\n  })\r\n  data.help.forEach(h=>{help[h.title.toLowerCase().replace(/ /g,'_')]=h})\r\n  return {tests:{tests:tests,questions:questions},books:books,past:past,help:help}\r\n}\r\n\r\nfunction expand_book(t)\r\n{\r\n  t.book=JSON.parse(t.json)\r\n  delete t.json\r\n  t.qmap={qs:{},q:{}}\r\n  t.book.chapters.forEach(ch=>{\r\n    t.qmap.qs[ch.chapter]={}\r\n    t.qmap.q[ch.chapter]={}\r\n    ch.exercises.forEach(e=>{\r\n      let k=0\r\n      t.qmap.qs[ch.chapter][e.exercise]=e.qs\r\n      t.qmap.q[ch.chapter][e.exercise]={}\r\n      e.qs.forEach(q=>t.qmap.q[ch.chapter][e.exercise][q.q]=k++)\r\n    })\r\n  })\r\n}\r\n\r\nclass Diffs extends Component {\r\n  // duplicated code\r\n  update=(test)=>\r\n  {\r\n    let data=window.FreeMaths.state.data\r\n    data.tests[test.id]=test\r\n    window.FreeMaths.setState({data:data})\r\n    this.props.update()\r\n    ajax(\"/react_ajax/past\",(r)=>{\r\n      if (r.error) this.setState({error:r.data})\r\n      else {\r\n        console.log(\"past\",r.data.id)\r\n      }\r\n    },{test:test.test,copy:test.updated_at}) //var obj = this; map tests\r\n  }\r\n  render() {\r\n      if (!this.props.diffs) return null\r\n      return (<div>\r\n      {Object.keys(this.props.diffs.tests).map(k=>{\r\n        let diff=this.props.diffs.tests[k]\r\n        if (!diff.live) return <div key={k}>Missing {diff.comp.id} {diff.comp.title} <span className=\"btn-link\" onClick={()=>this.update(diff.comp)}>update</span></div>\r\n        else if (!diff.comp)  return <div key={k}>Extra {diff.comp.id} {diff.comp.title}</div>\r\n        else {\r\n          let lts=new Date(diff.live.updated_at.replace(' ', 'T')).getTime()\r\n          let cts=new Date(diff.comp.updated_at.replace(' ', 'T')).getTime()\r\n          if (lts>cts) return <div key={k}>Local {diff.live.test.copy?'copy':'newer'} {diff.live.id} {diff.live.title} {diff.live.test.copy?diff.live.test.copy:diff.live.updated_at} ({diff.comp.updated_at})</div>\r\n          else  return <div key={k}>Remote newer {diff.comp.id} {diff.comp.title} {diff.comp.updated_at} ({diff.live.updated_at})<span className=\"btn-link\" onClick={()=>this.update(diff.comp)}>update</span></div>\r\n        }\r\n      })}\r\n      </div>)\r\n  }\r\n}\r\n\r\nclass Users extends Component {\r\n  state={users:null,sort:'login',error:{}}\r\n  componentWillMount() {\r\n    ajax('react_ajax/users',r=>{\r\n      if (r.error) this.props.fm.setState({message:{type:'danger',text:r.data.error}})\r\n      else this.setState({users:r.data.users})\r\n    })\r\n    this.props.fm.getStudents(true)\r\n  }\r\n  sort=(x,y)=>{\r\n    switch (this.state.sort) {\r\n      case 'login':\r\n        x.ts=new Date(x.updated_at.replace(' ', 'T')).getTime()\r\n        y.ts=new Date(y.updated_at.replace(' ', 'T')).getTime()\r\n        return y.ts-x.ts\r\n      case 'register':\r\n        x.ts=new Date(x.created_at.replace(' ', 'T')).getTime()\r\n        y.ts=new Date(y.created_at.replace(' ', 'T')).getTime()\r\n        return y.ts-x.ts\r\n      case 'name':\r\n        return x.name.localeCompare(y.name)\r\n      case 'email':\r\n        return x.email.localeCompare(y.email)\r\n      default: // id\r\n        return y[this.state.sort]-x[this.state.sort]\r\n    }\r\n  }\r\n  render() {\r\n    if (!this.state.users) return <div>loading...</div>\r\n    const ths=['id','name','email','login','register']\r\n    const tds=[/*'id',*/'name','email','updated_at','created_at']\r\n    let users=this.state.users.sort(this.sort).map(u=>{\r\n      return (<tr key={u.id}>\r\n      <td>{u.id} <StudentSelect uid={u.id} fm={this.props.fm}/></td>\r\n      {tds.map(f=>{return <td key={f}>{u[f]}</td>})}\r\n      </tr>)\r\n    })\r\n    return (<table className=\"table table-bordered table-condensed table-striped width-auto\">\r\n    <thead><tr>{ths.map(f=>{return <th key={f}><span className=\"btn-link\" onClick={()=>this.setState({sort:f})}>{f}</span></th>})}</tr></thead>\r\n    <tbody>{users}</tbody>\r\n    </table>)\r\n  }\r\n}\r\n/*\r\nsetUser=(id,name)=>{\r\n  let user=this.props.fm.state.user\r\n  if (!user.logout) user.logout={name:user.name,id:user.id,log:user.log,token:user.token}\r\n  let log=user.students.log.filter(x=>{return x.user_id===id})\r\n  user.name=name\r\n  user.id=id\r\n  user.log=log\r\n  user.token=null\r\n  user.isAdmin=user.isTutor=false\r\n  this.props.fm.setState({user:user,page:null,message:{type:'success',text:'Switched user to: '+name}})\r\n}\r\n\r\nfunction symbol(k) {\r\n  return sym[k]?sym[k]:k\r\n}\r\n\r\nclass Log extends Component {\r\n  render() {\r\n    if (this.props.log===null) return null\r\n    console.log('Log',this.props.s,this.props.stats)\r\n    let i=0\r\n    let date=''\r\n    let dates=[]\r\n    this.props.log.forEach((l)=>{\r\n      if (l.created_at.substr(0,10) !== date) {\r\n        date=l.created_at.substr(0,10)\r\n        dates.push(<LogDate date={date} stats={this.props.stats} log={this.props.log} i={i} key={i}/>)\r\n      }\r\n      i++\r\n    })\r\n    return <ModalBox close={()=>this.props.setS(null,false,true)} title={this.props.stats.users[this.props.log[0].user_id].name}>{dates}</ModalBox>\r\n  }\r\n}\r\n\r\nclass LogItem extends Component {\r\n  render() {\r\n    let question=null,mark=null\r\n    //console.log(\"LogItem\",this.props.log)\r\n    if (isset(this.props.stats.tests[this.props.log.paper]) && isset(this.props.log.q)) {\r\n      let q=this.props.log.paper==='0'?this.props.stats.questions[this.props.log.q]:this.props.stats.tests[this.props.log.paper].test.qs[this.props.log.q-1]\r\n      let vars=this.props.log.variables?JSON.parse(this.props.log.variables):null\r\n      if (this.props.log.event === 'Q' || this.props.log.event === 'Re-try')\r\n      {\r\n        question=<div><Maths vars={vars}>{q.question}</Maths></div>\r\n      }\r\n      else if ((this.props.log.event === '✗' || this.props.log.event === '?✓' || this.props.log.event === '✓') && !empty(this.props.log.answer))\r\n      {\r\n        mark=<div><Answer noBox={true} answer={this.props.log.answer} vars={vars} mark={checkAnswer(this.props.log.answer,q.answer,vars)} keyboard={false}/></div>\r\n      }\r\n    }\r\n    return (<div>\r\n      <div>{this.props.log.created_at.substr(11,8)} {title(this.props.log.paper,this.props.stats)} {this.props.log.q?'Q'+this.props.log.q:this.props.log.question} {symbol(this.props.log.event)}</div>\r\n      {question}{mark}\r\n      </div>)\r\n  }\r\n}\r\n\r\nclass LogDate extends Component {\r\n  state={expand:false,paper:null}\r\n  render() {\r\n    let detail=[]\r\n    let total={}\r\n    let summary=[]\r\n    for (var i=this.props.i; i<this.props.log.length&&this.props.log[i].created_at.substr(0,10)===this.props.date; i++) {\r\n      if (!isset(total[this.props.log[i].paper])) total[this.props.log[i].paper]={'Q':0,'Re-try':0,':(':0,':|':0,':)':0,'✗':0,'?✓':0,'✓':0,'✓✗':0,'Show':0,'Help':0}\r\n      if (isset(total[this.props.log[i].paper][this.props.log[i].event])) total[this.props.log[i].paper][this.props.log[i].event]++\r\n      //else console.log(\"LogDate?\",this.props.log[i].event)\r\n      if (this.props.log[i].paper === this.state.paper) detail.unshift(<LogItem log={this.props.log[i]} stats={this.props.stats} key={i} />)\r\n      else if (this.state.expand) detail.unshift(<LogItem log={this.props.log[i]} stats={this.props.stats} key={i} />)\r\n    }\r\n    i=0\r\n    Object.keys(total).forEach(p=>{\r\n      summary.push(<a onClick={()=>this.setState({paper:this.state.paper===p?null:p,expand:false})} key={i++}>{title(p,this.props.stats)}</a>)\r\n      Object.keys(total[p]).forEach(k=>{if (total[p][k]>0) summary.push(<span key={i++} className={rag[k]?rag[k]:null}> {symbol(k)}{total[p][k]} </span>)})\r\n    })\r\n    return <div><div><a onClick={()=>this.setState({expand:!this.state.expand})}>{this.props.date}</a> {summary}</div>{detail}</div>\r\n  }\r\n}\r\n*/\r\nexport default Admin\r\n","import React, { Component } from 'react'\r\nimport './FreeMaths.css'\r\nimport {Navbar,Nav,NavItem,NavDropdown,MenuItem} from 'react-bootstrap';\r\nimport {Login,Reset,Forgot,Password,Register,Details} from './Login'\r\nimport {Contact,Mail} from './Contact'\r\nimport AutoTest from './AutoTest'\r\nimport Tutor from './Tutor'\r\nimport Admin from './Admin'\r\nimport {ajax} from './ajax'\r\nimport {Students} from './Students'\r\nimport {JsonHelp} from './Help'\r\nimport {debug,store_user,load_user,clear_user,unzip} from './Utils'\r\n//import Draw from './Draw'\r\n\r\nclass FreeMaths extends Component {\r\n  state={user:null, students:null, log:null, data:null, page:'Home', modal:null, message:null, token:null, password:null, help:null}\r\n  logout=()=>{\r\n    //console.log(\"logout\",this.state.user,this.state.user.logout)\r\n    if (this.state.user.logout)\r\n    {\r\n      let user=this.state.user\r\n      user.id=user.logout.id\r\n      user.name=user.logout.name\r\n      user.log=user.logout.log\r\n      user.token=user.logout.token\r\n      user.isAdmin=user.isTutor=true\r\n      user.logout=null\r\n      this.setState({user:user,page:'Students',message:{type:'success',text:'Switched user to:'+user.name}})\r\n    }\r\n    else {\r\n      this.setState({user:null, page: null, message:null, password:false})\r\n      ajax('/react_ajax/logout')\r\n      clear_user()\r\n    }\r\n  }\r\n  updateLog=(l,f)=>{\r\n    if (debug('updateLog')) console.log(\"updateLog(l,f)\",l,f)\r\n    ajax('/react_ajax/log_event',(r)=>{\r\n      if (r.error) {\r\n        if (r.data.error==='Unauthorized') this.setState({password:true})\r\n        else this.setState({message:{type:'danger',text:'Server Error: '+r.data.error}})\r\n      }\r\n      else\r\n      {\r\n        let user=this.state.user\r\n        //console.log(\"updateLog\",r.data.log)\r\n        if (!r.data.log) r.data.log={\r\n            id:user.log.length?user.log[user.log.length-1].id+1:1,\r\n            event:l.event,\r\n            paper:l.paper,\r\n            question:l.question,\r\n            variables:JSON.stringify(l.vars),\r\n            answer:l.answer?l.answer:'',\r\n            comment:l.comment?l.comment:'',\r\n            user_id:user.id\r\n          }\r\n        user.log.push(r.data.log)\r\n        //console.log('updateLog',user.log)\r\n        this.setState({user:user,message:null})\r\n        f(r.data)\r\n      }\r\n    },{log:l})\r\n  }\r\n  saveQ=(question)=>{\r\n    if (question) ajax('/react_ajax/saveQ',r=>{\r\n      console.log(\"saveQ\",r)\r\n      if (!r.error) {\r\n        let data=this.state.data\r\n        data.tests.questions[r.data.id]=r.data\r\n        this.setState({data:data,reload:true})\r\n      }\r\n    },{question: question, token:this.state.user.token})\r\n  }\r\n  getStudents(all){\r\n    console.log(\"getStudents\",all)\r\n    ajax('/react_ajax/students',r=>{\r\n      if (r.error) this.setState({message:{type:'danger',text:'Server Error: '+r.data.error}})\r\n      else {\r\n        let students={}\r\n        r.data.users.forEach(u=>{students[u.id]=u})\r\n        this.setState({students:students,log:r.data.log})\r\n        console.log(\"getStudents\",all,Object.keys(students).length)\r\n      }\r\n    },{all:all})\r\n  }\r\n  componentWillMount()\r\n  {\r\n    window.FreeMaths=this;\r\n    ['help','tests','books','past'].forEach(t=>{\r\n      ajax(t+'.lz',(r)=>{\r\n        if (r.error) this.setState({message:{type:'danger',text:t+' Error: '+r.data.error}})\r\n        else {\r\n          let data=this.state.data?this.state.data:{}\r\n          data[t]=unzip(r.data)\r\n          console.log(t,data)\r\n          this.setState({data:data})\r\n        }\r\n      })\r\n    })\r\n    let token=window.location.pathname.substring(window.location.pathname.lastIndexOf('/')+1)\r\n    if (window.location.pathname.indexOf('/reset/') !== -1) this.setState({modal:'reset',token:token})\r\n    else if (window.location.pathname.indexOf('/contact') !== -1) this.setState({modal:'contact'})\r\n    else if (window.location.pathname.indexOf('/mail/') !== -1) this.setState({modal:'mail',token:token})\r\n    else {\r\n      let user=load_user()\r\n      this.setState({user:user}) // may get updated but will work offline\r\n      ajax('/react_ajax/user',(r)=>{\r\n        if (r.error) this.setState({message:{type:'danger',text:'user Error: '+r.data.error}})\r\n        else if (r.data==='password') this.setState({password:true})\r\n        else if (r.data.id) this.setState({user: store_user(r.data,user)}) // null is returned as empty object\r\n      },user?{id:user.id,token:user.token,lastLogId:user.log.length?user.log[user.log.length-1].id:0}:'null',user?user.token:null)\r\n    }\r\n    if (window.location.pathname.indexOf('/Q') !== -1) {\r\n      let qid=window.location.pathname.substr(window.location.pathname.indexOf('/Q')+2)\r\n      let vars=null\r\n      if (window.location.search)\r\n      {\r\n        vars={}\r\n        window.location.search.substr(1).split('&').forEach(v=>{v=decodeURIComponent(v).split('='); vars[v[0]]=v[1]})\r\n      }\r\n      console.log('Q',qid,vars)\r\n      this.setState({qid:qid, vars:vars})\r\n    }\r\n    window.history.pushState(\"object or string\", \"Title\", \"/\")\r\n  }\r\n  showPage() {\r\n    if (this.state.user === null) return <Login fm={this}/>\r\n    else if (!this.state.data||!this.state.data.help||!this.state.data.tests||!this.state.data.books||!this.state.data.past) return null\r\n    switch(this.state.page) {\r\n      case 'Students': return <Students fm={this} students={true}/>\r\n      case 'Past': return <Students type=\"past\" fm={this}/>\r\n      case 'Books': return <Students type=\"book\" fm={this}/>\r\n      //case 'Graph': return <Draw fm={this}/>\r\n      case 'Admin': return <Admin fm={this}/>\r\n      default: return <AutoTest qid={this.state.qid} vars={this.state.vars} fm={this} reset={this.state.password}/>\r\n    }\r\n  }\r\n  showModal() {\r\n    switch(this.state.modal) {\r\n      case 'contact': return <Contact fm={this} close={(m)=>this.setState({modal:null,message:m?m:null})}/>\r\n      case 'mail': return <Mail fm={this} close={(m)=>this.setState({modal:null,message:m?m:null})}/>\r\n      case 'register': return <Register fm={this} close={()=>this.setState({modal:null})}/>\r\n      case 'update': return <Details fm={this} close={()=>this.setState({modal:null})}/>\r\n      case 'tutor': return <Tutor fm={this} close={()=>this.setState({modal:null})}/>\r\n      case 'forgot': return <Forgot fm={this} email={this.state.email} close={(m)=>this.setState({modal:null,message:m?m:null})}/>\r\n      case 'reset': return <Reset fm={this} close={()=>this.setState({modal:null})}/> // token read from fm.state\r\n      default: return null\r\n    }\r\n  }\r\n  render() {\r\n    return (<div>\r\n      <FreeMathsNav fm={this}/>\r\n      <div id=\"modalRoot\"></div>\r\n      <div id=\"page\" className=\"container\">\r\n      {this.state.message?<div className={\"alert alert-dismissible alert-\"+this.state.message.type}><button type=\"button\" className=\"close\" onClick={()=>this.setState({message:null})} data-dismiss=\"alert\">&times;</button><strong>{this.state.message.text}</strong></div>:null}\r\n      {this.showPage()}\r\n      {this.showModal()}\r\n      {this.state.password&&this.state.modal!=='mail'?<Password fm={this} close={()=>this.setState({user:null,password:null})}/>:null}\r\n      {this.state.help?<JsonHelp topic={this.state.help} close={()=>this.setState({help:null})}/>:null}\r\n      </div>\r\n    </div>)\r\n  }\r\n}\r\n\r\nclass FreeMathsNav extends Component {\r\nrender() {\r\n  //      <NavItem eventKey={'Graph'} onClick={()=>this.props.fm.setState({page:'Graph',message:null})}>Graph</NavItem>\r\n  var nav;\r\n  if (this.props.fm.state.user !== null) {\r\n    nav = (<div><Nav activeKey={this.props.fm.state.page}>\r\n      <NavItem id='tests' eventKey={'Home'} onClick={()=>this.props.fm.setState({page:'Home',message:null})}>Tests</NavItem>\r\n      <NavItem id='books' eventKey={'Books'} onClick={()=>this.props.fm.setState({page:'Books',message:null})}>Books</NavItem>\r\n      <NavItem id='past' eventKey={'Past'} onClick={()=>this.props.fm.setState({page:'Past',message:null})}>Past Papers</NavItem>\r\n      </Nav>\r\n      <Nav pullRight>\r\n      <NavDropdown title={this.props.fm.state.user.name} id=\"user\">\r\n      <MenuItem id='logout' eventKey={'logout'} onSelect={this.props.fm.logout}><i className=\"fa fa-sign-out\"></i> Logout</MenuItem>\r\n      <MenuItem id='contact' eventKey={'contact'} onSelect={()=>this.props.fm.setState({modal:'contact',message:null})}><i className=\"fa fa-envelope-o\"></i> Contact Us</MenuItem>\r\n      <MenuItem id='tutor' eventKey={'Tutor'} onSelect={()=>this.props.fm.setState({modal:'tutor',message:null})}><i className=\"fa fa-mortar-board\"></i> Add Tutor</MenuItem>\r\n      <MenuItem id='update' eventKey={'Update'} onSelect={()=>this.props.fm.setState({modal:'update',message:null})}><i className=\"fa fa-user\"></i> Update Details</MenuItem>\r\n      {this.props.fm.state.user.isTutor?<MenuItem id='students' eventKey={'Students'} onSelect={()=>this.props.fm.setState({page:'Students',message:null})}><i className=\"fa fa-group\"></i> Students</MenuItem>:null}\r\n      {this.props.fm.state.user.isAdmin?<MenuItem id='admin' eventKey={'Admin'} onSelect={()=>this.props.fm.setState({page:'Admin',message:null})}><i className=\"fa fa-key\"></i> Admin</MenuItem>:null}\r\n      </NavDropdown>\r\n      </Nav></div>);\r\n    }\r\n    else {\r\n      nav =  (<div>\r\n        {this.props.fm.state.data?<Nav><NavItem id='about' eventKey={'about'} onClick={()=>this.props.fm.setState({help:'about'})}>About</NavItem></Nav>:null}\r\n        <Nav pullRight>\r\n        <NavItem id='register' eventKey='register' onClick={()=>this.props.fm.setState({modal:'register',message:null})}>Register</NavItem>\r\n        <NavItem id='contact' eventKey={'contact'} onSelect={()=>this.props.fm.setState({modal:'contact',message:null})}>Contact Us</NavItem>\r\n        </Nav></div>);\r\n    }\r\n    return(<div id='nav'><Navbar collapseOnSelect fixedTop>\r\n    <Navbar.Header><Navbar.Brand><a href=\"http://ec2.freemaths.uk/\">FreeMaths.uk</a></Navbar.Brand><Navbar.Toggle /></Navbar.Header>\r\n    <Navbar.Collapse>{nav}</Navbar.Collapse>\r\n    </Navbar>\r\n    </div>);\r\n  }\r\n}\r\n\r\nexport default FreeMaths;\r\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n\n              // Execute callback\n              if (config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport FreeMaths from './FreeMaths';\r\nimport 'whatwg-fetch'\r\nimport * as serviceWorker from './serviceWorker'\r\n\r\nReactDOM.render(<FreeMaths/>, document.getElementById('root'))\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nif (window.location.href.startsWith('https://app.')) {\r\n  console.log(\"service worker registered\")\r\n  serviceWorker.register()\r\n}\r\nelse {\r\n  console.log(\"service worker unregistered\")\r\n  serviceWorker.unregister()\r\n}\r\n"],"sourceRoot":""}