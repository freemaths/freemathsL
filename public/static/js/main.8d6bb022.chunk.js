(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{123:function(e,t,a){e.exports=a(218)},128:function(e,t,a){},133:function(e,t){},135:function(e,t){},218:function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(17),l=a.n(n),i=a(4),o=a(5),c=a(8),u=a(6),p=a(7),m=(a(128),a(227)),h=a(228),f=a(233),d=a(229),v=a(232),b=a(220),g=a(221),k=a(230),E=a(222),y=a(223),O=a(224),j=a(234),w=a(225),q=a(114),S=a(226),x=a(231);function C(e,t,a,s){var r=!1;fetch(e,function(e,t){var a;a=e?{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","Content-Type":"application/json","FM-Token":t||(window.FreeMaths.state.user?window.FreeMaths.state.user.token:null)},credentials:"include",method:"post",cache:"no-cache",body:JSON.stringify(e)}:{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","FM-Token":window.FreeMaths.state.user?window.FreeMaths.state.user.token:null,"FM-Env":JSON.stringify(Object({NODE_ENV:"production",PUBLIC_URL:""}))},credentials:"include",method:"get",cache:"default"};return a}(a,s)).then(function(t){return t.ok||(r=t.statusText),e.endsWith(".lz")?t.text():t.json()}).then(function(e){t&&t({error:r,data:e})}).catch(function(a){console.error(e,r,a),t&&t({error:a,data:{error:r||a.message}})})}var N=a(18),_=a(235),A=a(219),M=a(42),T=a.n(M),F={};function Q(e){if(F[e]?F[e].n++:(F[e]={n:1},Object.keys(F).forEach(function(t){t!==e&&e.startsWith(t)&&F[t].show&&(F[e].show=!0)})),F[e].show)return!0}function W(){for(var e=arguments,t=function(){var t=e[a];F[t]?F[t].show=!F[t].show:F[t]={n:0,show:!0},Object.keys(F).forEach(function(e){e!==t&&e.startsWith(t)&&(F[e].show=!0)})},a=0;a<arguments.length;a++)t()}function P(e,t){if(t&&t.id===e.id&&(e.log=t.log.concat(e.log)),window.localStorage)try{var a=JSON.stringify(e),s=T.a.compress(a,{outputEncoding:"Base64"});window.localStorage.setItem("FMuser",s)}catch(r){console.error("user not stored",r.name,e)}return e.debug&&(e.debug.split(" ").forEach(function(e){return W(e)}),console.log("set_debug",e.debug)),e}function z(e){return Q("unzip")&&console.log("unzip",T.a.decompress("C4UwzsAEEE4JYDsDmQ==",{inputEncoding:"Base64"})),JSON.parse(T.a.decompress(e,{inputEncoding:"Base64"}))}function D(e){return window.FreeMaths.state.data.tests.questions[e]}function B(e){var t=window.FreeMaths.state.data;"string"===typeof e&&e.indexOf(":")>0&&(e=e.split(":")[0]);var a=t.tests.tests[e]?t.tests.tests[e]:t.books[e]?t.books[e]:t.past[e]?t.past[e]:null;return 0!==e&&"0"!==e||(a={id:0,type:"var",title:"Adaptive"}),a}function H(e,t,a,s,n){if(!e)return null;if(t&&"string"===typeof e&&e.indexOf(":")>0){var l=e.split(":"),i=Object(N.a)(l,4),o=i[0],c=i[1],u=i[2],p=i[3];e=o}if("0"===o)return"Q"+p;var m=B(e)?B(e).title.replace(/Edexcel_/,"").replace(/_/g," "):e;return $(u)&&""!==u?m+=" "+u:$(c)&&""!==c&&(m+=" "+c),s&&(m=""),$(p)&&a&&(m+=" Q"+p),window.FreeMaths.state.user&&window.FreeMaths.state.user.isAdmin&&n&&(m=r.a.createElement(L,{tooltip:e},m)),m}var R=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){if("undefined"!==typeof this.props.save)var e=r.a.createElement(x.a.Footer,null,r.a.createElement(q.a,{className:"btn btn-sm btn-primary",onClick:this.props.save.fn},this.props.save.text));else e=null;return r.a.createElement(x.a,{show:!0,name:this.props.name,bsSize:"large",onHide:this.props.close},r.a.createElement(x.a.Header,{closeButton:!0},r.a.createElement(x.a.Title,null,this.props.title)),r.a.createElement(x.a.Body,null,this.props.children),e)}}]),t}(s.Component);function I(){return window.FreeMaths.state.user&&window.FreeMaths.state.user.isMobile?"large":"medium"}var L=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return window.FreeMaths.state.user&&window.FreeMaths.state.user.isMobile?r.a.createElement("span",{className:this.props.className},this.props.children):r.a.createElement(_.a,{placement:this.props.placement?this.props.placement:"top",overlay:r.a.createElement(A.a,{id:"tooltip"},this.props.tooltip)},r.a.createElement("span",{className:this.props.className},this.props.children))}}]),t}(s.Component),U=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return window.FreeMaths.state.user&&window.FreeMaths.state.user.isMobile?r.a.createElement("span",{className:this.props.className?this.props.className:"btn-link",onClick:this.props.onClick},this.props.children):r.a.createElement(_.a,{placement:"top",overlay:r.a.createElement(A.a,{id:"tooltip"},this.props.tooltip)},r.a.createElement("span",{className:this.props.className?this.props.className:"btn-link",onClick:this.props.onClick},this.props.children))}}]),t}(s.Component);function J(e){return JSON.parse(JSON.stringify(e))}function $(e){return"undefined"!==typeof e&&null!==e}function K(e){return"undefined"===typeof e||null===e||0===e.length}function V(e){return e[0].toUpperCase()+e.substr(1,e.length-1)}function G(e){var t=e.getDate();t<10&&(t="0"+t);var a=e.getMonth()+1;return a<10&&(a="0"+a),t+"/"+a}function X(e){return $(e)&&0!==e?G(new Date(1*e)):""}function Y(e,t){if(!$(e))return"";"undefined"===typeof t&&(t="");var a=Math.floor(e/1e3);if(0===a)return"";var s=Math.floor(a/60);a-=60*s;var r=Math.floor(s/60);if(s-=60*r,a<10&&(a="0"+a),r>0){s<10&&(s="0"+s);var n=r+":"+s+":"+a}else n=s+":"+a;return t+n}var Z,ee=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={email:"",password:"",remember:!!a.props.app,error:{}},a.login=function(e){e.preventDefault(),C("/react_ajax/login",function(e){e.error?a.setState({error:e.data}):(a.props.fm.setState({user:e.data}),P(e.data))},a.state)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(b.a,null,r.a.createElement(g.a,{smOffset:2,sm:8},r.a.createElement(k.a,null,r.a.createElement(k.a.Heading,null,r.a.createElement(k.a.Title,{componentClass:"h3"},"Login")),r.a.createElement(k.a.Body,null,this.state.error.error?r.a.createElement("div",{className:"alert alert-danger"},r.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,r.a.createElement(E.a,{onSubmit:this.login,horizontal:!0},r.a.createElement(y.a,{controlId:"formEmail",validationState:this.state.error.email?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Email"),r.a.createElement(g.a,{sm:9},r.a.createElement(j.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.setState({email:t.target.value,error:""})}})),this.state.error.email?r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.email)):null),r.a.createElement(y.a,{controlId:"formPassword",validationState:this.state.error.password?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Password"),r.a.createElement(g.a,{sm:9},r.a.createElement(j.a,{type:"password",name:"password",value:this.state.password,placeholder:"Password",onChange:function(t){return e.setState({password:t.target.value,error:""})}})),this.state.error.password?r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.password)):null),r.a.createElement(y.a,null,r.a.createElement(g.a,{smOffset:2,sm:4},r.a.createElement(q.a,{name:"login",bsStyle:"primary",type:"submit"},r.a.createElement("i",{className:"fa fa-btn fa-sign-in"})," Login")),r.a.createElement(g.a,{sm:4},r.a.createElement(q.a,{name:"forgot",bsStyle:"link",onClick:function(t){t.currentTarget.blur(),e.props.fm.setState({modal:"forgot",email:e.state.email})}},"Forgot your password?"))),r.a.createElement(y.a,null,r.a.createElement(g.a,{smOffset:2,sm:4},r.a.createElement(S.a,{checked:!!this.state.remember,onChange:function(){return e.setState({remember:!e.state.remember})}},"remember me")),r.a.createElement(g.a,{sm:4},r.a.createElement(q.a,{name:"register",bsStyle:"link",onClick:function(t){t.currentTarget.blur(),e.props.fm.setState({modal:"register"})}},r.a.createElement("i",{className:"fa fa-btn fa-user"}),"Register"))))))))}}]),t}(s.Component),te=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={email:a.props.email?a.props.email:"",error:{},sending:!1},a.send=function(e){e.preventDefault(),a.setState({sending:!0}),C("/react_ajax/forgot",function(e){e.error?a.setState({error:e.data,sending:!1}):a.props.close({type:"success",text:"We have e-mailed your password reset link!"})},{email:a.state.email})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(x.a,{name:"forgot",show:!0,onHide:function(){return e.props.close(null)}},r.a.createElement(x.a.Header,{closeButton:!0},r.a.createElement(x.a.Title,null,"Reset Password")),r.a.createElement(x.a.Body,null,this.state.sending?r.a.createElement("div",{className:"alert alert-success"},r.a.createElement("strong",null,"Sending...")):null,this.state.error.error?r.a.createElement("div",{className:"alert alert-danger"},r.a.createElement("strong",null,"Error: ",this.state.error.error)):null,r.a.createElement(E.a,{onSubmit:this.send,horizontal:!0},r.a.createElement(y.a,{controlId:"formHorizontalEmail",validationState:this.state.error.email?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Email"),r.a.createElement(g.a,{sm:9},r.a.createElement(j.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.setState({email:t.target.value,error:{}})}})),""===this.state.error.email?null:r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.email))),r.a.createElement(y.a,null,r.a.createElement(g.a,{smOffset:2,sm:6},r.a.createElement(q.a,{bsStyle:"primary",type:"submit"},r.a.createElement("i",{className:"fa fa-btn fa-envelope"})," Send Password Reset Link"))))))}}]),t}(s.Component),ae=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={email:"",password:"",password_confirmation:"",error:{}},a.reset=function(e){e.preventDefault(),C("/react_ajax/reset",function(e){e.error?a.setState({error:e.data}):a.props.fm.setState({user:e.data,modal:null,message:{type:"success",text:"Your password has been reset."}})},{email:a.state.email,password:a.state.password,password_confirmation:a.state.password_confirmation,token:a.props.fm.state.token})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(x.a,{name:"reset",show:!0,onHide:this.props.close},r.a.createElement(x.a.Header,{closeButton:!0},r.a.createElement(x.a.Title,null,"Reset Password")),r.a.createElement(x.a.Body,null,this.state.error.error?r.a.createElement("div",{className:"alert alert-danger"},r.a.createElement("strong",null,"Error: ",this.state.error.error)):null,this.state.error.token?r.a.createElement("div",{className:"alert alert-danger"},r.a.createElement("strong",null,"Error: ",this.state.error.token)):null,r.a.createElement(E.a,{onSubmit:this.reset,horizontal:!0},r.a.createElement(y.a,{controlId:"email1",validationState:this.state.error.email?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Email"),r.a.createElement(g.a,{sm:9},r.a.createElement(j.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.setState({email:t.target.value,error:{}})}})),this.state.error.email?r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.email)):null),r.a.createElement(y.a,{controlId:"password1",validationState:this.state.error.password?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Password"),r.a.createElement(g.a,{sm:9},r.a.createElement(j.a,{type:"password",name:"password",value:this.state.password,placeholder:"Password",onChange:function(t){return e.setState({password:t.target.value,error:{}})}})),$(this.state.error.password)?r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.password)):null),r.a.createElement(y.a,{controlId:"confirm1",validationState:this.state.error.password_confirmation?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Confirm"),r.a.createElement(g.a,{sm:9},r.a.createElement(j.a,{type:"password",name:"password_confirmation",value:this.state.password_confirmation,placeholder:"Password",onChange:function(t){return e.setState({password_confirmation:t.target.value,error:{}})}})),this.state.error.password_confirmation?r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.password_confirmation)):null),r.a.createElement(y.a,null,r.a.createElement(g.a,{smOffset:2,sm:4},r.a.createElement(q.a,{bsStyle:"primary",type:"submit"},r.a.createElement("i",{className:"fa fa-btn fa-refresh"})," Reset Password"))))))}}]),t}(s.Component),se=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={password:"",error:{}},a.login=function(e){e.preventDefault();var t=!1,s=a.props.to?a.props.to:null,r=a.props.fm.state.user;!a.props.auth||!r||a.props.to&&a.props.to.email!==r.email||(t=!0,s=null),C("/react_ajax/password",function(e){e.error?a.setState({error:e.data}):!a.props.auth||!r||a.props.to&&a.props.to.email!==r.email?a.props.fm.setState({user:P(e.data,r),password:!1}):a.props.auth()},{password:a.state.password,auth:t,to:s,lastLogId:r&&r.log.length?r.log[r.log.length-1].id:0})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(x.a,{name:"password",show:!0,onHide:this.props.close},r.a.createElement(x.a.Header,{closeButton:!0},r.a.createElement(x.a.Title,null,"Enter Password")),r.a.createElement(x.a.Body,null,this.state.error.error?r.a.createElement("div",{className:"alert alert-danger"},r.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,r.a.createElement(E.a,{onSubmit:this.login,horizontal:!0},r.a.createElement(y.a,{controlId:"password",validationState:this.state.error.password?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Password"),r.a.createElement(g.a,{sm:9},r.a.createElement(j.a,{type:"password",name:"password",value:this.state.password,placeholder:"Password",onChange:function(t){return e.setState({password:t.target.value,error:""})}})),this.state.error.password?r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.password)):null),r.a.createElement(y.a,null,r.a.createElement(g.a,{smOffset:2,sm:4},r.a.createElement(q.a,{bsStyle:"primary",type:"submit"},r.a.createElement("i",{className:"fa fa-btn fa-sign-in"})," Confirm")),this.props.fm.state.user?null:r.a.createElement(g.a,{sm:4},r.a.createElement(q.a,{bsStyle:"link",onClick:this.props.close},"Switch user?"))))))}}]),t}(s.Component),re=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={auth:!1},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return this.state.auth?r.a.createElement(ne,{fm:this.props.fm,close:this.props.close}):r.a.createElement(se,{fm:this.props.fm,close:this.props.close,auth:function(){return e.setState({auth:!0})}})}}]),t}(s.Component),ne=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state=a.props.fm.state.user?{name:a.props.fm.state.user.name,email:a.props.fm.state.user.email,password:"",password_confirmation:"",error:{},pw:!1}:{name:"",email:"",password:"",password_confirmation:"",error:{},pw:!0},a.register=function(e){e.preventDefault(),C("/react_ajax/"+(a.props.fm.state.user?"update":"register"),function(e){if(e.error)a.setState({error:e.data});else if(a.props.fm.state.user){var t=a.props.fm.state.user;t.email=e.data.email,t.name=e.data.name,a.props.fm.setState({user:t,modal:null,message:{type:"success",text:"Details updated"}})}else a.props.fm.setState({user:e.data,modal:null,message:{type:"success",text:"Account registered. Use Test to check you knowledge."}})},a.state)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"update",value:function(e,t){var a=this.state;a[e]=t,$(a.error[e])&&delete a.error[e],this.setState(a)}},{key:"render",value:function(){var e=this;return r.a.createElement(x.a,{name:"register",show:!0,onHide:this.props.close},r.a.createElement(x.a.Header,{closeButton:!0},r.a.createElement(x.a.Title,null,this.props.fm.state.user?"Update Details":"Register")),r.a.createElement(x.a.Body,null,this.state.error.error?r.a.createElement("div",{className:"alert alert-danger"},r.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,r.a.createElement(E.a,{onSubmit:this.register,horizontal:!0},r.a.createElement(y.a,{controlId:"formName",validationState:$(this.state.error.name)?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Name"),r.a.createElement(g.a,{sm:9},r.a.createElement(j.a,{type:"name",name:"name",value:this.state.name,placeholder:"First Last",onChange:function(t){return e.update("name",t.target.value)}})),$(this.state.error.name)?r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.name)):null),r.a.createElement(y.a,{controlId:"formEmail",validationState:$(this.state.error.email)?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Email"),r.a.createElement(g.a,{sm:9},r.a.createElement(j.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.update("email",t.target.value)}})),$(this.state.error.email)?r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.email)):null),this.state.pw?r.a.createElement("div",null,r.a.createElement(y.a,{controlId:"formPassword",validationState:$(this.state.error.password)?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Password"),r.a.createElement(g.a,{sm:9},r.a.createElement(j.a,{type:"password",name:"password",value:this.state.password,placeholder:this.props.fm.state.user?"New Password":"Password",onChange:function(t){return e.update("password",t.target.value)}})),$(this.state.error.password)?r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.password)):null),r.a.createElement(y.a,{controlId:"formConfirm",validationState:$(this.state.error.password_confirmation)?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Confirm"),r.a.createElement(g.a,{sm:9},r.a.createElement(j.a,{type:"password",name:"password_confirmation",value:this.state.password_confirmation,placeholder:this.props.fm.state.user?"New Password":"Password",onChange:function(t){return e.update("password_confirmation",t.target.value)}})),$(this.state.error.password_confirmation)?r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.password_confirmation)):null)):r.a.createElement(y.a,null,r.a.createElement(g.a,{sm:4},r.a.createElement(q.a,{bsStyle:"link",onClick:function(t){e.setState({pw:!0})}},"Change password?"))),r.a.createElement(y.a,null,r.a.createElement(g.a,{smOffset:2,sm:4},r.a.createElement(q.a,{bsStyle:"primary",type:"submit"},r.a.createElement("i",{className:"fa fa-btn fa-user"})," ",this.props.fm.state.user?"Update":"Register"))))))}}]),t}(s.Component),le=a(34),ie={"\xb1":"+-","\u2013":"\\-","\u02fd":"\\ ","\u221a":"\\2","\u03c0":"\\p","\u222b":"\\[","\u2248":"~=","\u2260":"/=","\u2265":">=","\u2264":"<=","\xf7":"\\/","\u2261":"==","\u2026":"...","\u21d2":"=>","\u27fa":"<>","\u2192":"->","\u221e":"\\i","\u03b1":"\\a","\u03b2":"\\b","\u03b3":"\\g","\u03b4":"\\d","\u0394":"\\D","\u03f5":"\\e","\u03bc":"\\m","\u03bb":"\\l","\u03c3":"\\s","\u03a3":"\\S","\u03b8":"\\t","\u03a0":"\\P","\u2229":"\\^","\u222a":"\\v","\xd7":"\\*","\u22c5":"\\.","\xb0":"\\o"},oe={"%":"\\%",du:"du",dy:"dy",dx:"dx","\u03b1":"\u03b1","\u03b2":"\u03b2","\u03b3":"\u03b3","\u03b4":"\u03b4","\u03f5":"\u03f5","\u03bc":"\u03bc","\u03bb":"\u03bb","\u03c0":"\u03c0","\u03c3":"\u03c3","\u03b8":"\u03b8","\u03a3":"\u03a3","\u2026":"\u2026","\xb0":"\xb0","\u0394":"\u0394"},ce={"\u2265":"\u2265","\u2264":"\u2264","\u2260":"\u2260","\u2261":"\u2261","\u2248":"\u2248","\u21d2":"\u21d2","\u221d":"\u221d","\u27fa":"\u27fa"},ue={"\xf7":"\xf7","\xb1":"\xb1","\u2013":"-","\u221a":"\u221a","\u2229":"\u2229","\u222a":"\u222a","\xd7":"\xd7","\u22c5":"\u22c5","\u02fd":"\u02fd"},pe="+-*/^(),=<>{}[]|~\xb1";function me(e){return!isNaN(e)&&""!==e&&!1!==e&&!0!==e&&null!==e}function he(e){return"string"===typeof e||me(e)}function fe(e){return e&&"object"===Object(le.a)(e)&&e.op}function de(e){return"string"===typeof e&&null!==e.match(/([0-9]+)\xb0(?:([0-9]+)')?(?:([0-9]+)'')?$/)}function ve(e){"undefined"===typeof e&&console.error("normalise() called with null tree");var t=e;if(t&&!he(t)){var a=ve(t.left),s=ve(t.right);if("^"===t.op&&we(s)){var r=je(s);t=it("1","/",1*r===1?a:it(a,"^",r))}else t="*"===t.op||" "===t.op||"("===t.op?function e(t,a){var s;s=be(t)&&be(a)?it(e(t.left,a.left),"/",e(t.right,a.right)):be(t)?it(e(t.left,a),"/",t.right):be(a)?it(e(t,a.left),"/",a.right):1*t===1?a:1*a===1?t:it(t,"*",a);return s}(a,s):"\u221a"===t.op?it(s,"^",it("1","/","2")):it(a,t.op,s)}return t}function be(e){return fe(e)&&"/"===e.op}function ge(e){var t=!1;return fe(e)?me(e.left)&&"/"===e.op&&me(e.right)?t=!0:me(e.left)&&"\u02fd"===e.op&&be(e.right)?t=ge(e.right):we(e)&&(t=ge(je(e))):t=!1,t}function ke(e,t,a,s){var r,n,l;return e===t?r=!0:(n=ze(e,s),l=ze(t,s),r=!1!==e&&!1!==t&&function e(t,a,s,r){"undefined"===typeof s&&(s=!0);var n=!1;if(me(t)&&me(a))n=Ee(t,a,r);else if(null===t||null===a)n=t===a;else if(he(t)&&he(a))n=t===a;else if(he(t)||he(a))n=!1;else if(e(t.right,a.right,!0,r))" "!==t.op&&"("!==t.op||(t.op="*")," "!==a.op&&"("!==a.op||(a.op="*"),n=t.op===a.op&&e(t.left,a.left,!0,r);else if(we(t)&&e(je(t),je(a),!1,r))n=!0;else if(s)for(var l,i=0;!1===n&&(l=Oe(a,i++));)n=e(t,l,!1,r);else n=!1;return n}(ve(n),ve(l),!0,a)),r}function Ee(e,t,a){if(!me(e)||!me(t))return e===t;if(e=e*=1,t=t*=1,a&&""!==a)if(a.endsWith("sf"))var s=e.toPrecision(a[0])===t.toPrecision(a[0]);else a.endsWith("dp")&&(s=e.toFixed(a[0])===t.toFixed(a[0]));else s=e.toPrecision(10)===t.toPrecision(10);return s}function ye(e,t,a,s){var r,n;return r=ze(e,s),""!==Z?e===t:(n=ze(t,s),""!==Z?e===t:(r=Ue(r,s),n=Ue(n,s),Array.isArray(r)||Array.isArray(n)?function(e,t,a){if(!Array.isArray(e)||!Array.isArray(t)||0===e.length||e.length!==t.length)return!1;for(var s=!0,r=0,n=[];s&&r<e.length;){if(a&&","===a[0]){for(var l=!1,i=0;i<t.length&&!l;i++)n.includes(i)||(l=Ee(e[r],t[i],a.substr(1)));l&&n.push(i-1),s=l}else s=Ee(e[r],t[r],a);r++}return s}(r,n,a):Ee(r,n,a)))}function Oe(e,t){null===e&&console.error("commute() called with null inputTree");var a,s=e,r=0,n=[];if(!he(s))for(var l=pt(s.op);!he(s)&&pt(s.op)===l;)n[r]={right:s.right,op:s.op},s=s.left,r++;if(""===s&&"-"===n[r-1].op?(r--,(s=n.pop()).left="",r===t+1&&(n[r]=s)):r===t+1&&(n[r]={right:s,op:l===pt("+")?"+":"*"}),r>t){var i;if(r===++t&&("-"===n[0].op?s=je(n[0].right):s=("*"===(a=n[0].op)||"+"===a||" "===a||"("===a||","===a)&&n[0].right),!1!==s)for(i=r-1;i>0;i--)s=t===i?it(s,n[0].op,n[0].right):it(s,n[i].op,n[i].right);!1!==s&&(s=we(n[t].right)&&"+"===n[t].op?it(s,"-",je(n[t].right)):it(s,n[t].op,n[t].right))}else s=!1;return s}function je(e){return we(e)?""===e.left?e.right:it(je(e.left),e.op,e.right):he(e)||"*"!==e.op&&" "!==e.op&&"("!==e.op?it("","-",e):it(je(e.left),e.op,e.right)}function we(e){return fe(e)&&(""===e.left&&"-"===e.op||("*"===e.op||" "===e.op||"("===e.op||"/"===e.op)&&we(e.left))}function qe(e,t){var a=function e(t,a,s,r){if(!t)return"";var n="";var l;a&&(r=r||"/"===t.op||"^"===t.op&&"right"===a);a?"left"===a?(l=t.left,s=t):"right"===a&&(l=t.right):l=t;if(fe(l)){var i=e(l,"left",s,!1,r),o=e(l,"right",s,r),c=l.op;"*"!==c&&"("!==c&&")"!==c&&" "!==c||(c="-"!==o[0]&&isNaN(o[0])&&"\\dfrac"!==o.substring(0,6)?" ":"("===c?"(":"\xd7"),n="/"===c?r?"\\frac{"+i+"}{"+o+"}":"\\dfrac{"+i+"}{"+o+"}":"\u02fd"===c?"{\\Large{"+i+"}}"+o:"^"===c?Ae(t,a)?-1!==i.indexOf("\\dfrac")?"\\Big("+i+"\\Big)^{"+o+"}":"("+i+")^{"+o+"}":i.startsWith("(")&&-1!==i.indexOf("\\dfrac")?"\\Big"+i.substring(0,i.length-1)+"\\Big)^{"+o+"}":i+"^{"+o+"}":"|"===c?"\\left|"+o+"\\right|":"\u221a"===c?"\\sqrt{"+o+"}\\,":"(,)"===c?"("+i+","+o+")":"-"!==c||he(l.right)||"+"!==l.right.op&&"-"!==l.right.op?Ye(c)?function e(t){if(he(t))return!1;if(Ye(t.op))return!0;if("*"===t.op||"("===t.op||")"===t.op||" "===t.op)return e(t.left)||e(t.right)}(l.right)?"\\"+c+"("+o+")":!Ae(l,"right")||fe(l.right)&&"^"===l.right.op?-1!==o.indexOf("\\times")||-1!==o.indexOf("(")?"\\"+c+"("+o+")":"left"===a&&(" "===t.op||"*"===t.op&&Qe(t.right)||"^"===t.op)?"\\"+c+"("+o+")":"right"===a&&fe(s)&&!Ae(s,"left")&&("*"===s.op&&Qe(s.right)||" "===s.op)?"\\"+c+"("+o+")":"f"===c?c+"("+o+")":"\\"+c+"{"+o+"}":"f"===c?i+" "+c+"{"+o+"}":i+"\\"+c+"{"+o+"}":Ae(t,a)?"("+i+c+o+")":"("===c?i+"("+o+")":i+c+o:""!==l.right.left?i+c+"("+o+")":i+c+"{"+o+"}",Fe="="===c?o:n}else n=me(l)&&1*l===0?"0":1*l===1?"1":""+l,Fe=n;return""+n}(ze(e,t)),s=null;return""!==Z?(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),s='<span class="red">'+("?"!==Z?"?":"")+Z+"</span>"+e):s=tt(a).replace(/_('?[a-zA-Z0-9]+)/g,"_{$1}").replace(/'([a-zA-Z][a-zA-Z0-9]*)/g,"\\text{$1}"),Q("mj")&&console.log("mj(maths,vars)=",e,t,a,s),s}function Se(e,t){for(var a=[],s="",r=0;r<e.length;r++)"{"===e[r]?Pe=!0:"}"===e[r]&&(Pe=!1),-1!==pe.indexOf(e[r])||et("symbol",e[r])?(s.length>0&&(s=xe(s,t,a,!0)),s=xe(e[r],t,a,!0)):(s.length>0&&(isNaN(s)&&"."!==s)!==(isNaN(e[r])&&"."!==e[r])&&(s=xe(s,t,a,!0)),s=xe(s+=e[r],t,a,!1));return s&&xe(s,t,a,!0),Q("token_split")&&console.log("token_split(maths,vars)",e,t,a,s),Pe=!1,a}function xe(e,t,a,s){var r="";if("_"===e&&a.length)r=a[a.length-1]+"_",a.length--;else if(s&&a.length&&a[a.length-1].endsWith("_"))a[a.length-1]+=e,r="";else{for(var n=e,l=-1,i="",o=a.length;o>=0&&((Ye(n,t)||rt(n,t)||de(n))&&(l=o,i=n),0!==o&&-1===pe.indexOf(a[o-1]));o--)n=""+a[o-1]+n;-1!==l?(l<a.length&&(a.length=l),a[l]=function(e,t){return-1!==at(t).indexOf(e)?e:-1!==at(t).indexOf("'"+e)?"'"+e:-1!==at(t).indexOf(e.replace("_","_'"))?e.replace("_","_'"):-1!==at(t).indexOf("'"+e.replace("_","_'"))?"'"+e.replace("_","_'"):e}(i,t)):s||1===e.length&&e.match(/[a-z]/i)?a.push(e):r=e}return Q("longest")&&console.log("longest(token,vars,ret,store)=",e,t,a,s,r),r}function Ce(e,t,a){var s=e;if("undefined"===typeof a&&(a=""),"undefined"===typeof t&&(t=0),fe(e)){var r=pt(e.op);"-"===e.op&&""===e.left&&(r=pt("*")),s=Ce(e.left,r)+(" "===e.op?"":e.op)+Ce(e.right,r,e.op),(r<t||"/"===a&&r===pt("*")&&"/"!==e.op)&&(s="("+s+")")}return!1===s||""===s?s:me(s)&&1*s===0?"0":1*s===1?"1":""+s}function Ne(e){return e?function e(t){return fe(t)?it(e(t.left),t.op,e(t.right)):"0.0"===t?0:"1.0"===t?1:t}(function e(t){if(!fe(t))return t;var a=" "===t.op||"("===t.op?"*":t.op;var s=e(t.left);var r=e(t.right);var n;!we(r)||"+"!==t.op&&"-"!==t.op?n=it(s,t.op,r):(r=je(r),"+"===t.op?(a="-",n=it(s,"-",r)):"-"===t.op&&(a="+",n=it(s,"+",r)));"0.0"===s?"*"===a?n="0.0":"+"===a?n=r:"-"===a&&(n="0.0"===r?"0.0":it("","-",r)):"0.0"===r?"*"===a?n="0.0":"+"===a||"-"===a?n=s:"^"===a&&(n="1.0"):"1.0"===s?"*"===a?n=r:"^"===a&&(n="1.0"):"1.0"===r?"*"!==a&&"^"!==a||(n=s):"*"===a&&(_e(s)?n=it("","-",r):_e(r)&&(n=it("","-",s)));return n}(e)):e}function _e(e){return fe(e)&&""===e.left&&"-"===e.op&&1*e.right===1}function Ae(e,t){var a;return"undefined"===typeof t?a=e:"left"===t?a=e.left:"right"===t&&(a=e.right),!!fe(a)&&("/"!==e.op&&("right"!==t||"^"!==e.op&&"\u221a"!==e.op)&&(!("^"!==a.op||!fe(a.left)||"^"!==a.left.op&&"/"!==a.left.op)||("-"!==a.op||""!==a.left||"^"===e.op)&&pt(e.op)>pt(a.op)))}var Me,Te,Fe="";function Qe(e){return!(fe(e)&&Ye(e.op))}var We,Pe=!1;function ze(e,t){var a="";if(Z="",Me=null,Te=0,Pe=!1,"undefined"===typeof e||null===e||""===e)a=null;else{if(Me=Se(e,t),"="===ot()||et(ce,ot()))a=it("",ut(),Re(Xe(t),0,t));else a=Re(Xe(t),0,t);Te!==Me.length?Z="E"+ct():Z&&("="===ct()||et(ce,ct()))&&(Z=""),a=""===Z&&Ne(a)}return Q("parse_expression=")&&console.log("parse_expression(expression,vars)=ret,tokens,parseError",e,t,a,Me,Te,Z),a}function De(e,t){return"("===e||Ye(e,t)||e.length>0&&-1===pt(e)&&")"===ct()?"*":rt(e,t)||"\u221a"===e?" ":e}function Be(e,t){return Ye(e,t)?pt("+")+.5:pt(De(e,t))}function He(e,t){var a=null;return t&&rt(e,t)?a=e:t&&fe(e)&&","===e.op&&!nt(e.right)&&rt(e.right,t)&&(a=e.right),Q("variable")&&console.log("variable(lhs,vars)=",J(e),J(t),a),a}function Re(e,t,a){if(""!==Z)return"";for(var s="",r=ot();""===Z&&")"!==r&&"}"!==r&&"|"!==r&&"]"!==r&&Be(r,a)>=t;){s=De(r,a)!==r?"("===r?"(":De(r,a):ut();var n=Xe(a);for(r=ot();""===Z&&")"!==r&&"}"!==r&&"|"!==r&&"]"!==r&&(Be(r,a)>pt(s)||Ie(r)&&pt(r)===pt(s));)n=Re(n,Be(r,a),a),r=ot();var l=void 0;!Pe&&"="===s&&(l=He(e,a))?(Q("parse_expression_1")&&console.log("var set",l,n),a[l]=n):"="===s&&Q("parse_expression_1")&&console.log("var not set",J(e),"=",J(n)),e=it(e,","!==s||")"!==r||Pe?s:"(,)",n)}return e}function Ie(e){return"^"===e}function Le(e,t,a){var s,r,n=t&&void 0!==t[e]?t[e]:e;return fe(n)||"string"===typeof n&&t&&void 0!==t[n]?(a||(a=[]),-1===a.indexOf(e)?(a.push(e),n=Ue(n,t,a)):n=e):n=function(e){var t=e;if("string"===typeof e&&-1!==t.indexOf("/")){var a=t.startsWith("-");a&&(t=t.substring(1));var s=t.split("/"),r=Object(N.a)(s,2),n=r[0],l=r[1];t=it(n,"/",l),a&&(t=it("","-",t))}Q("checkFraction")&&console.log("checkFraction(f)=",e,t);return t}(n),"\u03c0"===n?n=Math.PI:"e"===n?n=Math.E:de(n)&&(r=s=n,de(s)&&(r=s.replace(/([0-9]+)\xb0(?:([0-9]+)')?(?:([0-9]+)'')?$/,function(e,t,a,s,r,n){var l=(1*t+(a||0)/60+(s||0)/360)*Math.PI/180;return Q("radians")&&console.log("radians",l,e,t,a,s,r,n),l})),n=r),Q("substitute")&&console.log("substitute(s,var)=",e,t,n,a),n}function Ue(e,t,a){var s=0;if(""===e)return"";if(!e)return console.log("evaluate",e,t,null),e;if(he(e))s=Le(e,t,a);else{var r=Ue(e.left,t),n=Ue(e.right,t);if((""===r||me(r))&&me(n))switch(e.op){case"+":case"\u02fd":s=1*r+1*n;break;case"\xb1":s=[1*r+1*n,1*r-1*n];break;case"-":s=r-n;break;case"*":case" ":case"(":case"\xd7":s=r*n;break;case"\xf7":case"/":if(1*n!==0)if(Pe&&Math.round(r)===1*r&&Math.round(n)===1*n){var l=(r<0||n<0)&&!(r<0&&n<0),i=Je({n:Math.abs(r),d:Math.abs(n)});s=1===i.d?i.n:it(i.n,"/",i.d),l&&(s=it("","-",s))}else s=r/n;else s="@"+r+"/"+n+"divide by zero";break;case"^":s=Math.pow(r,n);break;case"|":s=Math.abs(n);break;case"\u221a":s=Math.pow(n,.5);break;case"~":s=Ot(1*r,1*n);break;case"=":s=Pe?1*r===1*n?1:0:"@"+r+"="+n;break;case"\u2260":s=Pe?1*r===1*n?0:1:"@"+r+"\u2260"+n;break;case">":s=Pe?1*r>1*n?1:0:"@"+r+">"+n;break;case"<":s=Pe?1*r<1*n?1:0:"@"+r+"<"+n;break;case"\u2265":s=Pe?1*r>=1*n?1:0:"@"+r+"\u2265"+n;break;case"\u2264":s=Pe?1*r<=1*n?1:0:"@"+r+"\u2264"+n;break;case",":s=[r,n];break;default:s=Ye(e.op)?Ge(e.op,n):"@@"+r+e.op+n}else if(Array.isArray(r)||Array.isArray(n))s=function(e,t,a){var s=[];Array.isArray(e)?s=e.map(function(e){return Ue({left:e,op:t,right:a})}):Array.isArray(a)&&(s=a.map(function(a){return Ue({left:e,op:t,right:a})}));return s}(r,e.op,n);else if(!1===(s=function(e){if(ge(e)||me(e))return e;if(!fe(e))return!1;var t,a=!1,s=!1,r=Ve(e.left);t=","===e.op&&nt(e.right)?e.right:Ve(e.right);if(!1!==r&&!1!==t)switch(e.op){case"+":a=$e(r,t);break;case"-":a=$e(r,{n:-t.n,d:t.d});break;case"*":case"(":case" ":case"\xd7":a=Ke(r,t);break;case"\xf7":case"/":a=Ke(r,{n:t.d,d:t.n});break;case"^":a=1*e.right===2?Ke(r,r):1*e.right===-1&&{n:r.d,d:r.n};break;case",":"mixed"===t?(s=!0,a=r):a=function(e,t){var a;if("numerator"===t)a=e.n;else if("denominator"===t)a=e.d;else if("whole"===t)a=Math.floor(e.n/e.d);else if("fractional"===t)a={n:e.n-Math.floor(e.n/e.d)*e.d,d:e.d};else if("improper"===t)a=e.n>e.d?1:0;else{var s=(r=e.d,n=t.d,r*n/Ot(r,n)/e.d);a={n:e.n*s,d:e.d*s}}var r,n;return a}(r,t);break;case"~":a={n:r.n/Ot(r.n,t.d),d:r.d/Ot(r.d,t.n)};break;case"=":a=r.n===t.n&&r.d===t.d?1:0;break;case"\u2260":a=r.n===t.n&&r.d===t.d?0:1;break;case">":a=r.n*t.d>t.n*r.d?1:0;break;case"<":a=r.n*t.d<t.n*r.d?1:0;break;case"\u2265":a=r.n*t.d>=t.n*r.d?1:0;break;case"\u2264":a=r.n*t.d<=t.n*r.d?1:0;break;default:a=!1}if(a&&a.d){var n=a.n<0;n&&(a.n=-a.n);var l=Math.floor(a.n/a.d);0===a.n?a=0:a.n/a.d===l?a=n?it("","-",l):l:s&&l>0?(a.n-=a.d*l,a=n?it("","-",it(l,"\u02fd",it(a.n,"/",a.d))):it(l,"\u02fd",it(a.n,"/",a.d))):(a=it(a.n,"/",a.d),n&&(a=it("","-",a)))}else a<0&&(a=it("","-",-a));Q("fraction_op")&&console.log("fraction_op(t)=",e,a);return a}(it(r,e.op,n)))){var o=null;Ye(e.op)&&(o=Ve(e.right))?s=Ge(e.op,o.n/o.d):","===e.op&&(me(r)||(o=Ve(r)))&&(n.endsWith("dp")||n.endsWith("sf"))?(r=o?o.n/o.d:r,s=n.endsWith("dp")?(1*r).toFixed(n.substr(0,n.length-2)):(1*r).toPrecision(n.substr(0,n.length-2))):s=""+r+e.op+n}}return Q("evaluate")&&console.log("evaluate(t,vars)=",e,t,s),s}function Je(e){var t=Ot(e.n,e.d);return{n:e.n/t,d:e.d/t}}function $e(e,t){return Je({n:e.n*t.d+t.n*e.d,d:e.d*t.d})}function Ke(e,t){return Je({n:e.n*t.n,d:e.d*t.d})}function Ve(e){var t=!1;if(me(e))t={n:1*e,d:1};else if(be(e))t={n:1*e.left,d:1*e.right};else if(we(e)){var a=je(e);me(a)?t={n:-1*a,d:1}:be(a)&&(t={n:-1*a.left,d:1*a.right})}else if(fe(e)&&"\u02fd"===e.op)(t=Ve(e.right)).n=t.n+e.left*t.d;else if(he(e)&&-1!==e.indexOf("/")){var s=e.split("/"),r=Object(N.a)(s,2);t={n:1*r[0],d:1*r[1]}}return Q("fraction")&&console.log("fraction(s)=",e,t),t}function Ge(e,t){var a,s="",r=e.indexOf("^");if(r>0&&(s=e.substring(r+2,e.length-1),e=e.substring(0,r),1*s===-1&&(e="a"+e)),me(t))switch(e){case"sin":a=Math.sin(t);break;case"cos":a=Math.cos(t);break;case"tan":a=Math.tan(t);break;case"cosec":a=1/Math.sin(t);break;case"sec":a=1/Math.cos(t);break;case"cot":a=1/Math.tan(t);break;case"asin":a=Math.asin(t);break;case"acos":a=Math.acos(t);break;case"atan":a=Math.atan(t);break;case"acosec":a=Math.asin(1/t);break;case"asec":a=Math.acos(1/t);break;case"acot":a=Math.atan(1/t);break;case"ln":a=Math.log(t);break;default:console.error("evaluate not yet supported",e,t),a=[e,t]}else a=[e,t];return s>0&&(a=Math.pow(a,s)),a.toString()}function Xe(e){if(""!==Z)return"";var t=ct(),a=ut();if("("===a)a=Re(Xe(e),0,e),")"!==ot()?mt(")"):ut();else if("|"===a)a=Re(Xe(e),0,e),"|"!==ot()?mt("|"):(ut(),a=it("","|",a));else if("["===a)a=Re(Xe(e),0,e),"]"!==ot()?mt("]"):(ut(),a=it("","[]",a));else if("{"===a){if(Pe?mt("{"):"'"===ot()?ut():Pe=!0,a=Re(Xe(e),0,e),"}"!==ot())mt("}");else if(ut(),Pe){var s=Ue(a,e);me(s)?a=s<0?it("","-",-s):1*s===0?"0.0":1*s===1?"1.0":s:de(s)?a=s:we(s)&&me(je(s))?a=s:ge(s)?a=s:Array.isArray(s)&&(a=it(s[0],",",s[1])),Pe=!1}}else if("\u221a"===a||Ye(a,e)){var r=pt(a);if(Ye(a,e)&&"("===ot()&&(r=pt("^")+1),Ze(a)&&"^"===ot()){ut();var n=ut();"-"===n&&"1"===ot()?(n=ut(),a+="^{-1}"):isNaN(n)?mt(n):a+="^{"+n+"}","("===ot()&&(r=pt("^")+1)}else if("log_"===a&&"{"===ot()){ut();var l=ut();"}"!==ot()?mt("}"):ut(),a+="{"+l+"}"}a=it("",a,Re(Xe(e),r,e))}else"-"!==a&&"\xb1"!==a&&"\u2013"!==a||!(Ye(ot())||rt(ot(),e)||lt(ot())||de(ot())||"{"===ot()||"("===ot()||"\u221a"===ot())?"."===a?a="":0!==a.length&&(rt(a,e)||lt(a)||de(a))||mt(a):a=it("",a,Re(Xe(e),"^"===t?pt("^")-1:pt("\u02fd"),e));return a}function Ye(e,t){return Ze(e)||function(e){return"string"===typeof e&&null!==e.match(/^(ln|log(_[0-9]+)?)$/)}(e)}function Ze(e){return"string"===typeof e&&null!==e.match(/^(sin|cos|tan|cosec|sec|cot)(\^{(-1|[0-9]+)})?$/)}function et(e,t){return"symbol"===e?oe[t]||ce[t]||ue[t]:!!e[t]}function tt(e){for(var t="",a=0;a<e.length;a++)"undefined"!==typeof oe[e[a]]?t+=oe[e[a]]+" ":"undefined"!==typeof ce[e[a]]?t+=ce[e[a]]+" ":"undefined"!==typeof ue[e[a]]?t+=ue[e[a]]+" ":t+=e[a];return t}function at(e){return e&&e.xyz?e.xyz.replace(/,/g," ").split(" "):["x","y","z"]}function st(e,t){return"string"===typeof e&&(-1!==at(t).indexOf(e)||-1!==at(t).indexOf("'"+e)||-1!==at(t).indexOf(e.replace("_","_'"))||-1!==at(t).indexOf("'"+e.replace("_","_'")))}function rt(e,t){var a=!1;return a="string"===typeof e&&(!Ye(e)&&(!(!st(e,t)&&"e"!==e&&!et(oe,e))||(!(!e.endsWith("'")||!st(e.substring(0,e.length-1),t))||!!Pe&&(!(!t||void 0===t[e])||nt(e))))),Q("algebra")&&console.log("algebra(token,vars)condition=",e,t,Pe,a),a}function nt(e){return"dp"===e||"sf"===e||"improper"===e||"fractional"===e||"whole"===e||"mixed"===e||"denominator"===e||"numerator"===e||"mixed"===e}function lt(e){return e.match(/^[0-9]*(\.)?[0-9]+$/)}function it(e,t,a){var s="undefined"!==typeof t?t:"";if(""!==s)var r={left:e,op:s,right:"undefined"!==typeof a?a:""};else r=e;return r}function ot(){return Te<0||Te===Me.length?"":Me[Te]}function ct(){return Te<1?"":Me[Te-1]}function ut(){var e;return Te<0||Te===Me.length?e="":"+"===(e=Me[++Te-1])&&Te<Me.length&&"/"===Me[Te]&&(e+=Me[Te++]),e}function pt(e){return"="===e||"<"===e||">"===e||et(ce,e)?1:","===e?Pe?1.5:1:"~"===e&&Pe?1.5:"+"===e||"-"===e||"\u2013"===e||"\xb1"===e?2:"\u02fd"===e?2.5:"*"===e||"\xd7"===e||"("===e||"\u22c5"===e?4:"/"===e||"\xf7"===e?4:Ye(e)?3:" "===e?4:"\u221a"===e||"^"===e?7:-1}function mt(e){Q("parse_error")&&console.error("parse_error(expected),tokens,pos",e,Me,Te),Z=""===e?"?":e}var ht=0;function ft(e){if(ht>=We.length)return-1;var t=We.charAt(ht++);if(-1!==" \r\n[]\\?".indexOf(t)){if("\\"===t&&"("===We.charAt(ht)){for(t+=We.charAt(ht++);ht<We.length-1&&("\\"!==We.charAt(ht)||")"!==We.charAt(ht+1));)t+=We.charAt(ht++);"\\"===We.charAt(ht)&&")"===We.charAt(ht+1)&&(t+=We.charAt(ht++),t+=We.charAt(ht++))}else"?"===t?t=function(e){var t="?";if(ht<We.length&&"{"===We.charAt(ht)){for(var a=ht,s=ht++;s<We.length&&-1==="\n:;}".indexOf(We.charAt(s));)s++;if("}"===We.charAt(s)){ht=++s;var r=We.substring(a,s);for(a=s;s<We.length&&-1==="\n:;".indexOf(We.charAt(s));)s++;var n="",l="";if(s>a&&(n=We.substring(a,s)),":"===We.charAt(s)){for(a=++s;s<We.length&&-1==="\n:;".indexOf(We.charAt(s));)s++;s>a&&(l=We.substring(a,s))}s<We.length&&"\n"!==We.charAt(s)&&s++,ht=s;var i=Ue(ze(r,e));t=1*i!==0?n:l}else t={text:"?{",error:"?{ with no matching }"}}else if(ht<We.length&&"="===We.charAt(ht)){a=s=++ht;for(;s<We.length&&-1==="\n;?=".indexOf(We.charAt(s));)s++;s>a&&(t=We.substring(a,s));var o=Fe,c=qe(t,e);""!==Z?t={text:"?=",error:"expression parse error"}:(t=o===c?"":"="+t,s<We.length&&";"===We.charAt(s)&&s++,ht=s)}return t}(e):"["===t&&(t=function(){var e="[",t=!1,a=ht;for(;ht<We.length-1&&"]"!==We.charAt(ht);)"\n"===We.charAt(ht)&&(t=!0),e+=We.charAt(ht++);if("]"===We.charAt(ht)){if(ht++,t)return e+"]";if("_"===We.charAt(ht)){var s=kt(We,ht),r=We.substr(ht,s-ht);ht=s,Z="";var n=qe(e.substr(1));return console.log("[]_^",e,n,r,s),""===Z?"\\(\\Big["+n+"\\Big]"+r+"\\)":"\\(\\Big["+e.substr(1)+"\\Big]"+r+"\\)"}var l=e.substr(1).split(",");return 1===l.length?1===l[0].length?"\\(\\utilde{"+l[0]+"}\\)":0===l[0].indexOf("|")&&l[0].substr(1).indexOf("|")===l[0].length-2?"\\(|\\overrightarrow{"+l[0].substr(1,l[0].length-2)+"}|\\)":"\\(\\overrightarrow{"+l[0]+"}\\)":"\\(\\begin{pmatrix}"+e.substr(1).split(",").join("\\\\")+"\\end{pmatrix}\\)"}return ht=a,"["}());return t}for(;ht<We.length&&-1===" \r\n[]\\?".indexOf(We.charAt(ht));)t+=We.charAt(ht++);return t}function dt(e,t){for(var a,s,r=e;-1!==(a=e.indexOf("{"))&&-1!==(s=e.indexOf("}"));)if(s<a)e=e.substr(s+1);else{for(var n=e.substring(a+1,s);-1!==(a=n.indexOf("{"));)n=n.substr(a+1);if("'"===n[0]){var l=qe(n.substr(1));r=""===Z?r.replace("{"+n+"}","{"+l+"}"):r.replace("{"+n+"}","{"+n.substr(1)+"}")}else if(t){var i=Ue(ze("{"+n+"}",t));""===Z&&(r=r.replace("{"+n+"}","{"+(i!==n?i:qe(n))+"}"))}e=e.substr(s+1)}return r}function vt(e,t,a,s){if("\n"===t)e.push({chunk:"\n",type:"newline"});else if(0===t.indexOf("\\(")){var r=t.indexOf("\\)");r===t.length-2?"integral"===a||-1!==t.indexOf("//Big]_")?vt(e,tt(dt(t.substring(2,r),s)).replace(/\\'/g,"\\").replace(/\\dfrac/g,"\\frac"),"latex"):vt(e,tt(dt(t.substring(2,r),s)).replace(/\\'/g,"\\"),"latex"):e.push({chunk:t,error:"\\( with no matching \\)",type:"error"})}else e.length>0&&e[e.length-1].type===a?e[e.length-1].chunk+=t:e.length>0&&("maths"===e[e.length-1].type&&"latex"===a||"latex"===e[e.length-1].type&&"maths"===a)?(e[e.length-1].chunk+=t,e[e.length-1].type=a):e.push({chunk:t,type:a})}function bt(e,t){if(-1!==e.indexOf("\\(")||-1!==e.indexOf("</")||-1!==e.indexOf("class=")||-1!==e.indexOf("target=")||e.endsWith("^")||e.endsWith("\u221a"))return!1;var a=!1;["^","+","=","{","[","/"].forEach(function(t){-1!==e.indexOf(t)&&(a=!0)}),/-?[0-9]*/.test(e)&&(a=!0),ze(e,t)&&(a=!0);for(var s=0;!a&&s<e.length;s++)ie[e.charAt(s)]&&(a=!0);return a}function gt(e,t,a){var s="";(e.endsWith(".")||e.endsWith(","))&&(s=e.substring(e.length-1,e.length),e=e.substring(0,e.length-1));var r=qe(e,a);""===Z?vt(t,r,"maths"):function(e,t,a){if(-1===e.indexOf("\u222b"))vt(t,"\\("+e+"\\)","latex");else{var s=e.split(/(?=\u222b)/g);s.forEach(function(e){"\u222b"===e[0]?function(e,t,a){var s=null,r=null,n=null,l=null;if(e.indexOf("=")>0){var i=e.split(/(?==)/),o=Object(N.a)(i,2);e=o[0],r=o[1]}var c=kt(e,1);s=e.substr(0,c);var u=e.length;u>=2&&"d"===e[u-2]&&(l=e.substr(u-2,2),u-=2);u>c&&(n=e.substr(c,u-c));s.indexOf("_")>-1?vt(t,"\\(\\displaystyle"+s+"\\)","integral"):vt(t,"\\("+s+"\\)","latex");n&&gt(n,t,a);l&&vt(t,"\\(\\;"+l+"\\)","latex");r&&gt(r,t,a)}(e,t,a):gt(e,t,a)})}}(e,t,a),""!==s&&vt(t,s,"html")}function kt(e,t){return console.log("limits",e.substr(t,5),t),t||(t=0),"_"===e.charAt(t)&&(t++,"{"===e.charAt(t)&&e.indexOf("}",t)>t&&(t=e.indexOf("}",t)),t++,"^"===e.charAt(t)&&(t++,"{"===e.charAt(t)&&e.indexOf("}",t)>t&&(t=e.indexOf("}",t)),t++)),t}function Et(e){var t=""+e;return t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<r>/g,'<span class="red">')).replace(/<o>/g,'<span class="amber">')).replace(/<g>/g,'<span class="green">')).replace(/<h>/g,"<h5>")).replace(/<\/r>/g,"</span>")).replace(/<\/o>/g,"</span>")).replace(/<\/g>/g,"</span>")).replace(/<\/h>/g,"</h5>")}function yt(e){for(var t=0;t<e.length&&-1===" \r\n\\'[](){}.,@".indexOf(e[t]);)t++;return{name:e.substring(0,t),end:t===e.length?"":e.substring(t)}}function Ot(e,t){var a=1;return me(e)&&me(t)&&(a=1*t===0?1*e:1*t===1?e%t:Ot(t,e%t)),a>0?a:0===a?1:-a}function jt(e,t,a){Q("setVariables")&&console.log("setVariables",e,t,a);var s=wt(e,t);if(!s){var r,n=function(){var n,l,i={},o=[];"undefined"!==typeof e&&e.length>0&&(o=e.split("\n"));var c=function(){if(-1===o[r].indexOf("=")||-1!==o[r].indexOf("{")&&o[r].indexOf("{")<o[r].indexOf("="))return"continue";var e=o[r].substr(o[r].indexOf("=")+1),t=o[r].substr(0,o[r].indexOf("=")).split(",");e.length>0&&t.length>0&&t.forEach(function(t){"xyz"===(t=t.trim())?n=e:"keys"===t?l=e:t&&(i[t]=a?Ct(e):function(e){if("undefined"!==typeof window.FreeMaths&&"undefined"!==typeof window.FreeMaths.testing&&window.FreeMaths.testing)return e;if(e.length>0)for(var t=0;t<e.length;t++){var a=Math.floor(t+Math.random()*(e.length-t)),s=e[t];e[t]=e[a],e[a]=s}return e}(Ct(e)))})};for(r=0;r<o.length;r++)c();if(a)return{v:function(e,t){var a={false:0,true:0,opts:[]};a[!1]=0,a[!0]=0;var s=qt(e);for(;!1!==s&&a[!1]<65e3&&a[!0]<65e3;){var r=St(e,s);_t(r,t)?(a[!0]++,a.opts.push(r)):a[!1]++,s=xt(e,s)}return a}(i,Nt(e))};(s=function(e,t,a){var s=qt(e),r=J(s),n=St(e,s);for(;!1!==s&&!_t(n,t,a);)s=xt(e,s),n=St(e,s);if(!1===s){for(console.log("setVals - retry",s,r,e,t,a),s=J(r),n=St(e,s);!1!==s&&!_t(n,t,null);)s=xt(e,s),n=St(e,s);!1===s&&console.error("setVals",s,r,e,t)}return s?n:null}(i,Nt(e),t))&&n&&(s.xyz=n),s&&l&&(s.keys=l)}();if("object"===Object(le.a)(n))return n.v}return s}function wt(e,t){var a=Nt(e),s=!1,r=null;if(t&&t.use.length>0)for(var n=0;!s&&n<t.use.length;)s=_t(r=JSON.parse(t.use[n++]),a,t);return!!s&&r}function qt(e){for(var t={},a=Object.keys(e),s=0;s<a.length;s++)t[a[s]]=0;return t}function St(e,t){var a={};return Object.keys(e).forEach(function(s){a[s]=e[s][t[s]]}),a}function xt(e,t){for(var a=Object.keys(t),s=0;s<a.length;s++){if(t[a[s]]++,t[a[s]]<e[a[s]].length)return t;t[a[s]]=0}return!1}function Ct(e){var t=[];return e.startsWith("[")?t=function(e){var t=[];if(e.indexOf(",")>0)t=(t=e.split(",")).map(function(e){return me(e)?1*e:e});else if(e.indexOf("..")>0){var a=0,s=e.split("..");if(2===s.length)if(s[0].indexOf("/")>0&&s[1].indexOf("/")>0)t=function(e,t){var a,s,r=[],n=e.split("/"),l=t.split("/");if(me(n[0])&&me(n[1])&&me(l[0])&&me(l[1]))for(a=1;a<=9*l[0]/l[1];a++)for(s=2;s<=9;s++)a/s>=n[0]/n[1]&&a/s<=l[0]/l[1]&&1===Ot(a,s)&&r.push(a+"/"+s);return r}(s[0],s[1]);else for(var r=1*s[0];r<=s[1];r++)t[a++]=r}return t}(e.substr(1,e.indexOf("]")-1)):me(e)?t[0]=1*e:be(ze(e))?t[0]=e:t[0]=Ue(ze(e)),t}function Nt(e){var t=e.split("\n"),a=[];return t.forEach(function(e){var t,s;-1!==e.indexOf("]")&&(e=e.substring(e.indexOf("]")+1)),-1!==e.indexOf(":")&&(e=e.substring(e.indexOf("]")+1)),-1!==(t=e.indexOf("{"))&&-1===e.indexOf("{xyz=")&&-1!==(s=e.indexOf("}"))&&s>t&&a.push(e.substring(t,s+1))}),a}function _t(e,t,a){var s=!0;if(a&&function(e,t){for(var a=!1,s=0;s<t.length&&!a;)a=t[s]===JSON.stringify(e),s++;return a}(e,a.skip))s=!1;else for(var r=0;r<t.length;r++)t[r].startsWith("{\u2260")?function(){var a=t[r].substring(2,t[r].length-1).split(",");a.forEach(function(t){return a.forEach(function(a){t!==a&&e[t]===e[a]&&(s=!1)})})}():s=!(!s||!ze(t[r],e));return s}var At=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={question:D(a.props.qid),vars:a.props.vars?a.props.vars:jt(D(a.props.qid).variables),help:"",showHelp:!1},a.save=function(e){var t=a.state.question;e&&((t=J(t)).previous_id=t.id,t.id=0),JSON.stringify(D(a.props.qid))!==JSON.stringify(t)?a.props.fm.saveQ(t):(console.log("Question save: no changes"),a.props.close())},a.updateQuestion=function(e,t){if(a.state.question[e]!==t){var s=JSON.parse(JSON.stringify(a.state.question));s[e]=t,a.setState({question:s})}},a.changeVariables=function(){a.setState({vars:jt(a.state.question.variables)})},a.setQ=function(e){var t=a.props.questions[e.target.value-1];$(t.next)||(t.next=""),a.setState({vars:jt(t.variables),question:t})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.qid!==this.state.question.id&&this.setState({question:D(e.qid),vars:jt(D(e.qid).variables),showHelp:!1})}},{key:"shouldComponentUpdate",value:function(e,t){return JSON.stringify(t.question)!==JSON.stringify(this.state.question)||t.vars!==this.state.vars||t.help!==this.state.help||t.showHelp!==this.state.showHelp}},{key:"render",value:function(){var e=this;return r.a.createElement(x.a,{show:!0,bsSize:"large",onHide:this.props.close},r.a.createElement(x.a.Header,{closeButton:!0},r.a.createElement(x.a.Title,null,r.a.createElement(Mt,{q:this.state.question,qs:this.props.questions,setQ:this.setQ}))),r.a.createElement(x.a.Body,null,r.a.createElement(Tt,{fields:this.state.question,vars:this.state.vars,change:this.changeVariables,update:this.updateQuestion})),r.a.createElement(x.a.Footer,null,r.a.createElement(q.a,{onClick:function(){return e.save(!0)}},"Copy"),r.a.createElement(q.a,{onClick:function(){return e.save(!1)}},"Save")))}}]),t}(s.Component),Mt=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return $(this.props.qs)?r.a.createElement("select",{value:this.props.q.id,onChange:this.props.setQ},this.props.qs.map(function(e){return r.a.createElement("option",{value:e.id,key:e.id},e.id,": ",e.topic)})):r.a.createElement("div",null,this.props.q.id,": ",r.a.createElement(Dt,null,this.props.q.topic))}}]),t}(s.Component),Tt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,n=new Array(s),l=0;l<s;l++)n[l]=arguments[l];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={fields:null},a.renderFields=function(e,t){var s={};Object.keys(e).forEach(function(n){"undefined"!==typeof t?s[n]=r.a.createElement(Ft,{auto:a.props.auto,key:n,field:n,text:e[n],vars:t,update:a.props.update,change:a.props.change}):null===a.state.fields||a.props.fields[n]!==e[n]?s[n]=r.a.createElement(Ft,{auto:a.props.auto,key:n,field:n,text:e[n],vars:a.props.vars,update:a.props.update,change:a.props.change}):s[n]=a.state.fields[n]}),a.setState({fields:s})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return t.fields!==this.state.fields}},{key:"componentWillReceiveProps",value:function(e){null!==this.state.fields&&(e.vars!==this.props.vars?this.renderFields(e.fields,e.vars):e.fields!==this.props.fields&&this.renderFields(e.fields))}},{key:"componentDidMount",value:function(){this.renderFields(this.props.fields,this.props.vars)}},{key:"render",value:function(){var e=this;if(null===this.state.fields)return null;var t=Object.keys(this.state.fields).map(function(t){return e.state.fields[t]});return r.a.createElement("div",null,t)}}]),t}(s.Component),Ft=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={stats:{},text:a.props.text,caret:null},a.update=function(e){var t=a.text.selectionStart;if("json"!==a.props.field)var s=Ht(e.target.value,t);else s={text:e.target.value,caret:t};a.setState({text:s.text,caret:s.caret}),a.props.update(a.props.field,s.text)},a.setStats=function(){a.setState({stats:jt(a.props.text,null,!0)})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentDidUpdate",value:function(){null!==this.state.caret&&this.state.caret!==this.text.selectionStart&&this.text.setSelectionRange(this.state.caret,this.state.caret)}},{key:"componentWillReceiveProps",value:function(e){e.text!==this.state.text&&this.setState({stats:{},text:e.text})}},{key:"render",value:function(){var e=this;return"undefined"===typeof{json:1,working:1,variables:1,help:1,topic:1,answer:1,question:1,title:1,keywords:1,comment:1,topics:1,next:1}[this.props.field]?null:"variables"===this.props.field?r.a.createElement("div",{className:"EditVariables row"},r.a.createElement("div",{className:"col-sm-1",dangerouslySetInnerHTML:{__html:function(e){for(var t="",a=Object.keys(e),s=0;s<a.length;s++)t+=a[s]+"="+e[a[s]]+"<br />\n";return t}(this.props.vars)}}),r.a.createElement("div",{className:"col-sm-1"},r.a.createElement("i",{className:"btn btn-default btn-sm fa fa-btn fa-repeat",onClick:this.props.change})),r.a.createElement("div",{className:"col-sm-2"},"options: ",this.state.stats[!0],r.a.createElement("br",null),"failed: ",this.state.stats[!1]),r.a.createElement("div",{className:"col-sm-2"},r.a.createElement("i",{className:"btn btn-deafult btn-sm fa fa-btn fa-repeat",onClick:this.setStats})),r.a.createElement("div",{className:"col-sm-6"},r.a.createElement("textarea",{ref:function(t){e.text=t},style:{minWidth:"100%"},placeholder:this.props.field,value:this.state.text,rows:this.state.text.split("\n").length,onChange:this.update}))):"json"===this.props.field?this.state.text.length>0?r.a.createElement("div",{className:"EditField row"},r.a.createElement("div",{className:"col-sm-12"},r.a.createElement("textarea",{ref:function(t){e.text=t},style:{minWidth:"100%"},placeholder:this.props.field,value:this.state.text,rows:this.state.text.split("\n").length,onChange:this.update}))):null:r.a.createElement("div",{className:"EditField row"},r.a.createElement("div",{className:"col-sm-6"},r.a.createElement(Dt,{auto:this.props.auto,edit:!0,vars:this.props.vars},this.state.text)),r.a.createElement("div",{className:"col-sm-6"},r.a.createElement("textarea",{ref:function(t){e.text=t},style:{minWidth:"100%"},placeholder:this.props.field,value:this.state.text?this.state.text:"",rows:this.state.text?this.state.text.split("\n").length:1,onChange:this.update})))}}]),t}(s.Component),Qt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={edit:!1},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentWillMount",value:function(){C("/react_ajax/help",null,{topic:this.props.topic})}},{key:"componentWillReceiveProps",value:function(e){C("/react_ajax/help",null,{topic:e.topic})}},{key:"render",value:function(){var e=this;if(null===this.props.topic)return null;var t=this.props.topic,a="not found",s=0;return window.FreeMaths.state.data&&window.FreeMaths.state.data.help[this.props.topic]?(s=window.FreeMaths.state.data.help[this.props.topic].id,t=window.FreeMaths.state.data.help[this.props.topic].title,a=window.FreeMaths.state.data.help[this.props.topic].text):console.log("help",this.props.topic,window.FreeMaths.state.data.help),this.state.edit?r.a.createElement(Pt,{id:s,title:t,help:a,close:function(){return e.setState({edit:!1})}}):r.a.createElement(Wt,{title:t.split("__")[0].replace(/_/g," "),help:a,edit:function(){console.log("click"),e.setState({edit:!0})},close:this.props.close})}}]),t}(s.Component),Wt=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement(x.a,{name:"help",show:!0,onHide:this.props.close},r.a.createElement(x.a.Header,{closeButton:!0},r.a.createElement(x.a.Title,null,r.a.createElement(Dt,null,this.props.title),this.props.edit&&window.FreeMaths.state.user&&window.FreeMaths.state.user.isAdmin?r.a.createElement("span",{className:"btn-link",onClick:this.props.edit}," ",r.a.createElement("i",{className:"fa fa-btn fa-edit"})):null)),r.a.createElement(x.a.Body,null,r.a.createElement(Dt,null,this.props.help)))}}]),t}(s.Component),Pt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={title:a.props.title,help:a.props.help,id:a.props.id,error:{}},a.save=function(){a.state.title===a.props.title&&a.state.help===a.props.help||C("/react_ajax/saveHelp",function(e){e.error?a.setState({error:e.data}):(window.FreeMaths.state.data.help[a.props.title.toLowerCase().replace(/ /g,"_")]=e.data,a.props.close())},{title:a.state.title,text:a.state.help,id:a.state.id})},a.update=function(e,t){"title"===e?a.setState({title:t}):"help"===e&&a.setState({help:t})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement(x.a,{show:!0,bsSize:"large",onHide:this.props.close},r.a.createElement(x.a.Header,{closeButton:!0},this.state.error.error?r.a.createElement("div",{className:"alert alert-danger"},r.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,r.a.createElement(x.a.Title,null,r.a.createElement(Tt,{fields:{title:this.state.title},update:this.update}))),r.a.createElement(x.a.Body,null,r.a.createElement(Tt,{fields:{help:this.state.help},update:this.update})),r.a.createElement(x.a.Footer,null,r.a.createElement(q.a,{onClick:this.save},"Save")))}}]),t}(s.Component),zt=a(202),Dt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,n=new Array(s),l=0;l<s;l++)n[l]=arguments[l];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={help:""},a.close=function(){a.setState({help:""})},a.table=function(e,s){var n=0,l=0,i=e.split("\n").map(function(e){var s=e.split(",").map(function(e){return e.startsWith(" ")?r.a.createElement("th",{style:{textAlign:"center"},key:l++},r.a.createElement(t,{vars:a.props.vars},e.substring(1))):r.a.createElement("td",{style:{textAlign:"center"},key:l++},r.a.createElement(t,{vars:a.props.vars},e))});return r.a.createElement("tr",{key:n++},s)});return r.a.createElement("table",{className:"table table-condensed table-bordered table-striped",style:{width:"auto"},key:s},r.a.createElement("tbody",null,i))},a.help=function(e,t){a.setState({help:e}),t.currentTarget.blur()},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.children!==this.props.children||e.vars!==this.props.vars||t.help!==this.state.help}},{key:"render",value:function(){var e=this;if(!this.props.children)return null;var t=function(e,t,a){Q("maths")&&console.log("maths(txt,vars,auto)",e,t,a);var s,r=[];if(!(We=e))return[];for(ht=0;-1!==(s=ft(t));)if(Q("maths token")&&console.log("maths",s),""!==s)if("object"===Object(le.a)(s))r.push({chunk:s.text,error:s.error,type:"error"});else if(s.startsWith("\\("))vt(r,s,"latex",t);else if(s.startsWith("''")&&ze(s.substr(1),t))vt(r,qe(s.substr(1),t),"maths");else if(s.startsWith("'"))vt(r,Et(s.substring(1)),"html");else if(s.startsWith("{xyz=")&&s.endsWith("}"))(t=t||{}).xyz=s.substring(5,s.length-1);else if(s.endsWith(".png"))r.push({chunk:s,type:"png"});else if(s.startsWith("@")){var n=yt(s.substring(1));vt(r,n.name,"help"),""!==n.end&&vt(r,n.end,"text")}else s.startsWith("[")&&s.endsWith("]")?vt(r,s.substring(1,s.length-1),"table"):a&&bt(s,t)?gt(s,r,t):ze(s,t)?vt(r,qe(s,t),"maths"):vt(r,Et(s),"html");return r}(this.props.children,this.props.auto?function(e){var t={};e.split("\n").forEach(function(e){e.split(" ").forEach(function(e){var a=J(t),s=!1;e.startsWith("''")&&(e=e.substr(1),s=!0);var r=Se(e,null);r.forEach(function(e){-1!=="=^/+*-\u2260\u2265\u2264\xb1\xf7\u221a\u2261\u2248\u2026\u21d2{}".indexOf(e)?s=!0:(/['a-zA-Z]/.test(e.charAt(0))||e.indexOf("_")>0)&&!Ye(e)&&(Object.keys(a).length&&st(e,{xyz:Object.keys(a).join(",")})||(a[e]=e),e.indexOf("_")>0&&(s=!0))}),s&&ze(e,{xyz:Object.keys(a).join(",")})&&(t=a),Q("xyz(w)")&&console.log("xyz(w)",e,r,a,t)})}),Q("xyz(text)")&&console.log("xyz(text)",e,t);return Object.keys(t).length?{xyz:Object.keys(t).join(",")}:null}(this.props.children):this.props.vars,this.props.auto),a=0,s="",n=t.map(function(t){if("\n"===t.chunk)if(s.endsWith(">")||s.endsWith(" "))var n=null;else n=r.a.createElement("br",{key:a++});else n="latex"===t.type?r.a.createElement(Bt,{key:a++},t.chunk):"error"===t.type?r.a.createElement("div",{key:a++},r.a.createElement("span",null,t.chunk),r.a.createElement("span",{className:"red"}," ",t.error)):"maths"===t.type?r.a.createElement(Bt,{key:a++},t.chunk):"help"===t.type?r.a.createElement("span",{className:"btn-link",key:a++,onClick:function(a){return e.help(t.chunk,a)}},t.chunk.split("__")[0]):"table"===t.type?e.table(t.chunk,a++):"png"===t.type?r.a.createElement("img",{key:a++,alt:"figure",src:t.chunk,style:{maxWidth:"100%"}}):r.a.createElement("span",{key:a++,dangerouslySetInnerHTML:{__html:t.chunk}});return s="html"===t.type?t.chunk:"",n}),l=null;return""!==this.state.help&&(l=r.a.createElement(Qt,{edit:this.props.edit,topic:this.state.help,close:this.close})),r.a.createElement("div",{style:{display:"inline"}},n,l)}}]),t}(s.Component),Bt=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e;try{e=r.a.createElement("span",{className:"expression",dangerouslySetInnerHTML:{__html:zt.renderToString(this.props.children)}})}catch(t){e=r.a.createElement("div",null,r.a.createElement("span",null,this.props.children)),console.log("Latex",t.message)}return e}}]),t}(s.Component);function Ht(e,t){var a=e.length;if(-1===e.indexOf("begin")&&Object.keys(ie).forEach(function(t){e=e.replace(ie[t],t,e)}),e=(e=(e=e.replace("/dx","/(dx)",e)).replace("/du","/(du)",e)).replace("/\u0394x","/(\u0394x)",e),t)var s=t+e.length-a;else s=null;return{text:e,caret:s}}var Rt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={message:a.props.text?a.props.text:"",name:"",email:"",maths:!1,error:{},to:"",from:"",sending:!1},a.contact=function(e){e.preventDefault();var t=a.props.qkey?a.props.qkey:a.props.reply&&a.props.reply.qkey?a.props.reply.qkey:null,s=t?H(a.props.qkey,window.FreeMaths.state.data,!0):null;a.setState({error:{},sending:!0}),C("/react_ajax/contact",function(e){e.error?a.setState({error:e.data,sending:!1}):a.props.close({type:"success",text:a.props.reply?"Reply sent.":"Message sent. We aim to respond within 24 hours."})},{email:a.state.email,name:a.state.name,maths:a.state.maths,message:a.state.message,from:a.state.from,to:a.state.to,qkey:t,question:s})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentWillMount",value:function(){if(this.props.reply)this.setState({message:this.props.reply.message,maths:this.props.reply.maths,to:this.props.reply.from,from:this.props.reply.to});else if(this.props.uid){var e=this.props.fm.state.students[this.props.uid];e||console.error("Contact",this.props.uid,this.props.fm.state),this.setState({to:e||null})}}},{key:"render",value:function(){var e=this;return r.a.createElement(x.a,{name:"contact",bsSize:this.state.maths?"lg":null,show:!0,onHide:function(){return e.props.close()}},r.a.createElement(x.a.Header,{closeButton:!0},r.a.createElement(x.a.Title,null,this.props.reply?"Reply to ":"Contact ",this.state.to?this.state.to.name:"FreeMaths.uk")),r.a.createElement(x.a.Body,null,this.state.sending?r.a.createElement("div",{className:"alert alert-success"},r.a.createElement("strong",null,"Sending ...")):null,this.state.error.error?r.a.createElement("div",{className:"alert alert-danger"},r.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,r.a.createElement(E.a,{onSubmit:this.contact,horizontal:!0},this.props.fm.state.user||this.props.reply?null:r.a.createElement("div",null,r.a.createElement(y.a,{controlId:"name",validationState:$(this.state.error.name)?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Name"),r.a.createElement(g.a,{sm:9},r.a.createElement(j.a,{type:"name",name:"name",value:this.state.name,placeholder:"First Last",onChange:function(t){return e.setState({name:t.target.value,error:{}})}})),$(this.state.error.name)?r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.name)):null),r.a.createElement(y.a,{controlId:"email",validationState:$(this.state.error.email)?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Email"),r.a.createElement(g.a,{sm:9},r.a.createElement(j.a,{type:"email",name:"email",value:this.state.email,placeholder:"Email",onChange:function(t){return e.setState({email:t.target.value,error:{}})}})),$(this.state.error.email)?r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.email)):null)),this.props.qkey?r.a.createElement(y.a,null,r.a.createElement(g.a,{componentClass:O.a,sm:2},"Question"),r.a.createElement(g.a,{sm:9},H(this.props.qkey,this.props.fm.state.data,!0))):null,this.state.maths?r.a.createElement(It,{fm:this.props.fm,text:this.state.message,update:function(t){return e.setState({message:t})},close:function(){return e.setState({maths:!1})}}):r.a.createElement(y.a,{controlId:"message",validationState:this.state.error.message?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:2},"Message"),r.a.createElement(g.a,{sm:9},r.a.createElement("textarea",{placeholder:"Your message",value:this.state.message,rows:8,style:{minWidth:"100%"},onChange:function(t){return e.setState({message:t.target.value,error:{}})}})),this.state.error.message?r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(w.a,null,this.state.error.message)):null,r.a.createElement(g.a,{smOffset:2,sm:9},r.a.createElement(S.a,{checked:!1,onChange:function(t){return e.setState({maths:!0})}},"include maths?")))),r.a.createElement(x.a.Footer,null,r.a.createElement(q.a,{bsStyle:"primary",onClick:this.contact},r.a.createElement("i",{className:"fa fa-envelope-o"})," ",this.props.reply?"Reply":"Contact Us"))))}}]),t}(s.Component),It=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={caret:null,text:a.props.text},a.update=function(e){var t=Ht(e.target.value,a.text.selectionStart);a.setState({text:t.text,caret:t.caret}),a.props.update(t.text)},a.key=function(e){e.preventDefault(),a.text.focus();var t=a.state.text,s=a.text.selectionStart,r=a.text.selectionEnd;s&&r||(s=r=0===s&&0===r?0:null!==a.state.caret?a.state.caret:t.length),t=t.substr(0,s)+e.target.value+t.substr(r,t.length-r),a.setState({text:t,caret:s+1}),a.props.update(t)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentDidUpdate",value:function(){null!==this.state.caret&&this.text.setSelectionRange(this.state.caret,this.state.caret)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"EditField row"},r.a.createElement("div",{className:"col-sm-6"},r.a.createElement(Dt,{auto:!0},this.state.text)),r.a.createElement("div",{className:"col-sm-6"},r.a.createElement("textarea",{ref:function(t){e.text=t},style:{minWidth:"100%"},placeholder:"Message",value:this.state.text,rows:8,onChange:this.update}))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-sm-6"},r.a.createElement(S.a,{checked:!0,onChange:this.props.close}," maths? ",r.a.createElement("span",{className:"btn-link",onClick:function(t){t.preventDefault(),e.props.fm.setState({help:"typing_maths"})}},"(help)"))),r.a.createElement("div",{className:"col-sm-6"},Object.keys(ie).map(function(t){return r.a.createElement(L,{key:t,tooltip:ie[t]},r.a.createElement(q.a,{onClick:e.key,value:t,bsSize:"small"},t))}))))}}]),t}(s.Component),Lt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={message:null,error:{},reply:!1},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentWillMount",value:function(){var e=this;C("/react_ajax/mail",function(t){t.error?(console.log("Mail error",t.error,t.data),e.props.fm.setState({message:{type:"danger",text:t.data.error},modal:null,token:null})):(console.log("Mail",t.data,!1===t.data.maths),e.setState({message:t.data}))},{token:this.props.fm.state.token})}},{key:"render",value:function(){var e=this;return null===this.state.message?null:this.state.reply?r.a.createElement(Rt,{fm:this.props.fm,reply:this.state.message,close:function(t){return e.props.close(t)}}):r.a.createElement(x.a,{show:!0,name:"mail",onHide:function(){return e.props.close()}},r.a.createElement(x.a.Header,{closeButton:!0},r.a.createElement(x.a.Title,null,"Message from ",this.state.message.from.name,this.state.message.qkey?r.a.createElement("div",null,"Question: "+H(this.state.message.qkey,this.props.fm.state.data,!0)):null)),r.a.createElement(x.a.Body,null,this.state.error.error?r.a.createElement("div",{className:"alert alert-danger"},r.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,this.state.message.maths?r.a.createElement(Dt,{auto:!0},this.state.message.message):r.a.createElement("div",null,this.state.message.message)),r.a.createElement(x.a.Footer,null,r.a.createElement(q.a,{bsStyle:"primary",onClick:function(){return e.setState({reply:!0})}},r.a.createElement("i",{className:"fa fa-envelope-o"})," Reply")))}}]),t}(s.Component);function Ut(e){var t=e;return 0===t.indexOf("[")&&(t=t.substring(t.indexOf("]")+1)),-1!==t.indexOf("#")&&(t=t.substring(0,t.indexOf("#"))),t.indexOf("[")>0&&(t=t.substring(0,t.indexOf("["))),t}function Jt(e){var t=void 0;return-1!==e.indexOf("#")&&-1!==(t=e.substring(e.indexOf("#")+1)).indexOf("[")&&(t=t.substring(0,e.indexOf("["))),t}function $t(e){var t=void 0;return 0===e.indexOf("[")&&(e=e.substring(e.indexOf("]"))),e.indexOf("[")>0&&e.endsWith("]")&&(t=e.substring(e.indexOf("[")+1,e.length-1)),t}function Kt(e,t,a){var s=function(e,t){var a=t,s=e.indexOf("]")-1;if(0===e.indexOf("[")&&s>1){var r=e.substring(1,s);t.startsWith(r)?a=t.substr(s):e.indexOf("?")<=s&&(s=e.indexOf("?")-1,r=e.substring(1,s),t.startsWith(r)&&(a=t.substr(s)))}else t.startsWith("=")&&t.length>1&&(a=t.substr(1));return a.startsWith("(")&&a.endsWith(")")&&-1===a.substr(1).indexOf("(")&&(a=a.substr(1,t.length-2)),a}(t,e);s=s.replace(/^(-?)(\d+)(\u02fd| )(\d+\/\d+)$/,"$1{$2\u02fd$4}").replace(/\s/g,"");var r,n=!1,l=!1,i=t.split("\n");for(r=0;r<i.length;r++){var o=Ut(i[r]);if(n=ke(s,o,Jt(i[r]),a))break;l||(l=ye(s,o,Jt(i[r]),a))}return!n&&l?i[0].indexOf("#")>0?{attempt:e,correct:"\u2713",diff:null}:{attempt:e,correct:"?\u2713",diff:n?null:Vt(s,t,a)}:{attempt:e,correct:n?"\u2713":"\u2717",diff:n?null:Vt(s,t,a)}}function Vt(e,t,a){var s=Ce(ze(Ut(t.split("\n")[0]),a));""!==Z&&(s=Ut(t.split("\n")[0]));for(var r="",n=e,l=e.match(/[+-]?[\d]*([a-z]*(\^[\d])?)*/g),i=s.match(/[+-]?[\d]*([a-z]*(\^[\d])?)*/g),o=0;o<l.length;o++)if(l[o].length>0&&"+"!==l[o]&&"-"!==l[o]){var c=n.substr(0,n.indexOf(l[o])+l[o].length);n=n.replace(c,"");for(var u=0;u<i.length&&c.length>0;u++)Gt(l[o])===Gt(i[u])&&(Xt(l[o])===Xt(i[u])?r+=c.replace(l[o],"<g>"+l[o]+"</g>"):r+=c.replace(l[o],"<o>"+l[o]+"</o>"),c="",i.splice(u,1));r+=c}return r+=n}function Gt(e){return e.length>0&&("+"===e[0]||"-"===e[0])?e.substr(1):e}function Xt(e){return e.length>0&&"-"===e[0]?"-":"+"}var Yt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={start:0,keypad:!1},a.change=function(e,t){t=t||(a.calcInput?a.calcInput.selectionStart:0);var s=e.length,r=Ht(e,t+=e.length-s);r.text!==a.props.answer&&(a.props.change(r.text),a.setState({start:r.caret})),a.calcInput&&a.calcInput.focus()},a.keyboard=function(e){a.change(e.target.value)},a.keypress=function(e){var t=a.calcInput.selectionStart,s=a.calcInput.selectionEnd;a.change(a.props.answer.substring(0,t)+e+a.props.answer.substring(s),t+e.length)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return t.keypad!==this.state.keypad||e.answer!==this.props.answer||e.qid!==this.props.qid||e.vars!==this.props.vars}},{key:"componentDidUpdate",value:function(){this.calcInput&&(this.calcInput.setSelectionRange(this.state.start,this.state.start),this.calcInput.focus())}},{key:"render",value:function(){var e=this;return this.state.keypad?r.a.createElement(ra,{qid:this.props.qid,vars:this.props.vars,answer:this.props.answer,change:this.change,mark:this.props.mark,close:function(){return e.setState({keypad:!1,start:e.props.answer.length})}}):r.a.createElement(E.a,{onSubmit:function(t){t.preventDefault(),e.props.mark()},inline:!0},r.a.createElement(aa,{qid:this.props.qid,vars:this.props.vars}),r.a.createElement("input",{ref:function(t){e.calcInput=t},autoFocus:!0,className:"form-control",inputMode:"numeric",type:window.FreeMaths.state.user.isios?"tel":"text",value:this.props.answer,onChange:this.keyboard}),r.a.createElement(sa,{qid:this.props.qid,vars:this.props.vars}),r.a.createElement(ta,{show:function(){return e.setState({keypad:!0})}}),this.props.answer?r.a.createElement(la,{mark:this.props.mark}):r.a.createElement(ea,null),r.a.createElement("div",null,r.a.createElement(Zt,{qid:this.props.qid,vars:this.props.vars,onClick:this.keypress})))}}]),t}(s.Component),Zt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).buttons=function(){var e=["-"],t=function(e,t){var a=Ce(ze(Ut(e.split("\n")[0]),t));return Q("evaluateAnswer=")&&console.log("evaluateAnswer(answer,vars)=",e,t,a),""+a}(D(a.props.qid).answer,a.props.vars);return["+","/","(",")","^","\u221a",",","x","y","z","\u02fd"].forEach(function(a){-1!==t.indexOf(a)&&e.push(a)}),Q("buttons")&&console.log("buttons,answer,ret,qid,vars",t,e,a.props.qid,a.props.vars),e},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.qid!==this.props.qid||e.vars!==this.props.vars}},{key:"textClass",value:function(e){return-1!==["x","y","z"].indexOf(e)?"keyboard-algebra":"keyboard-text"}},{key:"render",value:function(){var e=this,t={"-":"\u2013"};return this.buttons().map(function(a){return r.a.createElement(q.a,{key:a,className:"keyboard-button",onClick:function(){return e.props.onClick(a)}},r.a.createElement("span",{className:e.textClass(a)},t[a]?t[a]:a))})}}]),t}(s.Component),ea=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={help:!1},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return this.state.help?r.a.createElement(Qt,{topic:"keyboard",close:function(){return e.setState({help:!1})}}):r.a.createElement(U,{className:"btn btn-default green",onClick:function(){return e.setState({help:!0})},tooltip:"keyboard help"},"?")}}]),t}(s.Component),ta=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement(U,{className:"btn btn-default kbd",onClick:this.props.show,tooltip:"keyboard"},"\u200b")}}]),t}(s.Component),aa=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e,t,a=window.FreeMaths.state.data.tests.questions[this.props.qid];if(a.answer.startsWith("[")&&-1!==(e=a.answer.indexOf("]"))){var s=a.answer.substring(1,e);if((t=s.indexOf("{"))>-1&&(e=s.indexOf("}"))>-1&&e>t){var n=s.substring(t+1,e);s=s.substring(0,t)}return n?r.a.createElement(L,{tooltip:n},r.a.createElement(Dt,{vars:this.props.vars},s)):r.a.createElement(Dt,{vars:this.props.vars},s)}return r.a.createElement(Dt,null,"=")}}]),t}(s.Component),sa=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=window.FreeMaths.state.data.tests.questions[this.props.qid];return $t(e.answer)?r.a.createElement(Dt,{vars:this.props.vars},$t(e.answer)):null}}]),t}(s.Component),ra=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).keypress=function(e){"{mark}"===e?a.props.mark():"{clear}"===e?a.props.change(""):"{bs}"===e?a.props.change(a.props.answer.substr(0,a.props.answer.length-1)):a.props.change(a.props.answer+e)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"keys",value:function(){var e=this,t={x:"x",y:"y",z:"z"},a=0;return[["x","y","z","\u02fd","{clear}"],[7,8,9,"+","-"],[4,5,6,"*","/"],[1,2,3,"^","\u221a"],[0,".","(",",",")"],["<",">","=","{bs}","{mark}"]].map(function(s){var n=s.map(function(a){var s=a,n="default",l=t[a]?"keyboard-algebra":"keyboard-text";switch(a){case"{bs}":s=r.a.createElement("img",{src:"/images/backspace.svg",alt:"backspace"});break;case"{mark}":n="success",s="\u2713";break;case"{clear}":s="C",l="keyboard-text red"}return r.a.createElement(na,{key:"key_"+a,onClick:e.keypress,keyval:""+a,button:n,textClass:l},s)});return r.a.createElement("div",{key:a++},n)})}},{key:"componentDidMount",value:function(){this.scrollKB.scrollIntoView()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{ref:function(t){e.scrollKB=t},className:"well keypad"},r.a.createElement("button",{className:"close",onClick:this.props.close},"\xd7"),r.a.createElement("input",{className:"form-control",readOnly:!0,value:this.props.answer,onClick:this.props.close}),this.keys())}}]),t}(s.Component),na=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={style:a.props.button},a.hover=function(){window.FreeMaths.state.user.isMobile||a.setState({style:"primary"})},a.unhover=function(){window.FreeMaths.state.user.isMobile||a.setState({style:a.props.button})},a.click=function(e){a.props.onClick(a.props.keyval)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement(q.a,{className:"keyboard-button",id:this.props.keyval,onClick:this.click,bsStyle:this.state.style,onMouseEnter:this.hover,onMouseLeave:this.unhover},r.a.createElement("span",{className:this.props.textClass},this.props.children))}}]),t}(s.Component),la=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement(U,{className:"btn btn-success",onClick:this.props.mark,tooltip:"mark"},"\u2713")}}]),t}(s.Component),ia=Yt,oa=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={list:!1},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"tests",value:function(e){var t=this,a=null;return e.tests&&(a=Object.keys(e.tests).map(function(a){return t.props.fm.state.data.tests.tests[a].title+" Q"+e.tests[a]})),a}},{key:"render",value:function(){var e=this,t=this.props.fm.state.data.tests;if(this.state.list){var a=Object.keys(this.props.tree.topics).map(function(a){return Object.keys(e.props.tree.topics[a]).map(function(s){return e.props.tree.topics[a][s].map(function(a){var s=t.questions[a];return r.a.createElement("div",{key:s.id},r.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setQ(s.id,!1)}},s.id)," ",r.a.createElement(Dt,null,s.topic)," ",r.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setQ(s.id,!0)}},"[",s.topics,"]")," ",e.tests(s))})})}),s=Object.keys(t.questions).map(function(a){var s=t.questions[a];return s.topics?null:r.a.createElement("div",{key:s.id},r.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setQ(s.id,!1)}},s.id)," ",r.a.createElement(Dt,null,s.topic)," ",r.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setQ(s.id,!0)}},"[",s.topics,"]")," ",e.tests(s))});return r.a.createElement("div",null,r.a.createElement(U,{className:"btn btn-primary",tooltip:"Hide Questions",onClick:function(){return e.setState({list:!1})}},"Hide"),a,s)}return r.a.createElement("button",{className:"btn btn-link",style:{float:"right"}},r.a.createElement("i",{className:"fa fa-btn fa-edit",onClick:function(){return e.setState({list:!0})}}))}}]),t}(s.Component);function ca(e,t){return""===e&&""===t?"":(""===e?0:1*e)+(""===t?0:1*t)}function ua(e,t,a,s){$(e[s].c)||(e[s].c=[]),e[s].c.push.apply(e[s].c,t.c[a])}function pa(e,t,a,s,r,n){if($(e[a])||(e[a]={"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:0,effort:0,r:[]}),a===s)[":(",":|",":)","\u2717","?\u2713","\u2713"].forEach(function(n){$(t[n][r])&&t[n][r].forEach(function(l){return e[a][n].push({uid:r,key:s,ts:l.ts,a:l.a,v:l.v,l:n===t.l[r].m||n===t.l[r].f})})}),r===n?t.rs[r].forEach(function(n){return e[a].r.push({uid:r,key:s,mk:n.mk,mks:t.mks,ts:n.ts})}):e[a].r.push({uid:r,key:s,mk:t.l[r].mk,mks:t.mks,ts:t.l[r].ts});else{if(""!==t.l[r].m){var l=t[t.l[r].m][r][t[t.l[r].m][r].length-1];e[a][t.l[r].m].push({uid:r,key:s,ts:l.ts,a:l.a,v:l.v})}if(""!==t.l[r].f){var i=t[t.l[r].f][r][t[t.l[r].f][r].length-1];e[a][t.l[r].f].push({uid:r,key:s,ts:i.ts,a:i.a,v:i.v})}}""!==t.l[r].mk&&(e[a].mks+=t.mks),e[a].mk=ca(e[a].mk,t.l[r].mk),e[a].qs++,t.l[r].ts>e[a].ts&&(e[a].ts=t.l[r].ts),e[a].uid=r}function ma(e,t,a,s){$(e.l[s])||(e.l[s]={"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:0,effort:0}),""!==t.l[s].m&&e.l[s][t.l[s].m].push({key:a,ts:t[t.l[s].m][s][t[t.l[s].m][s].length-1].ts}),""!==t.l[s].f&&e.l[s][t.l[s].f].push({key:a,ts:t[t.l[s].f][s][t[t.l[s].f][s].length-1].ts}),""!==t.l[s].mk&&(e.l[s].mks+=t.mks),e.l[s].mk=ca(e.l[s].mk,t.l[s].mk),t.l[s].ts>e.l[s].ts&&(e.l[s].ts=t.l[s].ts),e.l[s].qs++}function ha(e,t,a){var s="0"===t.paper?{qs:[{id:t.q}]}:a.state.data.tests.tests[t.paper];0!==t.paper&&($(e.ts[t.paper])||(e.ts[t.paper]={rs:{},qs:{},l:{},c:{}}),$(e.uids[t.user_id])?0===e.uids[t.user_id].p&&(e.uids[t.user_id].p=t.paper,e.uids[t.user_id].ts=e.uids[t.user_id].ts1=t.ts):e.uids[t.user_id]={p:t.paper,ts1:t.ts,ts:t.ts,l:{},c:{}});var r=e.uids[t.user_id];if($(r)&&(t.ts-r.ts>36e5||t.paper!==r.p)){var n={"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:0,effort:0};Object.keys(s.qs).forEach(function(a){var s=r.p+":::"+a.id,l=e.ts[r.p].qs[s];$(l)&&$(l.xl[t.user_id])&&(0===n.ts&&(n.ts=l.xl[t.user_id].ts,n.effort=l.xl[t.user_id].ts-r.ts1),""!==l.xl[t.user_id].m&&n[l.xl[t.user_id].m].push({key:s,ts:l[l.xl[t.user_id].m].ts}),""!==l.xl[t.user_id].f&&n[l.xl[t.user_id].f].push({key:s,ts:l[l.xl[t.user_id].f].ts}),n.mks++,n.qs++,n.mk=ca(n.mk,l.xl[t.user_id].mk),l.xl[t.user_id]=null)}),$(e.ts[r.p].rs[t.user_id])||(e.ts[r.p].rs[t.user_id]=[]),0!==r.p&&e.ts[r.p].rs[t.user_id].push(n),e.uids[t.user_id].p=t.paper,e.uids[t.user_id].ts=e.uids[t.user_id].ts1=t.ts}if(0!==t.paper&&("\u2713"===t.event||"\u2717"===t.event||"?\u2713"===t.event||":("===t.event||":|"===t.event||":)"===t.event)){var l=t.paper+":::"+t.q;$(e.ts[t.paper].qs[l])||(e.ts[t.paper].qs[l]={mks:1,l:{},xl:{},c:{},rs:{},"\u2717":{},":(":{},"?\u2713":{},":|":{},"\u2713":{},":)":{}});var i=e.ts[t.paper].qs[l];$(i.l[t.user_id])||(i.l[t.user_id]={m:"",f:"",ts:t.ts,mk:0},i.rs[t.user_id]=[]),$(i.xl[t.user_id])||(i.xl[t.user_id]={m:"",f:"",ts:t.ts,mk:0}),$(i[t.event][t.user_id])||(i[t.event][t.user_id]=[]),"\u2713"===t.event||"\u2717"===t.event||"?\u2713"===t.event?(i.l[t.user_id].m=i.xl[t.user_id].m=t.event,i[t.event][t.user_id].push({ts:t.ts,a:t.answer,v:t.variables}),"\u2713"===t.event?i.l[t.user_id].mk=i.xl[t.user_id].mk=1:i.l[t.user_id].mk=i.xl[t.user_id].mk=0,i.rs[t.user_id].push({ts:t.ts,mk:i.xl[t.user_id].mk})):":("!==t.event&&":|"!==t.event&&":)"!==t.event||(i.l[t.user_id].f=i.xl[t.user_id].f=t.event,i[t.event][t.user_id].push({ts:t.ts}),t.comment.length>0&&($(i.c[t.user_id])||(i.c[t.user_id]=[]),i.c[t.user_id].push({key:l,uid:t.user_id,c:t.comment,f:t.event,ts:t.ts}))),i.l[t.user_id].ts=i.xl[t.user_id].ts=e.uids[t.user_id].ts=t.ts}}function fa(e,t,a){var s=a?e.state.log:e.state.user.log;if(!s)return null;if(t){if(0===s.length||t.last===s[s.length-1].id)return t}else t={users:{},log:s,uids:{},ts:{}};return a?Object.keys(e.state.students).forEach(function(a){t.users[a]||(t.users[a]={name:e.state.students[a].name,log:[]})}):t.users[e.state.user.id]||(t.users[e.state.user.id]={log:[]}),s.forEach(function(a){if(1*a.user_id!==0&&!(t.last&&a.id<=t.last&&t.users[a.user_id].log.length>0)){a.ts=new Date(a.created_at.replace(" ","T")).getTime();var s=a.paper?a.paper.split(":")[0]:"0";"0"===a.paper||e.state.data.tests.tests[s]?(a.q=a.question,ha(t,a,e)):"\u2713\u2717"===a.event&&function(e,t){$(e.ts[t.paper])||(e.ts[t.paper]={rs:{},qs:{},l:{},c:{}}),$(e.uids[t.user_id])||(e.uids[t.user_id]={p:0,l:{}});var a=JSON.parse(t.variables),s={"":[],"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:t.ts,effort:a.effort};a.marks.forEach(function(a){if($(a)){var r=t.paper.indexOf(":")>0?t.paper+":"+a.q:t.paper+":::"+a.q;$(e.ts[t.paper].qs[r])||(e.ts[t.paper].qs[r]={mks:1*a.mks,l:{},xl:{},c:{},rs:{},"":{},"\u2717":{},":(":{},"?\u2713":{},":|":{},"\u2713":{},":)":{}});var n=e.ts[t.paper].qs[r];$(n.l[t.user_id])||(n.l[t.user_id]={m:"",f:"",ts:0,mk:0},n.rs[t.user_id]=[]),n.l[t.user_id].ts=t.ts,n.l[t.user_id].mk=a.mk,n.rs[t.user_id].push({ts:t.ts,mk:a.mk}),""!==a.mk&&(s.mks+=1*a.mks),s.mk=ca(s.mk,a.mk),s.qs++,n.l[t.user_id].f=a.f,$(n[a.f][t.user_id])||(n[a.f][t.user_id]=[]),n[a.f][t.user_id].push({ts:t.ts}),s[a.f].push({key:r,ts:t.ts}),n.l[t.user_id].m=a.m,$(n[a.m][t.user_id])||(n[a.m][t.user_id]=[]),n[a.m][t.user_id].push({ts:t.ts,a:t.answer}),s[a.m].push({key:r,ts:t.ts}),$(a.c)&&a.c.length>0&&($(n.c[t.user_id])||(n.c[t.user_id]=[]),n.c[t.user_id].push({key:r,uid:t.user_id,c:a.c,f:a.f,ts:t.ts}))}}),$(e.ts[t.paper].rs[t.user_id])||(e.ts[t.paper].rs[t.user_id]=[]),e.ts[t.paper].rs[t.user_id].push(s)}(t,a),t.users[a.user_id].log.unshift(a),t.last=a.id}}),Object.keys(t.uids).forEach(function(e){0!==t.uids[e].p&&ha(t,{user_id:e,event:"",paper:"0"},t.uids[e].ts)},e),function(e){Object.keys(e.uids).forEach(function(t){return e.uids[t].l={}}),Object.keys(e.ts).forEach(function(t){e.ts[t].l={},Object.keys(e.ts[t].qs).forEach(function(a){Object.keys(e.ts[t].qs[a].l).forEach(function(s){var r=e.ts[t].qs[a];ma(e.ts[t],r,a,s),ma(e.uids[s],r,a,s)})})})}(t),t}function da(e,t,a){return a?t.ts-e.ts:t[":("].length-e[":("].length!==0?t[":("].length-e[":("].length:t[":|"].length-e[":|"].length!==0?t[":|"].length-e[":|"].length:t["\u2717"].length-e["\u2717"].length!==0?t["\u2717"].length-e["\u2717"].length:t["?\u2713"].length-e["?\u2713"].length!==0?t["?\u2713"].length-e["?\u2713"].length:t.mks-e.mks-(t.mk-e.mk)}function va(e){return 0===e.length||$(e[0].l)&&!e[0].l?0:e.length}var ba=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return"book"===this.props.type?r.a.createElement(Za,{stats:this.props.stats,set:this.props.setTopic,pkey:this.props.pkey}):r.a.createElement("div",null,r.a.createElement("h3",{className:"inline"},"Subject: ")," ",r.a.createElement(ga,{type:this.props.type,topic:this.props.topic,setTopic:this.props.setTopic}),this.props.topic&&"0"!==this.props.topic?r.a.createElement(Qa,{type:this.props.type,topic:this.props.topic,stats:this.props.stats,update:this.props.update}):null)}}]),t}(s.Component),ga=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=[r.a.createElement("option",{key:0,value:"0"},"select")];return["GCSE(9-1)","IGCSE","P1","SM1","C1","C2","C3","C4","FP1","FP2","FP3","D1","D2","S1","S2","S3","S4","M1","M2","M3","M4","M5"].forEach(function(e){t.push(r.a.createElement("option",{key:e},e))}),r.a.createElement("form",{className:"form-horizontal inline"},r.a.createElement("select",{className:"form-control inline",style:{width:"auto"},value:this.props.topic,onChange:function(t){return e.props.setTopic(t.target.value)}},t))}}]),t}(s.Component),ka=ba,Ea=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={uid:null,pkey:null,topic:"0",students:null,stats:null,test:null,edit:!1,s:null,q:null,cs:null,log:null,all:!1},a.toggleAll=function(){a.props.fm.getStudents(!a.state.all),a.setState({all:!a.state.all})},a.setTest=function(e,t){a.setState({test:e.toString(),edit:t})},a.setPaper=function(e){var t=e.split(":"),s=Object(N.a)(t,4),r=s[0],n=s[1],l=s[2];$(s[3])&&(e=""!==l?r+":"+n+":"+l:r),$(B(r))&&e===a.state.pkey?a.props.students?a.setState({pkey:null,test:null}):a.setState({test:e}):a.setState({pkey:e,topic:"0"})},a.setQ=function(e){a.setState({test:e})},a.setS=function(e,t){t?a.setState({cs:e}):null!==a.state.s?a.setState({s:null}):K(e)||a.setState({s:e})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.students&&!e.fm.state.students?e.fm.getStudents(!1):e.students?this.setState({students:fa(e.fm,null,e.students)}):this.setState({stats:fa(e.fm,null,e.students)}),e.type!==this.props.type&&this.setState({pkey:null,topic:"0"})}},{key:"componentWillMount",value:function(){this.props.students&&!this.props.fm.state.students?this.props.fm.getStudents(!1):this.props.students?this.setState({students:fa(this.props.fm,null,this.props.students)}):this.setState({stats:fa(this.props.fm,null,this.props.students)})}},{key:"render",value:function(){var e=this,t=null,a=this.props.students?this.state.students:this.state.stats;if(!a)return r.a.createElement("div",{className:"blue"},"loading...");if(null!==this.state.test){var s=B(this.state.test);"past"===s.type||"book"===s.type?t=r.a.createElement(Pa,{user:this.props.user,stats:a,test:this.state.test,close:function(){return e.setState({pkey:null,test:null})}}):"vars"===s.type&&console.error("Students type vars")}return a=function(e,t,a,s,r){return e.t={qs:{},ts:{},uids:{},corrections:{}},Object.keys(e.ts).filter(function(e){return!$(s)||B(e).type===s}).forEach(function(s){(null===a||"0"===a||a===s.substr(0,a.length)||H(s,e).startsWith(a))&&(Object.keys(e.ts[s].qs).forEach(function(a){Object.keys(e.ts[s].qs[a].l).forEach(function(r){if(r===t||null===t){var n=e.ts[s].qs[a];pa(e.t.qs,n,a,a,r,t),pa(e.t.ts,n,s,a,r),pa(e.t.uids,n,r,a,r),ua(e.t.uids,n,r,r),ua(e.t.ts,n,r,s),ua(e.t.qs,n,r,a)}})}),Object.keys(e.ts[s].l).forEach(function(a){if(a===t||null===t){var r=e.ts[s].l[a];$(e.t.uids[a].r)||(e.t.uids[a].r=[]),e.t.uids[a].r.push({uid:a,key:s,mk:r.mk,mks:r.mks,ts:r.ts}),$(e.t.ts[s].r)||(e.t.ts[s].r=[]),null===t?e.t.ts[s].r.push({uid:a,key:s,mk:r.mk,mks:r.mks,ts:r.ts}):e.ts[s].rs[t].forEach(function(t){t.ts>0&&e.t.ts[s].r.push({uid:a,key:s,mk:t.mk,mks:t.mks,ts:t.ts})})}}))}),e.uid=1===Object.keys(e.t.uids).length?Object.keys(e.t.uids)[0]:"0",Object.keys(e.t.uids).forEach(function(t){return["\u2717","?\u2713",":(",":|"].forEach(function(a){e.t.uids[t][a].forEach(function(t){$(e.t.corrections[t.key])||(e.t.corrections[t.key]=t)})})}),0===Object.keys(e.t.corrections).length&&(e.t.corrections=null),e}(a,this.props.students?this.state.uid:this.props.fm.state.user.id.toString(),this.state.pkey,this.props.type),r.a.createElement("div",null,this.props.fm.state.user.isAdmin&&this.props.students?r.a.createElement("button",{className:"btn btn-link",style:{float:"right"}},r.a.createElement("i",{className:"fa fa-btn fa-users",onClick:this.toggleAll})):null,a.t.corrections?r.a.createElement(U,{className:"btn btn-danger",tooltip:"Correct first",onClick:function(){return e.setS((t=a.t.corrections,Object.keys(t).map(function(e){return t[e]})));var t}},"Corrections"):null,this.props.students?null:r.a.createElement(ka,{type:this.props.type,topic:this.state.topic,pkey:this.state.pkey,setTest:this.setTest,setTopic:function(t){return e.setState({pkey:t,topic:t||"0"})},stats:a}),r.a.createElement(ya,{fm:this.props.fm,students:this.props.students,stats:a,uid:this.state.uid,p:this.state.pkey,setUid:function(t){return e.setState({uid:t===e.state.uid?null:t})},setS:this.setS}),r.a.createElement(Oa,{type:this.props.type,students:this.props.students,stats:a,uid:this.state.uid,p:this.state.pkey,setPaper:this.setPaper,setS:this.setS}),r.a.createElement(ja,{type:this.props.type,students:this.props.students,setQ:this.setQ,stats:a,uid:this.state.uid,p:this.state.pkey,setPaper:this.setPaper,setS:this.setS}),r.a.createElement(ys,{s:this.state.s,stats:a,setS:this.setS}),r.a.createElement(js,{cs:this.state.cs,stats:a,setS:this.setS}),t)}}]),t}(s.Component),ya=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={byDate:!0},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=[];return Object.keys(this.props.stats.t.uids).sort(function(t,a){return da(e.props.stats.t.uids[t],e.props.stats.t.uids[a],e.state.byDate)}).forEach(function(a){var s=vs(e.props.stats.t.uids[a],e.props.stats,!0,e.props.setS);e.props.students&&s.unshift(r.a.createElement("td",{key:"name"},r.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setUid(a)}},e.props.stats.users[a].name))),t.push(r.a.createElement("tr",{key:a},s))}),0===t.length&&(t=r.a.createElement("tr",null,r.a.createElement("td",{colSpan:this.props.students?9:8,className:"blue",style:{textAlign:"center"}},"No student activity to show yet."))),r.a.createElement("div",null,r.a.createElement("h3",null,"Summary"),r.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},r.a.createElement("thead",null,r.a.createElement("tr",null,this.props.students?r.a.createElement("th",{style:{textAlign:"center"}},r.a.createElement(qa,{fm:this.props.fm,uid:this.props.uid})):null,ds(),r.a.createElement("th",null,"marks"),r.a.createElement("th",{onClick:function(){return e.setState({byDate:!e.state.byDate})}},r.a.createElement("i",{className:"fa fa-file-o","aria-hidden":"true"})),r.a.createElement("th",null,r.a.createElement("i",{className:"fa fa-comments","aria-hidden":"true"})))),r.a.createElement("tbody",null,t)))}}]),t}(s.Component),Oa=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={byDate:!0},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=[];return Object.keys(this.props.stats.t.ts).sort(function(t,a){return da(e.props.stats.t.ts[t],e.props.stats.t.ts[a],e.state.byDate)}).forEach(function(a){var s=B(a),n=vs(e.props.stats.t.ts[a],e.props.stats,!e.props.students,e.props.setS);t.push(r.a.createElement("tr",{key:a},r.a.createElement("td",null,r.a.createElement("span",{className:"btn-link",onClick:e.props.setPaper.bind(e,a)},H(a,e.props.stats,!1,!1,!0))," ",_a(s)),n))}),r.a.createElement("div",null,r.a.createElement("h3",null,"past"===this.props.type?"Past Paper":"book"===this.props.type?"Exercise":"Test"," Analysis"),r.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,r.a.createElement(wa,{type:this.props.type,p:this.props.p,stats:this.props.stats,setPaper:this.props.setPaper})),ds(),r.a.createElement("th",null,"marks"),"0"===this.props.stats.uid?r.a.createElement("th",null,r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({byDate:!e.state.byDate})}},r.a.createElement("i",{className:"fa fa-user","aria-hidden":"true"}),r.a.createElement("span",{className:"sr-only"},"user"))):r.a.createElement("th",null,r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({byDate:!e.state.byDate})}},r.a.createElement("i",{className:"fa fa-calendar-o","aria-hidden":"true"}),r.a.createElement("span",{className:"sr-only"},"date"))),r.a.createElement("th",null,r.a.createElement("i",{className:"fa fa-comments","aria-hidden":"true"}),r.a.createElement("span",{className:"sr-only"},"comments")))),r.a.createElement("tbody",null,t)))}}]),t}(s.Component);var ja=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={qSort:!1,detail:null},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"qn",value:function(e,t,a){var s=this;if("vars"===e.type){var n=r.a.createElement("span",{className:"btn-link",onClick:function(){return s.props.setQ(a)}},t?t.q:a);$(e.test)&&(n=r.a.createElement(L,{tooltip:r.a.createElement(Dt,null,t.topic.split(",")[0])},n))}else n=t?_a(e,t,t.q):a;return n}},{key:"render",value:function(){var e=this,t=[];return Object.keys(this.props.stats.t.qs).sort(function(t,a){return function(e,t,a,s){if(s)return e.localeCompare(t,void 0,{numeric:!0});var r=a[t],n=a[e];return va(r[":("])-va(n[":("])!==0?va(r[":("])-va(n[":("]):va(r[":|"])-va(n[":|"])!==0?va(r[":|"])-va(n[":|"]):va(r["\u2717"])-va(n["\u2717"])!==0?va(r["\u2717"])-va(n["\u2717"]):va(r["?\u2713"])-va(n["?\u2713"])!==0?va(r["?\u2713"])-va(n["?\u2713"]):r.mks-n.mks-(r.mk-n.mk)}(t,a,e.props.stats.t.qs,e.state.qSort)}).splice(0,50).forEach(function(a){var s=a.split(":")[0],n=e.props.stats.t.qs[a],l=B(s),i=function(e,t){var a=e.split(":"),s=Object(N.a)(a,4),r=s[0],n=s[1],l=s[2],i=s[3];if("0"===r)return{q:i};var o=B(r),c={q:e};return l?c=o.qmap.qs&&o.qmap.qs[n]&&o.qmap.qs[n][l]&&o.qmap.q[n][l][i]?o.qmap.qs[n][l][o.qmap.q[n][l][i]]:{q:e}:o.qs[i]&&(c=o.qs[i]),c.q&&(c.q=i),c}(a,e.props.stats);t.push(r.a.createElement("tr",{key:a},r.a.createElement("td",null,r.a.createElement("span",{className:"btn-link",onClick:e.props.setPaper.bind(e,a)},H(a,e.props.stats,!1,!1,!0))),r.a.createElement("td",null,e.qn(l,i,a)),vs(n,e.props.stats,!e.props.students,e.props.setS)))}),r.a.createElement("div",null,r.a.createElement("h3",null,"Question Analysis"),r.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,r.a.createElement(wa,{type:this.props.type,p:this.props.p,stats:this.props.stats,setPaper:this.props.setPaper})),r.a.createElement("th",null,r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({qSort:!e.state.qSort})}},"Q")),ds(),r.a.createElement("th",null,"marks"),"0"===this.props.stats.uid?r.a.createElement("th",null,r.a.createElement("i",{className:"fa fa-user","aria-hidden":"true"})):r.a.createElement("th",null,r.a.createElement("i",{className:"fa fa-calendar-o","aria-hidden":"true"})),r.a.createElement("th",null,r.a.createElement("i",{className:"fa fa-comments","aria-hidden":"true"})))),r.a.createElement("tbody",null,t)),this.state.detail)}}]),t}(s.Component),wa=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;if(!$(this.props.stats))return null;var t={},a=Object.keys(this.props.stats.ts).filter(function(t){return!e.props.type||B(t).type===e.props.type}).map(function(t){return{id:t,title:H(t,e.props.stats)}}).sort(function(e,t){return e.title.localeCompare(t.title)}),s=[r.a.createElement("option",{key:"sel",value:0},"select")];return a.forEach(function(e){var a=e.title.split(" ");a.length>1&&!$(t[a[0]])&&(t[a[0]]=a[0],s.push(r.a.createElement("option",{key:a[0],value:a[0]},a[0])))}),s=s.concat(a.map(function(e){return r.a.createElement("option",{key:e.id,value:e.id},H(e.title))})),r.a.createElement("select",{value:null===this.props.p?0:this.props.p,onChange:function(t){return e.props.setPaper(t.target.value)}},s)}}]),t}(s.Component),qa=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).setUser=function(){var e=a.props.fm.state.user;e.logout||(e.logout={name:e.name,id:e.id,log:e.log,token:e.token});var t=a.props.fm.state.log.filter(function(e){return e.user_id===1*a.props.uid});e.name=a.props.fm.state.students[a.props.uid].name,e.id=1*a.props.uid,e.log=t,e.token=null,e.isAdmin=e.isTutor=!1,a.props.fm.setState({user:e,page:null,message:{type:"success",text:"Switched user to: "+e.name}})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.props.uid&&this.props.fm.state.user.isAdmin&&this.props.fm.state.students&&this.props.fm.state.students[this.props.uid]?r.a.createElement("span",null,r.a.createElement("span",{className:"btn-link",onClick:this.setUser},r.a.createElement("i",{className:"fa fa-group"}))," ",r.a.createElement(ks,{uid:this.props.uid})):null}}]),t}(s.Component),Sa=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={paper:a.setPaper(a.props.test),type:null,error:{},q:null},a.update=function(e,t){var s=a.state.paper;s[e]=t,a.setState({paper:s})},a.update=function(e,t){var s=a.state.paper;s.questions[a.state.q][e]=t,a.setState({paper:s})},a.working=function(){var e=a.state.paper.questions[a.state.q],t={};return["topic","question","answer","help","working"].forEach(function(a){t[a]=e[a]?e[a]:""}),t},a.updateQ=function(e,t,s){if("ans"===a.state.type)console.log("updateQ",e),a.setState({q:e});else{var r=a.state.paper.questions;"undefined"===typeof r[e]&&(r[e]={q:"",marks:""}),r[e][t]=s;for(var n=0,l=0;l<e;l++)K(r[l][t])||(n=1*r[l][t]);if(l=e-1,1*s>=n)for(;l>=0&&K(r[l][t]);)r[l--][t]=s;var i=a.state.paper;i.questions=r,a.setState({paper:i})}},a.save=function(){C("/react_ajax/past",function(e){e.error?a.setState({error:e.data}):(a.state.paper.id=e.data.id,a.setState({paper:a.state.paper}),console.log("past",e.data.id))},{test:a.state.paper})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"setPaper",value:function(e){if(!e)return{id:"",name:"",board:"",month:"",year:"",title:"",QP:"",MS:"",ER:"",questions:[]};var t=e.test;return t.title=e.title,t.id=e.id,t.questions=e.test.questions,t}},{key:"render",value:function(){var e=this,t=[],a=0,s=0;for(s=0;s<this.state.paper.questions.length;s++){var n=this.state.paper.questions[s];"edit"===this.state.type?t.push(r.a.createElement(xa,{key:s,i:s,update:this.updateQ,q:n||{q:"",marks:""}})):t.push(r.a.createElement(Ca,{key:s,i:s,update:this.updateQ,type:this.state.type,q:n})),"undefined"!==typeof n&&(a+=1*n.marks)}return"edit"===this.state.type&&t.push(r.a.createElement(xa,{key:s,i:s,update:this.updateQ,q:{q:"",marks:""}})),r.a.createElement(x.a,{show:!0,onHide:this.props.close,bsSize:"ans"===this.state.type?"lg":null},r.a.createElement(x.a.Header,{closeButton:!0},r.a.createElement(x.a.Title,null,this.state.paper.title.replace(/_/g," "))),r.a.createElement(x.a.Body,null,this.state.error.error?r.a.createElement("div",{className:"alert alert-danger"},r.a.createElement("strong",null,"Error: ",this.state.error.error)):null,r.a.createElement("input",{type:"text",size:"10",placeholder:"Name",value:this.state.paper.name,onChange:function(t){return e.update("name",t.target.value)}}),r.a.createElement("input",{size:"5",type:"text",placeholder:"Board",value:this.state.paper.board,onChange:function(t){return e.update("board",t.target.value)}}),r.a.createElement("input",{size:"5",type:"text",placeholder:"Month",value:this.state.paper.month,onChange:function(t){return e.update("month",t.target.value)}}),r.a.createElement("input",{size:"5",type:"text",placeholder:"Year",value:this.state.paper.year,onChange:function(t){return e.update("year",t.target.value)}}),r.a.createElement("br",null),r.a.createElement("input",{style:{width:"90%"},type:"text",placeholder:"Paper",value:this.state.paper.QP,onChange:function(t){return e.update("QP",t.target.value)}}),r.a.createElement("br",null),r.a.createElement("input",{style:{width:"90%"},type:"text",placeholder:"Mark Scheme",value:this.state.paper.MS,onChange:function(t){return e.update("MS",t.target.value)}}),r.a.createElement("br",null),r.a.createElement("input",{style:{width:"90%"},placeholder:"Examiners Report",value:this.state.paper.ER,onChange:function(t){return e.update("ER",t.target.value)}}),r.a.createElement("br",null),r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({type:"edit"})}},"Questions & Marks"),r.a.createElement("br",null),r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.setState({type:"qp"})},href:this.state.paper.QP},"question paper"),"\xa0",r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.setState({type:"ms"})},href:this.state.paper.MS},"mark scheme"),"\xa0",r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",onClick:function(){return e.setState({type:"er"})},href:this.state.paper.ER},"examiners report"),r.a.createElement("br",null),_a(this.state.paper)," ",Aa(this.state.paper)," ",r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({type:"ans"})}},"working"),r.a.createElement("br",null),"qp"===this.state.type?r.a.createElement("input",{type:"text",placeholder:"Extra Pages",value:this.state.paper.qpx?this.state.paper.qpx:"",onChange:function(t){return e.update("qpx",t.target.value)}}):null,r.a.createElement(b.a,null,r.a.createElement(g.a,{sm:3},r.a.createElement("table",{className:"table table-bordered table-condensed table-striped",style:{width:"auto"}},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Q"),r.a.createElement("th",null,this.state.type))),r.a.createElement("tbody",null,t),r.a.createElement("tfoot",null,r.a.createElement("tr",null,r.a.createElement("th",null,"total"),r.a.createElement("th",null,a))))),"ans"===this.state.type?r.a.createElement(g.a,{sm:9},null!==this.state.q?r.a.createElement("div",null,r.a.createElement("h3",null,"Question ",this.state.paper.questions[this.state.q].q),r.a.createElement(Tt,{auto:!0,fields:this.working(),update:this.update})):null):null)),r.a.createElement(x.a.Footer,null,r.a.createElement(q.a,{onClick:this.save},"Save")))}}]),t}(s.Component),xa=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("input",{size:"4",type:"text",value:this.props.q.q,placeholder:"1a",onChange:function(t){return e.props.update(e.props.i,"q",t.target.value)}})),r.a.createElement("td",null,r.a.createElement("input",{style:{width:"3em"},type:"number",placeholder:"0",value:this.props.q.marks,onChange:function(t){return e.props.update(e.props.i,"marks",t.target.value)}})))}}]),t}(s.Component),Ca=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return this.props.type?r.a.createElement("tr",null,r.a.createElement("td",null,this.props.q.q),"ans"===this.props.type?r.a.createElement("td",null,r.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.update(e.props.i,e.props.type)}},"edit")):r.a.createElement("td",null,r.a.createElement("input",{style:{width:"3em"},type:"number",placeholder:"0",value:this.props.q[this.props.type]?this.props.q[this.props.type]:"",onChange:function(t){return e.props.update(e.props.i,e.props.type,t.target.value)}}))):null}}]),t}(s.Component),Na=Sa;function _a(e,t,a){if($(t)&&K(t.qp))return a||"";$(e.test)&&(e=e.test);var s=$(t)&&!K(t.qp)?e.QP.split("#")[0]+"#page="+t.qp:e.QP;return $(e)&&!K(e.QP)?$(a)?r.a.createElement("a",{className:"btn-link",target:"_blank",rel:"noopener noreferrer",href:s+Ta(e)},r.a.createElement(L,{tooltip:"question paper"},a)):r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:s+Ta(e)},r.a.createElement(L,{tooltip:"question paper"},r.a.createElement("i",{style:{fontSize:I()},className:"fa fa-question-circle"}))):""}function Aa(e,t,a){if($(t)&&K(t.ms))return $(a)?a:"";$(e.test)&&(e=e.test);var s=$(t)&&!K(t.ms)?e.MS.split("#")[0]+"#page="+t.ms:e.MS;return $(e)&&!K(e.MS)?$(a)?r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:s},r.a.createElement(L,{tooltip:"mark scheme"},a)):r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:s},r.a.createElement(L,{tooltip:"mark scheme"},r.a.createElement("i",{style:{fontSize:I()},className:"fa fa-check-circle"}))):""}function Ma(e,t){if($(t)&&K(t.er))return"";$(e.test)&&(e=e.test);var a=$(t)&&!K(t.er)?e.ER.split("#")[0]+"#page="+t.er:e.ER;return $(e)&&!K(e.ER)?r.a.createElement("a",{rel:"noopener noreferrer",target:"_blank",href:a},r.a.createElement(L,{tooltip:"examiners report"},r.a.createElement("i",{style:{fontSize:I()},className:"fa fa-info-circle"}))):""}function Ta(e){if(!$(e.qpx))return"";for(var t=e.questions.map(function(e){return e.qp}),a=e.qpx.split(","),s=0,r=0,n=0,l=[];s<t.length&&r<a.length;)1*t[s]>1*a[r]?1*a[r]>n?(n=1*a[r],l.push(a[r++])):r++:1*t[s]>n?(n=1*t[s],l.push(t[s++])):s++;for(;s<t.length;)1*t[s]>n?(n=1*t[s],l.push(t[s++])):s++;for(;r<a.length;)1*a[r]>n?(n=1*a[r],l.push(a[r++])):r++;return"#"+l.join(",")}function Fa(e,t){var a=t.t.ts[e];return $(a)&&$(a.r)&&a.r.length>0?r.a.createElement(L,{placement:"bottom",tooltip:hs(a.r,t,!0)},r.a.createElement("span",{className:us(a.mk,a.mks)},H(e,t),"(",a.mk,"/",a.mks,")")):$(t.ts[e])&&$(t.ts[e].rs)&&$(t.ts[e].rs[window.FreeMaths.state.user.id])&&$(t.ts[e].rs[window.FreeMaths.state.user.id][0])?r.a.createElement(L,{placement:"bottom",tooltip:X(t.ts[e].rs[window.FreeMaths.state.user.id][0].ts)},r.a.createElement("span",{className:"green"},H(e,t)," (0/0)")):H(e,t)}var Qa=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,n=new Array(s),l=0;l<s;l++)n[l]=arguments[l];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={test:null,mark:!1,bar:!1,edit:!1},a.links=function(e){var t=B(e);if(!t||"past"!==t.type)return null;var s=window.FreeMaths.state.user.isAdmin?r.a.createElement(L,{tooltip:e},r.a.createElement("span",{className:"btn-link",onClick:function(){return a.setState({test:e,edit:!0})}},r.a.createElement("i",{className:t.test.questions.length&&t.test.questions[0].qp?"fa fa-edit green":"fa fa-edit red"}))):null;return r.a.createElement("span",null,"\xa0",_a(t),"\xa0",Aa(t),"\xa0",Ma(t),"\xa0",s)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t="past"===this.props.type?window.FreeMaths.state.data.past:window.FreeMaths.state.data.books,a=null;if(Q("Past")&&console.log("Past render",t,this.props,window.FreeMaths),this.props.test||(a=Object.keys(t).filter(function(a){return t[a].title.startsWith(e.props.topic)}).sort(function(e,a){return function(e,t){$(e.test)||(e.test=JSON.parse(e.json));$(t.test)||(t.test=JSON.parse(t.json));return e=e.test,t=t.test,0!==Da(e.name,t.name)?Da(e.name,t.name):e.board!==t.board?e.board>t.board?1:-1:e.year!==t.year?1*e.year-1*t.year:e.month!==t.month?e.month>t.month?1:-1:e.name.split("_").length>1?t.name.split("_").length>1?e.name.split("_")[1]>t.name.split("_")[1]?1:-1:1:t.name.split("_").length>1?-1:0}(t[e],t[a])}).map(function(t){return r.a.createElement("li",{key:t},r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({test:t})}},Fa(t,e.props.stats)),e.links(t))})),null!==this.state.test)if(this.state.edit)s=r.a.createElement(Na,{test:t[this.state.test],close:function(){return e.setState({test:null,edit:!1})}});else var s=r.a.createElement(Pa,{stats:this.props.stats,test:this.state.test,update:this.update,close:function(){return e.setState({test:null})}});return r.a.createElement("div",null,"GCSE(9-1)"===this.props.topic||"P1"===this.props.topic||"SM1"===this.props.topic?r.a.createElement("p",null,r.a.createElement("span",{className:"red"},"Note:")," Several ",this.props.topic," sample papers are combined into a single PDF. The links below should jump to the correct page but be careful to set a page range if printing."):null,a?r.a.createElement("ul",null,a):r.a.createElement("span",null,X(this.props.ts)," ",r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({test:e.props.test})}},Fa(this.props.test,this.props.stats)),this.links(this.props.test)),s)}}]),t}(s.Component);function Wa(e,t){var a={key:e},s=e.split(":"),r=Object(N.a)(s,3),n=r[0],l=r[1],i=r[2];return a.t=B(n),a.ts=t.ts[e],$(i)&&""!==i?(a.qs=$(a.t.qmap.qs)&&$(a.t.qmap.qs[l])&&$(a.t.qmap.qs[l][i])?a.t.qmap.qs[l][i]:null,a.ch=l,a.e=i):$(a.t.test)&&$(a.t.test.questions)&&(a.qs=a.t.test.questions),a}var Pa=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).setMarks=function(){var e=Wa(a.props.test,a.props.stats);return e.qs.map(function(t){var a=e.key.indexOf(":")>0?e.key+":"+t.q:e.key+":::"+t.q,s=$(e.ts)&&$(e.ts.qs[a])?e.ts.qs[a].l[window.FreeMaths.state.user.id]:null;return $(s)?{m:s.m,f:s.f,c:"",mk:s.mk,mks:t.marks,q:t.q}:{m:"",f:"",c:"",mk:"",mks:t.marks,q:t.q}})},a.state={marks:a.setMarks(),effort:0,show:!1},a.marking=function(e){var t=window.FreeMaths.state.user;t.log.push(e),window.FreeMaths.setState({user:t,message:null}),a.props.close()},a.save=function(){var e={marks:a.state.marks.map(function(e){return e.show?(delete e.show,e):void 0}),effort:a.state.effort};C("/react_ajax/marking",function(e){e.error?a.setState({error:e.data.error}):a.marking(e.data.log)},{test_id:a.props.test,info:e})},a.setEffort=function(e){a.setState({effort:e})},a.mark=function(e,t,s){var r=a.state.marks,n=Wa(a.props.test,a.props.stats).qs;r[e].show=!0,"f"===t?r[e].f=s:"mk"===t?(r[e].mk=s,r[e].mks=n[e].marks,""===s?r[e].f="":s===n[e].marks?(r[e].f=":)",r[e].m="\u2713"):"0"===s?(r[e].f=":)",r[e].m="\u2717"):(r[e].f=":)",r[e].m="?\u2713")):r[e].c=s,a.setState({marks:r})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"total",value:function(){var e={marks:0,total:0,f:{":)":0,":|":0,":(":0},m:{"\u2713":0,"?\u2713":0,"\u2717":0},qs:0,qc:0},t=this.state.marks,a=Wa(this.props.test,this.props.stats).qs;e.qc=a.length;for(var s=0;s<a.length;s++)(this.state.show||t[s].show||1*a[s].marks!==1*t[s].mk||":)"!==t[s].f)&&(e.qs++,e.total+=1*a[s].marks,e.marks+=1*t[s].mk,t[s].f.startsWith(":")&&e.f[t[s].f]++,""!==t[s].m&&e.m[t[s].m]++);return e}},{key:"render",value:function(){var e=this;if(null===this.props.test)return null;var t=Wa(this.props.test,this.props.stats),a=0,s=[],n=!1;t.qs.forEach(function(l){var i=t.key.indexOf(":")>0?t.key+":"+l.q:t.key+":::"+l.q;e.state.show?s.push(r.a.createElement(Ba,{key:a,qkey:i,i:a,test:t.t,update:e.updateQ,q:l,mark:e.mark,marks:!K(e.state.marks)&&$(e.state.marks[a])?e.state.marks[a]:{m:"",f:"",c:""}})):e.state.marks[a].show||1*l.marks!==1*e.state.marks[a].mk||":)"!==e.state.marks[a].f?s.push(r.a.createElement(Ba,{qkey:i,key:a,test:t.t,i:a,update:e.updateQ,q:l,mark:e.mark,marks:$(e.state.marks[a])?e.state.marks[a]:{m:"",f:"",c:"",mk:0}})):n=!0,a++});var l=this.total();if(l.marks===l.total)var i="green";else i=l.marks>.65*l.total?"amber":"red";return r.a.createElement(R,{save:{fn:this.save,text:"Save"},close:this.props.close,title:H(this.props.test,this.props.stats)},n||this.state.show?r.a.createElement("button",{onClick:function(){return e.setState({show:!e.state.show})},className:"btn btn-default btn-sm"},this.state.show?"Hide":"Show"," ",r.a.createElement("span",{className:"green"},"\u2713",cs[":)"])):null,r.a.createElement("table",{className:"table table-bordered table-condensed table-striped",style:{width:"auto"}},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Q ",_a(t.t)),r.a.createElement("th",null,"Marks ",Aa(t.t)),r.a.createElement("th",{style:{textAlign:"center"}},cs[":)"]),r.a.createElement("th",null,"Comment ",Ma(t.t)))),r.a.createElement("tbody",null,s),r.a.createElement("tfoot",null,r.a.createElement("tr",null,r.a.createElement("th",{style:{verticalAlign:"middle"}},"Total"),r.a.createElement("th",{style:{verticalAlign:"middle",textAlign:"center"}},r.a.createElement("span",{className:i},l.marks),"/",l.total),r.a.createElement("th",{style:{verticalAlign:"middle",textAlign:"center"}},r.a.createElement("span",{className:"green"},l.f[":)"])," ",r.a.createElement("span",{className:"amber"},l.f[":|"])," ",r.a.createElement("span",{className:"red"},l.f[":("])),r.a.createElement("th",null,r.a.createElement(za,{total:l,effort:this.state.effort,setEffort:this.setEffort}))))),this.state.error?r.a.createElement("div",{className:"alert alert-danger"},r.a.createElement("strong",null,"Server Error: ",this.state.error)):null)}}]),t}(s.Component),za=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).update=function(e){var t=e.target.value.split(":");if(3===t.length)var s=1e3*(60*(60*t[0]+t[1])+t[2]);else 2===t.length?s=60*(60*t[0]+t[1])*1e3:1===t.length&&(s=60*t[0]*1e3);a.props.setEffort(s)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=$(this.props.effort)&&this.props.effort>0?Math.round(this.props.effort/6e4):"";return r.a.createElement("span",null,"Effort: ",r.a.createElement("input",{onChange:this.update,size:"5",type:"text",value:e,placeholder:Math.round(this.props.total.total/75*90)}),"(mins)")}}]),t}(s.Component);function Da(e,t){return(e=e.split("_")[0])===(t=t.split("_")[0])?0:"GCSE(9-1)"===e?-1:"GCSE(9-1)"===t?1:e>t?1:-1}var Ba=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;if(window.FreeMaths.state.user.isMobile)var t=r.a.createElement("input",{style:{width:"6em"},type:"text",name:"comment",value:this.props.marks.c,onChange:function(t){return e.props.mark(e.props.i,"c",t.target.value)}});else t=r.a.createElement("input",{type:"text",name:"comment",value:this.props.marks.c,onChange:function(t){return e.props.mark(e.props.i,"c",t.target.value)}});return r.a.createElement("tr",null,r.a.createElement("td",null,_a(this.props.test,this.props.q,this.props.q.q)),r.a.createElement("td",{style:{width:"6em"}},r.a.createElement(Ha,{test:this.props.test,q:this.props.q,mk:this.props.marks.mk,i:this.props.i,mark:this.props.mark})),r.a.createElement("td",null,r.a.createElement(Ra,{f:this.props.marks.f,i:this.props.i,mark:this.props.mark})),r.a.createElement("td",null,Ma(this.props.test,this.props.q)," ",t," ",this.props.marks.c?r.a.createElement(ks,{c:this.props.marks.c,qkey:this.props.qkey}):null))}}]),t}(s.Component),Ha=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){for(var e=this,t=[r.a.createElement("option",{key:"?",value:""},"?")],a=0;a<=this.props.q.marks;a++)t.push(r.a.createElement("option",{key:a},a));if(1*this.props.mk===1*this.props.q.marks)var s=r.a.createElement("span",{className:"green"},this.props.q.marks);else s=this.props.mk>0?r.a.createElement("span",{className:"amber"},this.props.q.marks):"0"===this.props.mk?r.a.createElement("span",{className:"red"},this.props.q.marks):r.a.createElement("span",null,this.props.q.marks);return r.a.createElement("span",null,r.a.createElement("select",{value:this.props.mk,className:"qmark btn btn-default btn-sm",onChange:function(t){return e.props.mark(e.props.i,"mk",t.target.value)}},t),"/",Aa(this.props.test,this.props.q,s))}}]),t}(s.Component),Ra=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;if(":)"===this.props.f)var t="green ";else t=":|"===this.props.f?"amber ":":("===this.props.f?"red ":"";return r.a.createElement("select",{value:this.props.f,className:t+"feedback btn btn-default btn-sm",onChange:function(t){return e.props.mark(e.props.i,"f",t.target.value)}},r.a.createElement("option",{value:""},"?"),r.a.createElement("option",{className:"green"},":)"),r.a.createElement("option",{className:"amber"},":|"),r.a.createElement("option",{className:"red"},":("))}}]),t}(s.Component),Ia=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={book:{id:"",name:"",board:"",isbn:"",link:"",chapters:[]}},a.update=function(e,t){var s=a.state.book;s[e]=t,a.setState({book:s})},a.save=function(){C("/react_ajax/book",function(e){if(e.error)a.setState({error:e.data});else{var t=a.state.book;t.id=e.data.id,a.setState({book:t}),console.log("book",e.data.id)}},{book:a.state.book})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){$(this.props.id)&&this.setState({book:window.FreeMaths.state.data.books[this.props.id].book})}},{key:"render",value:function(){var e=this;return r.a.createElement(x.a,{show:!0,onHide:this.props.close,bsSize:"lg"},r.a.createElement(x.a.Header,{closeButton:!0},r.a.createElement(x.a.Title,null,this.state.book.name.replace(/_/g," "))),r.a.createElement(x.a.Body,null,r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("input",{type:"text",size:"5",placeholder:"Name",value:this.state.book.name,onChange:function(t){return e.update("name",t.target.value)}}),r.a.createElement("input",{size:"5",type:"text",placeholder:"Board",value:this.state.book.board,onChange:function(t){return e.update("board",t.target.value)}}),r.a.createElement("input",{size:"15",type:"text",placeholder:"ISBN",value:this.state.book.isbn,onChange:function(t){return e.update("isbn",t.target.value)}}),r.a.createElement("br",null),r.a.createElement("input",{size:"100",type:"text",placeholder:"Link",value:this.state.book.link,onChange:function(t){return e.update("link",t.target.value)}}),r.a.createElement(La,{cs:this.state.book.chapters,update:this.update}))),r.a.createElement(x.a.Footer,null,r.a.createElement(q.a,{onClick:this.save},"Save")))}}]),t}(s.Component),La=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={c:0,e:0},a.update=function(e,t){var s=a.props.cs;""===e.chapter&&""===e.topic?s.splice(t,1):s[a.state.c]=e,a.setState({e:null}),a.props.update("chapters",s)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(Ua,{e:this.state.e,c:this.props.cs[this.state.c],i:this.state.c,update:this.update,add:function(){return e.setState({c:e.state.c+1,e:0})},back:function(){return e.setState({c:e.state.c>0?e.state.c-1:0,e:0})}})}}]),t}(s.Component),Ua=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).update=function(e,t){if($(a.props.c))var s=a.props.c;else s={chapter:"",topic:"",link:"",exercises:[]};s[e]=t,a.props.update(s,a.props.i)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;if($(this.props.c))var t=this.props.c;else t={chapter:"",topic:"",link:"",exercises:[]};return r.a.createElement("div",null,"Chapter: ",r.a.createElement("input",{size:"2",type:"text",value:t.chapter,placeholder:"1",onChange:function(t){return e.update("chapter",t.target.value)}}),r.a.createElement("input",{size:"15",type:"topic",placeholder:"Topic",value:t.topic,onChange:function(t){return e.update("topic",t.target.value)}}),r.a.createElement("span",{className:"btn-link",onClick:this.props.add},"\xa0",r.a.createElement("i",{className:"fa fa-btn fa-plus-square-o"})),r.a.createElement("span",{className:"btn-link",onClick:this.props.back},"\xa0",r.a.createElement("i",{className:"fa fa-btn fa-minus-square-o"})),r.a.createElement("input",{size:"100",type:"text",placeholder:"Link",value:t.link,onChange:function(t){return e.update("link",t.target.value)}}),r.a.createElement(Ja,{e:this.props.e,es:t.exercises,update:this.update}))}}]),t}(s.Component),Ja=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={e:0},a.update=function(e,t){var s=a.props.es;""===e.exercise&&""===e.topic?s.splice(t,1):s[a.state.e]=e,a.props.update("exercises",s)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){$(e.e)&&this.setState({e:e.e})}},{key:"render",value:function(){var e=this;return r.a.createElement($a,{e:this.props.es[this.state.e],i:this.state.e,update:this.update,add:function(){return e.setState({e:e.state.e+1})},back:function(){return e.setState({e:e.state.e>0?e.state.e-1:0})}})}}]),t}(s.Component),$a=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).update=function(e,t){if(console.log("Exercise update",e,t),$(a.props.e))var s=a.props.e;else s={exercise:"",topic:"",page:"",qs:[]};s[e]=t,a.props.update(s,a.props.i)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;if($(this.props.e))var t=this.props.e;else t={exercise:"",topic:"",page:"",qs:[]};return r.a.createElement("div",null,"Exercise: ",r.a.createElement("input",{size:"2",type:"text",value:t.exercise,placeholder:"1",onChange:function(t){return e.update("exercise",t.target.value)}}),r.a.createElement("input",{size:"15",type:"topic",placeholder:"Topic",value:t.topic,onChange:function(t){return e.update("topic",t.target.value)}}),r.a.createElement("input",{style:{width:"4em"},type:"number",placeholder:"pg",value:t.page,onChange:function(t){return e.update("page",t.target.value)}}),r.a.createElement("span",{className:"btn-link",onClick:this.props.add},"\xa0",r.a.createElement("i",{className:"fa fa-btn fa-plus-square-o"})),r.a.createElement("span",{className:"btn-link",onClick:this.props.back},"\xa0",r.a.createElement("i",{className:"fa fa-btn fa-minus-square-o"})),r.a.createElement(Ka,{qs:t.qs,update:this.update}))}}]),t}(s.Component),Ka=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).update=function(e,t){var s=a.props.qs;if(e.q.indexOf("-")>0){var r=e.q.split("-"),n=Object(N.a)(r,2),l=n[0],i=n[1],o=l.substring(0,l.length-1);if(l.endsWith("a")){if(1===i.length&&i.match(/[b-z]/)){s.splice(t,1);for(var c="a";c!==i;c=String.fromCharCode(c.charCodeAt(0)+1))s.splice(t++,0,{q:o+c,marks:e.marks});s.splice(t,0,{q:o+c,marks:e.marks})}}else if(l.endsWith("i")){var u=["i","ii","iii","iv","v","vi","vii","viii","ix","x"];if(u.includes(i)){for(s.splice(t,1),c=0;u[c]!==i;c++)s.splice(t++,0,{q:o+u[c],marks:e.marks});s.splice(t,0,{q:o+u[c],marks:e.marks})}}else if((i*=1)>(l*=1)&&i-l<99)for(s.splice(t,1),c=l;c<=i;c++)s.splice(t++,0,{q:c,marks:e.marks})}else""===e.q?s.splice(t,1):s[t]=e;a.props.update("qs",s)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=0,a=this.props.qs.map(function(a){return r.a.createElement(Va,{key:t,q:a,i:t++,update:e.update})});return r.a.createElement("div",null,a,r.a.createElement(Va,{key:t,q:void 0,i:t,update:this.update}))}}]),t}(s.Component),Va=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).update=function(e,t){if($(a.props.q))var s=a.props.q;else s={q:"",marks:"2"};s[e]=t,a.props.update(s,a.props.i)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;if($(this.props.q))var t=this.props.q;else t={q:"",marks:"2"};return r.a.createElement("div",null,r.a.createElement("input",{size:"4",type:"text",value:t.q,placeholder:"1a",onChange:function(t){return e.update("q",t.target.value)}}),r.a.createElement("input",{style:{width:"4em"},type:"number",placeholder:"0",value:t.marks,onChange:function(t){return e.update("marks",t.target.value)}}))}}]),t}(s.Component),Ga=Ia,Xa=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={show:!1},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=this.props.pkey.split(":"),a=Object(N.a)(t,3),s=a[0],n=a[1],l=a[2],i=s+":"+n+":"+l,o=window.FreeMaths.state.data.books[s].book;if(!o)return null;var c=o.chapters.find(function(e){return e.chapter===n});if(c.exercises){var u=c.exercises.find(function(e){return e.exercise=l});if(u)return this.state.show?r.a.createElement(Pa,{stats:this.props.stats,test:i,update:this.update,close:function(){return e.setState({show:!1})}}):r.a.createElement("span",null,r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({show:!0})}},u.exercise,"  ",r.a.createElement(Dt,null,u.topic)),r.a.createElement(ss,{stats:this.props.stats,ekey:i}),"\xa0",Ya(c.link,u.page,u.exercise))}}}]),t}(s.Component);function Ya(e,t,a){var s=e+"#page="+t;return e.indexOf("$pg")>0&&(s=t>1e4?e.replace(/r00\/.*\$pg/,"r00/r00"+Math.floor(t/1e4)+"/r00"+Math.floor(t/100)+"/r00"+t).replace("$ex",a):e.replace("$pg",t).replace("$ex",a)),r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:s},r.a.createElement(L,{tooltip:"solution bank"},r.a.createElement("i",{style:{fontSize:I()},className:"fa fa-check-circle"})))}var Za=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=[237,238,240].map(function(t){var a=window.FreeMaths.state.data.books[t],s=0;return a.book.chapters.forEach(function(e){e.n=s++;var t=0;e.exercises.forEach(function(e){return e.n=t++})}),r.a.createElement(es,{key:a.id,bk:a,stats:e.props.stats,pkey:e.props.pkey,set:e.props.set})});return r.a.createElement("div",null,t)}}]),t}(s.Component),es=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={show:!1,edit:!1},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=1===window.FreeMaths.state.user.id?r.a.createElement(L,{tooltip:this.props.bk.id},r.a.createElement("button",{className:"btn btn-link",onClick:function(){return e.setState({edit:!0})}},r.a.createElement("i",{className:"fa fa-edit green"}))):null;return this.state.edit?r.a.createElement(Ga,{close:function(){return e.setState({edit:!1})},id:this.props.bk.id}):r.a.createElement("div",null,r.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.set(e.props.pkey?null:e.props.bk.id+"")}},H(this.props.bk.title)),r.a.createElement(ss,{bk:this.props.bk,stats:this.props.stats})," ",t,this.props.pkey?r.a.createElement(ts,{pkey:this.props.pkey,set:this.props.set,bk:this.props.bk,stats:this.props.stats}):null)}}]),t}(s.Component),ts=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=this.props.pkey.split(":");if(0===t.length||1*t[0]!==1*this.props.bk.id)return null;var a=t[0],s=this.props.bk.book.chapters.map(function(t){var s=a+":"+t.chapter;return r.a.createElement("li",{key:t.chapter},r.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.set(e.props.pkey===s?a:s)}},t.chapter," ",r.a.createElement(Dt,null,t.topic)),r.a.createElement(ss,{bk:e.props.bk,stats:e.props.stats,ch:t.chapter}),r.a.createElement(as,{stats:e.props.stats,set:e.props.set,bk:e.props.bk,chapter:t,pkey:e.props.pkey}))});return r.a.createElement("ul",null,s)}}]),t}(s.Component),as=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=this.props.pkey.split(":");if(t.length<2||t[1]!==this.props.chapter.chapter)return null;var a=t[0]+":"+t[1],s=this.props.chapter.exercises.map(function(s){var n=a+":"+s.exercise;return r.a.createElement("li",{key:s.exercise},r.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.set(e.props.pkey===n?a:n)}},s.exercise,"  ",r.a.createElement(Dt,null,s.topic)),r.a.createElement(ss,{stats:e.props.stats,bk:e.props.bk,ch:t[1],e:s.exercise}),"\xa0",Ya(e.props.chapter.link,s.page,s.exercise))}),n=3===t.length?r.a.createElement(Pa,{stats:this.props.stats,test:this.props.pkey,close:function(){return e.props.set(a)}}):null;return r.a.createElement("div",null,r.a.createElement("ul",null,s),n)}}]),t}(s.Component);var ss=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e,t,a,s,n=function(e,t){var a={"\u2717":[],":(":[],"?\u2713":[],":|":[],"\u2713":[],":)":[],mk:"",mks:0,qs:0,ts:0,effort:0,r:[]};return Object.keys(t.t.ts).filter(function(t){return t.startsWith(e)}).forEach(function(e){var s=t.t.ts[e];[":(",":|",":)","\u2717","?\u2713","\u2713"].forEach(function(e){return a[e].push.apply(a[e],s[e])}),a.r.push.apply(a.r,s.r),a.mks+=s.mks,a.mk=ca(a.mk,s.mk),a.qs+=s.qs,s.ts>a.ts&&(a.ts=s.ts)}),a}(this.props.ekey?this.props.ekey:(e=this.props.bk.id,t=this.props.ch,a=this.props.e,s=e,$(t)&&(s+=":"+t,$(a)&&(s+=":"+a)),s),this.props.stats);return n&&0!==n.mks?r.a.createElement("span",{className:us(n.mk,n.mks)}," (",n.mk,"/",n.mks,")"):null}}]),t}(s.Component),rs={":(":!0,":|":!0,":)":!0},ns={"\u2717":!0,"?\u2713":!0,"\u2713":!0},ls={"\u2717":"red","?\u2713":"amber","\u2713":"green",":)":"green",":|":"amber",":(":"red",Help:"blue"},is=[":(",":|","\u2717","?\u2713","\u2713"],os=[":(",":|",":)","\u2717","?\u2713","\u2713"],cs={"\u2717":"\u2717","?\u2713":"\u2713","\u2713":"\u2713",Q:"?",":)":r.a.createElement("i",{name:"smile",className:"fa fa-smile-o green"}),":|":r.a.createElement("i",{name:"meh",className:"fa fa-meh-o amber"}),":(":r.a.createElement("i",{name:"frown",className:"fa fa-frown-o red"}),Show:r.a.createElement("i",{className:"fa fa-eye"}),Help:r.a.createElement("i",{className:"fa fa-book"}),"Re-try":r.a.createElement("i",{className:"fa fa-repeat"}),"\u2713\u2717":r.a.createElement("i",{className:"fa fa-check-square-o"})};function us(e,t){return 1*e===t?"green":e>.65*t?"amber":"red"}function ps(e){var t=0,a=null;return e[":)"].forEach(function(e){e.ts>t&&(a=":)",t=e.ts)}),e[":|"].forEach(function(e){e.ts>t&&(a=":|",t=e.ts)}),e[":("].forEach(function(e){e.ts>t&&(a=":(",t=e.ts)}),a?cs[a]:null}function ms(e,t,a,s){return r.a.createElement("td",{key:"mks",onClick:s?function(){return s(e.r)}:null,style:{textAlign:"center"},className:us(""===e.mk?0:e.mk,e.mks)},r.a.createElement(L,{placement:"bottom",tooltip:function(e,t,a){var s=0;return e.sort(function(e,t){return t.ts-e.ts}).map(function(n){var l=n.uid?n.uid:e.uid?e.uid:null;return r.a.createElement("div",{key:s++,style:{textAlign:"left"}},X(n.ts)," ",a?"":$(l)?t.users[l].name:""," ",n.key?H(n.key,t,!0):""," ",""!==n.mk?r.a.createElement("span",{className:us(n.mk,n.mks)},n.mk,"/",n.mks):"?/?")})}(e.r,t,a)},""===e.mk?0:e.mk,"/",e.mks))}function hs(e,t,a){var s=0;return e.sort(function(e,t){return t.ts-e.ts}).map(function(n){var l=n.uid?n.uid:e.uid?e.uid:null;return r.a.createElement("div",{key:s++,style:{textAlign:"left"}},X(n.ts)," ",a?"":$(l)?t.users[l].name:""," ",n.key?H(n.key,t,!0):""," ",""!==n.mk?r.a.createElement("span",{className:us(n.mk,n.mks)},n.mk,"/",n.mks):"")})}function fs(e,t,a,s,n){return 0===e[t].length?r.a.createElement("td",{key:t}):r.a.createElement("td",{key:t,onClick:n?function(){return n(e[t])}:null,className:$(e[t][0].l)&&!e[t][0].l?"grey":ls[t]},r.a.createElement(L,{placement:"bottom",tooltip:function(e,t,a,s,n){var l=0,i=e[t].sort(function(e,t){return t.ts-e.ts===0?e.key.localeCompare(t.key):t.ts-e.ts}).slice(0,20).map(function(t){var i=t.uid?t.uid:e.uid?e.uid:null;return r.a.createElement("div",{key:l++,style:{textAlign:"left"}},X(t.ts)," ",s?"":$(i)?a.users[i].name:""," ",t.key?r.a.createElement("span",{className:n},H(t.key,a,!0)):"")});e[t].length>20&&i.push(r.a.createElement("div",{key:"dots",style:{textAlign:"center"}},"\u2026"));return i}(e,t,a,s,ls[t])},e[t].length))}function ds(){return is.map(function(e){return r.a.createElement("th",{key:e,className:ls[e]},cs[e])})}function vs(e,t,a,s){var n=is.map(function(r){return fs(e,r,t,a,s)});return n.push(ms(e,t,a,s)),n.push(function(e,t,a,s){return r.a.createElement("td",{key:"n",onClick:s?function(){return s(e.r)}:null},r.a.createElement(L,{placement:"bottom",tooltip:hs(e.r,t,a)},e.r.length))}(e,t,a,s)),n.push(function(e,t,a,s){var n=0;if(0===e.length)return r.a.createElement("td",{key:n++});var l=e.sort(function(e,t){return t.ts-e.ts}).map(function(e){return r.a.createElement("div",{key:n++,style:{textAlign:"left"}},X(e.ts)," ",a?"":t.users[e.uid].name," ",H(e.key,t,!0),a?" ":r.a.createElement("br",null),r.a.createElement("span",{style:{textAlign:"left"},className:ls[e.f]},r.a.createElement(Dt,null,e.c)))});return r.a.createElement("td",{key:"comments",onClick:s?function(){return s(e,!0)}:null,style:{textAlign:"center"}},r.a.createElement(L,{tooltip:l,placement:"bottom"},e.length))}(e.c,t,a,s)),n}function bs(e,t){return os.map(function(a){return function(e,t,a){return 0===Object.keys(e[t]).length?r.a.createElement("td",{key:t}):r.a.createElement("td",{key:t,onClick:a?function(){return a(e[t])}:null,className:ls[t]},r.a.createElement(L,{placement:"bottom",tooltip:function(e,t){var a=window.FreeMaths.state.data.tests.questions;return Object.keys(e[t]).sort(function(a,s){return e[t][s].ts-e[t][a].ts}).map(function(s){return e[t][s].variables||console.log("tipT0",e[t][s],e,t,a,s),r.a.createElement("div",{key:s,style:{textAlign:"left"}},X(e[t][s].ts)," ",r.a.createElement("span",{className:ls},"Q",s," ",r.a.createElement(Dt,{vars:e[t][s].variables?JSON.parse(e[t][s].variables):null},a[s].topic)))})}(e,t)},Object.keys(e[t]).length))}(e,a,t)})}function gs(e,t,a){var s=0,n="",l="",i="",o="",c="";return e.sort(function(e,t){return e.mks?t.ts-e.ts:e.key.localeCompare(t.key,void 0,{numeric:!0})}).map(function(e){var u=e.key.split(":"),p=Object(N.a)(u,4),m=p[0],h=p[1],f=p[2],d=p[3],v=$(e.mk)?e.mk:t.t.qs[e.key].mk,b=$(e.mks)?e.mks:t.t.qs[e.key].mks,g=B(m).type,k=r.a.createElement("div",{key:s++},f?m!==i||h!==n||f!==l?r.a.createElement("h5",null,X(e.ts)," ",H(m,t)," ",r.a.createElement(Xa,{pkey:e.key,stats:t})):null:m!==i?r.a.createElement("h5",null,a?r.a.createElement("span",{className:"btn-link",onClick:a},X(e.ts)):X(e.ts)," ",H(m,t)," ",r.a.createElement("span",{className:us(v,b)},"(",v,"/",b,")")):null,!d||"vars"===g||m===i&&h===n&&f===l&&d===o&&c===e.c?null:r.a.createElement("div",null,X(e.ts)," Q ",function(e,t){var a=e.split(":"),s=Object(N.a)(a,4),r=s[0],n=s[3],l=B(r);return l&&"past"===l.type?_a(l,l.qs[n],n):n}(e.key)," ",r.a.createElement("span",{className:us(v,b)},"(",v,"/",b,")")," ",function(e,t,a){var s=e.split(":"),n=Object(N.a)(s,4),l=n[0],i=n[3],o=B(l);if(!o||"past"!==o.type)return null;var c=o.qs[i];return r.a.createElement("span",null,Aa(o,c)," ",Ma(o,c))}(e.key)," ",ps(t.t.qs[e.key])," ",r.a.createElement(Es,{qkey:e.key,stats:t})," ",r.a.createElement(ks,{qkey:e.key,stats:t})," ",e.c?e.c:null),d&&"vars"===g?r.a.createElement(Os,{x:e,stats:t}):null);return i=m,n=h,l=f,o=d,c=e.c,k})}var ks=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={contact:!1},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;if(this.state.contact){var t="",a=this.props.uid?this.props.uid:null;return this.props.c&&(t=this.props.c+"\n"),this.props.stats&&(1*this.props.stats.uid!==1*window.FreeMaths.state.user.id&&(a=this.props.stats.uid),this.props.qkey&&this.props.stats.t.qs[this.props.qkey].c.forEach(function(e){t+=e.c+"\n"})),r.a.createElement(Rt,{text:t,uid:a,fm:window.FreeMaths,qkey:this.props.qkey,close:function(){return e.setState({contact:!1})}})}return r.a.createElement(L,{tooltip:"Ask FreeMaths.uk",placement:"bottom"},r.a.createElement("i",{className:(this.props.btn?this.props.btn:"btn btn-default btn-sm")+" fa fa-envelope-o blue",onClick:function(){return e.setState({contact:!0})}}))}}]),t}(s.Component),Es=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.stats.t.qs[this.props.qkey].c;if(0===e.length)return null;var t=0,a=e.sort(function(e,t){return t.ts-e.ts}).map(function(e){return r.a.createElement("div",{key:t++,style:{textAlign:"left"}},X(e.ts)," ",r.a.createElement("span",{style:{textAlign:"left"},className:ls[e.f]},r.a.createElement(Dt,null,e.c)))});return r.a.createElement(L,{tooltip:a,placement:"bottom"},r.a.createElement("i",{className:"fa fa-comments","aria-hidden":"true"}))}}]),t}(s.Component),ys=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={ts:null},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"s",value:function(e){var t=this,a=[e];return Object.keys(this.props.stats.ts[e.key].qs).forEach(function(s){t.props.stats.ts[e.key].qs[s].rs[e.uid]&&t.props.stats.ts[e.key].qs[s].rs[e.uid].filter(function(t){return"vars"===B(e.key).type?e.ts-t.ts<3600:t.ts===e.ts}).forEach(function(e){a.push({ts:e.ts,mk:e.mk,key:s})})}),a}},{key:"render",value:function(){var e=this;if(!this.props.s)return null;var t=null;return t=-1===this.props.s[0].key.indexOf(":")?this.props.s.map(function(t){return t.ts&&t.ts===e.state.ts?gs(e.s(t),e.props.stats,function(){return e.setState({ts:null})}):gs([t],e.props.stats,function(){return e.setState({ts:t.ts})})}):gs(this.props.s,this.props.stats),r.a.createElement(R,{close:function(){return e.props.setS(null)},title:"Corrections"},t)}}]),t}(s.Component),Os=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={expand:!1},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"topic",value:function(e){if(!e.topics)return null;var t=e.topics.split(",")[0];return V(t.substr(0,t.length-1))+" level "+t.substr(t.length-1,1)}},{key:"render",value:function(){var e=this;if(null===this.props.x)return null;var t=this.props.x,a=t.key.split(":"),s=Object(N.a)(a,4)[3],n=window.FreeMaths.state.data.tests.questions[s];if(!n)return console.error("Adaptive",t,s),null;var l=t.v?JSON.parse(t.v):null,i=t.a?Kt(t.a,n.answer,l):null;return r.a.createElement("div",null,r.a.createElement("div",null,X(t.ts)," ",r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({expand:!e.state.expand})}},"Q ",s)," ",this.topic(n)," ",r.a.createElement(Ns,{mark:i})," ",ps(this.props.stats.t.qs[t.key])," ",r.a.createElement(Es,{qkey:t.key,stats:this.props.stats})," ",r.a.createElement(ks,{qkey:t.key,stats:this.props.stats})," ",t.c?t.c:null),this.state.expand&&t.v?r.a.createElement("div",null,r.a.createElement(Dt,{vars:l},n.question)):null,this.state.expand&&t.a?r.a.createElement("div",null,r.a.createElement(Fs,{noBox:!0,answer:t.a,vars:l,mark:i,keyboard:!1})):null)}}]),t}(s.Component),js=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return null===this.props.cs?null:r.a.createElement(R,{close:function(){return e.props.setS(null,!0)},title:"Comments"},gs(this.props.cs,this.props.stats))}}]),t}(s.Component);function ws(e,t,a){if("undefined"===typeof e.e[t])return r.a.createElement("td",null);var s="m"===a?{"\u2713":"green","?\u2713":"amber","\u2717":"red"}:{":)":"green",":|":"amber",":(":"red"},n=e.e[t].length,l=!1,i=0;if(n>0)var o=e.e[t].map(function(e){return"undefined"!==typeof e.comment&&e.comment.length>0?(l=!0,r.a.createElement("div",{className:s[t],style:{textAlign:"left"},key:i++},e.comment)):null});return 0===n&&(n=""),l?("s"===a&&(n=r.a.createElement("u",null,n)),t===e[a]?r.a.createElement("td",null,r.a.createElement(L,{className:s[t],tooltip:o},n)):r.a.createElement("td",null,r.a.createElement(L,{tooltip:o},n))):t===e[a]?r.a.createElement("td",{className:s[t]},n):r.a.createElement("td",null,n)}s.Component;var qs=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=["negatives","fractions","algebra","powers","surds","quadratics"].map(function(t){var a=e.props.stats[t]?bs(e.props.stats[t],e.props.setQs):[r.a.createElement("td",{key:"1"}),r.a.createElement("td",{key:"2"}),r.a.createElement("td",{key:"3"}),r.a.createElement("td",{key:"4"}),r.a.createElement("td",{key:"5"}),r.a.createElement("td",{key:"6"})];return r.a.createElement("tr",{key:t},r.a.createElement("td",null,r.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.setTest(t)}},V(t))),r.a.createElement("td",{className:"tdcenter"},e.props.stats[t]?e.props.stats[t].level:""),a)});return r.a.createElement("div",{name:"topics"},r.a.createElement("h3",null,"Topic Summary"),r.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Topic"),r.a.createElement("th",null,"level"),os.map(function(e){return r.a.createElement("th",{key:e,className:ls[e]},cs[e])}))),r.a.createElement("tbody",null,t)))}}]),t}(s.Component),Ss=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={correct:null,log:null,tid:null,qid:null,vars:null,tree:null,topic:null,last_log:null,edit:!1,qs:null,i:0},a.setQs=function(e){var t=Object.keys(e);Q("setQs")&&console.log("setQs(s) qs",e,t),a.setState({qid:t[0],vars:JSON.parse(e[t[0]].variables),i:1,qs:J(e)})},a.setTest=function(e){var t=a.props.fm.state.data.tests.tests,s=null,r=null,n=null;Object.keys(t).forEach(function(a){t[a].title.endsWith(V(e))&&(s=a)}),s&&(n=jt(D(r=t[s].qs[1].qid).variables,a.state.log[r])),a.setState({qid:r,vars:n,tid:s,topic:e,correct:null})},a.setTopic=function(e){var t=null;e=a.state.tree.topics[e]?e:null;var s=a.state.log.stats[e]?a.state.log.stats[e].level:null,r=jt(D(t=e?a.chooseQ(a.topicOptions(e,s)):a.setQ()).variables,a.state.log[t]);a.setState({qid:t,vars:r,topic:e})},a.logEvent=function(e,t,s){a.state.correct||"\u2713"!==e&&"?\u2713"!==e?"\u2717"!==e&&"?\u2717"!==e&&"Show"!==e||a.setState({correct:!1}):(a.setState({correct:e}),"\u2713"===e&&setTimeout(function(){return a.nextQ(":)")},1e3)),e.startsWith(":")&&a.nextQ(e),a.props.fm.updateLog({paper:a.state.tid?a.state.tid:0,question:a.state.qid,event:e,vars:a.state.vars,answer:t,comment:s})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){Q("AutoTestMount")&&console.log("AutoTest componentDidMount(),props,state",this.props,this.state);var e=this.filterLog(this.props.fm.state.user.log),t=this.buildTree(),a=this.props.qid&&!this.props.vars?jt(D(this.props.qid).variables,e[this.props.qid]):this.props.vars;this.setState({tid:this.props.tid,qid:this.props.qid,vars:a,log:e,tree:t,last_log:this.props.fm.state.user.log.length>0?this.props.fm.state.user.log[this.props.fm.state.user.log.length-1].id:0})}},{key:"shouldComponentUpdate",value:function(e,t){var a=e.fm.state.data.savedQ||t.last_log!==this.state.last_log||t.retry!==this.state.retry||t.correct!==this.state.correct||t.qid!==this.state.qid||t.vars!==this.state.vars||t.edit!==this.state.edit;return Q("AutoTestUpdate")&&console.log("AutoTest shouldComponentUpdate(p, s),props,state",e,t,this.props,this.state),a}},{key:"componentWillReceiveProps",value:function(e){if(Q("AutoTestProps")&&console.log("AutoTest componentWillReceiveProps(p),props,state",e,this.props,this.state),e.reset)this.setState({log:null});else if(this.state.log)if(e.fm.state.reload){var t=this.filterLog(e.fm.state.user.log),a=this.buildTree();this.setState({log:t,tree:a}),e.fm.setState({reload:!1})}else e.fm.state.user.log.length>0&&e.fm.state.user.log[e.fm.state.user.log.length-1].id!==this.state.last_log&&this.setState({log:this.updateLog(e.fm.state.user.log),last_log:e.fm.state.user.log[e.fm.state.user.log.length-1].id});else{var s=this.filterLog(e.fm.state.user.log),r=this.buildTree();this.setState({log:s,tree:r,last_log:this.props.fm.state.user.log.length>0?this.props.fm.state.user.log[this.props.fm.state.user.log.length-1].id:0})}}},{key:"maxLevel",value:function(){var e=this,t=3;return this.state.log.stats&&Object.keys(this.state.log.stats).forEach(function(a){e.state.log.stats[a].level>t&&(t=e.state.log.stats[a].level)}),t}},{key:"buildTree",value:function(){var e=this,t={topics:{},levels:{}};return Object.keys(this.props.fm.state.data.tests.questions).forEach(function(a){e.questionTopics(a).forEach(function(e){var s=e.topic,r=e.level;$(t.topics[s])||(t.topics[s]={}),$(t.levels[r])||(t.levels[r]={}),$(t.topics[s][r])?t.topics[s][r].push(a):t.topics[s][r]=[a],$(t.levels[r][s])?t.levels[r][s].push(a):t.levels[r][s]=[a]})}),t}},{key:"updateStats",value:function(e,t,a){var s=t;return this.questionTopics(e.question).forEach(function(t){$(s[t.topic])||(s[t.topic]={level:null,":(":{},":|":{},":)":{},"\u2717":{},"?\u2713":{},"\u2713":{},f:{},m:{}}),!rs[e.event]||s[t.topic].f[e.question]&&!a||(s[t.topic].f[e.question]&&s[t.topic][s[t.topic].f[e.question]][e.question]&&delete s[t.topic][s[t.topic].f[e.question]][e.question],s[t.topic][e.event][e.question]=e,s[t.topic].f[e.question]=e.event),!ns[e.event]||s[t.topic].m[e.question]&&!a||(s[t.topic].m[e.question]&&delete s[t.topic][s[t.topic].m[e.question]][e.question],s[t.topic][e.event][e.question]=e,s[t.topic].m[e.question]=e.event),"\u2713"===e.event&&(t.level>s[t.topic].level&&(s[t.topic].level=t.level),s[t.topic].f[e.question]&&s[t.topic][s[t.topic].f[e.question]][e.question]&&delete s[t.topic][s[t.topic].f[e.question]][e.question],s[t.topic].f[e.question]=":)")}),s}},{key:"corrections",value:function(e){var t={};return Object.keys(e).forEach(function(a){return["\u2717","?\u2713",":(",":|"].forEach(function(s){Object.keys(e[a][s]).forEach(function(r){t[r]||(t[r]=e[a][s][r])})})}),0===Object.keys(t).length&&(t=null),t}},{key:"updateLog",value:function(e){var t=this.state.log,a=e[e.length-1],s=new Date(a.created_at?a.created_at.replace(" ","T"):null).getTime();return t[a.question]?t[a.question].ts=s:t[a.question]={use:[],skip:[],ts:s},t[a.question].skip.includes(a.variables)||t[a.question].skip.push(a.variables),t[a.question].use.includes(a.variables)&&t[a.question].use.splice(t[a.question].use.indexOf(a.variables),1),t.stats=this.updateStats(a,t.stats,!0),t.corrections=this.corrections(t.stats),t}},{key:"filterLog",value:function(e){for(var t={session:[],stats:{},corrections:null},a=this.props.fm.state.data.tests.questions,s=e.length-1;s>0;s--){var r=e[s];if($(a[r.question])&&$(a[r.question].topics)&&r.variables.length>0&&-1===r.variables.indexOf("$")){var n=new Date(r.created_at.replace(" ","T")).getTime(),l=Date.now()-n<864e5;t[r.question]||(t[r.question]={use:[],skip:[],ts:n}),t[r.question].skip.includes(r.variables)||t[r.question].use.includes(r.variables)||(l||"\u2713"===r.event?t[r.question].skip.push(r.variables):"\u2717"===r.event&&t[r.question].use.push(r.variables)),t.stats=this.updateStats(r,t.stats)}}return t.corrections=this.corrections(t.stats),t}},{key:"setQ",value:function(e,t){t=t||null;for(var a=this.props.fm.state.data.tests.questions,s=Object.keys(this.state.log),r=0;null===t&&r<a.length;)$(this.state.log[s[r]].use)&&$(a[s[r]].topics)&&wt(a[s[r]].variables,this.state.log[s[r]])?t=s[r]:r++;if(null===t&&(t=this.chooseQ(this.levelOptions(null,this.maxLevel()))),Q("setQ")&&console.log("setQ(set,qid)",e,t),!e)return t;this.setState({qid:t,vars:jt(D(t).variables,this.state.log[t]),correct:null})}},{key:"chooseQ",value:function(e){for(var t=null,a=0;null===t&&a<e.length;)$(this.state.log[e[a]])&&!K(this.state.log[e[a]].skip)?a++:t=e[a];return null===t&&e.length>0&&(t=e[0]),t}},{key:"topicOptions",value:function(e,t){var a=this,s=[];return this.state.tree.topics[e]&&(this.state.tree.topics[e][t]?this.state.tree.topics[e][t].forEach(function(e){s.includes(e)||s.push(e)}):Object.keys(this.state.tree.topics[e]).forEach(function(t){return a.state.tree.topics[e][t].forEach(function(e){s.includes(e)||s.push(e)})}),s.sort(function(e,t){return a.state.log[e]?a.state.log[t]?a.state.log[e].ts-a.state.log[t].ts:1:-1})),s}},{key:"levelOptions",value:function(e,t){var a=this,s=[];return $(this.state.tree.levels[t])&&Object.keys(this.state.tree.levels[t]).forEach(function(r){r!==e&&a.state.tree.levels[t][r].forEach(function(e){s.includes(e)||s.push(e)})}),s}},{key:"questionTopic",value:function(e){return this.questionTopics(e)[0]?this.questionTopics(e)[0].topic:null}},{key:"questionSelect",value:function(e){var t=this;if(null!==this.state.correct&&"\u2713"!==this.state.correct)return r.a.createElement(Ts,{logEvent:this.logEvent});if(this.state.tid)return r.a.createElement("span",null,r.a.createElement(Qs,{tid:this.state.tid,qid:this.state.qid,selectQ:function(e){return t.setQ(!0,e)}}),r.a.createElement("button",{className:"btn btn-link",onClick:function(){return t.setQ(!0,t.state.qid)}},r.a.createElement("i",{className:"fa fa-btn fa-random"})));var a=this.questionTopics(e)[0]?this.questionTopics(e)[0]:{topic:"",level:0};return r.a.createElement("span",null,r.a.createElement(Ws,{tree:this.state.tree,topic:a.topic,setTopic:this.setTopic}),this.level(a.level-1)?r.a.createElement("button",{className:"btn btn-link",onClick:function(){return t.nextQ("-")}},r.a.createElement("i",{className:"fa fa-btn fa-minus-circle"})):null,"level ",a.level,this.level(a.level+1)?r.a.createElement("button",{className:"btn btn-link",onClick:function(){return t.nextQ("+")}},r.a.createElement("i",{className:"fa fa-btn fa-plus-circle"})):null,r.a.createElement("button",{className:"btn btn-link",onClick:function(){return t.nextQ()}},r.a.createElement("i",{className:"fa fa-btn fa-random"})))}},{key:"questionTopics",value:function(e){var t=this.props.fm.state.data.tests.questions;if((e=e||this.state.qid)&&!t[e])return console.error("questionTopics",e),[];if(null===e||!t[e].topics)return[];var a=t[e].topics.split(",")[0];return[{topic:a.substr(0,a.length-1),level:1*a.substr(a.length-1,1)}]}},{key:"level",value:function(e){return null===this.state.topic?$(this.state.tree.levels[e]):$(this.state.tree.topics[this.state.topic][e])}},{key:"questionOptions",value:function(e){var t=[],a=this.questionTopics()[0],s=a.topic,r=a.level;return":)"===e&&this.state.correct&&this.level(r+1)?r++:"+"===e&&this.level(r+1)?r++:":("!==e&&"-"!==e||!this.level(r-1)||r--,0===(t=this.state.correct&&null===this.state.topic?this.levelOptions(s,r):this.topicOptions(s,r)).length&&(t=this.levelOptions(null,r)),t}},{key:"setVars",value:function(e){return jt(D(e=e||this.state.qid).variables,this.state.log[e])}},{key:"nextQ",value:function(e){var t=this;if(this.state.tid)if(this.state.correct&&":|"!==e&&":("!==e){var a=B(this.state.tid),s=a.qs.find(function(e){return e&&e.qid==t.state.qid}).qn,r=a.qs[s+1]?a.qs[s+1].qid:null;this.setState({qid:r,tid:r?this.state.tid:null,vars:r?this.setVars(r):null,correct:null})}else this.setState({vars:this.setVars(),correct:null});else if(this.state.correct||":|"!==e&&":)"!==e)if(this.state.i){var n=Object.keys(this.state.qs);this.state.i>=n.length?this.setState({qid:null,vars:null,qs:null,i:0,correct:null,retry:0}):this.setState({qid:n[this.state.i],vars:JSON.parse(this.state.qs[n[this.state.i]].variables),i:this.state.i+1,retry:0,correct:null})}else{var l=this.chooseQ(this.questionOptions(e));l!==this.state.qid?this.setState({qid:l,correct:null,vars:this.setVars(l)}):this.setState({correct:null,vars:this.setVars()})}else this.setState({vars:this.setVars(),correct:null})}},{key:"render",value:function(){var e=this;return this.state.tree?this.state.qid?!0===this.state.edit?r.a.createElement(At,{fm:this.props.fm,qid:this.state.qid,vars:this.state.vars,close:function(){return e.setState({edit:!1})}}):r.a.createElement(R,{name:"question",close:function(){return e.setState({tid:null,qid:null,vars:null,qs:{},topic:null,correct:null})},title:this.questionSelect(this.state.q)},r.a.createElement("div",null,"See ",r.a.createElement(Dt,null,"@"+this.questionTopic(this.state.qid)),r.a.createElement("br",null),r.a.createElement("span",{style:{float:"right"}}),this.props.fm.state.user.isAdmin?r.a.createElement(L,{tooltip:this.state.qid},r.a.createElement("button",{className:"btn btn-link",style:{float:"right"}},r.a.createElement("i",{className:"fa fa-btn fa-edit",onClick:function(){return e.setState({edit:!0})}}))):null,r.a.createElement(xs,{qid:this.state.qid,vars:this.state.vars,logEvent:this.logEvent}))):r.a.createElement("div",null,this.props.fm.state.user.isAdmin?r.a.createElement(oa,{tree:this.state.tree,fm:this.props.fm,setQ:function(t,a){return e.setState({qid:t,edit:a})}}):null,this.state.log.corrections?r.a.createElement(U,{className:"btn btn-danger",tooltip:"Correct first",onClick:function(){return e.setQs(e.state.log.corrections)}},"Corrections"):null,r.a.createElement(U,{className:"btn btn-primary",tooltip:"Adaptive test and learn",onClick:function(){return e.setQ(!0)}},"Test"),"\xa0",r.a.createElement(Dt,null,"@instructions__home"),null===this.state.log?null:r.a.createElement(qs,{setQs:this.setQs,setTest:this.setTest,stats:this.state.log.stats})):null}}]),t}(s.Component),xs=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={help:!1,working:!1,correct:null},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.qid===this.props.qid&&e.vars===this.props.vars||(this.setState({help:!1,working:!1,correct:null}),e.qid&&e.logEvent("Q"))}},{key:"componentDidMount",value:function(){this.props.qid&&this.props.logEvent("Q")}},{key:"render",value:function(){var e=window.FreeMaths.state.data.tests.questions[this.props.qid];return r.a.createElement("div",{id:"Question_"+this.props.qid},r.a.createElement("div",{className:"PQ"},r.a.createElement(Dt,{vars:this.props.vars},e.question)),r.a.createElement(Cs,{qid:this.props.qid,vars:this.props.vars,logEvent:this.props.logEvent}))}}]),t}(s.Component),Cs=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={answer:"",hint:!1,show:!1,mark:null},a.hintShow=function(e,t){t.currentTarget.blur(),"hint"===e?(a.props.logEvent("Hint"),a.setState({keyboard:!1,hint:!0})):"show"===e&&(a.props.logEvent("Show"),a.setState({keyboard:!1,hint:!0,show:!0}))},a.mark=function(){var e=window.FreeMaths.state.data.tests.questions[a.props.qid].answer;if(a.state.answer.length>0){var t=Kt(a.state.answer,e,a.props.vars);a.props.logEvent(t.correct,a.state.answer),a.setState({mark:t})}else a.setState({mark:null})},a.logmark=function(e,t,s){a.props.log("M",s),a.setState({mark:{correct:"?\u2713",m:s}})},a.log=function(e,t,s,r){a.props.logEvent(e,s,r)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.qid===this.props.qid&&e.vars===this.props.vars||this.setState({answer:"",hint:!1,show:!1,mark:null})}},{key:"render",value:function(){var e=this,t=this.state.mark&&"\u2713"===this.state.mark.correct;return r.a.createElement("div",null,t?null:r.a.createElement(As,{hint:this.state.hint,show:this.state.show,hintShow:this.hintShow,mark:this.state.mark,change:this.props.change}),r.a.createElement(Fs,{answer:this.state.answer,mark:this.state.mark,vars:this.props.vars}),r.a.createElement(ks,{btn:"btn btn-default",c:"",qkey:(this.props.tid?this.props.tid:0)+":::"+this.props.qid}),t?null:r.a.createElement("div",null,this.state.show?null:r.a.createElement(ia,{answer:this.state.answer,mark:this.mark,change:function(t){return e.setState({answer:t})},qid:this.props.qid,vars:this.props.vars}),r.a.createElement(Ms,{qid:this.props.qid,vars:this.props.vars,hint:this.state.hint,show:this.state.show})))}}]),t}(s.Component),Ns=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return null===this.props.mark?null:"\u2713"===this.props.mark.correct?r.a.createElement("span",{className:"green"},"\u2713"):"?\u2713"===this.props.mark.correct?r.a.createElement("span",{className:"amber"},"\u2713"):"?\u2717"===this.props.mark.correct?r.a.createElement("span",{className:"amber"},"\u2717"):r.a.createElement("span",{className:"red"},"\u2717")}}]),t}(s.Component),_s=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={help:!1},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;if(!this.props.mark)return null;var t="amber";if("\u2713"===this.props.mark.correct?t="green":"\u2717"===this.props.mark.correct&&(t="red"),this.state.help){var a="Freemaths does its best to check your answer (re-arranging as needed).\n<g>\u2713</g> means your answer matched.\n<o>\u2713</o> means your answer is numerically correct but not as expected, can you simplify?\n<r>\u2717</r> means our tests suggest your answer is wrong (but the tests aren't perfect).\n";return"\u2713"!==this.props.mark.correct?(a+="\nHave you have provided the answer in exactly the format requested?\n<g>Green</g> terms are in the expected answer. <o>Amber</o> terms have a sign error. Check other terms carefully for calculation errors.",a+="\n\nUse <r>Show</r> to see a model answer and working."):a+="\nUse <g>Show</g> to see a model answer and working.",r.a.createElement(Wt,{title:"Marking Help",help:a,close:function(){return e.setState({help:!1})}})}return r.a.createElement(U,{className:"btn btn-default btn-sm "+t,onClick:function(){return e.setState({help:!0})},tooltip:"marking help"},"?")}}]),t}(s.Component),As=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=this.props.hint||null!==this.props.mark&&"\u2713"===this.props.mark.correct,a=null===this.props.mark?"red":"\u2713"===this.props.mark.correct?"green":"red";return r.a.createElement("span",null,t?null:r.a.createElement(U,{className:"btn btn-default amber",onClick:function(t){return e.props.hintShow("hint",t)},tooltip:"show hint"},"Hint"),this.props.show?null:r.a.createElement(U,{className:"btn btn-default "+a,onClick:function(t){return e.props.hintShow("show",t)},tooltip:"show answer"},"Show"))}}]),t}(s.Component),Ms=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,this.props.show?r.a.createElement("div",{name:"show",className:"box"},r.a.createElement(Dt,{vars:this.props.vars},D(this.props.qid).working)):null,this.props.show&&this.props.hint?r.a.createElement("br",null):null,this.props.hint?r.a.createElement("div",{name:"hint",className:"box"},r.a.createElement(Dt,{vars:this.props.vars},D(this.props.qid).help)):null)}}]),t}(s.Component),Ts=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={help:!1},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=null;if(!this.state.help)return r.a.createElement("div",{name:"rate"},r.a.createElement(U,{id:"rate",tooltip:"rate to move on",onClick:function(){return e.setState({help:!0})}},"Rate:"),r.a.createElement(U,{id:"FG",value:":)",className:"btn btn-default green",tooltip:"understood",onClick:function(){return e.props.logEvent(":)")}},cs[":)"]),r.a.createElement(U,{id:"FA",value:":|",className:"btn btn-default amber",tooltip:"practice needed",onClick:function(){return e.props.logEvent(":)")}},cs[":|"]),r.a.createElement(U,{id:"FR",value:":(",className:"btn btn-default red",tooltip:"help needed",onClick:function(){return e.props.logEvent(":)")}},cs[":("]),r.a.createElement("div",null,t));t=r.a.createElement(Qt,{topic:"rating",close:function(){return e.setState({help:!1})}})}}]),t}(s.Component),Fs=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.answer.replace(/^(-?)(\d+)(\u02fd| )(\d+\/\d+)$/,"$1{$2\u02fd$4}").replace(/\s/g,"");if(!e||""===e)return null;var t=this.props.mark,a=this.props.vars,s=null,n=null;return t&&t.attempt==this.props.answer?(s=r.a.createElement(Ns,{mark:t}),n="\u2713"===t.correct?r.a.createElement(Dt,{vars:a},e):r.a.createElement(Dt,{auto:!1},t.diff)):n=r.a.createElement(Dt,{vars:a},e),s?r.a.createElement("div",{name:"answer",className:"inline"},r.a.createElement("div",{className:"maths border"},n,s),this.props.hide?null:r.a.createElement(_s,{mark:t})):r.a.createElement("div",{className:"maths border inline"},n)}}]),t}(s.Component),Qs=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.tid!==this.props.tid||e.qid!==this.props.qid}},{key:"render",value:function(){var e=this,t=window.FreeMaths.state.data.tests.tests[this.props.tid],a=window.FreeMaths.state.data.tests.questions[this.props.qid];if(!t||!a)return null;var s=t.qs.map(function(e){return e?r.a.createElement("option",{value:e.qid,key:e.qid},e.qn):null});return r.a.createElement("span",null,"Question ",r.a.createElement("select",{value:this.props.qid,className:"btn btn-default",onChange:function(t){return e.props.selectQ(t.target.value)}},s)," of ",t.qs.length-1)}}]),t}(s.Component),Ws=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=[r.a.createElement("option",{key:0,value:"0"},"select")];return Object.keys(this.props.tree.topics).sort(function(e,t){return e.localeCompare(t)}).forEach(function(e){t.push(r.a.createElement("option",{key:e},e))}),r.a.createElement("form",{className:"form-horizontal inline"},r.a.createElement("select",{className:"form-control inline",style:{width:"auto"},value:this.props.topic,onChange:function(t){return e.props.setTopic(t.target.value)}},t))}}]),t}(s.Component),Ps=Ss,zs=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={tutor:["","","",""],remove:[],error:{}},a.tutor=function(e){e.preventDefault(),C("/react_ajax/tutor",function(e){if(e.error)a.setState({error:e.data});else{var t=a.props.fm.state.user;t.tutors=e.data.tutors,a.setState({tutor:["","","",""],remove:[],error:{added:e.data.added,removed:e.data.removed}}),a.props.fm.setState({user:t})}},{tutor:a.state.tutor,remove:a.state.remove,token:a.props.fm.state.user.token})},a.add=function(e,t){var s=a.state.tutor;s[e]=t,a.setState({tutor:s,error:{}})},a.remove=function(e){var t=a.state.remove,s=t.indexOf(e);-1!==s?t.splice(s,1):t.push(e),a.setState({remove:t,error:{}})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"button",value:function(){var e={style:"primary",text:"Add"};return this.state.remove.length>0&&(e.style="danger",this.state.tutor.join("")?e.text="Add & Remove":e.text="Remove"),e}},{key:"render",value:function(){var e=this;return r.a.createElement(x.a,{show:!0,onHide:this.props.close},r.a.createElement(x.a.Header,{closeButton:!0},r.a.createElement(x.a.Title,null,"Parents, Teachers & Tutors")),r.a.createElement(x.a.Body,null,this.state.error.added?r.a.createElement("div",{className:"alert alert-success"},r.a.createElement("strong",null,this.state.error.added," tutors added")):null,this.state.error.removed?r.a.createElement("div",{className:"alert alert-success"},r.a.createElement("strong",null,this.state.error.removed," tutors removed")):null,this.state.error.error?r.a.createElement("div",{className:"alert alert-danger"},r.a.createElement("strong",null,"Server Error: ",this.state.error.error)):null,r.a.createElement(E.a,{onSubmit:this.tutor,horizontal:!0},[1,2,3].map(function(t){return r.a.createElement(Ds,{key:t,i:t,email:e.state.tutor[t],error:e.state.error,add:e.add})}),r.a.createElement(y.a,null,r.a.createElement(g.a,{smOffset:3,sm:4},r.a.createElement(q.a,{bsStyle:this.button().style,type:"submit"},r.a.createElement("i",{className:"fa fa-mortar-board"})," ",this.button().text))),this.props.fm.state.user.tutors?r.a.createElement("div",null,r.a.createElement(y.a,null,this.props.fm.state.user.tutors.map(function(t){return r.a.createElement(g.a,{key:t.email,smOffset:3,sm:8},r.a.createElement(S.a,{value:!!e.state.remove[t.email]&&"checked",onChange:function(a){return e.remove(t.email)}},r.a.createElement("i",{className:"fa fa-trash"})," ",r.a.createElement("span",{className:"btn-link",onClick:function(){return e.props.fm.setState({email:t.email,modal:"contact"})}},t.name?t.name:t.email)))}))):null)))}}]),t}(s.Component),Ds=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(y.a,{controlId:"tutor"+this.props.i,validationState:this.props.error["tutor."+this.props.i]?"error":null},r.a.createElement(g.a,{componentClass:O.a,sm:3},"Tutor Email"),r.a.createElement(g.a,{sm:8},r.a.createElement(j.a,{type:"email",name:"email",value:this.props.email,placeholder:"Email",onChange:function(t){return e.props.add(e.props.i,t.target.value)}})),this.props.error["tutor."+this.props.i]?r.a.createElement(g.a,{smOffset:3,sm:8},r.a.createElement(w.a,null,this.props.error["tutor."+this.props.i])):null)}}]),t}(s.Component),Bs=zs,Hs=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={users:null,data:null,tables:null,past:!1,book:!1,diffs:null,lz:null,debug:null},a.send=function(){C("/react_ajax/update_data",function(e){e.error?a.props.fm.setState({message:{type:"danger",text:"Server Error: "+e.data.error}}):a.props.fm.setState({message:{type:"success",text:"Data updated"}})},{data:a.props.fm.state.data,lz:a.state.lz})},a.load=function(){C("/react_ajax/data",function(e){if(e.error)a.setState({message:{type:"danger",text:"Error: "+e.data.error}});else{var t=function(e){var t={},a={},s={},r={},n={};return e.tests.forEach(function(e){"book"===e.type?(function(e){e.book=JSON.parse(e.json),delete e.json,e.qmap={qs:{},q:{}},e.book.chapters.forEach(function(t){e.qmap.qs[t.chapter]={},e.qmap.q[t.chapter]={},t.exercises.forEach(function(a){var s=0;e.qmap.qs[t.chapter][a.exercise]=a.qs,e.qmap.q[t.chapter][a.exercise]={},a.qs.forEach(function(r){return e.qmap.q[t.chapter][a.exercise][r.q]=s++})})})}(e),r[e.id]=e):"past"===e.type?(function(e){e.test=JSON.parse(e.json),delete e.json,e.qs={},e.test.questions.forEach(function(t){return e.qs[t.q]=t})}(e),n[e.id]=e):"vars"===e.type&&(e.qs=[],t[e.id]=e)}),e.questions.forEach(function(e){a[e.id]=JSON.parse(e.json),a[e.id].id=e.id}),e.qmap.forEach(function(e){t[e.test_id].qs[e.number]={tid:e.test_id,qn:e.number,qid:e.question_id}}),e.help.forEach(function(e){s[e.title.toLowerCase().replace(/ /g,"_")]=e}),{tests:{tests:t,questions:a},books:r,past:n,help:s}}(e.data),s={};["tests","books","past","help"].forEach(function(e){var a=JSON.stringify(t[e]),r=T.a.compress(a,{outputEncoding:"Base64"});console.log(e,a.length,r.length),s[e]=r}),a.props.fm.setState({data:t,message:{type:"success",text:"Data loaded from DB"}}),a.setState({lz:s}),console.log("data loaded from DB")}})},a.compare=function(){var e={help:a.diff("help"),tests:a.diff("tests"),questions:a.diff("questions")};a.setState({diffs:e}),console.log("diffs",e)},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"diff",value:function(e){var t=this,a={};return Object.keys(this.state.data[e]).forEach(function(s){var r=t.props.fm.state.data[e][s],n=t.state.data[e][s];r&&n&&r.updated_at===n.updated_at||(a[s]={live:r,comp:n})}),Object.keys(this.props.fm.state.data[e]).forEach(function(s){var r=t.props.fm.state.data[e][s],n=t.state.data[e][s];r&&n&&r.updated_at===n.updated_at||a[s]||(a[s]={live:r,comp:n})}),a}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,this.state.message?r.a.createElement("div",{className:"alert alert-dismissible alert-"+this.state.message.type},r.a.createElement("button",{type:"button",onClick:function(){return e.setState({message:null})},className:"close","data-dismiss":"alert"},"\xd7"),r.a.createElement("strong",null,this.state.message.text)):null,r.a.createElement("span",{className:"btn-link",onClick:this.load},"Load Data"),r.a.createElement("br",null),this.state.lz?r.a.createElement("div",null,r.a.createElement("span",{className:"btn-link",onClick:this.compare},"Compare Data"),r.a.createElement("br",null),r.a.createElement(Is,{diffs:this.state.diffs,update:this.compare}),r.a.createElement("span",{className:"btn-link",onClick:this.send},"Send Data"),r.a.createElement("br",null)):null,r.a.createElement("br",null),r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({debug:!e.state.debug})}},"Debug"),this.state.debug?r.a.createElement(Rs,null):null,r.a.createElement("br",null),r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({users:!e.state.users})}},"Users"),this.state.users?r.a.createElement(Ls,{fm:this.props.fm}):null,r.a.createElement("br",null),r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({past:!e.state.past})}},"Past Papers"),this.state.past?r.a.createElement(Na,{close:function(){return e.setState({past:!1})},fm:this.props.fm}):null,r.a.createElement("br",null),r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({book:!e.state.book})}},"Books"),this.state.book?r.a.createElement(Ga,{close:function(){return e.setState({book:!1})},fm:this.props.fm}):null)}}]),t}(s.Component),Rs=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={debugs:F},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"set_debug",value:function(e){W(e),this.setState({debugs:F})}},{key:"render",value:function(){var e=this;if(this.state.debugs)return r.a.createElement("div",null,Object.keys(this.state.debugs).map(function(t){return r.a.createElement("span",{key:t,className:"btn-link",onClick:function(){e.set_debug(t)}},F[t].show?r.a.createElement("span",{className:"green"},t,":",F[t].n," "):r.a.createElement("span",null,t,":",F[t].n," "))}))}}]),t}(s.Component);var Is=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).update=function(e){var t=window.FreeMaths.state.data;t.tests[e.id]=e,window.FreeMaths.setState({data:t}),a.props.update(),C("/react_ajax/past",function(e){e.error?a.setState({error:e.data}):console.log("past",e.data.id)},{test:e.test,copy:e.updated_at})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return this.props.diffs?r.a.createElement("div",null,Object.keys(this.props.diffs.tests).map(function(t){var a=e.props.diffs.tests[t];return a.live?a.comp?new Date(a.live.updated_at.replace(" ","T")).getTime()>new Date(a.comp.updated_at.replace(" ","T")).getTime()?r.a.createElement("div",{key:t},"Local ",a.live.test.copy?"copy":"newer"," ",a.live.id," ",a.live.title," ",a.live.test.copy?a.live.test.copy:a.live.updated_at," (",a.comp.updated_at,")"):r.a.createElement("div",{key:t},"Remote newer ",a.comp.id," ",a.comp.title," ",a.comp.updated_at," (",a.live.updated_at,")",r.a.createElement("span",{className:"btn-link",onClick:function(){return e.update(a.comp)}},"update")):r.a.createElement("div",{key:t},"Extra ",a.comp.id," ",a.comp.title):r.a.createElement("div",{key:t},"Missing ",a.comp.id," ",a.comp.title," ",r.a.createElement("span",{className:"btn-link",onClick:function(){return e.update(a.comp)}},"update"))})):null}}]),t}(s.Component),Ls=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={users:null,sort:"login",error:{}},a.sort=function(e,t){switch(a.state.sort){case"login":return e.ts=new Date(e.updated_at.replace(" ","T")).getTime(),t.ts=new Date(t.updated_at.replace(" ","T")).getTime(),t.ts-e.ts;case"register":return e.ts=new Date(e.created_at.replace(" ","T")).getTime(),t.ts=new Date(t.created_at.replace(" ","T")).getTime(),t.ts-e.ts;case"name":return e.name.localeCompare(t.name);case"email":return e.email.localeCompare(t.email);default:return t[a.state.sort]-e[a.state.sort]}},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentWillMount",value:function(){var e=this;C("react_ajax/users",function(t){if(t.error)e.props.fm.setState({message:{type:"danger",text:t.data.error}});else{var a={0:{}};z(t.data.users).forEach(function(e){a[e.id]=e}),z(t.data.log).forEach(function(e){a[e.user_id].log=e.ts}),console.log("Users",a),e.setState({users:a})}})}},{key:"render",value:function(){var e=this;if(!this.state.users)return r.a.createElement("div",null,"loading...");console.log("Users",this.state.users,this.state.log);var t=["name","email","updated_at","created_at"],a=this.state.users.sort(this.sort).map(function(a){return r.a.createElement("tr",{key:a.id},r.a.createElement("td",null,a.id," ",r.a.createElement(qa,{uid:a.id,fm:e.props.fm})),t.map(function(e){return r.a.createElement("td",{key:e},a[e])}))});return r.a.createElement("table",{className:"table table-bordered table-condensed table-striped width-auto"},r.a.createElement("thead",null,r.a.createElement("tr",null,["id","name","email","login","register"].map(function(t){return r.a.createElement("th",{key:t},r.a.createElement("span",{className:"btn-link",onClick:function(){return e.setState({sort:t})}},t))}))),r.a.createElement("tbody",null,a))}}]),t}(s.Component),Us=Hs,Js=function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={user:null,students:null,log:null,data:null,page:"Home",modal:null,message:null,token:null,password:null,help:null},a.logout=function(){if(a.state.user.logout){var e=a.state.user;e.id=e.logout.id,e.name=e.logout.name,e.log=e.logout.log,e.token=e.logout.token,e.isAdmin=e.isTutor=!0,e.logout=null,a.setState({user:e,page:"Students",message:{type:"success",text:"Switched user to:"+e.name}})}else a.setState({user:null,page:null,message:null,password:!1}),C("/react_ajax/logout"),window.localStorage&&window.localStorage.removeItem("FMuser")},a.updateLog=function(e){Q("updateLog")&&console.log("updateLog(l)",e),C("/react_ajax/log_event",function(t){var s=null;t.error&&(s={type:"danger",text:"Working offline"});var r=a.state.user;t.data.log||(t.data.log={id:r.log.length?r.log[r.log.length-1].id+1:1,event:e.event,paper:e.paper,question:e.question,variables:JSON.stringify(e.vars),answer:e.answer?e.answer:"",comment:e.comment?e.comment:"",user_id:r.id}),r.log.push(t.data.log),a.setState({user:r,message:s})},{log:e})},a.saveQ=function(e){e&&C("/react_ajax/saveQ",function(e){if(console.log("saveQ",e),!e.error){var t=a.state.data;t.tests.questions[e.data.id]=e.data,a.setState({data:t,reload:!0})}},{question:e,token:a.state.user.token})},a}return Object(p.a)(t,e),Object(o.a)(t,[{key:"getStudents",value:function(e){var t=this;console.log("getStudents",e),C("/react_ajax/students",function(a){if(a.error)t.setState({message:{type:"danger",text:"Server Error: "+a.data.error}});else{var s={};a.data.users.forEach(function(e){s[e.id]=e}),t.setState({students:s,log:a.data.log}),console.log("getStudents",e,Object.keys(s).length)}},{all:e})}},{key:"componentWillMount",value:function(){var e=this;window.FreeMaths=this,["help","tests","books","past"].forEach(function(t){C(t+".lz",function(a){if(a.error)e.setState({message:{type:"danger",text:t+" Error: "+a.data.error}});else{var s=e.state.data?e.state.data:{};s[t]=z(a.data),e.setState({data:s})}})});var t=function(){var e=null;if(window.localStorage&&window.localStorage.FMuser)try{e=z(window.localStorage.getItem("FMuser"))}catch(t){console.error("failed to unzip user from localStorage",t),window.localStorage.removeItem("FMuser"),e=null}return e}();if(this.setState({user:t}),C("/react_ajax/user",function(a){a.error?e.setState({message:{type:"danger",text:"user Error: "+a.data.error}}):"password"===a.data?e.setState({password:!0}):a.data.id?e.setState({user:P(a.data,t)}):e.setState({user:null})},t?{id:t.id,token:t.token,lastLogId:t.log.length?t.log[t.log.length-1].id:0}:"null",t?t.token:null),window.location.search)if(window.location.search.startsWith("?reset="))this.setState({modal:"reset",token:window.location.search.substr(7)});else if(window.location.search.startsWith("?contact"))this.setState({modal:"contact"});else if(window.location.search.startsWith("?mail="))this.setState({modal:"mail",token:window.location.search.substr(6)});else if(window.location.search.startsWith("?Q")){var a=window.location.search.substr(2).split("&"),s=a[0],r=null;a.length>1&&(a.shift(),r={},a.forEach(function(e){e=decodeURIComponent(e).split("="),r[e[0]]=e[1]})),console.log("Q",s,r),this.setState({qid:s,vars:r})}window.history.pushState("object or string","Title","/")}},{key:"showPage",value:function(){if(null===this.state.user)return r.a.createElement(ee,{fm:this,app:-1!==window.location.href.indexOf("://app.")});if(!this.state.data||!this.state.data.help||!this.state.data.tests||!this.state.data.books||!this.state.data.past)return null;switch(this.state.page){case"Students":return r.a.createElement(Ea,{fm:this,students:!0});case"Past":return r.a.createElement(Ea,{type:"past",fm:this});case"Books":return r.a.createElement(Ea,{type:"book",fm:this});case"Admin":return r.a.createElement(Us,{fm:this});default:return r.a.createElement(Ps,{qid:this.state.qid,vars:this.state.vars,fm:this,reset:this.state.password})}}},{key:"showModal",value:function(){var e=this;switch(this.state.modal){case"contact":return r.a.createElement(Rt,{fm:this,close:function(t){return e.setState({modal:null,message:t||null})}});case"mail":return r.a.createElement(Lt,{fm:this,close:function(t){return e.setState({modal:null,message:t||null})}});case"register":return r.a.createElement(ne,{fm:this,close:function(){return e.setState({modal:null})}});case"update":return r.a.createElement(re,{fm:this,close:function(){return e.setState({modal:null})}});case"tutor":return r.a.createElement(Bs,{fm:this,close:function(){return e.setState({modal:null})}});case"forgot":return r.a.createElement(te,{fm:this,email:this.state.email,close:function(t){return e.setState({modal:null,message:t||null})}});case"reset":return r.a.createElement(ae,{fm:this,close:function(){return e.setState({modal:null})}});default:return null}}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement($s,{fm:this}),r.a.createElement("div",{id:"modalRoot"}),r.a.createElement("div",{id:"page",className:"container"},this.state.message?r.a.createElement("div",{name:"alert",className:"alert alert-dismissible alert-"+this.state.message.type},r.a.createElement("button",{type:"button",className:"close",onClick:function(){return e.setState({message:null})},"data-dismiss":"alert"},"\xd7"),r.a.createElement("strong",null,this.state.message.text)):null,this.showPage(),this.showModal(),this.state.password&&"mail"!==this.state.modal?r.a.createElement(se,{fm:this,close:function(){return e.setState({user:null,password:null})}}):null,this.state.help?r.a.createElement(Qt,{topic:this.state.help,close:function(){return e.setState({help:null})}}):null),this.state.token?r.a.createElement("span",{id:"debug",style:{display:"none"}},this.state.token):null)}}]),t}(s.Component),$s=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e,t=this;return e=null!==this.props.fm.state.user?r.a.createElement("div",null,r.a.createElement(m.a,{activeKey:this.props.fm.state.page},r.a.createElement(h.a,{id:"tests",eventKey:"Home",onClick:function(){return t.props.fm.setState({page:"Home",message:null})}},"Tests"),r.a.createElement(h.a,{id:"books",eventKey:"Books",onClick:function(){return t.props.fm.setState({page:"Books",message:null})}},"Books"),r.a.createElement(h.a,{id:"past",eventKey:"Past",onClick:function(){return t.props.fm.setState({page:"Past",message:null})}},"Past Papers")),r.a.createElement(m.a,{pullRight:!0},r.a.createElement(f.a,{title:this.props.fm.state.user.name,id:"user"},r.a.createElement(d.a,{id:"logout",eventKey:"logout",onSelect:this.props.fm.logout},r.a.createElement("i",{className:"fa fa-sign-out"})," Logout"),r.a.createElement(d.a,{id:"contact",eventKey:"contact",onSelect:function(){return t.props.fm.setState({modal:"contact",message:null})}},r.a.createElement("i",{className:"fa fa-envelope-o"})," Contact Us"),r.a.createElement(d.a,{id:"tutor",eventKey:"Tutor",onSelect:function(){return t.props.fm.setState({modal:"tutor",message:null})}},r.a.createElement("i",{className:"fa fa-mortar-board"})," Add Tutor"),r.a.createElement(d.a,{id:"update",eventKey:"Update",onSelect:function(){return t.props.fm.setState({modal:"update",message:null})}},r.a.createElement("i",{className:"fa fa-user"})," Update Details"),this.props.fm.state.user.isTutor?r.a.createElement(d.a,{id:"students",eventKey:"Students",onSelect:function(){return t.props.fm.setState({page:"Students",message:null})}},r.a.createElement("i",{className:"fa fa-group"})," Students"):null,this.props.fm.state.user.isAdmin?r.a.createElement(d.a,{id:"admin",eventKey:"Admin",onSelect:function(){return t.props.fm.setState({page:"Admin",message:null})}},r.a.createElement("i",{className:"fa fa-key"})," Admin"):null))):r.a.createElement("div",null,this.props.fm.state.data?r.a.createElement(m.a,null,r.a.createElement(h.a,{id:"about",eventKey:"about",onClick:function(){return t.props.fm.setState({help:"about"})}},"About")):null,r.a.createElement(m.a,{pullRight:!0},r.a.createElement(h.a,{id:"register",eventKey:"register",onClick:function(){return t.props.fm.setState({modal:"register",message:null})}},"Register"),r.a.createElement(h.a,{id:"contact",eventKey:"contact",onSelect:function(){return t.props.fm.setState({modal:"contact",message:null})}},"Contact Us"))),r.a.createElement("div",{id:"nav"},r.a.createElement(v.a,{collapseOnSelect:!0,fixedTop:!0},r.a.createElement(v.a.Header,null,r.a.createElement(v.a.Brand,null,r.a.createElement("a",{href:"http://ec2.freemaths.uk/"},"FreeMaths.uk")),r.a.createElement(v.a.Toggle,null)),r.a.createElement(v.a.Collapse,null,e)))}}]),t}(s.Component),Ks=Js,Vs=(a(217),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function Gs(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available; please refresh."),t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t.onSuccess&&t.onSuccess(e)))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}l.a.render(r.a.createElement(Ks,null),document.getElementById("root")),-1!==window.location.href.indexOf("://app.")?(console.log("service worker registered"),function(e){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("","/service-worker.js");Vs?(function(e,t){fetch(e).then(function(a){404===a.status||-1===a.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Gs(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):Gs(t,e)})}}()):(console.log("service worker unregistered"),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()}))}},[[123,2,1]]]);
//# sourceMappingURL=main.8d6bb022.chunk.js.map